{"version":3,"file":"index.min.js","sources":["../src/isprimitive.ts","../src/util.ts","../src/assetbrowser.ts","../src/reflect.ts","../src/createcostumelemet.ts","../src/CustomElementRegistry.ts","../node_modules/@masx200/dom-element-attribute-agent-proxy/src/index.ts","../src/dom.ts","../src/attrchange.ts","../node_modules/htm/dist/htm.module.js","../src/merge-entries.ts","../node_modules/lodash/isObject.js","../node_modules/lodash/_freeGlobal.js","../node_modules/lodash/_root.js","../node_modules/lodash/now.js","../node_modules/lodash/_Symbol.js","../node_modules/lodash/_getRawTag.js","../node_modules/lodash/_objectToString.js","../node_modules/lodash/_baseGetTag.js","../node_modules/lodash/isObjectLike.js","../node_modules/lodash/isSymbol.js","../node_modules/lodash/toNumber.js","../node_modules/lodash/debounce.js","../src/cached-map.ts","../src/reactivestate.ts","../src/VirtualElement.ts","../src/createelement.ts","../src/toArray.ts","../src/html.ts","../src/mount-real-element.ts","../src/isconnected.ts","../src/context-mounted-unmounted.ts","../src/watch.ts","../src/extend-directive.ts","../src/directives.ts","../src/iscomponent.ts","../src/handle-onevent.ts","../src/render-vdom-to-real.ts","../src/MountElement.ts","../src/readonlyproxy.ts","../src/computed.ts","../node_modules/@masx200/deep-observe-agent-proxy/src/index.ts","../src/createstate.ts","../src/handleobjectstate.ts","../src/parsecss-transformcss.ts","../src/cssurlblob.ts","../src/readysymbol.ts","../src/setimmediate.ts","../src/createComponent.ts","../src/element-onmount-unmount.ts","../src/conditon.ts","../src/model-input-textarea-value-directive-binding.ts","../src/createref.ts","../src/listmap.ts"],"sourcesContent":["import { isString, isnumber, isboolean, isundefined } from \"./util\";\r\nexport type Primitivetype = string | number | boolean | undefined | bigint;\r\nexport default function(a: any): a is Primitivetype {\r\n  return (\r\n    isString(a) ||\r\n    isnumber(a) ||\r\n    isboolean(a) ||\r\n    isundefined(a) ||\r\n    typeof a === \"bigint\"\r\n  );\r\n}\r\n","export function issymbol(a: any): a is symbol {\r\n  return typeof a === \"symbol\";\r\n  //||gettagtype(a) === \"symbol\";\r\n}\r\n\r\nexport { isplainobject };\r\nexport { isfunction as isFunction, isarray as isArray, isstring as isString };\r\nexport { isprimitive };\r\n\r\nconst isplainobject = (a: any): a is Record<any, any> =>\r\n  isobject(a) && gettagtype(a) === \"Object\";\r\n\r\nimport isprimitive from \"./isprimitive\";\r\n/* eslint-disable @typescript-eslint/explicit-function-return-type */\r\nexport function isundefined(a: any): a is void {\r\n  return (!a && a === void 0) || a === null;\r\n}\r\n\r\nexport function isnumber(a: any): a is number {\r\n  return typeof a === \"number\";\r\n}\r\nexport function isboolean(a: any): a is boolean {\r\n  return typeof a === \"boolean\";\r\n}\r\nexport function isobject(a: any): a is Exclude<object, Function> {\r\n  return typeof a === \"object\" && a !== null;\r\n}\r\n// export function isstring(a: string): true;\r\n// export function isstring(a): boolean;\r\nexport function isstring(a: any): a is string {\r\n  return typeof a === \"string\";\r\n}\r\nexport function isfunction(a: any): a is Function {\r\n  return typeof a === \"function\";\r\n}\r\n\r\nexport function isarray(a: any): a is Array<any> {\r\n  return a instanceof Array && Array.isArray(a) && gettagtype(a) === \"Array\";\r\n}\r\n/* export function getsymbol(a: string) {\r\n  return Symbol(a);\r\n} */\r\nexport function gettagtype(a: any): string {\r\n  return (\r\n    {}.toString\r\n      .call(a)\r\n      .replace(\"[object \", \"\")\r\n      .replace(\"]\", \"\")\r\n      //.toLowerCase()\r\n      .trim()\r\n  );\r\n}\r\n//export function ispromise(a: any): a is Promise<any> {\r\n//  return gettagtype(a) === \"promise\" && isFunction(get(a, \"then\"));\r\n//}\r\nexport function isSet(a: any): a is Set<any> {\r\n  return gettagtype(a) === \"Set\" && a instanceof Set;\r\n}\r\n\r\nconst camelizeRE = /-(\\w)/g;\r\nexport const camelize = (str: string): string => {\r\n  return str.replace(camelizeRE, (_, c) => (c ? c.toUpperCase() : \"\"));\r\n};\r\n\r\nconst hyphenateRE = /\\B([A-Z])/g;\r\nexport const hyphenate = (str: string): string => {\r\n  return str.replace(hyphenateRE, \"-$1\").toLowerCase();\r\n};\r\n","import { isfunction, isobject } from \"./util\";\r\nconst { HTMLElement, customElements, Proxy } = window;\r\nif (\r\n  !isfunction(HTMLElement) ||\r\n  //   typeof HTMLElement !== \"function\" ||\r\n  !isfunction(Proxy) ||\r\n  //   typeof Proxy !== \"function\" ||\r\n  !isobject(customElements)\r\n  /*||\r\n  //   typeof customElements !== \"object\" ||\r\n  !isfunction(window.CustomElementRegistry)\r\n  //||\r\n  //   typeof CustomElementRegistry !== \"function\"\r\n\r\n*/\r\n) {\r\n  console.error(\"Proxy,HTMLElement ,customElements ,browser not supported !\");\r\n  throw new TypeError();\r\n}\r\n","const Reflect = window.Reflect;\r\n// export default Reflect;\r\n\r\nexport const {\r\n  apply,\r\n  construct,\r\n  defineProperty,\r\n  deleteProperty,\r\n  get,\r\n  getOwnPropertyDescriptor,\r\n  getPrototypeOf,\r\n  has,\r\n\r\n  //   isExtensible,\r\n  ownKeys,\r\n  //   preventExtensions,\r\n  set\r\n  //   setPrototypeOf\r\n} = Reflect;\r\n// export {};\r\n/*\r\napply()\r\n对一个函数进行调用操作，同时可以传入一个数组作为调用参数。和 Function.prototype.apply() 功能类似。\r\nconstruct()\r\n对构造函数进行 new 操作，相当于执行 new target(...args)。\r\ndefineProperty()\r\n和 Object.defineProperty() 类似。\r\ndeleteProperty()\r\n作为函数的delete操作符，相当于执行 delete target[name]。\r\n//Reflect.enumerate()\r\n该方法会返回一个包含有目标对象身上所有可枚举的自身字符串属性以及继承字符串属性的迭代器，for...in 操作遍历到的正是这些属性。\r\nget()\r\n获取对象身上某个属性的值，类似于 target[name]。\r\ngetOwnPropertyDescriptor()\r\n类似于 Object.getOwnPropertyDescriptor()。\r\ngetPrototypeOf()\r\n类似于 Object.getPrototypeOf()。\r\nhas()\r\n判断一个对象是否存在某个属性，和 in 运算符 的功能完全相同。\r\nisExtensible()\r\n类似于 Object.isExtensible().\r\nownKeys()\r\n返回一个包含所有自身属性（不包含继承属性）的数组。(类似于 Object.keys(), 但不会受enumerable影响).\r\npreventExtensions()\r\n类似于 Object.preventExtensions()。返回一个Boolean。\r\nset()\r\n将值分配给属性的函数。返回一个Boolean，如果更新成功，则返回true。\r\nsetPrototypeOf()\r\n类似于 Object.setPrototypeOf()。\r\n*/\r\n","import { Class } from \"./customclass\";\r\n//import setlikearray from \"./setlikearay\";\r\n// const customElementsarray = new Set;\r\nimport RandomDefineCustomElement, {\r\n  invalid_custom_element_class\r\n} from \"./CustomElementRegistry\";\r\nimport { construct } from \"./reflect\";\r\n/* function getcustomelementname(initclass: any): string {\r\n  return customElements(initclass);\r\n} */\r\nimport { isfunction } from \"./util\";\r\n\r\nexport function isclassextendsHTMLElement(initclass: {\r\n  prototype: any;\r\n}): initclass is Class {\r\n  return !!(\r\n    isfunction(initclass) &&\r\n    initclass.prototype &&\r\n    initclass.prototype instanceof HTMLElement\r\n  );\r\n}\r\n\r\n// import Reflect from \"./reflect\";\r\n\r\n// import { Class } from \"./rendervdomtoreal\";\r\n\r\nexport function createcostumelemet(\r\n  initclass: Class | Function,\r\n  propsjson?: object,\r\n  children?: any[]\r\n  //   options?: any\r\n): HTMLElement {\r\n  if (isclassextendsHTMLElement(initclass)) {\r\n    // customElementsarray.push(initclass);\r\n    /*   const elementname =\r\n     getcustomelementname(initclass); */\r\n    /* if (customElements.get(elementname) === initclass) {\r\n    } else {\r\n      customElements.define(elementname, initclass);\r\n    } */\r\n    RandomDefineCustomElement(initclass);\r\n    return construct(initclass, [propsjson, children /* , options */]); // (children);\r\n  } else {\r\n    console.error(initclass);\r\n    console.error(invalid_custom_element_class);\r\n    throw TypeError();\r\n  }\r\n}\r\n","export const invalid_custom_element_class = \"invalid custom element class !\";\r\nimport { isclassextendsHTMLElement } from \"./createcostumelemet\";\r\nimport { get, getPrototypeOf, has, set } from \"./reflect\";\r\nimport { isobject } from \"./util\";\r\nif (\r\n  //   typeof Proxy !== \"function\" ||\r\n  !isobject(window.customElements) //||\r\n  //   typeof customElements !== \"object\" ||\r\n\r\n  //||\r\n  //   typeof CustomElementRegistry !== \"function\"\r\n) {\r\n  console.error(\" customElements  not supported !\");\r\n  throw new TypeError();\r\n}\r\n\r\nfunction Usevaluetoquerythekeyfromthetable(\r\n  table: object,\r\n  Componentstatusname: any\r\n): string | undefined {\r\n  const outputentrie = Object.entries(table).find(v => {\r\n    return v[1] === Componentstatusname;\r\n  });\r\n  return outputentrie ? outputentrie[0] : undefined;\r\n}\r\n\r\ninterface ElementDefinitionOptions {\r\n  extends?: string;\r\n}\r\nwindow.CustomElementRegistry = get(\r\n  getPrototypeOf(window.customElements),\r\n  \"constructor\"\r\n);\r\nconst elementset = Symbol.for(\"elementset\");\r\nconst elementmap = Symbol.for(\"elementmap\");\r\n\r\ninterface CustomElements extends CustomElementRegistry {\r\n  [elementset]: Set<Function>;\r\n  [elementmap]: Record<string, Function>;\r\n}\r\nconst { CustomElementRegistry } = window;\r\nconst customElements = window.customElements as CustomElements;\r\n// export default customElements;\r\n\r\nif (!has(customElements, elementset)) {\r\n  set(customElements, elementset, new Set());\r\n  //   customElements[elementset] = new Set();\r\n}\r\nif (!has(customElements, elementmap)) {\r\n  set(customElements, elementmap, {});\r\n  //   customElements[elementmap] = {};\r\n}\r\nexport default (initclass: Function, extendsname?: string) =>\r\n  RandomDefineCustomElement(initclass, extendsname);\r\n\r\nfunction RandomDefineCustomElement(\r\n  initclass: Function,\r\n  extendsname?: string,\r\n  length = 1\r\n): string | undefined {\r\n  if (!isclassextendsHTMLElement(initclass)) {\r\n    console.error(initclass);\r\n    console.error(invalid_custom_element_class);\r\n    throw TypeError();\r\n  }\r\n\r\n  //如果未注册自定义组件，则用随机名称注册，如果名称重复则重新生成新的随机名\r\n\r\n  if (!get(customElements, elementset).has(initclass)) {\r\n    const elementname = getrandomstringandnumber(length);\r\n\r\n    if (customElements.get(elementname)) {\r\n      return RandomDefineCustomElement(initclass, extendsname, length + 1);\r\n    } else {\r\n      if (extendsname) {\r\n        customElements.define(elementname, initclass, { extends: extendsname });\r\n      } else {\r\n        customElements.define(elementname, initclass);\r\n      }\r\n    }\r\n\r\n    return elementname;\r\n  } else {\r\n    return Usevaluetoquerythekeyfromthetable(\r\n      get(customElements, elementmap),\r\n      initclass\r\n    );\r\n  }\r\n\r\n  //如果已经注册自定义组件，则返回注册的名称\r\n}\r\n\r\n/* customElements.get = function name(name) {\r\n  return customElements[elementmap].get(name);\r\n};\r\n */\r\ncustomElements.define = function(\r\n  name: string,\r\n  constructor: Function,\r\n  options?: ElementDefinitionOptions\r\n): void {\r\n  if (!isclassextendsHTMLElement(constructor)) {\r\n    console.error(constructor);\r\n    console.error(invalid_custom_element_class);\r\n    throw TypeError();\r\n  }\r\n  if (!get(customElements, elementset).has(constructor)) {\r\n    if (has(customElements[elementmap], name)) {\r\n      /* 防止定义重名 */\r\n      RandomDefineCustomElement(\r\n        constructor,\r\n        options ? options.extends : undefined\r\n      );\r\n    } else {\r\n      CustomElementRegistry.prototype.define.call(\r\n        customElements,\r\n        name,\r\n        constructor,\r\n        options\r\n      );\r\n      customElements[elementset].add(constructor);\r\n      customElements[elementmap][name] = constructor;\r\n    }\r\n  }\r\n};\r\nset(customElements, Symbol.iterator, () => {\r\n  const entries = Object.entries(customElements[elementmap]);\r\n\r\n  return entries[Symbol.iterator].call(entries);\r\n});\r\n/* customElements[Symbol.iterator] = () => {\r\n  const entries = Object.entries(customElements[elementmap]);\r\n\r\n  return entries[Symbol.iterator].call(entries);\r\n}; */\r\n\r\nconst charactorlist = Array(26)\r\n  .fill(undefined)\r\n  .map((v, i) => 97 + i)\r\n  .map(n => String.fromCharCode(n));\r\n\r\nconst hexnumberlist = Array(16)\r\n  .fill(undefined)\r\n  .map((v, i) => i)\r\n  .map(a => a.toString(16));\r\n\r\nconst charactorandnumberlist = [\r\n  ...new Set([...hexnumberlist, ...charactorlist])\r\n];\r\n\r\nfunction getrandomcharactor() {\r\n  return get(\r\n    //  Array(26)\r\n    //  .fill(undefined)\r\n    //  .map((v, i) => 97 + i)\r\n    // .map(n => String.fromCharCode(n))\r\n    charactorlist,\r\n    Math.floor(Math.random() * charactorlist.length)\r\n  );\r\n}\r\nfunction getrandomhexnumberandcharactor() {\r\n  return get(\r\n    // Array(16)\r\n    //  .fill(undefined)\r\n    // .map((v, i) => i)\r\n    charactorandnumberlist,\r\n    Math.floor(Math.random() * charactorandnumberlist.length)\r\n  );\r\n\r\n  //.toString(16);\r\n}\r\nfunction getrandomstringandnumber(length = 1) {\r\n  return (\r\n    Array(length)\r\n      .fill(undefined)\r\n      .map(() => getrandomcharactor())\r\n\r\n      .join(\"\") +\r\n    \"-\" +\r\n    Array(length)\r\n      .fill(undefined)\r\n      .map(() => getrandomhexnumberandcharactor())\r\n      .join(\"\")\r\n  );\r\n}\r\n","/* const camelizeRE = /-(\\w)/g;\r\nconst camelize = (str: string): string => {\r\n  return str.replace(camelizeRE, (_, c) => (c ? c.toUpperCase() : \"\"));\r\n};\r\n */\r\nconst hyphenateRE = /\\B([A-Z])/g;\r\nconst hyphenate = (str: string): string => {\r\n  return str.replace(hyphenateRE, \"-$1\").toLowerCase();\r\n};\r\nconst String = window.String;\r\nconst Reflect = window.Reflect;\r\nconst { get, set, ownKeys } = Reflect;\r\nconst valuestring = \"value\";\r\nfunction isobject(a: any): a is Record<any, any> {\r\n  return typeof a === \"object\" && a !== null;\r\n}\r\nfunction isstring(a: any): a is string {\r\n  return typeof a === \"string\";\r\n}\r\nfunction isArray(a: any): a is Array<any> {\r\n  return Array.isArray(a);\r\n}\r\n\r\nfunction isSet(a: any): a is Set<any> {\r\n  return a instanceof Set;\r\n}\r\n\r\nconst isinputcheckbox = (\r\n  ele: HTMLElement | Element | SVGElement | HTMLInputElement\r\n) =>\r\n  \"input\" === geteletagname(ele) &&\r\n  (get(ele, \"type\") === \"checkbox\" || get(ele, \"type\") === \"radio\");\r\n\r\n//设置style对象时，先json深拷贝\r\nfunction objtostylestring(obj: object): string {\r\n  //style属性的驼峰转横杠\r\n\r\n  obj = JSON.parse(JSON.stringify(obj));\r\n\r\n  const objentries = Object.entries(obj).map(([key, value]) => [\r\n    hyphenate(key).trim(),\r\n    value\r\n  ]);\r\n\r\n  return objentries.map(([key, value]) => key + \":\" + value).join(\";\");\r\n}\r\nfunction asserthtmlelement(ele: any) {\r\n  if (!(ele instanceof Element)) {\r\n    console.error(ele);\r\n    console.error(\"invalid HTMLElement!\");\r\n    throw TypeError();\r\n  }\r\n}\r\nexport default function createeleattragentreadwrite(\r\n  ele: Element\r\n): Record<string, any> {\r\n  asserthtmlelement(ele);\r\n\r\n  var temp: Record<string, any> = Object.create(null);\r\n\r\n  const outputattrs: Record<string, any> = new Proxy(temp, {\r\n    ownKeys(/* target */) {\r\n      const isinputtextortextareaflag = isinputtextortextarea(ele);\r\n\r\n      const keys = attributesownkeys(ele);\r\n\r\n      return Array.from(\r\n        new Set(\r\n          [\r\n            ...keys,\r\n            isinputcheckbox(ele) ? \"checked\" : undefined,\r\n            isinputtextortextareaflag ? valuestring : undefined\r\n            //Array.from(new Set([...keys, valuestring]))\r\n            //  : keys\r\n          ]\r\n            .flat(Infinity)\r\n            .filter(a => !!a)\r\n        )\r\n      );\r\n    },\r\n    get(target, key) {\r\n      const isinputtextortextareaflag = isinputtextortextarea(ele);\r\n\r\n      if (isinputcheckbox(ele) && key === \"checked\") {\r\n        return get(ele, \"checked\");\r\n      }\r\n      if (isinputtextortextareaflag && key === valuestring) {\r\n        return get(ele, valuestring);\r\n      } else {\r\n        const v = getattribute(ele, String(key));\r\n        // ele.getAttribute(String(key));\r\n        //   console.log(v);\r\n        if (v === \"\") {\r\n          return true;\r\n        }\r\n        /* 修复属性空字符串返回不是true的bug问题 */\r\n        if (v === null) {\r\n          return;\r\n        }\r\n\r\n        //如果属性空字符串则返回true\r\n\r\n        if (isstring(v)) {\r\n          try {\r\n            return JSON.parse(String(v)); // v\r\n          } catch (error) {\r\n            return v;\r\n          }\r\n        } else return;\r\n      }\r\n    },\r\n    set(t, key, v) {\r\n      const isinputtextortextareaflag = isinputtextortextarea(ele);\r\n\r\n      //不允许设置属性为函数\r\n      if (\"function\" === typeof v) {\r\n        console.error(v);\r\n\r\n        console.error(\"Setting properties as functions is not allowed\");\r\n        throw TypeError();\r\n\r\n        // throw TypeError(\"不允许设置属性为函数\");\r\n      }\r\n      /* 对于input的checkbox设置 checked属性时,不添加属性,直接修改checked属性*/\r\n      if (geteletagname(ele) === \"input\" && key === \"checked\") {\r\n        set(ele, key, v);\r\n        return true;\r\n      }\r\n\r\n      if (isinputtextortextareaflag && key === valuestring) {\r\n        //设置元素的value属性,转成字符串\r\n        return set(ele, valuestring, String(v));\r\n      } else if (key === \"style\") {\r\n        const csstext = isstring(v)\r\n          ? v\r\n          : isobject(v)\r\n          ? objtostylestring(v)\r\n          : String(v);\r\n        //设置csstext可以删除注释\r\n        set(get(ele, \"style\"), \"cssText\", csstext.trim());\r\n        // ele.style.cssText = csstext.trim();\r\n\r\n        //    setattribute(\r\n        //      ele,\r\n        //       String(key),\r\n        //      isstring(v) ? v : isobject(v) ? objtostylestring(v) : String(v)\r\n        //     );\r\n        /*   ele.setAttribute(\r\n          String(key),\r\n          isstring(v) ? v : isobject(v) ? objtostylestring(v) : String(v)\r\n        ); */\r\n        return true;\r\n      } else if (key === \"class\" && isobject(v)) {\r\n        const classtext = isArray(v)\r\n          ? v.join(\" \")\r\n          : isSet(v)\r\n          ? [...v].join(\" \")\r\n          : String(v);\r\n\r\n        setattribute(ele, String(key), classtext);\r\n        return true;\r\n        /*  if (isArray(v)) {\r\n          setattribute(ele, String(key), v.join(\" \"));\r\n        } else if (isSet(v)) {\r\n          setattribute(ele, String(key), [...v].join(\" \"));\r\n        } else {\r\n          setattribute(ele, String(key), String(v));\r\n        }*/\r\n        //\r\n      } else {\r\n        /* 如果为false则删除attribute */\r\n\r\n        if (false === v || v === null || v === undefined) {\r\n          removeAttribute(ele, String(key));\r\n          return true;\r\n        }\r\n        //如果设置为true,则设置属性空字符串\r\n        if (isSet(v)) {\r\n          setattribute(ele, String(key), JSON.stringify([...v]));\r\n          return true;\r\n        } else {\r\n          if (v === true) {\r\n            v = \"\";\r\n          }\r\n\r\n          setattribute(\r\n            ele,\r\n            String(key),\r\n            isobject(v) ? JSON.stringify(v) : String(v)\r\n          );\r\n          /*  ele.setAttribute(\r\n          String(key),\r\n          isobject(v) ? JSON.stringify(v) : String(v)\r\n        ); */\r\n          return true;\r\n        }\r\n      }\r\n      //   return true;\r\n    },\r\n    deleteProperty(t, k) {\r\n      removeAttribute(ele, String(k));\r\n      // ele.removeAttribute(String(k));\r\n      return true;\r\n    },\r\n    has(target, key) {\r\n      return ownKeys(outputattrs).includes(key);\r\n      /*\r\nconst isinputtextortextareaflag = isinputtextortextarea(ele);\r\n  \r\n      if (isinputtextortextareaflag && key === valuestring) {\r\n        return true;\r\n      } else {\r\n        return hasAttribute(ele, String(key));\r\n\r\n        // ele.hasAttribute(String(key));\r\n      }\r\n\r\n*/\r\n    },\r\n    defineProperty() {\r\n      return false;\r\n    },\r\n    getOwnPropertyDescriptor(target, key) {\r\n      const otherdescipter = {\r\n        enumerable: true,\r\n        configurable: true,\r\n        writable: true\r\n      };\r\n      const myvalue: any = get(outputattrs, key);\r\n      if (typeof myvalue !== \"undefined\") {\r\n        return {\r\n          value: myvalue,\r\n          ...otherdescipter\r\n        };\r\n      } else {\r\n        return;\r\n      }\r\n\r\n      /*  if (isinputtextortextareaflag && key === valuestring) {\r\n        return {\r\n          value: get(ele, valuestring),\r\n          ...otherdescipter\r\n          //   enumerable: true,\r\n          //   configurable: true,\r\n          //   writable: true\r\n        };\r\n      } else {\r\n        const attr = getattribute(ele, String(key));\r\n        // ele.getAttribute(String(key));\r\n\r\n        //如果属性空字符串则返回true\r\n        let outvalue;\r\n        if (attr === \"\") {\r\n          outvalue = true;\r\n        }\r\n        if (outvalue) {\r\n          return {\r\n            value: outvalue,\r\n            ...otherdescipter\r\n            // enumerable: true,\r\n            // configurable: true,\r\n            // writable: true\r\n          };\r\n        } else {\r\n          return;\r\n        }\r\n      } */\r\n    },\r\n    setPrototypeOf() {\r\n      return false;\r\n    }\r\n    /*  setPrototypeOf() {\r\n      return false;\r\n    },\r\n    getPrototypeOf() {\r\n      return null;\r\n    }*/\r\n  });\r\n  return outputattrs;\r\n}\r\nfunction attributesownkeys(\r\n  ele: HTMLElement | Element | SVGElement | HTMLInputElement\r\n): string[] {\r\n  //   return ownKeys(ele.attributes).filter(k => !/\\d/.test(String(k)[0]));\r\n  return ele.getAttributeNames();\r\n}\r\nfunction getattribute(\r\n  ele: HTMLElement | Element | SVGElement | HTMLInputElement,\r\n  key: string\r\n) {\r\n  return ele.getAttribute(key);\r\n}\r\nfunction geteletagname(ele: Element /* { tagName: string } */) {\r\n  return ele.tagName.toLowerCase();\r\n}\r\nfunction setattribute(\r\n  ele: HTMLElement | Element | SVGElement | HTMLInputElement,\r\n  key: string,\r\n  value: string\r\n) {\r\n  return ele.setAttribute(key, value);\r\n}\r\nfunction removeAttribute(\r\n  ele: HTMLElement | Element | SVGElement | HTMLInputElement,\r\n  key: string\r\n) {\r\n  return ele.removeAttribute(key);\r\n}\r\n\r\n/* function hasAttribute(\r\n  ele: HTMLElement | Element | SVGElement | HTMLInputElement,\r\n  key: string\r\n) {\r\n  return ele.hasAttribute(key);\r\n}\r\n */\r\nfunction isinputtextortextarea(\r\n  ele: HTMLElement | Element | SVGElement | HTMLInputElement\r\n) {\r\n  const tagname = geteletagname(ele);\r\n  return (\r\n    tagname === \"textarea\" ||\r\n    tagname === \"select\" ||\r\n    (tagname === \"input\" && get(ele, \"type\") === \"text\")\r\n\r\n    /* 添加select元素 */\r\n  );\r\n}\r\n","const document = window.document;\r\n//import { seteletext, setelehtml } from \"./directives\";\r\n//export { seteletext, setelehtml };\r\n\r\nexport function seteletext(e: Element | Node, v: string) {\r\n  e.textContent = v;\r\n}\r\nexport function setelehtml(e: Element, v: string) {\r\n  e.innerHTML = v;\r\n}\r\nexport function appendchild(\r\n  container: HTMLElement | SVGSVGElement | SVGElement | Element | Node,\r\n  ele: HTMLElement | SVGElement | Element | Node\r\n) {\r\n  container.appendChild(ele);\r\n}\r\nexport function createsvgelement() {\r\n  return createElementNS(svgnamespace, \"svg\");\r\n}\r\nexport function createnonescript() {\r\n  return createDocumentFragment();\r\n}\r\nexport function createDocumentFragment() {\r\n  return document.createDocumentFragment();\r\n}\r\nexport function createnativeelement(type: string) {\r\n  return document.createElement(type);\r\n}\r\nexport function createElementNS(namespace: string, name: string) {\r\n  return document.createElementNS(namespace, name);\r\n}\r\nexport function createtextnode(data: string | number) {\r\n  return document.createTextNode(String(data));\r\n}\r\nexport const svgnamespace = \"http://www.w3.org/2000/svg\";\r\nexport function changetext(textnode: Text, value: string) {\r\n  textnode.nodeValue = String(value);\r\n}\r\nexport default document;\r\n\r\nexport const mathnamespace = \"http://www.w3.org/1998/Math/MathML\";\r\n\r\nexport function createmathelement() {\r\n  return createElementNS(mathnamespace, \"math\");\r\n}\r\nexport function createComment() {\r\n  return document.createComment(\"\");\r\n}\r\nexport function removeNode(node: Element | Node) {\r\n  let parentNode = node.parentNode;\r\n  if (parentNode) {\r\n    parentNode.removeChild(node);\r\n  }\r\n}\r\nexport function replaceChild(newChild: Node, oldChild: Node) {\r\n  let parentNode = oldChild.parentNode;\r\n  if (parentNode) {\r\n    parentNode.replaceChild(newChild, oldChild);\r\n  }\r\n}\r\n\r\nexport function domaddlisten(\r\n  ele: Element | Node,\r\n  event: string,\r\n  call: EventListener\r\n) {\r\n  ele.addEventListener(event, call);\r\n}\r\n\r\nexport function domremovelisten(\r\n  ele: Element | Node,\r\n  event: string,\r\n  call: EventListener\r\n) {\r\n  ele.removeEventListener(event, call);\r\n}\r\nexport function getdomchildren(ele: Element | Node) {\r\n  return [...ele.childNodes];\r\n}\r\nexport function getAttribute(ele: Element, name: string) {\r\n  return HTMLElementprototype.getAttribute.call(ele, name);\r\n}\r\nexport function setAttribute(ele: Element, name: string, value: any) {\r\n  HTMLElementprototype.setAttribute.call(ele, name, value);\r\n}\r\nexport function removeAttribute(ele: Element, name: string) {\r\n  HTMLElementprototype.removeAttribute.call(ele, name);\r\n}\r\nconst HTMLElementprototype = HTMLElement.prototype;\r\n\r\nexport function insertfirst(\r\n  container: HTMLElement | Element,\r\n  ele: HTMLElement\r\n) {\r\n  container.insertBefore(ele, container.firstChild);\r\n}\r\nexport function createanotherhtmldocument() {\r\n  return document.implementation.createHTMLDocument(\"\");\r\n}\r\n/* export function getparentNode(ele: Node): Node {\r\n  return ele.parentNode ? ele.parentNode : ele;\r\n}\r\n */\r\nexport function querySelectorAll(selector: string) {\r\n  return [...document.querySelectorAll(selector)];\r\n}\r\n","import createeleattragentreadwrite from \"@masx200/dom-element-attribute-agent-proxy\";\r\nimport { getAttribute, removeAttribute, setAttribute } from \"./dom\";\r\nimport { get } from \"./reflect\";\r\nimport { isFunction, isobject } from \"./util\";\r\nexport const attributeChangedCallback = \"attributeChangedCallback\";\r\nexport class AttrChange extends HTMLElement {\r\n  // [attributessymbol]: Record<string, ReactiveState<any>>;\r\n  constructor() {\r\n    super();\r\n    const defaultProps = get(this.constructor, \"defaultProps\");\r\n    // this.constructor[\"defaultProps\"];\r\n    const attrs: Record<string, any> = createeleattragentreadwrite(this);\r\n    //   const props = {};\r\n    if (isobject(defaultProps)) {\r\n      /*     if (!this[attributessymbol]) {\r\n        this[attributessymbol] = {};\r\n      } */\r\n      Object.assign(attrs, defaultProps);\r\n      // Object.assign(props, this.constructor[\"defaultProps\"]);\r\n    }\r\n  }\r\n  //   [attributeChangedCallback](name?: string): void;\r\n  // prototype!: HTMLElement;\r\n  /*  defaultProps?: { [key: string]: any } | undefined;\r\n  css?: string | undefined; */\r\n  /* constructor() {\r\n    super();\r\n  } */\r\n\r\n  /* 跟seteletext发生冲突,清空children */\r\n  //   get textContent() {\r\n  //     return String(super.textContent || \"\");\r\n  //   }\r\n  //   set textContent(_a: string) {\r\n  //     console.trace();\r\n  //     // return;\r\n  //   }\r\n  //   get innerHTML() {\r\n  //     return super.innerHTML;\r\n  //   }\r\n  //   set innerHTML(_a: string) {\r\n  //     // return;\r\n  //   }\r\n  //   get innerText() {\r\n  //     return super.innerText;\r\n  //   }\r\n  //   set innerText(_a: string) {\r\n  //     // return;\r\n  //   }\r\n  // [attributeChangedCallback](\r\n  //   name: string\r\n\r\n  /* _name?: any, _oldValue?: any, _newValue?: any */\r\n  // ) {\r\n  //   noop(name);\r\n  //\r\n  //  }\r\n  /* constructor() {\r\n    super();\r\n  } */\r\n\r\n  //禁止设置innerhtml，innertext，textcontent\r\n  /* disconnectedCallback() {\r\n  console.log('Custom square element removed from page.');\r\n} */\r\n  /* connectedCallback() {\r\n  console.log('Custom square element added to page.');\r\n  updateStyle(this);\r\n} */\r\n  //\r\n  //   connectedCallback(){}\r\n  /* attributeChangedCallback(name, oldValue, newValue) {\r\n  console.log('Custom square element attributes changed.');\r\n  updateStyle(this);\r\n} */\r\n  setAttribute(qualifiedName: string, value: string) {\r\n    const callback = get(this, attributeChangedCallback);\r\n    const oldValue = getAttribute(this, qualifiedName);\r\n    // super.getAttribute(qualifiedName);\r\n\r\n    if (oldValue !== value) {\r\n      setAttribute(this, qualifiedName, value);\r\n      //   super.setAttribute(qualifiedName, value);\r\n      if (\r\n        isFunction(\r\n          callback\r\n          // this[attributeChangedCallback]\r\n        )\r\n      ) {\r\n        // setimmediate(() => {\r\n        callback.call(this, qualifiedName, oldValue, value);\r\n        // });\r\n      }\r\n    }\r\n  }\r\n  removeAttribute(qualifiedName: string) {\r\n    const callback = get(this, attributeChangedCallback);\r\n    const oldValue = getAttribute(this, qualifiedName);\r\n\r\n    if (null !== oldValue) {\r\n      //   super.removeAttribute(qualifiedName);\r\n      removeAttribute(this, qualifiedName);\r\n      if (isFunction(callback)) {\r\n        // setimmediate(() => {\r\n        callback.call(this, qualifiedName, oldValue, undefined);\r\n        // });\r\n      }\r\n    }\r\n  }\r\n}\r\n","var n=function(t,r,u,e){for(var p=1;p<r.length;p++){var s=r[p],h=\"number\"==typeof s?u[s]:s,a=r[++p];1===a?e[0]=h:3===a?e[1]=Object.assign(e[1]||{},h):5===a?(e[1]=e[1]||{})[r[++p]]=h:6===a?e[1][r[++p]]+=h+\"\":e.push(a?t.apply(null,n(t,h,u,[\"\",null])):h)}return e},t=function(n){for(var t,r,u=1,e=\"\",p=\"\",s=[0],h=function(n){1===u&&(n||(e=e.replace(/^\\s*\\n\\s*|\\s*\\n\\s*$/g,\"\")))?s.push(n||e,0):3===u&&(n||e)?(s.push(n||e,1),u=2):2===u&&\"...\"===e&&n?s.push(n,3):2===u&&e&&!n?s.push(!0,5,e):u>=5&&((e||!n&&5===u)&&(s.push(e,u,r),u=6),n&&(s.push(n,u,r),u=6)),e=\"\"},a=0;a<n.length;a++){a&&(1===u&&h(),h(a));for(var f=0;f<n[a].length;f++)t=n[a][f],1===u?\"<\"===t?(h(),s=[s],u=3):e+=t:4===u?\"--\"===e&&\">\"===t?(u=1,e=\"\"):e=t+e[0]:p?t===p?p=\"\":e+=t:'\"'===t||\"'\"===t?p=t:\">\"===t?(h(),u=1):u&&(\"=\"===t?(u=5,r=e,e=\"\"):\"/\"===t&&(u<5||\">\"===n[a][f+1])?(h(),3===u&&(s=s[0]),u=s,(s=s[0]).push(u,2),u=0):\" \"===t||\"\\t\"===t||\"\\n\"===t||\"\\r\"===t?(h(),u=2):e+=t),3===u&&\"!--\"===e&&(u=4,s=s[0])}return h(),s},r=\"function\"==typeof Map,u=r?new Map:{},e=r?function(n){var r=u.get(n);return r||u.set(n,r=t(n)),r}:function(n){for(var r=\"\",e=0;e<n.length;e++)r+=n[e].length+\"-\"+n[e];return u[r]||(u[r]=t(n))};export default function(t){var r=n(this,e(t),arguments,[]);return r.length>1?r:r[0]}\n","/* \r\n        \r\n        [[\"value\",[\"f\",\"f\"]],[\"value\",[\"f\",\"f\"]]]\r\n\r\n\r\n        [[\"value\",[\"f\",\"f\",\"f\",\"f\"]]]\r\n        \r\n        */\r\nexport function merge_entries(\r\n  a: [string, any][] /* Array<[any, Array<any>]> */\r\n): [string, any][] {\r\n  const m: { [s: string]: Set<any> } = {};\r\n\r\n  a.forEach(([key, value]) => {\r\n    if (!m[key]) {\r\n      m[key] = new Set();\r\n    }\r\n    // m[key] && (m[key] = new Set());\r\n\r\n    value.forEach((v: any) => {\r\n      m[key].add(v);\r\n    });\r\n  });\r\n  return Object.entries(m).map(([k, v]) => [k, [...v]]);\r\n}\r\n","/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\nfunction isObject(value) {\n  var type = typeof value;\n  return value != null && (type == 'object' || type == 'function');\n}\n\nmodule.exports = isObject;\n","/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\nmodule.exports = freeGlobal;\n","var freeGlobal = require('./_freeGlobal');\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\nmodule.exports = root;\n","var root = require('./_root');\n\n/**\n * Gets the timestamp of the number of milliseconds that have elapsed since\n * the Unix epoch (1 January 1970 00:00:00 UTC).\n *\n * @static\n * @memberOf _\n * @since 2.4.0\n * @category Date\n * @returns {number} Returns the timestamp.\n * @example\n *\n * _.defer(function(stamp) {\n *   console.log(_.now() - stamp);\n * }, _.now());\n * // => Logs the number of milliseconds it took for the deferred invocation.\n */\nvar now = function() {\n  return root.Date.now();\n};\n\nmodule.exports = now;\n","var root = require('./_root');\n\n/** Built-in value references. */\nvar Symbol = root.Symbol;\n\nmodule.exports = Symbol;\n","var Symbol = require('./_Symbol');\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * A specialized version of `baseGetTag` which ignores `Symbol.toStringTag` values.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the raw `toStringTag`.\n */\nfunction getRawTag(value) {\n  var isOwn = hasOwnProperty.call(value, symToStringTag),\n      tag = value[symToStringTag];\n\n  try {\n    value[symToStringTag] = undefined;\n    var unmasked = true;\n  } catch (e) {}\n\n  var result = nativeObjectToString.call(value);\n  if (unmasked) {\n    if (isOwn) {\n      value[symToStringTag] = tag;\n    } else {\n      delete value[symToStringTag];\n    }\n  }\n  return result;\n}\n\nmodule.exports = getRawTag;\n","/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/**\n * Converts `value` to a string using `Object.prototype.toString`.\n *\n * @private\n * @param {*} value The value to convert.\n * @returns {string} Returns the converted string.\n */\nfunction objectToString(value) {\n  return nativeObjectToString.call(value);\n}\n\nmodule.exports = objectToString;\n","var Symbol = require('./_Symbol'),\n    getRawTag = require('./_getRawTag'),\n    objectToString = require('./_objectToString');\n\n/** `Object#toString` result references. */\nvar nullTag = '[object Null]',\n    undefinedTag = '[object Undefined]';\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * The base implementation of `getTag` without fallbacks for buggy environments.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the `toStringTag`.\n */\nfunction baseGetTag(value) {\n  if (value == null) {\n    return value === undefined ? undefinedTag : nullTag;\n  }\n  return (symToStringTag && symToStringTag in Object(value))\n    ? getRawTag(value)\n    : objectToString(value);\n}\n\nmodule.exports = baseGetTag;\n","/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return value != null && typeof value == 'object';\n}\n\nmodule.exports = isObjectLike;\n","var baseGetTag = require('./_baseGetTag'),\n    isObjectLike = require('./isObjectLike');\n\n/** `Object#toString` result references. */\nvar symbolTag = '[object Symbol]';\n\n/**\n * Checks if `value` is classified as a `Symbol` primitive or object.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a symbol, else `false`.\n * @example\n *\n * _.isSymbol(Symbol.iterator);\n * // => true\n *\n * _.isSymbol('abc');\n * // => false\n */\nfunction isSymbol(value) {\n  return typeof value == 'symbol' ||\n    (isObjectLike(value) && baseGetTag(value) == symbolTag);\n}\n\nmodule.exports = isSymbol;\n","var isObject = require('./isObject'),\n    isSymbol = require('./isSymbol');\n\n/** Used as references for various `Number` constants. */\nvar NAN = 0 / 0;\n\n/** Used to match leading and trailing whitespace. */\nvar reTrim = /^\\s+|\\s+$/g;\n\n/** Used to detect bad signed hexadecimal string values. */\nvar reIsBadHex = /^[-+]0x[0-9a-f]+$/i;\n\n/** Used to detect binary string values. */\nvar reIsBinary = /^0b[01]+$/i;\n\n/** Used to detect octal string values. */\nvar reIsOctal = /^0o[0-7]+$/i;\n\n/** Built-in method references without a dependency on `root`. */\nvar freeParseInt = parseInt;\n\n/**\n * Converts `value` to a number.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to process.\n * @returns {number} Returns the number.\n * @example\n *\n * _.toNumber(3.2);\n * // => 3.2\n *\n * _.toNumber(Number.MIN_VALUE);\n * // => 5e-324\n *\n * _.toNumber(Infinity);\n * // => Infinity\n *\n * _.toNumber('3.2');\n * // => 3.2\n */\nfunction toNumber(value) {\n  if (typeof value == 'number') {\n    return value;\n  }\n  if (isSymbol(value)) {\n    return NAN;\n  }\n  if (isObject(value)) {\n    var other = typeof value.valueOf == 'function' ? value.valueOf() : value;\n    value = isObject(other) ? (other + '') : other;\n  }\n  if (typeof value != 'string') {\n    return value === 0 ? value : +value;\n  }\n  value = value.replace(reTrim, '');\n  var isBinary = reIsBinary.test(value);\n  return (isBinary || reIsOctal.test(value))\n    ? freeParseInt(value.slice(2), isBinary ? 2 : 8)\n    : (reIsBadHex.test(value) ? NAN : +value);\n}\n\nmodule.exports = toNumber;\n","var isObject = require('./isObject'),\n    now = require('./now'),\n    toNumber = require('./toNumber');\n\n/** Error message constants. */\nvar FUNC_ERROR_TEXT = 'Expected a function';\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeMax = Math.max,\n    nativeMin = Math.min;\n\n/**\n * Creates a debounced function that delays invoking `func` until after `wait`\n * milliseconds have elapsed since the last time the debounced function was\n * invoked. The debounced function comes with a `cancel` method to cancel\n * delayed `func` invocations and a `flush` method to immediately invoke them.\n * Provide `options` to indicate whether `func` should be invoked on the\n * leading and/or trailing edge of the `wait` timeout. The `func` is invoked\n * with the last arguments provided to the debounced function. Subsequent\n * calls to the debounced function return the result of the last `func`\n * invocation.\n *\n * **Note:** If `leading` and `trailing` options are `true`, `func` is\n * invoked on the trailing edge of the timeout only if the debounced function\n * is invoked more than once during the `wait` timeout.\n *\n * If `wait` is `0` and `leading` is `false`, `func` invocation is deferred\n * until to the next tick, similar to `setTimeout` with a timeout of `0`.\n *\n * See [David Corbacho's article](https://css-tricks.com/debouncing-throttling-explained-examples/)\n * for details over the differences between `_.debounce` and `_.throttle`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to debounce.\n * @param {number} [wait=0] The number of milliseconds to delay.\n * @param {Object} [options={}] The options object.\n * @param {boolean} [options.leading=false]\n *  Specify invoking on the leading edge of the timeout.\n * @param {number} [options.maxWait]\n *  The maximum time `func` is allowed to be delayed before it's invoked.\n * @param {boolean} [options.trailing=true]\n *  Specify invoking on the trailing edge of the timeout.\n * @returns {Function} Returns the new debounced function.\n * @example\n *\n * // Avoid costly calculations while the window size is in flux.\n * jQuery(window).on('resize', _.debounce(calculateLayout, 150));\n *\n * // Invoke `sendMail` when clicked, debouncing subsequent calls.\n * jQuery(element).on('click', _.debounce(sendMail, 300, {\n *   'leading': true,\n *   'trailing': false\n * }));\n *\n * // Ensure `batchLog` is invoked once after 1 second of debounced calls.\n * var debounced = _.debounce(batchLog, 250, { 'maxWait': 1000 });\n * var source = new EventSource('/stream');\n * jQuery(source).on('message', debounced);\n *\n * // Cancel the trailing debounced invocation.\n * jQuery(window).on('popstate', debounced.cancel);\n */\nfunction debounce(func, wait, options) {\n  var lastArgs,\n      lastThis,\n      maxWait,\n      result,\n      timerId,\n      lastCallTime,\n      lastInvokeTime = 0,\n      leading = false,\n      maxing = false,\n      trailing = true;\n\n  if (typeof func != 'function') {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  wait = toNumber(wait) || 0;\n  if (isObject(options)) {\n    leading = !!options.leading;\n    maxing = 'maxWait' in options;\n    maxWait = maxing ? nativeMax(toNumber(options.maxWait) || 0, wait) : maxWait;\n    trailing = 'trailing' in options ? !!options.trailing : trailing;\n  }\n\n  function invokeFunc(time) {\n    var args = lastArgs,\n        thisArg = lastThis;\n\n    lastArgs = lastThis = undefined;\n    lastInvokeTime = time;\n    result = func.apply(thisArg, args);\n    return result;\n  }\n\n  function leadingEdge(time) {\n    // Reset any `maxWait` timer.\n    lastInvokeTime = time;\n    // Start the timer for the trailing edge.\n    timerId = setTimeout(timerExpired, wait);\n    // Invoke the leading edge.\n    return leading ? invokeFunc(time) : result;\n  }\n\n  function remainingWait(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime,\n        timeWaiting = wait - timeSinceLastCall;\n\n    return maxing\n      ? nativeMin(timeWaiting, maxWait - timeSinceLastInvoke)\n      : timeWaiting;\n  }\n\n  function shouldInvoke(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime;\n\n    // Either this is the first call, activity has stopped and we're at the\n    // trailing edge, the system time has gone backwards and we're treating\n    // it as the trailing edge, or we've hit the `maxWait` limit.\n    return (lastCallTime === undefined || (timeSinceLastCall >= wait) ||\n      (timeSinceLastCall < 0) || (maxing && timeSinceLastInvoke >= maxWait));\n  }\n\n  function timerExpired() {\n    var time = now();\n    if (shouldInvoke(time)) {\n      return trailingEdge(time);\n    }\n    // Restart the timer.\n    timerId = setTimeout(timerExpired, remainingWait(time));\n  }\n\n  function trailingEdge(time) {\n    timerId = undefined;\n\n    // Only invoke if we have `lastArgs` which means `func` has been\n    // debounced at least once.\n    if (trailing && lastArgs) {\n      return invokeFunc(time);\n    }\n    lastArgs = lastThis = undefined;\n    return result;\n  }\n\n  function cancel() {\n    if (timerId !== undefined) {\n      clearTimeout(timerId);\n    }\n    lastInvokeTime = 0;\n    lastArgs = lastCallTime = lastThis = timerId = undefined;\n  }\n\n  function flush() {\n    return timerId === undefined ? result : trailingEdge(now());\n  }\n\n  function debounced() {\n    var time = now(),\n        isInvoking = shouldInvoke(time);\n\n    lastArgs = arguments;\n    lastThis = this;\n    lastCallTime = time;\n\n    if (isInvoking) {\n      if (timerId === undefined) {\n        return leadingEdge(lastCallTime);\n      }\n      if (maxing) {\n        // Handle invocations in a tight loop.\n        clearTimeout(timerId);\n        timerId = setTimeout(timerExpired, wait);\n        return invokeFunc(lastCallTime);\n      }\n    }\n    if (timerId === undefined) {\n      timerId = setTimeout(timerExpired, wait);\n    }\n    return result;\n  }\n  debounced.cancel = cancel;\n  debounced.flush = flush;\n  return debounced;\n}\n\nmodule.exports = debounce;\n","import { Htmlelementconstructor } from \"./createComponent\";\r\nimport { CallbackReactiveState } from \"./watch\";\r\n\r\nexport const cached_callback_eventlistner = new Map<Function, EventListener>();\r\nexport const cached_create_componet = new Map<\r\n  Function,\r\n  Htmlelementconstructor\r\n>();\r\nexport const cached_callback_debounced_watchs = new Map<\r\n  CallbackReactiveState,\r\n  Function\r\n>();\r\n","import debounce from \"lodash/debounce\";\r\nimport { cached_callback_eventlistner } from \"./cached-map\";\r\n// import Reflect from \"./reflect\";\r\nimport isprimitive, { Primitivetype } from \"./isprimitive\";\r\nimport { gettagtype, isobject, isSet } from \"./util\";\r\nimport { UnwrapedState } from \"./watch\";\r\nimport { defineProperty } from \"./reflect\";\r\nexport const addonelistner = Symbol(\"addonelistner\");\r\nexport const removeonelistner = Symbol(\"removeonelistner\");\r\n// import { Primitive } from 'lodash';\r\n// export const callbackmap = Symbol(\"callbackmap\");\r\nexport const cancelsubscribe = Symbol(\"cancelsubscribe\");\r\nconst debouncedispatch = Symbol(\"debouncedispatch\");\r\nexport const invalid_primitive_or_object_state =\r\n  \"invalid primitive or object state\";\r\nexport function isReactiveState(a: any): a is ReactiveState<any> {\r\n  return a instanceof ReactiveState && gettagtype(a) === \"ReactiveState\";\r\n}\r\n// export const textnodesymbol = Symbol(\"textnode\");\r\nexport const changetextnodesymbol = Symbol(\"changetextnode\");\r\nexport const eventtargetsymbol = Symbol(\"eventtatget\");\r\nexport const memlisteners = Symbol(\"memlisteners\");\r\nexport const dispatchsymbol = Symbol(\"dispatch\");\r\nexport const subscribesymbol = Symbol(\"subscribe\");\r\nexport const removeallistenerssymbol = Symbol(\"removeallisteners\");\r\nexport const addallistenerssymbol = Symbol(\"addallisteners\");\r\n/* const forkarryaprototype = {};\r\nownKeys(Array.prototype).forEach(key => {\r\n  forkarryaprototype[key] = Array.prototype[key];\r\n}); */\r\n/* class forkarray {}\r\nObject.assign(forkarray.prototype, forkarryaprototype);\r\nforkarray.prototype.constructor = forkarray;\r\ndeleteProperty(forkarray.prototype, \"length\"); */\r\n/* extends forkarray  */\r\n\r\nexport default class ReactiveState<T extends UnwrapedState> {\r\n  value: T extends Array<any>\r\n    ? Array<any>\r\n    : T extends Function\r\n    ? Function\r\n    : T extends Primitivetype\r\n    ? Primitivetype\r\n    : object;\r\n  //extends Primitivetype ? Primitivetype : Exclude<object, Function>;\r\n  //   [callbackmap] = new Map<Function, EventListener>();\r\n\r\n  readonly [Symbol.toStringTag] = \"ReactiveState\";\r\n\r\n  constructor(init?: T) {\r\n    //super();\r\n    // this.value = undefined;\r\n\r\n    // if (isprimitive(init) || isobject(init)) {\r\n    this.value = init as any; //as T; /* extends Primitivetype\r\n    //  ? Primitivetype\r\n    //  : Exclude<object, Function>; */\r\n    defineProperty(this, \"value\", {\r\n      value: init,\r\n      configurable: true,\r\n      writable: true\r\n    });\r\n\r\n    // this.value = init;\r\n    // } else {\r\n    //   console.error(init);\r\n    //   console.error(invalid_primitive_or_object_state);\r\n    //   throw TypeError();\r\n    // }\r\n    // this[eventtargetsymbol] = new EventTarget();\r\n\r\n    /*\r\n  //  Object.defineProperty(this, Symbol.toStringTag, {\r\n //     value: \"ReactiveState\",\r\n   //   configurable: true\r\n    //});\r\n\r\n*/\r\n\r\n    const debouncedfun = debounce((eventname?: string) => {\r\n      const name = eventname ? String(eventname) : \"value\";\r\n\r\n      this[eventtargetsymbol].dispatchEvent(\r\n        new CustomEvent(\"value\", { detail: name })\r\n      );\r\n    });\r\n    this[debouncedispatch] = (eventname?: string) => {\r\n      debouncedfun(eventname);\r\n    };\r\n  }\r\n  [debouncedispatch]: (eventname?: string | undefined) => void;\r\n  /* get [Symbol.toStringTag]() {\r\n  //  return \"ReativeState\";\r\n\r\n} */\r\n  [removeallistenerssymbol]() {\r\n    this[memlisteners].forEach(callback => {\r\n      this[removeonelistner](callback);\r\n    });\r\n  }\r\n  [removeonelistner](callback: EventListener) {\r\n    const name = \"value\";\r\n    this[eventtargetsymbol].removeEventListener(name, callback);\r\n  }\r\n  [addonelistner](callback: EventListener) {\r\n    const name = \"value\";\r\n    this[eventtargetsymbol].addEventListener(name, callback);\r\n  }\r\n  [addallistenerssymbol]() {\r\n    // const name = \"value\";\r\n    this[memlisteners].forEach(callback => {\r\n      this[addonelistner](callback);\r\n      //   this[eventtargetsymbol].addEventListener(name, callback);\r\n    });\r\n  }\r\n  /*  [changetextnodesymbol](textnode: Text) {\r\n    this[textnodesymbol] = textnode;\r\n  } */\r\n  // [textnodesymbol]: Text | undefined;\r\n  /*  [changetextnodesymbol](textnode: Text) {\r\n      this[textnodesymbol] = textnode;\r\n    } */\r\n  // [textnodesymbol]: Text | undefined;\r\n\r\n  [eventtargetsymbol] = new EventTarget();\r\n  [memlisteners] = new Set<EventListener>();\r\n\r\n  //剑头函数绑定this\r\n  valueOf = () => {\r\n    return this.value;\r\n  };\r\n  toString() {\r\n    const value = this.valueOf();\r\n    return isprimitive(value)\r\n      ? String(value)\r\n      : isSet(value)\r\n      ? JSON.stringify([...(value as Set<any>)])\r\n      : isobject(value)\r\n      ? JSON.stringify(value)\r\n      : \"\";\r\n  }\r\n\r\n  [dispatchsymbol](eventname?: string) {\r\n    //添加防抖函数\r\n\r\n    this[debouncedispatch](eventname);\r\n  }\r\n  [subscribesymbol](\r\n    callback: Function\r\n    /*, eventname?: string*/\r\n  ) {\r\n    let eventlistener: EventListener;\r\n    const possiblecallback = cached_callback_eventlistner.get(callback);\r\n    if (possiblecallback) {\r\n      eventlistener = possiblecallback;\r\n    } else {\r\n      //自动解包\r\n      eventlistener = () => callback(/* this.valueOf() */);\r\n\r\n      cached_callback_eventlistner.set(callback, eventlistener);\r\n    }\r\n    // this[eventtargetsymbol].addEventListener(\"value\", callback);\r\n    // const name = eventname ? String(eventname) : \"value\";\r\n    //  const name = \"value\";\r\n    this[memlisteners].add(eventlistener);\r\n  }\r\n  [cancelsubscribe](callback: Function) {\r\n    const eventlistener = cached_callback_eventlistner.get(callback);\r\n    /*  if (!eventlistener) {\r\n      throw new Error();\r\n    } */\r\n    if (eventlistener) {\r\n      this[memlisteners].delete(eventlistener);\r\n      this[removeonelistner](eventlistener);\r\n    }\r\n  }\r\n\r\n  [Symbol.toPrimitive](): string | undefined | Primitivetype {\r\n    //return this.value;\r\n    const value = this.valueOf();\r\n    return isprimitive(value)\r\n      ? value\r\n      : isobject(value)\r\n      ? JSON.stringify(value)\r\n      : void 0;\r\n  }\r\n}\r\n/* Reflect.defineProperty(ReactiveState.prototype, Symbol.toStringTag, {\r\n  value: \"ReactiveState\"\r\n}); */\r\n","const Letter_case_and_Chinese = /[A-Za-z\\u4e00-\\u9fa5]/;\r\nimport { ElementAttrs } from \"./createelement\";\r\nimport { Class } from \"./customclass\";\r\n//// import { Class } from \"./rendervdomtoreal\";\r\nimport { merge_entries } from \"./merge-entries\";\r\nimport ReactiveState, { isReactiveState } from \"./reactivestate\";\r\nimport { defineProperty, get } from \"./reflect\";\r\nimport { isobject } from \"./util\";\r\n// //export function isVirtualdom(a: any): a is Virtualdom<any> {\r\n//   return a instanceof Virtualdom;\r\n// }//\r\nexport function isVirtualdom(a: any): a is Virtualdom<any> {\r\n  return (\r\n    isobject(a) &&\r\n    // has(a, isvirtualelement) &&\r\n    get(a, isvirtualelement) === isvirtualelement\r\n  );\r\n}\r\nexport const isvirtualelement = Symbol(\"isvirtualelement\");\r\nexport type Vdomchildren = Array<\r\n  Virtualdom<any> | string | ReactiveState<any> | number\r\n>;\r\nexport { createVirtualElement };\r\nfunction createVirtualElement<T extends Class | string | Function>(\r\n  type: T,\r\n  props: ElementAttrs = {},\r\n  children: Vdomchildren = []\r\n): Virtualdom<T> {\r\n  props = Object.assign({}, props);\r\n  children = children.flat(1 / 0);\r\n\r\n  const propsentries = Object.entries(props);\r\n  const propsentriesNOTevents = propsentries.filter(\r\n    ([key]) => !(key.startsWith(\"@\") || key.startsWith(\"on\"))\r\n  );\r\n  const Entries_beginning_with_a_letter = propsentriesNOTevents.filter(\r\n    ([key]) => Letter_case_and_Chinese.test(key[0])\r\n  );\r\n  const thisarg: Virtualdom<T> = Object.create(null);\r\n  [\r\n    \"onevent\",\r\n    \"element\",\r\n    \"type\",\r\n    \"props\",\r\n    \"children\",\r\n    \"directives\",\r\n    \"bindattr\"\r\n  ].forEach(key => {\r\n    defineProperty(thisarg, key, {\r\n      //   enumerable: false,\r\n      writable: true\r\n    });\r\n  });\r\n  //   [\"type\", \"props\", \"children\", \"directives\", \"bindattr\"].forEach(key => {\r\n  //     defineProperty(thisarg, key, {\r\n  //       enumerable: true,\r\n  //       writable: true\r\n  //     });\r\n  //   });\r\n  Object.assign(thisarg, {\r\n    type,\r\n    bindattr: Object.fromEntries(\r\n      Entries_beginning_with_a_letter.filter(e => isReactiveState(e[1]))\r\n    ),\r\n    props: Object.fromEntries(\r\n      Entries_beginning_with_a_letter.filter(e => !isReactiveState(e[1]))\r\n    ),\r\n    children,\r\n    onevent: Object.fromEntries(\r\n      merge_entries([\r\n        ...propsentries\r\n          .filter(([key]) => \"@\" == key[0])\r\n          .map(([key, value]) => [\r\n            key\r\n              .slice(1)\r\n              .toLowerCase()\r\n              .trim(),\r\n            [value].flat(1 / 0)\r\n          ]),\r\n        ...propsentries\r\n          .filter(([key]) => key.startsWith(\"on\"))\r\n          .map(([key, value]) => [\r\n            key\r\n              .slice(2)\r\n              .toLowerCase()\r\n              .trim(),\r\n            [value].flat(1 / 0)\r\n          ])\r\n      ] as [string, any][])\r\n    ),\r\n    directives: Object.fromEntries(\r\n      propsentriesNOTevents\r\n        .filter(([key]) => key[0] === \"*\" || key[0] === \"_\" || key[0] === \"$\")\r\n        .map(([key, value]) => [\r\n          key\r\n            .slice(1)\r\n            .toLowerCase()\r\n            .trim(),\r\n          value\r\n        ])\r\n    )\r\n  });\r\n  defineProperty(thisarg, Symbol.toStringTag, { value: \"VirtualElement\" });\r\n  //   thisarg[Symbol.toStringTag] = \"VirtualElement\";\r\n  //   thisarg[isvirtualelement] = isvirtualelement;\r\n  defineProperty(thisarg, isvirtualelement, { value: isvirtualelement });\r\n  return thisarg;\r\n}\r\n// JSON.stringify\r\ninterface Virtualdom<T extends Class | string | Function> {\r\n  readonly [isvirtualelement]: unique symbol;\r\n  readonly [Symbol.toStringTag]: \"VirtualElement\";\r\n  element: Element | undefined;\r\n  type: T;\r\n  props: ElementAttrs;\r\n  children: Vdomchildren;\r\n  directives: Record<string, any>;\r\n  //   { [key: string]: any };\r\n  onevent: Record<string, Array<EventListener>>;\r\n  //   {\r\n  //     [key: string]: Array<EventListener>;\r\n  //   };\r\n  bindattr: Record<string, ReactiveState<any>>;\r\n  /* {\r\n    [key: string]: ReactiveState<any>;\r\n  }; */\r\n}\r\nexport default Virtualdom;\r\n// //export default class Virtualdom<T extends Class | string | Function> {\r\n//   [Symbol.toStringTag] = \"VirtualElement\";\r\n//   // get [Symbol.toStringTag]() {\r\n//     return \"VirtualElement\";\r\n//   // } //\r\n// //   options: any |undefined\r\n// //  element: undefined | Element | Node;\r\n//   type: T | undefined;\r\n//   props: ElementAttrs = {};\r\n//   children: Vdomchildren = [];\r\n//   directives: object = {};\r\n//   onevent: { [key: string]: Array<EventListener> } = {};\r\n//   bindattr: { [key: string]: ReactiveState<any> } = {};\r\n//   constructor(type: T, props: ElementAttrs = {}, children: Vdomchildren = []) {\r\n//     //对象浅拷贝\r\n//     props = { ...props };\r\n//     const Letter_case_and_Chinese = /[A-Za-z\\u4e00-\\u9fa5]/;\r\n//     // console.log(type, props, children);\r\n//     //添加支持on开头事件绑定写法\r\n//     const propsentries = Object.entries(props);\r\n//     //\r\n// .map(([key, value]) => [\r\n// key.startsWith(\"on\")?key.replace(\"on\",\"@\")：key\r\n// ,\r\n// value\r\n\r\n// ]);\r\n// //\r\n// //   const propsentriesNOTevents = propsentries.filter(\r\n//       ([key]) => !(key.startsWith(\"@\") || key.startsWith(\"on\"))\r\n//     );\r\n//     const Entries_beginning_with_a_letter = propsentriesNOTevents.filter(([key]) =>\r\n//       Letter_case_and_Chinese.test(key[0])\r\n//     );\r\n\r\n//     Object.assign(this, {\r\n//       type,\r\n//       bindattr: Object.fromEntries(\r\n//         //   propsentriesNOTevents\r\n//           .filter(([key]) => Letter_case_and_Chinese.test(key[0])) //\r\n// //    Entries_beginning_with_a_letter.filter(\r\n//           e => isReactiveState(e[1])\r\n//           // e[1] instanceof ReactiveState\r\n//         )\r\n//       ),\r\n//       props: Object.fromEntries(\r\n//         //   propsentriesNOTevents\r\n//           .filter(([key]) => Letter_case_and_Chinese.test(key[0])) //\r\n// //  Entries_beginning_with_a_letter.filter(\r\n//           e => !isReactiveState(e[1])\r\n//           //    e[1] instanceof ReactiveState\r\n//         )\r\n//       ),\r\n//       children: children.flat(1 / 0),\r\n//       onevent: Object.fromEntries(\r\n//         // 需要合并entries\r\n//         [\r\n//         ['value',[f,f]]\r\n//         ,\r\n//         ['value',[f,f]]\r\n//       ]\r\n//         合并成\r\n\r\n//          [\r\n//         ['value',[f,f,f,f]]\r\n//          ]\r\n//         //\r\n\r\n// //\r\n\r\n//         [[\"value\",[\"f\",\"f\"]],[\"value\",[\"f\",\"f\"]]]\r\n\r\n//         [[\"value\",[\"f\",\"f\",\"f\",\"f\"]]]\r\n\r\n//         //\r\n// //     merge_entries([\r\n//           ...propsentries\r\n//             .filter(([key]) => /\\@/.test(key[0]))\r\n//             .map(([key, value]) => [\r\n//               //事件名称变成小写\r\n//               key\r\n//                 .slice(1)\r\n//                 .toLowerCase()\r\n//                 .trim(),\r\n//               //把事件绑定变成事件数组\r\n//               [value].flat(1 / 0)\r\n//             ]),\r\n//           ...propsentries\r\n//             .filter(([key]) => key.startsWith(\"on\"))\r\n//             .map(([key, value]) => [\r\n//               //事件名称变成小写\r\n//               key\r\n//                 .slice(2)\r\n//                 .toLowerCase()\r\n//                 .trim(),\r\n//               //把事件绑定变成事件数组\r\n//               [value].flat(1 / 0)\r\n//             ])\r\n//         ])\r\n//       ),\r\n\r\n//       //指令支持以\"*\"开头和\"_\"开头\r\n//       directives: Object.fromEntries(\r\n//         propsentriesNOTevents\r\n//         //  .filter(([key]) => /\\//\r\n// //.test(key[0]) || key[0].startsWith(\"_\"))\r\n//         //  .map(([key, value]) => [\r\n//             //指令也变成小写\r\n//             key\r\n//               .slice(1)\r\n//               .toLowerCase()\r\n//               .trim(),\r\n\r\n//             value\r\n//           ])\r\n//       )\r\n//     });\r\n//     //\r\n//  Object.defineProperty(this, Symbol.toStringTag, {\r\n//       value: \"virtualdom\",\r\n//       configurable: true\r\n//     });\r\n// //\r\n// //  }\r\n// }//\r\n// // defineProperty(Virtualdom.prototype, Symbol.toStringTag, {\r\n//   value: \"VirtualElement\"\r\n// });\r\n//  //\r\n","import { Class } from \"./customclass\";\r\nimport ReactiveState from \"./reactivestate\";\r\nimport { apply } from \"./reflect\";\r\nimport { isarray, isfunction, isplainobject, isstring } from \"./util\";\r\nimport Virtualdom, {\r\n  Vdomchildren,\r\n  createVirtualElement\r\n} from \"./VirtualElement\";\r\ntype styleprop =\r\n  | string\r\n  | object\r\n  | ReactiveState<string>\r\n  | ReactiveState<object>;\r\n\r\ntype classprop =\r\n  | string\r\n  | Set<string>\r\n  | Array<string>\r\n  | ReactiveState<string | Set<string> | Array<string>>;\r\nexport interface ElementAttrs {\r\n  style?: styleprop;\r\n  class?: classprop;\r\n  [key: string]: any;\r\n}\r\n\r\nexport default function<T extends Function | string>(\r\n  type: T,\r\n  propsorchildren?: Vdomchildren,\r\n  ...children: Vdomchildren\r\n): Virtualdom<T>;\r\nexport default function<T extends Vdomchildren>(\r\n  type: \"\",\r\n  propsorchildren?: T,\r\n  ...children: T\r\n): T;\r\nexport default function<T extends Vdomchildren>(\r\n  type: \"\",\r\n  props?: ElementAttrs,\r\n  ...children: T\r\n): T;\r\nexport default function<T extends Function | string>(\r\n  type: T,\r\n  props?: ElementAttrs,\r\n  ...children: Vdomchildren\r\n): Virtualdom<T>;\r\n//如果第二个参数是数组，则 变成\r\n/* \r\nh(type,...children)\r\nh(type,children)\r\n*/\r\n\r\nexport default function(\r\n  type?: Function | string | \"\" | Class,\r\n  propsorchildren?: Vdomchildren | ElementAttrs,\r\n  ...children: Vdomchildren\r\n) {\r\n  if (isarray(propsorchildren)) {\r\n    return apply(createElement, undefined, [\r\n      type,\r\n      undefined,\r\n      [...propsorchildren, ...children].flat(1 / 0)\r\n    ]);\r\n    /*   createElement(\r\n      type,\r\n      undefined,\r\n      [...propsorchildren, ...children].flat(1 / 0)\r\n    ); */\r\n  } else {\r\n    return apply(createElement, undefined, arguments); // createElement(...arguments);\r\n  }\r\n}\r\nfunction createElement<T extends Vdomchildren>(\r\n  type: \"\",\r\n  props?: ElementAttrs,\r\n  ...children: T\r\n): T;\r\nfunction createElement<T extends Function | string>(\r\n  type: T,\r\n  props?: ElementAttrs,\r\n  ...children: Vdomchildren\r\n): Virtualdom<T>;\r\n\r\n/* function createElement<T extends Vdomchildren>(\r\n  type: \"\",\r\n  props?: ElementAttrs,\r\n  ...children: T\r\n): T; */\r\n\r\nfunction createElement<T extends Function | string | Class>(\r\n  type: T,\r\n  props: ElementAttrs = {},\r\n  ...children: Vdomchildren\r\n): Virtualdom<T> | Vdomchildren {\r\n  // | Array<Virtualdom | string>\r\n  // if(isarray()){}\r\n  /* add fragment element */\r\n  //   console.log(type, props, children);\r\n  let typenormalized: \"\" | Function | string =\r\n    isstring(type) || isfunction(type) ? type : \"\";\r\n  const propsnormalized = isplainobject(props) ? props : {};\r\n  const childrennormalized: Vdomchildren = children\r\n    .flat(Infinity)\r\n    .map(a => (a === 0 ? \"0\" : a))\r\n    .filter(a => !!a);\r\n  if (\r\n    isstring(typenormalized)\r\n    //   typeof typenormalized === \"string\"\r\n  ) {\r\n    typenormalized = typenormalized.trim().toLowerCase();\r\n  }\r\n\r\n  if (\r\n    //typeof typenormalized === \"string\" &&\r\n\r\n    \"\" === typenormalized\r\n  ) {\r\n    return childrennormalized;\r\n  } else {\r\n    /* propsnormalized = Object.fromEntries(\r\n    Object.entries(propsnormalized).map(([key, value]) => [\r\n      key.trim().toLowerCase(),\r\n      value\r\n    ])\r\n  ); */\r\n\r\n    /* return new Virtualdom(\r\n      typenormalized,\r\n      propsnormalized,\r\n      childrennormalized\r\n    ) as Virtualdom<any>;\r\n*/\r\n    return apply(createVirtualElement, undefined, [\r\n      typenormalized,\r\n      propsnormalized,\r\n      childrennormalized\r\n    ]) as Virtualdom<T>;\r\n\r\n    /*  createVirtualElement(\r\n     \r\n    ); */\r\n  }\r\n}\r\n","import { isArray, isundefined } from \"./util\";\r\n/* export function toArray<T not Array>(a: T): Array<T>;\r\nexport function toArray<T>(a: Array<T>): Array<T>; */\r\n// export function toArray<T>(a: Array<T>): Array<T>;\r\nexport function toArray(a: any): any[] {\r\n  return (isArray(a) ? a : [a]).flat(1 / 0).filter(a => !isundefined(a));\r\n}\r\n","import { apply } from \"./reflect\";\r\n\r\n// declare const htm: (\r\n//   strings?: TemplateStringsArray,\r\n//   ...values: any[]\r\n// ) => Virtualdom<any>;\r\n/* declare module \"htm/dist/htm.module\" {\r\n  const htm: (\r\n    strings?: TemplateStringsArray,\r\n    ...values: any[]\r\n  ) => Virtualdom<any>;\r\n  export default htm;\r\n} */\r\n/* interface HTM {\r\n  (strings?: TemplateStringsArray, ...values: any[]): Virtualdom<any>;\r\n} */\r\nimport htm from \"htm\";\r\nimport { VaildVDom } from \"./conditon\";\r\n// import htm from \"../types/htm\";\r\nimport { invalid_Virtualdom } from \"./MountElement\";\r\nimport h from \"./createelement\";\r\nimport { isReactiveState } from \"./reactivestate\";\r\nimport { isArray, isnumber, isstring } from \"./util\";\r\nimport Virtualdom, { isVirtualdom, Vdomchildren } from \"./VirtualElement\";\r\nimport { toArray } from \"./toArray\";\r\n\r\n// const html = htm.bind(h);\r\n// function html(\r\n//   strings?: TemplateStringsArray,\r\n//   ...values: any[]\r\n// ): Virtualdom<any>;\r\nfunction html(...inargs: any[]): Virtualdom<any> | Vdomchildren {\r\n  // return (htm as HTM).call(h, ...inargs);\r\n\r\n  return apply(htm /* as HTM */, h, inargs);\r\n}\r\n\r\n/* 如果出现未闭合标签会产生错误的vdom */\r\nexport function isvalidvdom(v: any): v is VaildVDom {\r\n  if (isstring(v)) {\r\n    return true;\r\n  }\r\n  if (isnumber(v)) {\r\n    return true;\r\n  }\r\n  let flag = false;\r\n  if (isArray(v)) {\r\n    /*flag = v\r\n      .map((ele: any) => {\r\n        return isvalidvdom(ele);\r\n        //isstring(ele) || ele instanceof Virtualdom;\r\n      })\r\n      .includes(false)\r\n      ? false\r\n      : true;\r\n    return flag;*/\r\n    //https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/every\r\n    //不允许空数组\r\n    /* children可能为空数组 */\r\n    return /* !! */ /* v.length */ /* && */ v.every(e => isvalidvdom(e));\r\n  } else if (\r\n    isVirtualdom(v)\r\n    // v instanceof Virtualdom\r\n  ) {\r\n    return isvalidvdom(v.children);\r\n    /*  if (isvalidvdom(v.children)) {\r\n      return true;\r\n    } */\r\n  } else if (\r\n    isReactiveState(v)\r\n    //  v instanceof ReactiveState\r\n  ) {\r\n    return true;\r\n  }\r\n  /*  else {\r\n  } */\r\n  return flag;\r\n}\r\nexport default function(\r\n  strings?: TemplateStringsArray,\r\n  ...values: any[]\r\n): Virtualdom<any> | Vdomchildren;\r\nexport default function(...args: any[]) {\r\n  const prevdom = toArray(html(...args));\r\n\r\n  const vdom = prevdom.length === 1 ? prevdom[0] : prevdom;\r\n  if (isvalidvdom(vdom)) {\r\n    return vdom;\r\n  } else {\r\n    console.error(vdom);\r\n    console.error(invalid_Virtualdom);\r\n    throw new TypeError();\r\n  }\r\n}\r\n","import { appendchild, /* setelehtml,  */ seteletext } from \"./dom\";\r\nimport { toArray } from \"./toArray\";\r\nexport default function<\r\n  T extends HTMLElement | SVGSVGElement | SVGElement | Element | Node\r\n>(\r\n  ele:\r\n    | Node\r\n    | Array<\r\n        | HTMLElement\r\n        | Text\r\n        | SVGSVGElement\r\n        | DocumentFragment\r\n        | SVGElement\r\n        | Element\r\n        | Node\r\n      >\r\n    | SVGElement\r\n    | DocumentFragment\r\n    | HTMLElement\r\n    | Text\r\n    | SVGSVGElement\r\n    | Element,\r\n  container: T,\r\n  clear: boolean = true\r\n): T {\r\n  if (clear) {\r\n    seteletext(container, \"\");\r\n  }\r\n  //   container.innerHTML = \"\";\r\n  /*  let eles: Array<any>;\r\n  if (Array.isArray(ele)) {\r\n    eles = ele;\r\n  } else {\r\n    // appendchild(container, ele);\r\n    eles = [ele];\r\n  } */\r\n  const eles = toArray(ele).flat(Infinity);\r\n  eles.forEach((e: Node | HTMLElement | Element | SVGElement) =>\r\n    appendchild(container, e)\r\n  );\r\n  return container;\r\n}\r\n","// import { getparentNode } from \"./dom\";\r\n\r\nexport function isconnected(element: Node) {\r\n  return document.documentElement === getancestornode(element);\r\n}\r\nfunction getancestornode(node: Node) {\r\n  while (\r\n    node &&\r\n    node.parentNode &&\r\n    node.parentNode !== document\r\n    /*  getparentNode(node) &&\r\n    getparentNode(node) !== node &&\r\n    getparentNode(node) !== document */\r\n  ) {\r\n    //   if(getparentNode(node)){}\r\n    node = node.parentNode; // getparentNode(node);\r\n  }\r\n  return node;\r\n}\r\n","let watchrecord: [ReactiveState<any>, Function][] = [];\r\n/* 记录组件中使用的watch的state和callback,\r\n组件卸载时removeeventlistener,\r\n组件挂载时addeventlistener\r\n*/\r\nimport ReactiveState from \"./reactivestate\";\r\nimport { isFunction } from \"./util\";\r\nexport function getwatchrecords() {\r\n  return [...watchrecord];\r\n}\r\nexport function usewatch(state: ReactiveState<any>, callback: Function) {\r\n  if (ctxopen) {\r\n    watchrecord.push([state, callback]);\r\n  }\r\n}\r\nfunction clearwatch() {\r\n  watchrecord = [];\r\n}\r\nexport const invalid_Function = \"invalid Function\";\r\nconst errormessage =\r\n  \"invalid useMounted or useUnMounted out of createComponent\";\r\nlet ctxopen = false;\r\nlet MountedSet: Set<Function> = new Set();\r\nlet UnMountedSet: Set<Function> = new Set();\r\nlet StateSet: Set<ReactiveState<any>> = new Set();\r\n/* 收集组件内部创建的 ReactiveState*/\r\n\r\nexport function getstates() {\r\n  return [...StateSet];\r\n}\r\nexport function usestste(state: ReactiveState<any>) {\r\n  if (ctxopen) {\r\n    StateSet.add(state);\r\n  }\r\n}\r\nexport function getMounted() {\r\n  return [...MountedSet];\r\n}\r\nexport function getUnMounted() {\r\n  return [...UnMountedSet];\r\n}\r\nexport function useMounted(fun: Function) {\r\n  if (isFunction(fun)) {\r\n    if (ctxopen) {\r\n      MountedSet.add(fun);\r\n    } else {\r\n      //console.error()\r\n      console.error(errormessage);\r\n      throw Error();\r\n    }\r\n  } else {\r\n    console.error(fun);\r\n    console.error(invalid_Function);\r\n    throw TypeError();\r\n  }\r\n}\r\n\r\nexport function useUnMounted(fun: Function) {\r\n  if (isFunction(fun)) {\r\n    if (ctxopen) {\r\n      UnMountedSet.add(fun);\r\n    } else {\r\n      console.error(errormessage);\r\n      throw Error();\r\n      //throw Error(errormessage);\r\n    }\r\n  } else {\r\n    console.error(fun);\r\n    console.error(invalid_Function);\r\n    throw TypeError();\r\n    //throw TypeError(invalid_Function);\r\n  }\r\n}\r\nexport function clearMounted() {\r\n  MountedSet = new Set();\r\n}\r\n\r\nfunction clearstate() {\r\n  StateSet = new Set();\r\n}\r\nexport function clearUnMounted() {\r\n  UnMountedSet = new Set();\r\n}\r\nexport function openctx() {\r\n  ctxopen = true;\r\n  clearall();\r\n}\r\nexport function closectx() {\r\n  ctxopen = false;\r\n  clearall();\r\n}\r\nfunction clearall() {\r\n  clearMounted();\r\n  clearUnMounted();\r\n  clearstate();\r\n  clearwatch();\r\n}\r\n","import debounce from \"lodash/debounce\";\r\nimport { cached_callback_debounced_watchs } from \"./cached-map\";\r\nimport { invalid_ReactiveState } from \"./conditon\";\r\nimport { invalid_Function, usewatch } from \"./context-mounted-unmounted\";\r\nimport ReactiveState, {\r\n  addallistenerssymbol,\r\n  cancelsubscribe,\r\n  isReactiveState,\r\n  removeallistenerssymbol,\r\n  subscribesymbol\r\n} from \"./reactivestate\";\r\nimport { toArray } from \"./toArray\";\r\n//import { requestAnimationFrame } from \"./directives\";\r\nimport { isarray, isFunction } from \"./util\";\r\nexport type CancelWatchfun = () => void;\r\nexport type UnwrapedState = any; //Primitivetype | Exclude<object, Function>;\r\n\r\nexport interface CallbackReactiveState /* <\r\n  \r\n> */ {\r\n  (...args: UnwrapedState[]): void;\r\n}\r\n\r\nexport function watch<T extends UnwrapedState>(\r\n  state: ReactiveState<T> | Array<ReactiveState<T>>,\r\n\r\n  callback: CallbackReactiveState\r\n) {\r\n  if (isarray(state) || isReactiveState(state)) {\r\n    const statearray: ReactiveState<any>[] = toArray(state);\r\n    if (!statearray.length) {\r\n      console.error(\"Empty array not allowed\");\r\n      throw new Error();\r\n    }\r\n    /* 给watch的callback自动防抖 */\r\n    const debouncedcallback = debounce(callback);\r\n    const stateandlisteners: [ReactiveState<any>, Function][] = statearray.map(\r\n      state1 => {\r\n        const listener: Function = (() => {\r\n          /* 缓存callback和listener */\r\n          const cachedfun = cached_callback_debounced_watchs.get(callback);\r\n          if (cachedfun) {\r\n            return cachedfun;\r\n          } else {\r\n            const listenfun = () => {\r\n              //watch的回调函数自动解包\r\n              debouncedcallback(...statearray.map(r => r.valueOf()));\r\n            };\r\n            cached_callback_debounced_watchs.set(callback, listenfun);\r\n            return listenfun;\r\n          }\r\n        })();\r\n        watchsingle(\r\n          state1,\r\n\r\n          listener\r\n        );\r\n\r\n        return [state1, listener];\r\n      }\r\n    );\r\n\r\n    const cancelWatch: CancelWatchfun = () => {\r\n      stateandlisteners.forEach(([state, listener]) => {\r\n        state[cancelsubscribe](listener);\r\n      });\r\n    };\r\n    return cancelWatch;\r\n  }\r\n  //  else if (isReactiveState(state)) {\r\n  //  watchsingle(state, callback);\r\n  ////return watch(toArray(state),callback)\r\n  // }\r\n  else {\r\n    console.error(state);\r\n    console.error(callback);\r\n    console.error(invalid_ReactiveState + invalid_Function);\r\n    throw new TypeError();\r\n  }\r\n}\r\n\r\nfunction watchsingle(\r\n  state: ReactiveState<any>,\r\n  callback: Function\r\n  //  statekey?: string\r\n) {\r\n  if (\r\n    !(\r\n      isReactiveState(state) &&\r\n      // state instanceof ReactiveState\r\n      isFunction(callback)\r\n    )\r\n  ) {\r\n    console.error(state);\r\n    console.error(callback);\r\n    console.error(invalid_ReactiveState + invalid_Function);\r\n\r\n    throw TypeError();\r\n  }\r\n\r\n  state[subscribesymbol](callback);\r\n\r\n  //  if (statekey) {\r\n\r\n  //   state[subscribesymbol](callback, statekey);\r\n  // } else {\r\n\r\n  //  }\r\n\r\n  requestAnimationFrame(() => {\r\n    rewatch(state);\r\n    // state[addallistenerssymbol]();\r\n  });\r\n\r\n  usewatch(state, callback);\r\n}\r\nexport function unwatch(state: ReactiveState<any>): void {\r\n  state[removeallistenerssymbol]();\r\n}\r\n\r\nexport function rewatch(state: ReactiveState<any>): void {\r\n  state[addallistenerssymbol]();\r\n}\r\n","import { invalid_Function } from \"./context-mounted-unmounted\";\r\nimport directives from \"./directives\";\r\nimport Virtualdom from \"./VirtualElement\";\r\nimport { isplainobject } from \"./util\";\r\nexport interface Extendfun {\r\n  (\r\n    value: any,\r\n    element: Element,\r\n\r\n    vdom: Virtualdom<any>\r\n  ): void;\r\n}\r\nexport interface ExtendOptions {\r\n  [s: string]: Extendfun;\r\n}\r\nexport default function extenddirectives(options: ExtendOptions = {}) {\r\n  if (!isplainobject(options)) {\r\n    console.error(options);\r\n    throw new TypeError();\r\n  }\r\n  Object.entries(options).forEach(([key, value]) => {\r\n    if (typeof value !== \"function\") {\r\n      console.error(value);\r\n      console.error(invalid_Function);\r\n      throw TypeError();\r\n    } else {\r\n      if (!directives[key]) {\r\n        Reflect.set(directives, key, value);\r\n      } else {\r\n        console.error(directives);\r\n        console.error(\"do not extend existing directive\");\r\n        throw new Error();\r\n      }\r\n    }\r\n  });\r\n  return directives;\r\n}\r\n","export const { requestAnimationFrame } = window;\r\nimport { setelehtml, seteletext } from \"./dom\";\r\nimport { ExtendOptions } from \"./extend-directive\";\r\nimport { isconnected } from \"./isconnected\";\r\nimport ReactiveState, { isReactiveState } from \"./reactivestate\";\r\nimport { isfunction, isobject, isstring } from \"./util\";\r\nimport { watch } from \"./watch\";\r\nimport { set, apply } from \"./reflect\";\r\nimport Virtualdom from \"./VirtualElement\";\r\n\r\nconst directive: ExtendOptions = {\r\n  ref(ref: object | Function, ele: Element, _vdom: Virtualdom<any>) {\r\n    if (isfunction(ref)) {\r\n      apply(ref as Function, undefined, [ele]);\r\n      // ref(ele)\r\n      //   ref.call(undefined, ele);\r\n    } else if (isobject(ref)) {\r\n      set(ref as object, \"value\", ele);\r\n      //   ref.value = ele;\r\n    } else {\r\n      console.log(_vdom);\r\n      console.error(ref);\r\n      console.error(\"invalid ref\");\r\n      throw TypeError();\r\n    }\r\n  }\r\n};\r\nimport extenddirectives from \"./extend-directive\";\r\nextenddirectives({\r\n  html(\r\n    html: string | ReactiveState<any>,\r\n    ele: Element,\r\n\r\n    _vdom: Virtualdom<any>\r\n  ) {\r\n    console.log(_vdom);\r\n    createhtmlandtextdirective(setelehtml, \"html\")(ele, html);\r\n\r\n    // ele.innerHTML = html;\r\n    // console.log(ele.outerHTML);\r\n    /*  if (typeof html == \"string\") {\r\n          requestAnimationFrame(() => {\r\n            setelehtml(ele, html);\r\n    \r\n            /* ele.innerHTML = html;*/\r\n    //   console.log(ele.outerHTML);\r\n    /*     });\r\n        } else if (html instanceof ReactiveState) {\r\n          //   const ReactiveState = html;\r\n          watch(html, (state: { value: any }) => {\r\n            /*ele.innerHTML = String(state);*/\r\n    /*\r\n            setelehtml(ele, String(state));\r\n          });\r\n          //   ReactiveState[subscribesymbol]((state: { value: any }) => {\r\n          //     ele.innerHTML = String(state.value);\r\n          //   });\r\n          requestAnimationFrame(() => {\r\n            // console.log(\"html\");\r\n            /*  ele.innerHTML = String(html);*/\r\n    /*\r\n      //      setelehtml(ele, String(html));\r\n     //     });\r\n      //  } else {\r\n    \r\n    //console.error()\r\n      //    throw TypeError(\"invalid html\");\r\n     //   }\r\n    \r\n    */\r\n  },\r\n  text(\r\n    text: string | ReactiveState<any>,\r\n    ele: Element,\r\n    _vdom: Virtualdom<any>\r\n  ) {\r\n    console.log(_vdom);\r\n    createhtmlandtextdirective(seteletext, \"text\")(ele, text);\r\n\r\n    /*\r\n    \r\n      // ele.textContent = text;\r\n        // console.log(ele.outerHTML);\r\n        if (typeof text == \"string\") {\r\n          requestAnimationFrame(() => {\r\n            seteletext(ele, text);\r\n            /*    ele.textContent = text;*/\r\n    /*      //   console.log(ele.outerHTML);\r\n          });\r\n        } else if (text instanceof ReactiveState) {\r\n          //   const ReactiveState = text;\r\n          watch(text, (state: { value: any }) => {\r\n            seteletext(ele, String(state));\r\n    \r\n            /* ele.textContent = String(state);*/\r\n    /*   });\r\n          //   ReactiveState[subscribesymbol]((state: { value: any }) => {\r\n          //     ele.textContent = String(state.value);\r\n          //   });\r\n          requestAnimationFrame(() => {\r\n            // console.log(\"text\");\r\n            seteletext(ele, String(text));\r\n    \r\n            /*  ele.textContent = String(text);*/\r\n    /*    });\r\n       // } else {\r\n      //    throw TypeError(\"invalid text\");\r\n     //   }\r\n    \r\n    */\r\n  }\r\n});\r\nfunction createhtmlandtextdirective(seteletext: Function, errorname: string) {\r\n  return function(ele: Element, text: string | ReactiveState<any>) {\r\n    const element = ele;\r\n    if (\r\n      isstring(text)\r\n      //typeof text == \"string\"\r\n    ) {\r\n      requestAnimationFrame(() => {\r\n        seteletext(ele, text);\r\n        /*    ele.textContent = text;*/\r\n        //   console.log(ele.outerHTML);\r\n      });\r\n    } else if (\r\n      isReactiveState(text)\r\n      //  text instanceof ReactiveState\r\n    ) {\r\n      //   const ReactiveState = text;\r\n      watch(text, (/* state: { value: any } */) => {\r\n        const state = text;\r\n        if (isconnected(element)) {\r\n          seteletext(ele, String(state));\r\n        }\r\n        /* ele.textContent = String(state);*/\r\n      });\r\n      //   ReactiveState[subscribesymbol]((state: { value: any }) => {\r\n      //     ele.textContent = String(state.value);\r\n      //   });\r\n      requestAnimationFrame(() => {\r\n        // console.log(\"text\");\r\n        seteletext(ele, String(text));\r\n\r\n        /*  ele.textContent = String(text);*/\r\n      });\r\n    } else {\r\n      console.error(text);\r\n      console.error(\"invalid \" + errorname);\r\n      throw TypeError();\r\n    }\r\n  };\r\n}\r\nexport default directive;\r\n","import { get } from \"./reflect\";\r\nimport { isFunction } from \"./util\";\r\nconst componentsymbol = Symbol(\"component\");\r\nexport { componentsymbol };\r\nexport function iscomponent(a: any) {\r\n  return (\r\n    isFunction(a) &&\r\n    //  has(a, componentsymbol) &&\r\n    get(a, componentsymbol) === componentsymbol\r\n  );\r\n}\r\n","import { invalid_Function } from \"./context-mounted-unmounted\";\r\nimport { domaddlisten, domremovelisten } from \"./dom\";\r\nimport { toArray } from \"./toArray\";\r\nimport { /* isArray, */ isfunction } from \"./util\";\r\nimport { has, set, get } from \"./reflect\";\r\nexport const eventlistenerssymbol = Symbol(\"eventlisteners\");\r\nexport default function(\r\n  element: Element | Node,\r\n  eventname: string,\r\n  callback: EventListener | Array<EventListener>\r\n) {\r\n  /* if (!element[eventlistenerssymbol]) {\r\n    element[eventlistenerssymbol] = [];\r\n  }\r\n*/\r\n  firstaddlisteners(element, eventname, toArray(callback));\r\n  /*\r\n//  if (isfunction(callback)) {\r\n//    firstaddlisteners(element, eventname, [callback]);\r\n//  } else if (isArray(callback)) {\r\n//    firstaddlisteners(element, eventname, callback);\r\n // } else {\r\n //   console.error(callback);\r\n //   throw TypeError(invalid_Function);\r\n // }\r\n*/\r\n}\r\nexport function firstaddlisteners(\r\n  ele: Element | Node,\r\n  event: string,\r\n  callarray: Array<EventListener>\r\n) {\r\n  const element = ele;\r\n  callarray.forEach((call: EventListener) => {\r\n    if (!isfunction(call)) {\r\n      console.error(call);\r\n      console.error(invalid_Function);\r\n      throw TypeError();\r\n    }\r\n\r\n    if (!has(element, eventlistenerssymbol)) {\r\n      set(element, eventlistenerssymbol, []);\r\n      //   element[eventlistenerssymbol] = [];\r\n    }\r\n    (get(ele, eventlistenerssymbol) as [string, EventListener][])\r\n      /* ele[eventlistenerssymbol] */\r\n      .push([event, call]);\r\n    domaddlisten(ele, event, call);\r\n  });\r\n}\r\nexport function removelisteners(\r\n  ele: Element | Node\r\n  //   event: string,\r\n  //   callarray: Array<EventListener>\r\n) {\r\n  // const element = ele;\r\n  if (has(ele, eventlistenerssymbol)) {\r\n    (get(ele, eventlistenerssymbol) as [string, EventListener][])\r\n      /*   ele[eventlistenerssymbol] */\r\n\r\n      .forEach(([event, call]) => {\r\n        //   ele[eventlistenerssymbol].push([event, call]);\r\n        domremovelisten(ele, event, call);\r\n      });\r\n  }\r\n}\r\nexport function readdlisteners(\r\n  ele: Element | Node\r\n  //   event: string,\r\n  //   callarray: Array<EventListener>\r\n) {\r\n  if (has(ele, eventlistenerssymbol)) {\r\n    (get(ele, eventlistenerssymbol) as [string, EventListener][]).forEach(\r\n      ([event, call]) => {\r\n        //   ele[eventlistenerssymbol].push([event, call]);\r\n        domaddlisten(ele, event, call);\r\n      }\r\n    );\r\n  }\r\n}\r\n","import createeleattr from \"@masx200/dom-element-attribute-agent-proxy\";\r\nimport { createcostumelemet } from \"./createcostumelemet\";\r\nimport directives from \"./directives\";\r\nimport {\r\n  changetext,\r\n  createDocumentFragment,\r\n  createElementNS,\r\n  createmathelement,\r\n  //   createnonescript,\r\n  createnativeelement,\r\n  createsvgelement,\r\n  createtextnode,\r\n  mathnamespace,\r\n  svgnamespace\r\n} from \"./dom\";\r\nimport { iscomponent } from \"./iscomponent\";\r\nimport { isconnected } from \"./isconnected\";\r\nimport mount from \"./mount-real-element\";\r\nimport onevent /*  eventlistenerssymbol  */ from \"./handle-onevent\";\r\nimport ReactiveState, { isReactiveState } from \"./reactivestate\";\r\nimport { get, has, set } from \"./reflect\";\r\nimport { isArray, isfunction, isnumber, isobject, isstring } from \"./util\";\r\nimport Virtualdom, { isVirtualdom } from \"./VirtualElement\";\r\nimport { watch } from \"./watch\";\r\n\r\nexport const bindstatesymbol = Symbol(\"bindstate\");\r\n\r\nexport const reactivestatesymbol = Symbol(\"reactive\");\r\nexport const virtualdomsymbol = Symbol(\"virtualelement\");\r\nfunction throwinvalideletype(type?: any) {\r\n  console.error(type);\r\n  console.error(\"invalid element type!\");\r\n  throw TypeError(/*\"invalid element type!\"*/);\r\n}\r\nexport default function render(\r\n  vdom: Virtualdom<string | Function>,\r\n  namespace?: string\r\n): Element;\r\nexport default function render(\r\n  vdom: Virtualdom<\"script\" | \"\" | \"html\">,\r\n  namespace?: string\r\n): Node;\r\nexport default function render(\r\n  vdom: Array<Virtualdom<any> | string | ReactiveState<any> | number>,\r\n  namespace?: string\r\n): Array<Node | Element>;\r\nexport default function render(\r\n  vdom: string | ReactiveState<any> | number,\r\n  namespace?: string\r\n): Node;\r\nexport default function render(\r\n  vdom: Array<Virtualdom<any>>,\r\n  namespace?: string\r\n): Array<Element>;\r\nexport default function render(\r\n  vdom: Array<string | ReactiveState<any> | number>,\r\n  namespace?: string\r\n): Array<Node>;\r\nexport default function render(\r\n  vdom:\r\n    | Virtualdom<any>\r\n    | string\r\n    | number\r\n    | ReactiveState<any>\r\n    | Array<Virtualdom<any> | string | ReactiveState<any> | number>,\r\n  namespace?: string\r\n): Array<Node | Element> | Element | Node {\r\n  if (isArray(vdom)) {\r\n    return (vdom as (string | number | ReactiveState<any> | Virtualdom<any>)[])\r\n      .map(a => render(a as any))\r\n      .flat(1 / 0);\r\n  }\r\n  if (isnumber(vdom) || isstring(vdom)) {\r\n    const textnode = createtextnode(vdom);\r\n    set(textnode, virtualdomsymbol, vdom);\r\n    // textnode[virtualdomsymbol] = vdom;\r\n    return textnode;\r\n\r\n    // } else if (typeof vdom === \"string\") {\r\n    // return createtextnode(vdom);\r\n  } else if (isReactiveState(vdom) /*instanceof ReactiveState*/) {\r\n    const reactive = vdom;\r\n    const textnode = createtextnode(String(reactive));\r\n    set(textnode, virtualdomsymbol, vdom);\r\n    // textnode[virtualdomsymbol] = reactive;\r\n\r\n    //textnode[reactivestatesymbol] = reactive;\r\n    /*  try {\r\n      reactive[textnodesymbol] = textnode;\r\n    } catch (error) {\r\n      console.warn(error);\r\n    } */\r\n\r\n    watch(reactive, (/* state: ReactiveState<any> */) => {\r\n      const state = reactive;\r\n      if (isconnected(element)) {\r\n        changetext(textnode, String(state));\r\n      }\r\n    });\r\n    const element = textnode;\r\n    set(element, bindstatesymbol, new Set());\r\n    // element[bindstatesymbol] = new Set();\r\n    (get(element, bindstatesymbol) as Set<ReactiveState<any>>).add(reactive);\r\n    // element[bindstatesymbol].add(reactive);\r\n    return textnode;\r\n  } else if (\r\n    isVirtualdom(vdom)\r\n    //vdom instanceof Virtualdom && \"type\" in vdom\r\n  ) {\r\n    const { type } = vdom;\r\n    let element:\r\n      | Element\r\n      | HTMLElement\r\n      | SVGSVGElement\r\n      | SVGElement\r\n      | undefined = undefined;\r\n    if (typeof type === \"string\") {\r\n      if (type === \"script\") {\r\n        /* 禁止加载脚本 */\r\n\r\n        return createDocumentFragment();\r\n      } else if (type === \"svg\") {\r\n        /* 没想到svg的创建方式这么特别?否则显示不出svg */\r\n        element = createsvgelement();\r\n      } else if (type === \"math\") {\r\n        /* 没想到svg的创建方式这么特别?否则显示不出svg */\r\n        element = createmathelement();\r\n      } else if (\"\" === type || type === \"html\") {\r\n        const fragmentnode = createDocumentFragment();\r\n\r\n        mount(render(vdom.children), fragmentnode);\r\n\r\n        return fragmentnode;\r\n        //不要创建html元素\r\n        // return render(vdom.children);\r\n        // element = createDocumentFragment();\r\n      } else {\r\n        element = namespace\r\n          ? createElementNS(namespace, type)\r\n          : createnativeelement(type);\r\n      }\r\n    } else if (typeof type == \"function\") {\r\n      //添加默认props\r\n\r\n      /*static defaultProps = {\r\n        name: 'Omi',\r\n        myAge: 18\r\n  }*/\r\n      if (isobject(type[\"defaultProps\"])) {\r\n        vdom.props = JSON.parse(\r\n          JSON.stringify({ ...type[\"defaultProps\"], ...vdom.props })\r\n        );\r\n      }\r\n\r\n      const propsjson = JSON.parse(\r\n        JSON.stringify({\r\n          ...vdom.props,\r\n          ...Object.fromEntries(\r\n            Object.entries(vdom.bindattr).map(([key, value]) => {\r\n              return [key, value.value];\r\n            })\r\n          )\r\n        })\r\n      );\r\n      element = createcostumelemet(\r\n        type,\r\n        propsjson,\r\n        vdom.children\r\n        // vdom.options\r\n      );\r\n    } else {\r\n      throwinvalideletype(vdom);\r\n      // throw TypeError(\"invalid element type!\");\r\n    }\r\n    /*  if (element) {\r\n      const attribute1: { [key: string]: any } = createeleattr(element);\r\n      Object.assign(\r\n        attribute1,\r\n\r\n        /* 把属性为false的先不设置 */\r\n    //     vdom.props\r\n    //     // Object.fromEntries(Object.entries(vdom.props).filter())\r\n    //   );\r\n    // } */\r\n    // apply(handleprops)\r\n\r\n    /* 自定义组件不添加children,而是从构造函数传入 */\r\n    /* web components也可以设置 childnodes,比如说slot */\r\n    /* https://webkit.org/blog/4096/introducing-shadow-dom-api/ */\r\n    /*  */\r\n    /* https://developer.mozilla.org/zh-CN/docs/Web/API/Element/slot */\r\n    if (\r\n      type &&\r\n      (isfunction(type) || isstring(type))\r\n      // /\r\n      //   /\r\n\r\n      /* typeof type !== \"function\" */\r\n    ) {\r\n      /* 如果自己创造的组件就不加children, */\r\n      if (\r\n        !iscomponent(type)\r\n        // componentsymbol !== type[componentsymbol]\r\n      ) {\r\n        if (element) {\r\n          mount(\r\n            vdom.children.map(e => {\r\n              if (type === \"svg\" && isVirtualdom(e)) {\r\n                /* 没想到svg的创建方式这么特别?否则显示不出svg */\r\n                //   element.innerHTML = element.innerHTML;\r\n                return render(e, svgnamespace);\r\n              } else if (type === \"math\" && isVirtualdom(e)) {\r\n                return render(e, mathnamespace);\r\n              } else if (namespace && isVirtualdom(e)) {\r\n                return render(e, namespace);\r\n              } else {\r\n                return render(e as any) as any;\r\n              }\r\n            }),\r\n\r\n            element\r\n          );\r\n          //   return element;\r\n        }\r\n      }\r\n    }\r\n    /* 对于select元素,设置value属性时,如果没有 找到对应的option元素,则设置失败,\r\n    \r\n    改成先加children,后设attributes,\r\n    */\r\n    if (element) {\r\n      handleprops(element, vdom);\r\n    }\r\n\r\n    return element as Node | Element;\r\n  } else {\r\n    throwinvalideletype(vdom);\r\n    // throw TypeError(\"invalid element type!\");\r\n  }\r\n  //   throw Error();\r\n  //   throwinvalideletype();\r\n\r\n  /* console.error(vdom);\r\n  throw new Error(); */\r\n  //   return;\r\n  throw new Error();\r\n}\r\n\r\nfunction handleprops(\r\n  element: HTMLElement | Element | SVGSVGElement | SVGElement,\r\n  vdom: Virtualdom<any>\r\n) {\r\n  ((element, vdom) => {\r\n    Object.entries(vdom.directives).forEach(([name, value]) => {\r\n      if (\r\n        isfunction(\r\n          directives[name]\r\n        ) /* typeof directives[name] === \"function\" */\r\n        /*name in directives &&*/\r\n      ) {\r\n        directives[name](value, element, vdom);\r\n      } else {\r\n        console.error(vdom.directives);\r\n        console.error(\"invalid directives \" + name);\r\n        throw new Error();\r\n      }\r\n    });\r\n\r\n    const attribute1: { [key: string]: any } = createeleattr(element);\r\n    Object.assign(\r\n      attribute1,\r\n\r\n      /* 把属性为false的先不设置 */\r\n      vdom.props\r\n      // Object.fromEntries(Object.entries(vdom.props).filter())\r\n    );\r\n    /* 添加常量的属性 */\r\n    set(element, virtualdomsymbol, vdom);\r\n    // element[virtualdomsymbol] = vdom;\r\n    vdom.element = element;\r\n    /* 添加绑定属性 */\r\n\r\n    Object.entries(vdom.bindattr).forEach(([key, primitivestate]) => {\r\n      attribute1[key] = primitivestate.valueOf();\r\n      watch(primitivestate, (/* state: ReactiveState<any> */) => {\r\n        const state = primitivestate;\r\n        if (isconnected(element)) {\r\n          attribute1[key] = state.valueOf();\r\n        }\r\n      });\r\n      /*     primitivestate[subscribesymbol]();\r\n      requestAnimationFrame(() => {\r\n        primitivestate[addallistenerssymbol]();\r\n      }); */\r\n    });\r\n\r\n    /* 添加事件绑定和指令执行 */\r\n\r\n    /*  if (!element[eventlistenerssymbol]) {\r\n      element[eventlistenerssymbol] = [];\r\n    }\r\n*/\r\n    Object.entries(vdom.onevent).forEach(([event, callbacks]) => {\r\n      onevent(element, event, callbacks);\r\n    });\r\n  })(element, vdom);\r\n  /*  if (!element[bindstatesymbol]) {\r\n    element[bindstatesymbol] = new Set();\r\n  }\r\n*/\r\n  [...Object.values(vdom.bindattr), ...Object.values(vdom.directives)]\r\n    .flat(1 / 0)\r\n    .filter(\r\n      e => isReactiveState(e)\r\n      // e instanceof ReactiveState\r\n    )\r\n\r\n    .forEach((e: ReactiveState<any>) => {\r\n      if (!has(element, bindstatesymbol)) {\r\n        set(element, bindstatesymbol, new Set());\r\n        // element[bindstatesymbol] = new Set();\r\n      }\r\n      (get(element, bindstatesymbol) as Set<ReactiveState<any>>).add(e);\r\n      //   element[bindstatesymbol].add(e);\r\n    });\r\n}\r\n","export const invalid_Virtualdom = \"invalid Virtualdom \";\r\nimport { VaildVDom } from \"./conditon\";\r\nimport document from \"./dom\";\r\nimport { isvalidvdom } from \"./html\";\r\nimport mount from \"./mount-real-element\";\r\nimport render from \"./render-vdom-to-real\";\r\nimport { toArray } from \"./toArray\";\r\nimport { isArray } from \"./util\";\r\nexport default function MountElement<T extends Element>(\r\n  vdom: VaildVDom | Node | Element | Array<Node | Element>,\r\n  container: T\r\n): T {\r\n  if (isArray(vdom)) {\r\n    vdom = vdom.flat(Infinity);\r\n    if (!vdom.length) {\r\n      //不允许空数组\r\n      console.error(\"Empty array not allowed\");\r\n      throw new TypeError();\r\n    }\r\n  }\r\n  const el = container;\r\n  if (!(el instanceof HTMLElement)) {\r\n    console.error(el);\r\n    console.error(\"invalid container HTMLElement!\");\r\n    throw TypeError();\r\n  }\r\n\r\n  if (\r\n    el === document.body ||\r\n    el === document.documentElement ||\r\n    el === document.head\r\n  ) {\r\n    console.error(el);\r\n    console.error(\"Do not mount  to <html> or <body> <head>.\");\r\n    throw Error();\r\n  }\r\n  /*   if (\r\n    !(\r\n      isvalidvdom(vdom) ||\r\n      vdom instanceof Node ||\r\n      (isArray(vdom) && isNodeArray(vdom))\r\n    )\r\n  ) {\r\n    console.error(vdom);\r\n    throw TypeError(invalid_Virtualdom);\r\n  } */\r\n\r\n  /*   let elesarray: Array<any>;\r\n  if (Array.isArray(vdom)) {\r\n    elesarray = vdom;\r\n  } else {\r\n    elesarray = [vdom];\r\n  } */\r\n  const elesarray = toArray(vdom);\r\n  if (isvalidvdom(vdom)) {\r\n    // mount(elesarray.map(e => render(e)), container);\r\n    mount(render(elesarray), container);\r\n  } else if (isNode(vdom) /*  instanceof Node */ || isNodeArray(vdom)) {\r\n    mount(elesarray, container);\r\n  } else {\r\n    console.error(vdom);\r\n    console.error(invalid_Virtualdom);\r\n    throw TypeError();\r\n  }\r\n\r\n  //\r\n  return container;\r\n}\r\nexport function isNodeArray(arr: any[]): arr is Node[] {\r\n  //https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/every\r\n  //不允许空数组\r\n  return !!(isArray(arr) && arr.length && arr.every(a => isNode(a)));\r\n  //!array.map(e => e instanceof Node).includes(false);\r\n}\r\nexport function isNode(a: any): a is Node {\r\n  return a instanceof Node;\r\n}\r\n","export default function<T extends object>(target: T): T {\r\n  return new Proxy(target, {\r\n    set() {\r\n      return true;\r\n    },\r\n    defineProperty() {\r\n      return false;\r\n    },\r\n    deleteProperty() {\r\n      return false;\r\n    },\r\n    setPrototypeOf() {\r\n      return false;\r\n    }\r\n  });\r\n}\r\n","/* interface CallbackReactiveState<\r\n \r\n> {\r\n  (...args: T[]): any;\r\n} */\r\nimport { invalid_ReactiveState } from \"./conditon\";\r\nimport { invalid_Function, usestste } from \"./context-mounted-unmounted\";\r\nimport ReactiveState, {\r\n  dispatchsymbol,\r\n  isReactiveState\r\n} from \"./reactivestate\";\r\nimport readonlyproxy from \"./readonlyproxy\";\r\nimport {\r\n  apply,\r\n  //   getPrototypeOf\r\n  //   set\r\n  defineProperty,\r\n  //   deleteProperty,\r\n  get,\r\n  getOwnPropertyDescriptor,\r\n  //   getOwnPropertyDescriptor,\r\n  has,\r\n  ownKeys\r\n} from \"./reflect\";\r\nimport { toArray } from \"./toArray\";\r\nimport { isArray, isFunction, isobject, isprimitive, issymbol } from \"./util\";\r\nimport { CallbackReactiveState, UnwrapedState, watch } from \"./watch\";\r\n\r\n//const { defineProperty } = Object;\r\nexport default function<T extends UnwrapedState>(\r\n  state: ReactiveState<T> | Array<ReactiveState<T>>,\r\n  callback: CallbackReactiveState\r\n): ReactiveState<any> {\r\n  if (\r\n    !(\r\n      (isArray(state) || isReactiveState(state)) &&\r\n      // state instanceof ReactiveState\r\n      isFunction(callback)\r\n    )\r\n  ) {\r\n    console.error(state);\r\n    console.error(callback);\r\n    console.error(invalid_ReactiveState + invalid_Function);\r\n\r\n    throw TypeError();\r\n  }\r\n  const state1array: ReactiveState<T>[] =\r\n    //   if (isReactiveState(state)) {\r\n    toArray(state);\r\n  if (!state1array.length) {\r\n    console.error(\"Empty array not allowed\");\r\n    throw new Error();\r\n  }\r\n  /*  state1 = Arraycomputed(\r\n      toArray(state),\r\n\r\n      callback\r\n    ); */\r\n  //   } else if (isArray(state)) {\r\n  //     state1array = state;\r\n  //     // state1 = Arraycomputed(state, callback);\r\n  //   } else {\r\n  //     state1array = Array.from(state);\r\n  //   }\r\n  const state1 = Arraycomputed(state1array, callback);\r\n  usestste(state1);\r\n  return state1;\r\n}\r\n\r\nfunction Arraycomputed<T extends UnwrapedState>(\r\n  state: ReactiveState<T>[],\r\n  callback: CallbackReactiveState\r\n): ReactiveState<any> {\r\n  const reactivestate = new ReactiveState();\r\n  const getter = () => {\r\n    //自动解包\r\n    const value = apply(callback, undefined, state.map(st => st.valueOf()));\r\n    // callback(...state.map(st => st.valueOf()));\r\n    const possiblevalue = isReactiveState(value) ? value.valueOf() : value;\r\n\r\n    if (isobject(possiblevalue) || isprimitive(possiblevalue)) {\r\n      return possiblevalue;\r\n    } else {\r\n      console.error(possiblevalue);\r\n      throw TypeError();\r\n    }\r\n  };\r\n\r\n  let memorized = getter();\r\n\r\n  // if (isFunction(memorized)) {\r\n  //   console.error(memorized);\r\n  //   throw new TypeError();\r\n  // }\r\n  defineProperty(reactivestate, \"value\", {\r\n    get: getter,\r\n    configurable: true\r\n  });\r\n\r\n  state.forEach(state => {\r\n    watch(state, () => {\r\n      let newvalue = getter();\r\n      if (newvalue !== memorized) {\r\n        reactivestate[dispatchsymbol]();\r\n\r\n        memorized = newvalue;\r\n      }\r\n      //\r\n    });\r\n  });\r\n\r\n  return readonlyproxy(getproperyreadproxy(reactivestate));\r\n}\r\nconst __proto__ = \"__proto__\";\r\nexport function getproperyreadproxy<T extends object>(a: T): T;\r\nexport function getproperyreadproxy(a: object) {\r\n  /* 把基本类型原型的属性 也加上*/\r\n  //   const target = isobject(a) ? a : getPrototypeOf(a);\r\n  const target = a;\r\n  return new Proxy(target, {\r\n    getOwnPropertyDescriptor(target, key) {\r\n      //对于symbol属性，返回undefined\r\n      if (issymbol(key)) {\r\n        return;\r\n      } else {\r\n        return getOwnPropertyDescriptor(target, key);\r\n      }\r\n    },\r\n    ownKeys(target) {\r\n      let myvalue = get(target, \"value\");\r\n      const myvalueobj = isobject(myvalue) ? myvalue : myvalue[__proto__];\r\n      //   return ownKeys(target);\r\n      return Array.from(new Set([...ownKeys(target), ...ownKeys(myvalueobj)]));\r\n\r\n      /* Array.from(\r\n        new Set([...ownKeys(target), ...ownKeys(get(target, \"value\"))])\r\n      ); */\r\n    },\r\n    has(target, key) {\r\n      const myvalue = get(target, \"value\");\r\n      const myvalueobj = isobject(myvalue) ? myvalue : myvalue[__proto__];\r\n      return has(target, key) || has(myvalueobj, key);\r\n    },\r\n    get(target, key) {\r\n      if (has(target, key)) {\r\n        return get(target, key);\r\n      } else {\r\n        const myvalue = get(target, \"value\");\r\n        const myvalueobj = isobject(myvalue) ? myvalue : Object(myvalue);\r\n\r\n        if (has(myvalueobj, key)) {\r\n          /* 对于string,number等原始类型,返回的函数要绑定this */\r\n          const property = get(myvalueobj, key);\r\n          return isFunction(property) ? property.bind(myvalueobj) : property;\r\n        }\r\n      }\r\n      //   return get(target, key);\r\n      /*  const myvalue = get(target, \"value\");\r\n\r\n      if (has(target, key)) {\r\n        return get(target, key);\r\n      } else if (has(myvalue, key)) {\r\n        return get(myvalue, key);\r\n      } */\r\n    }\r\n  });\r\n}\r\n","const Setprototype = Set.prototype;\r\nconst Mapprototype = Map.prototype;\r\nfunction ispromise(a: any): a is Promise<any> {\r\n  return a instanceof Promise;\r\n}\r\nfunction isdate(a: any): a is Date {\r\n  return a instanceof Date;\r\n}\r\nfunction isregexp(a: any): a is RegExp {\r\n  return a instanceof RegExp;\r\n}\r\nfunction isMap(a: any): a is Map<any, any> {\r\n  return a instanceof Map;\r\n}\r\nfunction isSet(a: any): a is Set<any> {\r\n  return a instanceof Set;\r\n}\r\nfunction isArray(a: any): a is any[] {\r\n  return Array.isArray(a);\r\n}\r\n\"use strict\";\r\nconst Reflect = window.Reflect;\r\nconst {\r\n  ownKeys,\r\n  deleteProperty,\r\n  apply,\r\n  construct,\r\n  defineProperty,\r\n  get,\r\n  getOwnPropertyDescriptor,\r\n  getPrototypeOf,\r\n  has,\r\n\r\n  set,\r\n  setPrototypeOf\r\n} = Reflect;\r\nfunction isobject(a: any): a is Exclude<object, Function> {\r\n  return typeof a === \"object\" && a !== null;\r\n}\r\nfunction isfunction(a: any): a is Function {\r\n  return typeof a === \"function\";\r\n}\r\n/* API\r\nfunction deepobserveagent(target: Object | Function, callback: callback): any;\r\n\r\ninterface callback {\r\n  (\r\n    target: Object | Function,\r\n    patharray: Array<any>,\r\n    newvalue: any,\r\n    oldvalue: any\r\n  ): void;\r\n}\r\n\r\n*/\r\ninterface Callback<\r\n  T extends object | Function | any[] | Set<any> | Map<any, any>\r\n> {\r\n  (target: T, patharray: Array<string>, newvalue: any, oldvalue: any): void;\r\n}\r\nfunction deepobserveaddpath<\r\n  T extends object | Function | any[] | Set<any> | Map<any, any>\r\n>(\r\n  target: T,\r\n  callback: Callback<T>,\r\n  patharray: Array<string> = [],\r\n  ancestor = target\r\n): T {\r\n  if (\r\n    !isfunction(callback)\r\n\r\n    //typeof callback !== \"function\"\r\n  ) {\r\n    console.error(callback);\r\n    console.error(\"observe callback invalid !\");\r\n    throw Error();\r\n\r\n    //throw Error(\"callback not defined!\");\r\n    // setTimeout(() => {\r\n    // }, 0);\r\n\r\n    // callback(t, k, v);\r\n  }\r\n\r\n  /* promise,date,regexp直接返回,不可代理,不可监测 */\r\n\r\n  if (ispromise(target) || isregexp(target) || isdate(target)) {\r\n    return target;\r\n  }\r\n  if (isfunction(target) || isobject(target)) {\r\n    //\r\n\r\n    let fakeobj: T;\r\n    if (isSet(target)) {\r\n      fakeobj = new Set([...target]) as any;\r\n      set(fakeobj, \"add\", (value: any) => {\r\n        Setprototype.add.call(target, value);\r\n        callback(ancestor, patharray, undefined, undefined);\r\n\r\n        return Setprototype.add.call(fakeobj, value);\r\n      });\r\n      set(fakeobj, \"delete\", (value: any) => {\r\n        Setprototype.delete.call(target, value);\r\n        callback(ancestor, patharray, undefined, undefined);\r\n        return Setprototype.delete.call(fakeobj, value);\r\n      });\r\n      set(fakeobj, \"clear\", () => {\r\n        Setprototype.clear.call(target);\r\n        callback(ancestor, patharray, undefined, undefined);\r\n        return Setprototype.clear.call(fakeobj);\r\n      });\r\n      //   fakeobj.add = () => {};\r\n    } else if (isMap(target)) {\r\n      fakeobj = new Map([...target]) as any;\r\n      set(fakeobj, \"clear\", () => {\r\n        Mapprototype.clear.call(target);\r\n        callback(ancestor, patharray, undefined, undefined);\r\n        return Mapprototype.clear.call(fakeobj);\r\n      });\r\n      set(fakeobj, \"set\", (key: any, value: any) => {\r\n        Mapprototype.set.call(target, key, value);\r\n        callback(ancestor, patharray, undefined, undefined);\r\n        return Mapprototype.set.call(fakeobj, key, value);\r\n      });\r\n      set(fakeobj, \"delete\", (value: any) => {\r\n        Mapprototype.delete.call(target, value);\r\n        callback(ancestor, patharray, undefined, undefined);\r\n        return Mapprototype.delete.call(fakeobj, value);\r\n      });\r\n    } else if (isArray(target)) {\r\n      fakeobj = [] as T;\r\n      /* VM462:1 Uncaught TypeError: 'getOwnPropertyDescriptor' on proxy: trap returned descriptor for property 'length' that is incompatible with the existing property in the proxy target\r\n    at Function.getOwnPropertyDescriptors (<anonymous>)\r\n    at <anonymous>:1:8 */\r\n    } else if (isfunction(target)) {\r\n      fakeobj = (() => {}) as T;\r\n    } else {\r\n      fakeobj = {} as T;\r\n    }\r\n    if (!isSet(target) && !isMap(target)) {\r\n      setPrototypeOf(fakeobj, null);\r\n    }\r\n    // return (fakeobj => {\r\n    return new Proxy(fakeobj, {\r\n      defineProperty(t, p, a) {\r\n        callback(\r\n          ancestor,\r\n          [...patharray, String(p)],\r\n          //属性描述符的value或者getter\r\n          has(a, \"value\") ? a.value : isfunction(a.get) ? a.get() : undefined,\r\n          get(target, p)\r\n        );\r\n        return defineProperty(target, p, a);\r\n      },\r\n      deleteProperty(t, p) {\r\n        callback(\r\n          ancestor,\r\n          [...patharray, String(p)],\r\n          undefined,\r\n          get(target, p)\r\n\r\n          //target[p]\r\n        );\r\n        return deleteProperty(target, p);\r\n      },\r\n      ownKeys(/*  t*/) {\r\n        return ownKeys(target);\r\n      },\r\n      has(t, p) {\r\n        return has(target, p);\r\n      },\r\n      getPrototypeOf(/* t */) {\r\n        return getPrototypeOf(target);\r\n      },\r\n      setPrototypeOf(t, v) {\r\n        return setPrototypeOf(target, v);\r\n      },\r\n      construct(t, argumentslist) {\r\n        if (\r\n          isfunction(target)\r\n          //typeof target === \"function\"\r\n        ) {\r\n          return construct(target, argumentslist);\r\n        }\r\n      },\r\n      apply(t, thisarg, argarray) {\r\n        /* index.ts:153 Uncaught TypeError: Method Set.prototype.values called on incompatible receiver [object Object] */\r\n        if (isfunction(target)) {\r\n          /*  if (isSet(thisarg) || isMap(thisarg)) {\r\n            const result = apply(target, thisarg, argarray);\r\n            if (\r\n              target === Setprototype.delete ||\r\n              target === Setprototype.add ||\r\n              target === Setprototype.clear ||\r\n              (target === Mapprototype.set ||\r\n                target === Mapprototype.clear ||\r\n                target === Mapprototype.delete)\r\n            ) {\r\n              callback(ancestor, patharray, undefined, undefined);\r\n            }\r\n\r\n            return result;\r\n          } else { */\r\n          return apply(target, thisarg, argarray);\r\n        }\r\n        //   debugger;\r\n        // }\r\n      },\r\n      /* TypeError: 'get' on proxy: property 'prototype' is a read-only and non-configurable data property on the proxy target but the proxy did not return its actual value (expected '[object Symbol]' but got '[object Object]') */\r\n      getOwnPropertyDescriptor(t, k) {\r\n        var descripter = getOwnPropertyDescriptor(target, k);\r\n        if (isArray(target) && k === \"length\") {\r\n          return descripter;\r\n        } else {\r\n          if (descripter) {\r\n            descripter.configurable = true;\r\n            return descripter;\r\n          } else {\r\n            return;\r\n          }\r\n        }\r\n      },\r\n      //   return {\r\n      //     ...getOwnPropertyDescriptor(t, k),\r\n      //     ...{ configurable: true, writable: true }\r\n      //   };\r\n      // },\r\n\r\n      /* \r\n          https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/getOwnPropertyDescriptor\r\n          如果下列不变量被违反，代理将抛出一个 TypeError：\r\n  \r\n  getOwnPropertyDescriptor 必须返回一个 object 或 undefined。\r\n  如果属性作为目标对象的不可配置的属性存在，则该属性无法报告为不存在。\r\n  如果属性作为目标对象的属性存在，并且目标对象不可扩展，则该属性无法报告为不存在。\r\n  如果属性不存在作为目标对象的属性，并且目标对象不可扩展，则不能将其报告为存在。\r\n  属性不能被报告为不可配置，如果它不作为目标对象的自身属性存在，或者作为目标对象的可配置的属性存在。\r\n  Object.getOwnPropertyDescriptor（target）的结果可以使用 Object.defineProperty 应用于目标对象，也不会抛出异常。 */\r\n\r\n      /* https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/set\r\n  \r\n  如果违背以下的约束条件，proxy会抛出一个TypeError:\r\n  \r\n  若目标属性是不可写及不可配置的，则不能改变它的值。\r\n  如果目标属性没有配置存储方法，即set方法是undefined的，则不能设置它的值。\r\n  在严格模式下，若set方法返回false，则会抛出一个 TypeError 异常。\r\n  */\r\n      set(t, k, v) {\r\n        // console.log(\"set\", [t, k, v]);\r\n        if (\r\n          isfunction(callback)\r\n          //typeof callback === \"function\"\r\n        ) {\r\n          //throw Error(\"callback not defined!\");\r\n          callback(\r\n            ancestor,\r\n            [...patharray, String(k)] /* patharray.concat(k) */,\r\n            v,\r\n            get(target, k)\r\n            // target[k]\r\n          );\r\n        }\r\n\r\n        return set(target, k, v);\r\n        // return true;\r\n        /* Uncaught TypeError: 'set' on proxy: trap returned truish for property 'prototype' which exists in the proxy target as a non-configurable and non-writable data property with a different value */\r\n      },\r\n\r\n      /* \r\n          https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/get\r\n          如果违背了以下的约束，proxy会抛出 TypeError:\r\n  \r\n  如果要访问的目标属性是不可写以及不可配置的，则返回的值必须与该目标属性的值相同。\r\n  如果要访问的目标属性没有配置访问方法，即get方法是undefined的，则返回值必须为undefined。 */\r\n      get(t, k) {\r\n        // console.log(\"get\", [t, k]);\r\n        var value = get(target, k);\r\n\r\n        if (isfunction(value) && (isSet(target) || isMap(target))) {\r\n          return get(fakeobj, k).bind(fakeobj);\r\n        }\r\n        if (isfunction(value) || isobject(value)) {\r\n          // var descripter = getOwnPropertyDescriptor(t, k);\r\n          // /* descripter  可能是undefined */\r\n          // if (\r\n          //   descripter &&\r\n          //   descripter.writable === false &&\r\n          //   descripter.configurable === false\r\n          // ) {\r\n          //   console.warn(\r\n          //     `无法代理此属性!\\n如果要访问的目标属性是不可写以及不可配置的，\\n则返回的值必须与该目标属性的值相同。\\n`,\r\n          //     [t, k, value]\r\n          //   );\r\n          //   return value;\r\n          // } else {\r\n          return deepobserveaddpath(\r\n            value,\r\n            callback,\r\n            [...patharray, String(k)],\r\n            //  patharray.concat(k),\r\n            target\r\n          );\r\n          // }\r\n        } else {\r\n          return value;\r\n        }\r\n      }\r\n    });\r\n    // })(fakeobj);\r\n  } else {\r\n    return target;\r\n  }\r\n}\r\nexport default function observedeepagent<\r\n  T extends object | Function | any[] | Set<any> | Map<any, any>\r\n>(target: T, callback: Callback<T>): T {\r\n  if (\r\n    !isfunction(callback)\r\n    //typeof callback !== \"function\"\r\n  ) {\r\n    console.error(callback);\r\n    console.error(\"observe callback  invalid function !\");\r\n    throw Error();\r\n\r\n    //throw Error(\"callback not defined!\");\r\n    // setTimeout(() => {\r\n    // }, 0);\r\n\r\n    // callback(t, k, v);\r\n  }\r\n  if (\r\n    !isfunction(Proxy)\r\n    //typeof Proxy !== \"function\"\r\n  ) {\r\n    console.error(\"Proxy unsupported!\");\r\n    throw Error();\r\n\r\n    //setTimeout(() => {\r\n\r\n    // }, 0);\r\n    // return target;\r\n  }\r\n\r\n  // else\r\n  if (isfunction(target) || isobject(target)) {\r\n    return deepobserveaddpath(target, callback /*, [], target*/);\r\n  } else {\r\n    return target;\r\n  }\r\n}\r\n","// import deepobserve from \"deep-observe-agent-proxy\";\r\nimport { getproperyreadproxy } from \"./computed\";\r\nimport { usestste } from \"./context-mounted-unmounted\";\r\nimport handleobjectstate from \"./handleobjectstate\";\r\nimport ReactiveState, {\r\n  dispatchsymbol,\r\n  // textnodesymbol,\r\n  isReactiveState,\r\n  invalid_primitive_or_object_state\r\n} from \"./reactivestate\";\r\nimport { set } from \"./reflect\";\r\nimport { isobject, isprimitive, isfunction } from \"./util\";\r\nimport { UnwrapedState } from \"./watch\";\r\nexport const set_prototype = Set.prototype;\r\n\r\nexport default function<T extends UnwrapedState>(\r\n  init: ReactiveState<T>\r\n): ReactiveState<T>;\r\nexport default function<T extends UnwrapedState>(\r\n  init: Exclude<T, ReactiveState<any>> | undefined\r\n): ReactiveState<T>;\r\nexport default function<T extends UnwrapedState>(\r\n  init: Exclude<T, ReactiveState<any>> | ReactiveState<T> | undefined\r\n): ReactiveState<T> {\r\n  /* 收集组件内部创建的 ReactiveState*/\r\n  const state: ReactiveState<T> = createstate(init as any) as ReactiveState<T>;\r\n  usestste(state);\r\n  return state;\r\n}\r\n\r\nfunction createstate<T extends UnwrapedState>(\r\n  init: ReactiveState<T>\r\n): ReactiveState<T>;\r\nfunction createstate<T extends UnwrapedState>(\r\n  init: Exclude<T, ReactiveState<any>> | undefined\r\n): ReactiveState<T>;\r\n\r\nfunction createstate<T extends UnwrapedState>(\r\n  init: Exclude<T, ReactiveState<any>> | ReactiveState<T> | undefined\r\n) {\r\n  /*   if (!(isprimitive(init) || isobject(init) || isReactiveState(init))) {\r\n    console.error(init);\r\n    console.error(invalid_primitive_or_object_state);\r\n    throw TypeError();\r\n  } */\r\n  const inittype = isfunction(init)\r\n    ? \"function\"\r\n    : isprimitive(init)\r\n    ? \"primitive\"\r\n    : isobject(init)\r\n    ? \"object\"\r\n    : void 0;\r\n  if (isprimitive(init) || isfunction(init)) {\r\n    return getproperyreadproxy(\r\n      new Proxy(new ReactiveState(init), {\r\n        defineProperty() {\r\n          return false;\r\n        },\r\n        deleteProperty() {\r\n          return false;\r\n        },\r\n        set(target, key, value) {\r\n          /*  if (key === textnodesymbol) {\r\n          return set(target, key, value);\r\n        } */\r\n          if (\r\n            key === \"value\" &&\r\n            ((isprimitive(value) && inittype === \"primitive\") ||\r\n              (isfunction(value) && inittype === \"function\"))\r\n          ) {\r\n            if (target[key] !== value) {\r\n              /* 如果相同则不触发事件 */\r\n              set(target, key, value);\r\n              target[dispatchsymbol]();\r\n            }\r\n            return true;\r\n          } else {\r\n            console.error(value);\r\n            console.error(init);\r\n            console.error(invalid_primitive_or_object_state);\r\n            //   throw TypeError();\r\n            return false;\r\n          }\r\n        },\r\n        setPrototypeOf() {\r\n          return false;\r\n        }\r\n      })\r\n    );\r\n  } else if (\r\n    isReactiveState(init)\r\n    // init instanceof ReactiveState\r\n  ) {\r\n    // 如果init是个 ReactiveState，则对其解包，并生成新的 ReactiveState\r\n    return createstate(init.valueOf() as any);\r\n  } else if (isobject(init)) {\r\n    //如果在 ReactiveState属性中包含 ReactiveState，则转换成语法糖\r\n    //ReactiveState1=createstate( {aaaaa:ReactiveState2})\r\n    //\r\n    // else {\r\n    //   console.error(init);\r\n    //console.error(invalid_primitive_or_object_state)\r\n    //  throw TypeError();\r\n    //throw TypeError(\"invalid State\");\r\n    // }\r\n    return handleobjectstate(init);\r\n  } else {\r\n    throw Error();\r\n  }\r\n}\r\n\r\n// /*\r\n// let initobj=init\r\n// const containReactiveState=(isplainobject(init))&&Object.values(init).map(a=>isReactiveState(a)).includes(true)\r\n// const state_entries=Object.entries(init).filter(([key,a])=>isReactiveState(a))\r\n\r\n// if(\r\n// containReactiveState\r\n// ){\r\n\r\n// initobj={...init}\r\n\r\n// state_entries\r\n// .forEach(\r\n// ([key,state])=>{\r\n\r\n// defineProperty(initobj,key,{\r\n// enumerable:true,\r\n// get(){\r\n\r\n// return state.valueOf()\r\n\r\n// },\r\n// configurable: true\r\n\r\n// })\r\n\r\n// })\r\n\r\n// }\r\n// let reactive\r\n// =new ReactiveState(\r\n\r\n// initobj\r\n\r\n// )\r\n\r\n// if(containReactiveState){\r\n// state_entries.forEach(\r\n// ([key,state])=>{\r\n\r\n// watch(state,()=>{\r\n\r\n// reactive[dispatchsymbol](String(key));\r\n\r\n// })\r\n// }\r\n// )\r\n// }\r\n\r\n//     return new Proxy(\r\n// reactive\r\n\r\n// , {\r\n//     ownKeys(target) {\r\n//     return Array.from(\r\n//       new Set([...ownKeys(target), ...ownKeys(get(target, \"value\"))])\r\n//     );\r\n//   }\r\n//   ,\r\n//   setPrototypeOf() {\r\n//     return false;\r\n//   },\r\n//       defineProperty() {\r\n//         return false;\r\n//       },\r\n//       getOwnPropertyDescriptor(target, key) {\r\n//         const myvalue = get(target, \"value\");\r\n\r\n//         const descripter =\r\n//           getOwnPropertyDescriptor(target, key) ||\r\n//           getOwnPropertyDescriptor(myvalue, key);\r\n//         if (descripter) {\r\n//           descripter.configurable = true;\r\n//         }\r\n\r\n//         return descripter;\r\n//       },\r\n//       deleteProperty(target, key) {\r\n//         const myvalue = get(target, \"value\");\r\n//         if (has(myvalue, key)) {\r\n//           deleteProperty(myvalue, key);\r\n//           target[dispatchsymbol](String(key));\r\n//           return true;\r\n//         } else {\r\n//           return true;\r\n//         }\r\n//       },\r\n//       has(target, key) {\r\n//         const myvalue = get(target, \"value\");\r\n//         return has(target, key) || has(myvalue, key);\r\n//       },\r\n//       get(target, key) {\r\n//         const value = get(target, \"value\");\r\n\r\n//         if (\r\n//           key === \"value\" &&\r\n//           (isarray(value)  || isplainobject(value))\r\n//         ) {\r\n//           return deepobserve(get(target, key), (_target_, patharray) => {\r\n//             target[dispatchsymbol](patharray[0]);\r\n//           });\r\n//         } else if (has(target, key)) {\r\n//           return get(target, key);\r\n//         } else if (has(value, key)) {\r\n//           if (isSet(value) ) {\r\n//             const myvalue = value;\r\n//             if (key === \"add\") {\r\n//               return (add: any) => {\r\n//                 if (!set_prototype.has.call(myvalue, add)) {\r\n//                   const returnvalue = set_prototype[key].call(myvalue, add);\r\n//                   target[dispatchsymbol]();\r\n//                   return returnvalue;\r\n//                 }\r\n//               };\r\n//             } else if (key === \"delete\") {\r\n//               return (dele: any) => {\r\n//                 if (\r\n// set_prototype.has.call(myvalue, dele)) {\r\n//                   const returnvalue = set_prototype[key].call(myvalue, dele);\r\n//                   target[dispatchsymbol]();\r\n//                   return returnvalue;\r\n//                 }\r\n//               }\r\n// else if (key === \"clear\") {\r\n//               return () => {\r\n//                 if (value.length) {\r\n//                   const returnvalue = set_prototype[key].call(myvalue);\r\n//                   target[dispatchsymbol]();\r\n//                   return returnvalue;\r\n//                 }\r\n//               }\r\n// else {\r\n\r\n// return  get(value, key)\r\n// }\r\n\r\n//             }\r\n//           } else {\r\n// //只深度观察array和plainobject\r\n// if(\r\n// (isarray(value)  || isplainobject(value))\r\n// ){\r\n// return deepobserve(get(value, key), () => {\r\n//               target[dispatchsymbol](String(key));\r\n//             });\r\n// }\r\n// else{\r\n// return get(value, key)\r\n// }\r\n\r\n//           }\r\n\r\n//           /*  */\r\n//         }\r\n//     }},\r\n\r\n//     set(target, key, value)\r\n//      {\r\n\r\n// if(isReactiveState(value)){\r\n// //如果遇到 isReactiveState则自动解包\r\n// value=value.valueOf()\r\n\r\n// }\r\n//       /*   if (key === textnodesymbol) {\r\n//         return set(target, key, value);\r\n//       } */\r\n//       const myvalue = get(target, \"value\");\r\n//       if (key === \"value\" && isobject(value)) {\r\n//         // if (target[key] !== value) {\r\n//         set(target, key, value);\r\n//         target[dispatchsymbol]();\r\n\r\n//         // }\r\n//         return true;\r\n//       } else if (!has(target, key)) {\r\n//         set(myvalue, key, value);\r\n//         target[dispatchsymbol](String(key));\r\n\r\n//         //\r\n//       } else if (key === \"length\") {\r\n//         set(myvalue, key, value);\r\n//         target[dispatchsymbol](key);\r\n//       } else {\r\n//         return false;\r\n//       }\r\n//       return true;\r\n\r\n//     }\r\n\r\n// }) */\r\n","import { issymbol } from \"./util\";\r\nimport deepobserve from \"@masx200/deep-observe-agent-proxy\";\r\nimport { isplainobject, isarray, isSet, isobject } from \"./util\";\r\nimport ReactiveState, {\r\n  isReactiveState,\r\n  dispatchsymbol,\r\n  invalid_primitive_or_object_state\r\n} from \"./reactivestate\";\r\nimport {\r\n  defineProperty,\r\n  ownKeys,\r\n  get,\r\n  getOwnPropertyDescriptor,\r\n  has,\r\n  deleteProperty,\r\n  set\r\n} from \"./reflect\";\r\nimport { watch } from \"./watch\";\r\nimport { set_prototype } from \"./createstate\";\r\n\r\nexport default function(init: object): ReactiveState<object> {\r\n  let initobj = init;\r\n  const containReactiveState =\r\n    isplainobject(init) && Object.values(init).some(a => isReactiveState(a));\r\n  const state_entries = Object.entries(init).filter(e => {\r\n    const a = e[1];\r\n    return isReactiveState(a);\r\n  });\r\n  if (containReactiveState) {\r\n    initobj = { ...init };\r\n    state_entries.forEach(([key, state]) => {\r\n      defineProperty(initobj, key, {\r\n        enumerable: true,\r\n        get() {\r\n          return state.valueOf();\r\n        },\r\n        configurable: true\r\n      });\r\n    });\r\n  }\r\n  const reactive: ReactiveState<object> = new ReactiveState(initobj);\r\n  if (containReactiveState) {\r\n    state_entries.forEach(([key, state]) => {\r\n      watch(state, () => {\r\n        reactive[dispatchsymbol](String(key));\r\n      });\r\n    });\r\n    // console.log(reactive);\r\n  }\r\n  const objproxyhandler: ProxyHandler<object> = {};\r\n  objproxyhandler.ownKeys = target => {\r\n    return Array.from(\r\n      new Set([...ownKeys(target), ...ownKeys(get(target, \"value\"))])\r\n    );\r\n  };\r\n  objproxyhandler.setPrototypeOf = () => {\r\n    return false;\r\n  };\r\n  objproxyhandler.defineProperty = () => {\r\n    return false;\r\n  };\r\n  objproxyhandler.getOwnPropertyDescriptor = (\r\n    target: ReactiveState<object>,\r\n    key\r\n  ) => {\r\n    //如果是symbol属性返回undefined\r\n    if (issymbol(key)) {\r\n      return;\r\n    }\r\n    const myvalue = get(target, \"value\");\r\n\r\n    const descripter =\r\n      getOwnPropertyDescriptor(target, key) ||\r\n      getOwnPropertyDescriptor(myvalue, key);\r\n    if (descripter) {\r\n      descripter.configurable = true;\r\n    }\r\n\r\n    return descripter;\r\n  };\r\n  objproxyhandler.deleteProperty = (target: ReactiveState<object>, key) => {\r\n    const myvalue = get(target, \"value\");\r\n    if (has(myvalue, key)) {\r\n      deleteProperty(myvalue, key);\r\n      target[dispatchsymbol](String(key));\r\n      return true;\r\n    } else {\r\n      return true;\r\n    }\r\n  };\r\n  objproxyhandler.has = (target: ReactiveState<object>, key) => {\r\n    const myvalue = get(target, \"value\");\r\n    return has(target, key) || has(myvalue, key);\r\n  };\r\n  objproxyhandler.get = (target: ReactiveState<object>, key) => {\r\n    const value = get(target, \"value\");\r\n    if (key === \"value\" && (isarray(value) || isplainobject(value))) {\r\n      return deepobserve(get(target, key), (_target_, patharray) => {\r\n        target[dispatchsymbol](patharray[0]);\r\n      });\r\n    } else if (has(target, key)) {\r\n      return get(target, key);\r\n    } else if (has(value, key)) {\r\n      if (\r\n        isSet(value) &&\r\n        (key === \"add\" || key === \"clear\" || key === \"delete\")\r\n      ) {\r\n        switch (key) {\r\n          case \"add\": {\r\n            return ((add: any) => {\r\n              if (!set_prototype.has.call(value, add)) {\r\n                const returnvalue = set_prototype[key].call(value, add);\r\n                target[dispatchsymbol]();\r\n                return returnvalue;\r\n              }\r\n              return;\r\n            }).bind(value);\r\n          }\r\n          // break;\r\n          case \"delete\": {\r\n            return ((dele: any) => {\r\n              if (set_prototype.has.call(value, dele)) {\r\n                const returnvalue = set_prototype[key].call(value, dele);\r\n                target[dispatchsymbol]();\r\n                return returnvalue;\r\n              }\r\n              return;\r\n            }).bind(value);\r\n          }\r\n          // break;\r\n          case \"clear\": {\r\n            return (() => {\r\n              if (value.size) {\r\n                const returnvalue = set_prototype[key].call(value);\r\n                target[dispatchsymbol]();\r\n                return returnvalue;\r\n              }\r\n              return;\r\n            }).bind(value);\r\n          }\r\n          // break;\r\n        }\r\n      } else if (isobject(value)) {\r\n        return deepobserve(get(value, key), () => {\r\n          target[dispatchsymbol](String(key));\r\n        });\r\n      } else {\r\n        return get(value, key);\r\n      }\r\n    }\r\n  };\r\n  objproxyhandler.set = (target: ReactiveState<object>, key, value) => {\r\n    if (isReactiveState(value)) {\r\n      //如果遇到 isReactiveState则自动解包\r\n      value = value.valueOf();\r\n    }\r\n    const myvalue = get(target, \"value\");\r\n    if (key === \"value\" && isobject(value)) {\r\n      // if (target[key] !== value) {\r\n      set(target, key, value);\r\n      target[dispatchsymbol]();\r\n      return true;\r\n    } else if (!has(target, key)) {\r\n      set(myvalue, key, value);\r\n      target[dispatchsymbol](String(key));\r\n      return true;\r\n      //\r\n    } else {\r\n      console.error(value);\r\n      console.error(init);\r\n      console.error(invalid_primitive_or_object_state);\r\n      return false;\r\n    }\r\n    // return true;\r\n  };\r\n  return new Proxy(\r\n    reactive,\r\n\r\n    objproxyhandler\r\n  ) as ReactiveState<object>;\r\n}\r\n","export function isCSSStyleRule(a: any): a is CSSStyleRule {\r\n  return gettagtype(a) === \"CSSStyleRule\";\r\n}\r\nimport createElement from \"./createelement\";\r\nimport { createcssBlob } from \"./cssurlblob\";\r\n// import { RegExp } from \"core-js\";\r\nimport {\r\n  appendchild,\r\n  createanotherhtmldocument /* , insertfirst */\r\n} from \"./dom\";\r\nimport { get } from \"./reflect\";\r\nimport render from \"./render-vdom-to-real\";\r\nimport { gettagtype } from \"./util\";\r\nexport function isCSSMediaRule(a: any): a is CSSMediaRule {\r\n  return gettagtype(a) === \"CSSMediaRule\";\r\n}\r\nexport function isCSSImportRule(a: any): a is CSSImportRule {\r\n  return gettagtype(a) === \"CSSImportRule\";\r\n}\r\n\r\nexport function parsecsstext(text: string): Array<CSSRule> {\r\n  const styleelement = render(\r\n    createElement(\"style\", [text])\r\n  ) as HTMLStyleElement;\r\n  //   console.dir(styleelement);\r\n  /* 只有添加到document之后才会有sheet */\r\n  //const otherdocument = document.implementation.createHTMLDocument(\"\");\r\n  const otherdocument = createanotherhtmldocument();\r\n  appendchild(otherdocument.documentElement, styleelement);\r\n  //otherdocument.firstElementChild.appendChild(styleelement);\r\n  return Array.from(\r\n    get(\r\n      get(styleelement, \"sheet\"),\r\n\r\n      \"cssRules\"\r\n    )\r\n  );\r\n}\r\n\r\nexport function selectoraddprefix(cssstylerule: CSSStyleRule, prefix: string) {\r\n  /* 突然发现Edge浏览器的 CSSStyleRule的selectorText属性居然是只读的?*/\r\n  //css 选择器可能有多个\r\n  //h1,p,h3,div\r\n  const selectorold = cssstylerule.selectorText;\r\n  const stylebodyold = cssstylerule.cssText.slice(selectorold.length);\r\n  const selectorTextss = selectorold;\r\n\r\n  const selectorarray = selectorTextss.split(\",\");\r\n  const selectoraftertransform = selectorarray\r\n    .map(selectorTextone => {\r\n      let prefixselector = prefix + \" \" + selectorTextone;\r\n\r\n      if (selectorTextone.startsWith(\"*\")) {\r\n        prefixselector =\r\n          prefixselector + \",\" + selectorTextone.replace(\"*\", prefix);\r\n      }\r\n      return prefixselector;\r\n    })\r\n    .join(\",\");\r\n\r\n  /*   cssstylerule.selectorText = selectoraftertransform;\r\n  if (cssstylerule.selectorText.startsWith(prefix)) {\r\n    return cssstylerule;\r\n  } else { */\r\n  // console.trace();\r\n  return {\r\n    type: cssstylerule.type,\r\n    parentRule: cssstylerule.parentRule,\r\n    parentStyleSheet: cssstylerule.parentStyleSheet,\r\n    style: cssstylerule.style,\r\n    styleMap: get(cssstylerule, \"styleMap\"),\r\n    selectorText: selectoraftertransform,\r\n    cssText: selectoraftertransform + stylebodyold,\r\n    // cssText: selectoraftertransform + stylebodyold,\r\n    // selectorText: selectoraftertransform,\r\n    [Symbol.toStringTag]: \"CSSStyleRule\"\r\n  };\r\n  // }\r\n\r\n  /*\r\n  const prefixselector = prefix + \" \" + selectorText;\r\n  if (selectorText.startsWith(\"*\")) {\r\n    cssstylerule.selectorText =\r\n      selectorText.replace(\"*\", prefix) + \",\" + prefixselector;\r\n    /* 对于'* '的处理,变成两个selectorrule*/\r\n\r\n  /* \r\n    *{font-size:80px !important;}\r\np{color:blue !important;} \r\n*/\r\n  /* \r\n    \r\n    q-9, q-9 * { font-size: 80px !important; }\r\nq-9 p { color: blue !important; }\r\n\r\n    */\r\n  /* } else {\r\n    cssstylerule.selectorText = prefixselector;\r\n  }\r\n*/\r\n}\r\n\r\nexport function prefixcssrules(\r\n  cssRulesarray: Array<CSSRule>,\r\n  prefix: string\r\n): Array<CSSRule> {\r\n  return cssRulesarray\r\n    .map((cssrule: CSSRule) => {\r\n      if (isCSSStyleRule(cssrule)) {\r\n        const resultoutput = selectoraddprefix(cssrule, prefix);\r\n        // console.log(resultoutput);\r\n        return resultoutput;\r\n      } else if (isCSSMediaRule(cssrule)) {\r\n        prefixcssrules([...cssrule.cssRules], prefix);\r\n        return cssrule;\r\n      } else if (isCSSImportRule(cssrule)) {\r\n        //把url放入\r\n        savestyleblob(prefix, undefined, cssrule.href);\r\n        return;\r\n      } else {\r\n        return cssrule;\r\n      }\r\n    })\r\n    .filter(Boolean) as Array<CSSRule>;\r\n}\r\n\r\nconst componentsstylesheet: Record<string, Set<string>> = {};\r\n// { [key: string]: Set<string> }\r\n\r\nexport { componentsstylesheet };\r\nexport function savestyleblob(\r\n  tagname: string,\r\n  csstext?: string,\r\n  urltext?: string\r\n) {\r\n  tagname = tagname.toLowerCase();\r\n  if (!componentsstylesheet[tagname]) {\r\n    componentsstylesheet[tagname] = new Set();\r\n  }\r\n  if (csstext) {\r\n    componentsstylesheet[tagname].add(createcssBlob(csstext));\r\n  } else if (urltext) {\r\n    componentsstylesheet[tagname].add(urltext);\r\n  }\r\n}\r\nexport function cssrulestocsstext(cssrules: Array<CSSRule>): string {\r\n  return cssrules.map(c => c.cssText).join(\"\\n\");\r\n  // .replace(/\\n/g, \"\");\r\n}\r\nexport function createlinkstylesheet(url: string): HTMLLinkElement {\r\n  return render(\r\n    createElement(\"link\", { href: url, rel: \"stylesheet\" })\r\n  ) as HTMLLinkElement;\r\n}\r\nexport function transformcsstext(text: string, prefix: string): string {\r\n  const css = text;\r\n  const cssomold = parsecsstext(css);\r\n  const cssomnew = prefixcssrules(cssomold, prefix).filter(Boolean);\r\n  //   console.log(cssomnew);\r\n  //   console.log([css, prefix, cssomold, cssomnew]);\r\n  const cssnewtext = cssrulestocsstext(cssomnew);\r\n  //   console.log([text, cssomold, cssomnew, cssnewtext]);\r\n  return cssnewtext;\r\n}\r\nexport function registercssprefix(text: string, prefix: string) {\r\n  const css = text;\r\n  const cssnewtext = transformcsstext(css, prefix);\r\n  //   cssnewtext.forEach(url => {\r\n  /* 把css文字转成url放入 */\r\n  savestyleblob(prefix, cssnewtext);\r\n  //   });\r\n}\r\nexport function loadlinkstyle(\r\n  stylelinkelement: HTMLElement,\r\n  container: HTMLElement | Element | SVGSVGElement | SVGElement\r\n): Promise<void> {\r\n  return new Promise(rs => {\r\n    const loaderrorfun = () => {\r\n      stylelinkelement.onload = stylelinkelement.onerror = null;\r\n      rs();\r\n      //   console.log(stylelinkelement.href);\r\n    };\r\n    stylelinkelement.onload = loaderrorfun;\r\n    stylelinkelement.onerror = loaderrorfun;\r\n    appendchild(container, stylelinkelement);\r\n  });\r\n}\r\n\r\nexport async function waitloadallstyle(\r\n  prefix: string,\r\n  containerthis: Element | HTMLElement | SVGSVGElement | SVGElement\r\n) {\r\n  await Promise.all(\r\n    [...componentsstylesheet[prefix]].map(styleurl =>\r\n      loadlinkstyle(createlinkstylesheet(styleurl), containerthis)\r\n    )\r\n  );\r\n}\r\n","export { createcssBlob };\r\nfunction createcssBlob(source: string) {\r\n  return URL.createObjectURL(new Blob([source], { type: \"text/css\" }));\r\n}\r\n","export const readysymbol = Symbol(\"readystate\");\r\n","export function setimmediate(fun: Function) {\r\n  return Promise.resolve().then(() => fun());\r\n}\r\n","export const innerwatchrecords = Symbol(\"innerwatchrecord\");\r\nexport const innerstatesymbol = Symbol(\"innerstate\");\r\nimport createeleattragentreadwrite from \"@masx200/dom-element-attribute-agent-proxy\";\r\nimport { AttrChange, attributeChangedCallback } from \"./attrchange\";\r\nimport {\r\n  closectx,\r\n  getMounted,\r\n  getstates,\r\n  getUnMounted,\r\n  getwatchrecords,\r\n  invalid_Function,\r\n  openctx\r\n} from \"./context-mounted-unmounted\";\r\nimport createstate from \"./createstate\";\r\nimport { Custom } from \"./customclass\";\r\nimport { seteletext } from \"./dom\";\r\nimport { onmounted, onunmounted } from \"./element-onmount-unmount\";\r\nimport { isvalidvdom } from \"./html\";\r\n// import { Promise } from \"q\";\r\n// import { inflate } from \"zlib\";\r\nimport { componentsymbol } from \"./iscomponent\";\r\n// import { insertfirst } from \"./dom\";\r\nimport mount from \"./mount-real-element\";\r\nimport { /* createApp, */ invalid_Virtualdom } from \"./MountElement\";\r\nimport {\r\n  /* parsecsstext,\r\n            prefixcssrules,\r\n            cssrulestocsstext, */\r\n  //   savestyleblob,\r\n  componentsstylesheet,\r\n  //   createlinkstylesheet,\r\n  //   transformcsstext,\r\n  registercssprefix,\r\n  /*  loadlinkstyle,\r\n            createlinkstylesheet */\r\n  //   savestyleblob\r\n  waitloadallstyle\r\n} from \"./parsecss-transformcss\";\r\nimport ReactiveState /* , { dispatchsymbol } */ from \"./reactivestate\";\r\nimport readonlyproxy from \"./readonlyproxy\";\r\nimport { readysymbol } from \"./readysymbol\";\r\nimport { apply, get } from \"./reflect\";\r\nimport render from \"./render-vdom-to-real\";\r\nimport { setimmediate } from \"./setimmediate\";\r\nimport { toArray } from \"./toArray\";\r\nimport { isArray, isfunction, isobject, isstring } from \"./util\";\r\n// import { Class } from \"./rendervdomtoreal\";\r\nimport Virtualdom from \"./VirtualElement\";\r\nexport const attributessymbol = Symbol(\"attributes\");\r\nconst elementsymbol = Symbol(\"innerelement\");\r\nconst vdomsymbol = Symbol(\"innervdom\");\r\nconst mountedsymbol = Symbol(\"mounted\");\r\nconst unmountedsymbol = Symbol(\"unmounted\");\r\nexport interface Htmlelementconstructor {\r\n  new (): HTMLElement;\r\n  prototype: HTMLElement;\r\n  defaultProps?: Record<string, any>;\r\n  css?: string;\r\n}\r\nimport { cached_create_componet } from \"./cached-map\";\r\nexport function createComponent(custfun: Custom): Htmlelementconstructor {\r\n  if (isfunction(custfun)) {\r\n    const cached_class = cached_create_componet.get(custfun);\r\n    if (cached_class) {\r\n      return cached_class;\r\n    }\r\n\r\n    const defaultProps = get(custfun, \"defaultProps\"); //custfun[\"defaultProps\"];\r\n    const css = get(custfun, \"css\");\r\n    class Component extends AttrChange {\r\n      [innerwatchrecords]: [ReactiveState<any>, Function][];\r\n      [attributessymbol]: Record<string, ReactiveState<any>> = {};\r\n      // new (propsjson?: object | undefined, children?: any[] | undefined): HTMLElement\r\n\r\n      //   constructor(...args: any[]);\r\n      constructor(\r\n        propsjson: object = {},\r\n        children: any[] = [] /* , options?: any */ //   : HTMLElement;\r\n      ) {\r\n        super();\r\n        // this[attributessymbol] = {};\r\n        const css = get(this.constructor, \"css\");\r\n\r\n        if (css) {\r\n          const prefix = this.tagName.toLowerCase();\r\n          if (!componentsstylesheet[prefix]) {\r\n            registercssprefix(css, prefix);\r\n            /* 把css文本先解析成cssom ,然后添加前缀,然后转成字符串,生成blob,再生成link-stylesheet,添加*/\r\n            /* const cssomold = parsecsstext(css);\r\n                const cssomnew = prefixcssrules(cssomold, prefix);\r\n                //   console.log([css, prefix, cssomold, cssomnew]);\r\n                const cssnewtext = cssrulestocsstext(cssomnew); */\r\n            // const cssnewtext = transformcsstext(css, prefix);\r\n            // savestyleblob(prefix, cssnewtext);\r\n            // console.log(cssnewtext, componentsstylesheet);\r\n          }\r\n        }\r\n        // const defaultProps = get(this.constructor, \"defaultProps\");\r\n        // this.constructor[\"defaultProps\"];\r\n        const attrs: Record<string, any> = createeleattragentreadwrite(this);\r\n        //   const props = {};\r\n        /*    if (isobject(defaultProps)) {\r\n          Object.assign(attrs, defaultProps);\r\n          // Object.assign(props, this.constructor[\"defaultProps\"]);\r\n        } */\r\n        if (isobject(propsjson)) {\r\n          Object.assign(attrs, propsjson);\r\n          // Object.assign(props, propsjson);\r\n        }\r\n        // console.log({ ...attrs });\r\n        //   this[attributessymbol] = createeleattragentreadwrite(this);\r\n        // const props = createeleattragentreadwrite(this);/\r\n        const props = attrs;\r\n        openctx();\r\n\r\n        const thisattributess = Object.fromEntries(\r\n          Object.entries(props).map(([key, value]) => [key, createstate(value)])\r\n        );\r\n        this[attributessymbol] = thisattributess;\r\n        // console.log({ props, thisattributess });\r\n        // debugger;\r\n        /* 把attributes的reactivestates也放进innerstates中 */\r\n        const readonlyprop = readonlyproxy(\r\n          Object.fromEntries(\r\n            Object.entries(thisattributess).map(([key, value]) => [\r\n              key,\r\n              readonlyproxy(value)\r\n            ])\r\n          )\r\n        );\r\n\r\n        let possiblyvirtualdom:\r\n          | string\r\n          | Virtualdom<any>\r\n          | ReactiveState<any>\r\n          | (string | Virtualdom<any> | ReactiveState<any>)[]\r\n          | any;\r\n        try {\r\n          possiblyvirtualdom = apply(custfun, undefined, [\r\n            readonlyprop,\r\n            children.flat(1 / 0)\r\n          ]);\r\n          /* custfun.call(\r\n            undefined,\r\n            //让组件里面无法修改props的reactivestate的value\r\n            // readonlyproxy(thisattributess),\r\n            readonlyprop,\r\n            children */\r\n          // );\r\n        } catch (error) {\r\n          closectx();\r\n          console.error(error);\r\n          throw error;\r\n        }\r\n\r\n        if (isArray(possiblyvirtualdom)) {\r\n          possiblyvirtualdom = possiblyvirtualdom\r\n            .flat(Infinity)\r\n            .filter(Boolean);\r\n        }\r\n        if (isvalidvdom(possiblyvirtualdom)) {\r\n          const thisvdomsymbol /* isArray(possiblyvirtualdom)\r\n                ? possiblyvirtualdom\r\n                : [possiblyvirtualdom]; */ = toArray(\r\n            possiblyvirtualdom\r\n          );\r\n          //\r\n          this[vdomsymbol] = thisvdomsymbol.flat(Infinity).filter(Boolean);\r\n          this[mountedsymbol] = getMounted();\r\n          this[unmountedsymbol] = getUnMounted();\r\n          this[innerstatesymbol] = getstates();\r\n          this[innerwatchrecords] = getwatchrecords();\r\n          closectx();\r\n        } else {\r\n          closectx();\r\n          console.error(possiblyvirtualdom);\r\n          console.error(invalid_Virtualdom);\r\n          throw TypeError();\r\n        }\r\n\r\n        //   this[mountedsymbol] = getMounted();\r\n        //   this[unmountedsymbol] = getUnMounted();\r\n      }\r\n      //   prototype!: HTMLElement;\r\n      //   defaultProps?: { [key: string]: any } | undefined;\r\n      //  css?: string | undefined;\r\n      [innerstatesymbol]: Array<ReactiveState<any>>;\r\n      static [componentsymbol] = componentsymbol;\r\n      static css = isstring(css) && css ? css : undefined;\r\n      [readysymbol] = false;\r\n      [mountedsymbol]: Array<Function>;\r\n      [unmountedsymbol]: Array<Function>;\r\n      static defaultProps = isobject(defaultProps)\r\n        ? JSON.parse(JSON.stringify(defaultProps))\r\n        : undefined;\r\n\r\n      [elementsymbol]: Array<Node>;\r\n      [vdomsymbol]: Array<\r\n        Virtualdom<any> | ReactiveState<any> | string | number\r\n      >;\r\n\r\n      async connectedCallback() {\r\n        if (!this[elementsymbol]) {\r\n          this[elementsymbol] = render(this[vdomsymbol]).flat(Infinity);\r\n        }\r\n        if (!this[readysymbol]) {\r\n          this[readysymbol] = true;\r\n          /* 这段代码只在初始化时执行一次 */\r\n          //   mount(this[elementsymbol], this, false);\r\n\r\n          const css = get(this.constructor, \"css\");\r\n          const prefix = this.tagName.toLowerCase();\r\n          if (css && componentsstylesheet[prefix]) {\r\n            /* 先清空当前组件 的children */\r\n\r\n            seteletext(this, \"\");\r\n            /* 应该要等待css加载完成之后再渲染出来,否则会有页面跳动 */\r\n            /* 是css里面的@import导致的 */\r\n            /* 挂载样式到组件最前面 */\r\n            //   console.log(componentsstylesheet[prefix]);\r\n            // if (componentsstylesheet[prefix]) {\r\n            /* const stylelinkelement = createlinkstylesheet(\r\n              componentsstylesheet[prefix]\r\n            ); */\r\n            /*   stylelinkelement.onload = () => {\r\n              mount(this[elementsymbol], this, false);\r\n            };\r\n            stylelinkelement.onerror = () => {\r\n              mount(this[elementsymbol], this, false);\r\n            }; */\r\n            // insertfirst(this, stylelinkelement);\r\n            // }\r\n            /*  Promise.all(\r\n              [...componentsstylesheet[prefix]].map(styleurl =>\r\n                loadlinkstyle(createlinkstylesheet(styleurl), this)\r\n              )\r\n            )\r\n*/\r\n            waitloadallstyle(prefix, this).then(() => {\r\n              //   console.log(\"style load all\");\r\n              //   console.log(\"mount1\");\r\n              mount(this[elementsymbol], this, false);\r\n            });\r\n          } else {\r\n            // console.log(\"mount2\");\r\n            mount(this[elementsymbol], this);\r\n          }\r\n        }\r\n        //把mounted callback 异步执行\r\n        this[mountedsymbol].forEach(f => {\r\n          setimmediate(f);\r\n        });\r\n        onmounted(this);\r\n      }\r\n      async disconnectedCallback() {\r\n        this[unmountedsymbol].forEach(f => {\r\n          setimmediate(f);\r\n        });\r\n\r\n        onunmounted(this);\r\n      }\r\n      [attributeChangedCallback](\r\n        name: string /* , oldValue: any, newValue: any */\r\n      ) {\r\n        // console.log(this[attributessymbol]);\r\n        // if (!this[attributessymbol]) {\r\n        //   this[attributessymbol] = {};\r\n        // }\r\n        if (this[readysymbol]) {\r\n          {\r\n            const propreactivestate = this[attributessymbol][name];\r\n            const attributes = createeleattragentreadwrite(this) as Record<\r\n              string,\r\n              any\r\n            >;\r\n            if (propreactivestate) {\r\n              propreactivestate[\"value\"] = attributes[name];\r\n              /* 当属性改变时要跟ReactiveState同步状态 */\r\n              /*   set(\r\n            get(this, attributessymbol)[name],\r\n            \"value,\",\r\n            (createeleattragentreadwrite(this) as { [key: string]: any })[\r\n              name\r\n            ] as any */\r\n              //   );\r\n              /*   this[attributessymbol][name].value = createeleattragentreadwrite(\r\n            this\r\n          )[name]; */\r\n              //   this[attributessymbol][name][dispatchsymbol]();\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n    cached_create_componet.set(custfun, Component);\r\n    return Component;\r\n  } else {\r\n    console.error(custfun);\r\n    console.error(invalid_Function);\r\n    throw TypeError();\r\n  }\r\n}\r\n","import { innerstatesymbol, innerwatchrecords } from \"./createComponent\";\r\nimport { getdomchildren } from \"./dom\";\r\nimport { readdlisteners, removelisteners } from \"./handle-onevent\";\r\nimport { isNode } from \"./MountElement\";\r\nimport ReactiveState, {\r\n  addonelistner,\r\n  //   callbackmap,\r\n  removeonelistner,\r\n  dispatchsymbol\r\n} from \"./reactivestate\";\r\nimport { get, has } from \"./reflect\";\r\nimport { bindstatesymbol } from \"./render-vdom-to-real\";\r\nimport { isArray } from \"./util\";\r\nimport { rewatch /* , unwatch */, unwatch } from \"./watch\";\r\nimport { cached_callback_eventlistner } from \"./cached-map\";\r\n\r\nexport function onmounted(ele: Element | Node | Array<Node>) {\r\n  if (isArray(ele)) {\r\n    ele.forEach(e => {\r\n      onmounted(e);\r\n    });\r\n  } else if (\r\n    isNode(ele)\r\n    //   ele instanceof Node\r\n  ) {\r\n    // if (has(ele, eventlistenerssymbol)) {\r\n    readdlisteners(ele);\r\n    // }\r\n    //全局共享状态\r\n    if (\r\n      has(ele, bindstatesymbol)\r\n      // ele[bindstatesymbol]\r\n    ) {\r\n      (get(ele, bindstatesymbol) as ReactiveState<any>[])\r\n\r\n        /*  ele[bindstatesymbol] */\r\n        .forEach((state: ReactiveState<any>) => {\r\n          rewatch(state);\r\n\r\n          /* 当组件挂载时把状态跟dom元素同步一次 */\r\n          state[dispatchsymbol]();\r\n        });\r\n    }\r\n    if (\r\n      has(ele, innerstatesymbol)\r\n      //   ele[innerstatesymbol]\r\n    ) {\r\n      (get(ele, innerstatesymbol) as ReactiveState<any>[]).forEach(\r\n        (state: ReactiveState<any>) => {\r\n          rewatch(state);\r\n        }\r\n      );\r\n    }\r\n    // readdlisteners(ele);\r\n    /* 记录组件中使用的watch的state和callback,\r\n组件卸载时removeeventlistener,\r\n组件挂载时addeventlistener\r\n*/\r\n    if (has(ele, innerwatchrecords)) {\r\n      const watchrecords = get(ele, innerwatchrecords) as [\r\n        ReactiveState<any>,\r\n        Function\r\n      ][];\r\n      watchrecords.forEach(([state, callback]) => {\r\n        const eventlistener = cached_callback_eventlistner.get(callback);\r\n        /*   if (!eventlistener) {\r\n          throw new Error();\r\n        } */\r\n        if (eventlistener) {\r\n          state[addonelistner](eventlistener);\r\n        }\r\n      });\r\n    }\r\n    onmounted(getdomchildren(ele));\r\n  }\r\n\r\n  //\r\n}\r\nexport function onunmounted(ele: Element | Node | Array<Node>) {\r\n  if (isArray(ele)) {\r\n    ele.forEach(e => {\r\n      onunmounted(e);\r\n    });\r\n  } else if (\r\n    isNode(ele)\r\n    //   ele instanceof Node\r\n  ) {\r\n    // if (\r\n    //   has(ele, eventlistenerssymbol)\r\n    //   // ele[eventlistenerssymbol]\r\n    // ) {\r\n    removelisteners(ele);\r\n    // }\r\n    /*   if (ele[bindstatesymbol]) {\r\n      ele[bindstatesymbol].forEach((state: ReactiveState) => {\r\n        unwatch(state);\r\n      });\r\n */\r\n    // readdlisteners(ele);\r\n    // }\r\n    //\r\n    /* 组件卸载时unwatch组件内部的 ReactiveState*/\r\n    if (\r\n      has(ele, innerstatesymbol)\r\n      // ele[innerstatesymbol]\r\n    ) {\r\n      (get(ele, innerstatesymbol) as ReactiveState<any>[]).forEach(\r\n        (state: ReactiveState<any>) => {\r\n          unwatch(state);\r\n        }\r\n      );\r\n    }\r\n    if (has(ele, innerwatchrecords)) {\r\n      const watchrecords = get(ele, innerwatchrecords) as [\r\n        ReactiveState<any>,\r\n        Function\r\n      ][];\r\n      watchrecords.forEach(([state, callback]) => {\r\n        const eventlistener = cached_callback_eventlistner.get(callback);\r\n        /*  if (!eventlistener) {\r\n          throw new Error();\r\n        } */\r\n        if (eventlistener) {\r\n          state[removeonelistner](eventlistener);\r\n        }\r\n      });\r\n    }\r\n    onunmounted(getdomchildren(ele));\r\n  }\r\n}\r\n","import createeleattr from \"@masx200/dom-element-attribute-agent-proxy\";\r\nimport { AttrChange, attributeChangedCallback } from \"./attrchange\";\r\nimport { invalid_Virtualdom } from \"./MountElement\";\r\nimport createElement from \"./createelement\";\r\nimport { setelehtml } from \"./dom\";\r\n// const readysymbol = Symbol(\"ready\");\r\nimport { onmounted, onunmounted } from \"./element-onmount-unmount\";\r\nimport { isvalidvdom } from \"./html\";\r\nimport { componentsymbol } from \"./iscomponent\";\r\nimport mount from \"./mount-real-element\";\r\nimport ReactiveState, { isReactiveState } from \"./reactivestate\";\r\nimport { readysymbol } from \"./readysymbol\";\r\nimport { get } from \"./reflect\";\r\nimport render from \"./render-vdom-to-real\";\r\n// import mount from \"./mount\";\r\nimport { isboolean, isundefined } from \"./util\";\r\n// import createElement from \"./createelement\";\r\nimport Virtualdom, { Vdomchildren } from \"./VirtualElement\";\r\nimport { Htmlelementconstructor } from \"./createComponent\";\r\nexport type VaildVDom =\r\n  | Virtualdom<any>\r\n  | string\r\n  | number\r\n  | Vdomchildren\r\n  | ReactiveState<any>;\r\n// import { readysymbol } from \"./createComponent\";\r\nexport const invalid_ReactiveState = \"invalid ReactiveState\";\r\nconst truevdomsymbol = Symbol(\"truevdom\");\r\nconst falsevdomsymbol = Symbol(\"falsevdom\");\r\nconst trueelesymbol = Symbol(\"trueele\");\r\nconst falseelesymbol = Symbol(\"falseele\");\r\nconst handletrue = Symbol(\"handletrue\");\r\nconst handlefalse = Symbol(\"handlefalse\");\r\n\r\nexport default function(\r\n  conditon: ReactiveState<any> | boolean,\r\n  iftrue?: VaildVDom,\r\n  iffalse?: VaildVDom\r\n): Virtualdom<Htmlelementconstructor> {\r\n  if (!(isReactiveState(conditon) || isboolean(conditon))) {\r\n    console.error(conditon);\r\n    console.error(invalid_ReactiveState);\r\n    throw TypeError();\r\n  }\r\n  [iftrue, iffalse].forEach(a => {\r\n    if (!(isundefined(a) || isvalidvdom(a))) {\r\n      console.error(a);\r\n      console.error(invalid_Virtualdom);\r\n      throw new TypeError();\r\n    }\r\n  });\r\n  const options = { true: iftrue, false: iffalse };\r\n  class Condition extends AttrChange {\r\n    // prototype!: HTMLElement;\r\n    // defaultProps?: { [key: string]: any } | undefined;\r\n    // css?: string | undefined;\r\n    static [componentsymbol] = componentsymbol;\r\n    [readysymbol] = false;\r\n    constructor() /* propsjson?: object, children?: any[], options: object = {} */ {\r\n      super();\r\n      // if(){}\r\n      const optionstrue = get(options, \"true\");\r\n      const optionsfalse = get(options, \"false\");\r\n      this[truevdomsymbol] =\r\n        /*isarray(optionstrue)\r\n        ? optionstrue.filter(Boolean)\r\n        : */\r\n        [optionstrue].flat(1 / 0).filter(Boolean);\r\n      this[falsevdomsymbol] =\r\n        /* isarray(optionsfalse)\r\n        ? optionsfalse.filter(Boolean)\r\n        : */\r\n\r\n        [optionsfalse].flat(1 / 0).filter(Boolean);\r\n      // optionsfalse;\r\n    }\r\n    [falseelesymbol]: any[];\r\n    [trueelesymbol]: any[];\r\n    [truevdomsymbol]: any[];\r\n    [falsevdomsymbol]: any[];\r\n    //   [readysymbol] = false;\r\n    [handlefalse]() {\r\n      setelehtml(this, \"\");\r\n      if (this[falsevdomsymbol]) {\r\n        if (!this[falseelesymbol]) {\r\n          // } else {\r\n          this[falseelesymbol] = render(this[falsevdomsymbol]);\r\n          // this[falsevdomsymbol].map(e => render(e));\r\n        }\r\n        //   mount(this[falseelesymbol], this);\r\n        const elementtomount = this[falseelesymbol];\r\n        mount(elementtomount, this);\r\n        elementtomount.forEach(e => onmounted(e));\r\n        if (this[trueelesymbol]) {\r\n          this[trueelesymbol].forEach(e => onunmounted(e));\r\n        }\r\n      }\r\n    }\r\n    [handletrue]() {\r\n      setelehtml(this, \"\");\r\n      if (this[truevdomsymbol]) {\r\n        if (!this[trueelesymbol]) {\r\n          this[trueelesymbol] = render(this[truevdomsymbol]);\r\n          // this[truevdomsymbol].map(e => render(e));\r\n        }\r\n        //\r\n        //   mount(this[trueelesymbol], this);\r\n        const elementtomount = this[trueelesymbol];\r\n        mount(elementtomount, this);\r\n        elementtomount.forEach(e => onmounted(e));\r\n        if (this[falseelesymbol]) {\r\n          this[falseelesymbol].forEach(e => onunmounted(e));\r\n        }\r\n      }\r\n    }\r\n    async connectedCallback() {\r\n      if (!this[readysymbol]) {\r\n        // createApp(this[elementsymbol], this);\r\n        this[readysymbol] = true;\r\n\r\n        const attrs: { [key: string]: any } = createeleattr(this);\r\n        // console.log(attrs);\r\n        if (true === attrs[\"value\"]) {\r\n          get(this, handletrue).call(this);\r\n        }\r\n        if (false === attrs[\"value\"]) {\r\n          get(this, handlefalse).call(this);\r\n          //\r\n        }\r\n      }\r\n      onmounted(this);\r\n      //\r\n    }\r\n    async disconnectedCallback() {\r\n      onunmounted(this);\r\n    }\r\n\r\n    [attributeChangedCallback](\r\n      name: string /* , oldValue: any, newValue: any */\r\n    ) {\r\n      if (this[readysymbol]) {\r\n        // console.log(name, oldValue, newValue);\r\n        if (name === \"value\") {\r\n          const attrs: { [key: string]: any } = createeleattr(this);\r\n          //   console.log(attrs);\r\n          if (true === attrs[\"value\"]) {\r\n            this[handletrue]();\r\n            //\r\n          }\r\n          if (false === attrs[\"value\"]) {\r\n            this[handlefalse]();\r\n            //\r\n          }\r\n        }\r\n\r\n        //\r\n      }\r\n    }\r\n  }\r\n  /* vdom.options = { true: iftrue, false: iffalse }; */\r\n  const vdom = createElement(Condition, { value: conditon });\r\n  return vdom;\r\n  /*  */\r\n}\r\n","import { invalid_ReactiveState } from \"./conditon\";\r\nimport { invalid_Virtualdom } from \"./MountElement\";\r\nimport directives from \"./extend-directive\";\r\nimport ReactiveState, {\r\n  // ReactiveState,\r\n  isReactiveState\r\n} from \"./reactivestate\";\r\nimport { set, get } from \"./reflect\";\r\nimport { toArray } from \"./toArray\";\r\nimport Virtualdom from \"./VirtualElement\";\r\nimport { querySelectorAll } from \"./dom\";\r\ndirectives({\r\n  value(value, element, vdom) {\r\n    model(\r\n      [\"input\", \"textarea\", \"select\"],\r\n      \"value\",\r\n      \"value\",\r\n      [\"change\", \"input\"],\r\n      value,\r\n      vdom\r\n    );\r\n  },\r\n  checked(value, element, vdom) {\r\n    model([\"input\"], \"checked\", \"checked\", [\"change\", \"click\"], value, vdom);\r\n\r\n    /* 对于name相同的input,radio,单选框,如果一个改变,其他全都要触发change事件 */\r\n    const eventname = \"click\";\r\n    const origin = toArray(vdom.onevent[eventname]);\r\n    const eventsarray = origin;\r\n    const dispatchallsamename: EventListener = (event: Event) => {\r\n      const inputelement = event.target as HTMLInputElement;\r\n      const name = (event.target as HTMLInputElement).name;\r\n      if (name) {\r\n        querySelectorAll(`input[name=${name}]`)\r\n          /* 通知其他inputelement */\r\n          .filter(ele => ele !== inputelement)\r\n\r\n          .forEach(element => {\r\n            element.dispatchEvent(new Event(\"change\"));\r\n          });\r\n      }\r\n    };\r\n\r\n    set(\r\n      vdom.onevent,\r\n      eventname,\r\n      toArray([...eventsarray, dispatchallsamename]).filter(Boolean)\r\n    );\r\n  }\r\n});\r\nfunction model(\r\n  types: string[],\r\n  bindattribute: string,\r\n  domprop: string,\r\n  eventnames: string[],\r\n  value: ReactiveState<any>,\r\n  vdom: Virtualdom<any>\r\n) {\r\n  if (!isReactiveState(value)) {\r\n    console.error(value);\r\n    console.error(invalid_ReactiveState + invalid_Virtualdom);\r\n    throw TypeError();\r\n  }\r\n  if (types.includes(vdom.type)) {\r\n    // const vdom = virtualdom;\r\n    set(vdom.bindattr, bindattribute, value);\r\n    /*  [\r\n      // vdom.bindattr[\"checked\"] = value;\r\n      \"change\",\r\n      \"input\"\r\n    ]. */\r\n\r\n    eventnames.forEach(eventname => {\r\n      const origin = vdom.onevent[eventname];\r\n\r\n      const eventsarray = toArray(origin);\r\n\r\n      set(\r\n        vdom.onevent,\r\n        eventname,\r\n        toArray([\r\n          ...eventsarray,\r\n\r\n          (e: any) => {\r\n            return (value.value = get(e.target, domprop));\r\n          }\r\n        ]).filter(Boolean)\r\n      );\r\n    });\r\n  } else {\r\n    console.error(vdom);\r\n    console.error(invalid_ReactiveState + invalid_Virtualdom);\r\n    throw TypeError();\r\n  }\r\n}\r\n\r\n/* directives({\r\n  value(_element: Element, value: ReactiveState<any>, vdom: Virtualdom<any>) {\r\n    // console.log(vdom);\r\n    if (\r\n      isReactiveState(value) &&\r\n      //   value instanceof ReactiveState\r\n\r\n      (vdom.type === \"input\" ||\r\n        vdom.type === \"textarea\" ||\r\n        vdom.type === \"select\")\r\n    ) {\r\n      vdom.bindattr[\"value\"] = value;\r\n      [\"change\", \"input\"].forEach(eventname => {\r\n        const origin = vdom.onevent[eventname];\r\n\r\n        const eventsarray = toArray(origin);\r\n\r\n        set(\r\n          vdom.onevent,\r\n          eventname,\r\n          [\r\n            ...eventsarray,\r\n\r\n            (e: any) => {\r\n              return (value.value = e.target.value);\r\n            }\r\n          ].filter(Boolean)\r\n        );\r\n      });\r\n    } else {\r\n      console.log(_element);\r\n      console.error(value);\r\n      console.error(vdom);\r\n      console.error(invalid_ReactiveState + invalid_Virtualdom);\r\n      throw TypeError();\r\n    }\r\n  }\r\n});\r\ndirectives({\r\n  checked(_element: Element, value: ReactiveState<any>, vdom: Virtualdom<any>) {\r\n    // console.log(vdom);\r\n    if (\r\n      isReactiveState(value) &&\r\n      //   value instanceof ReactiveState\r\n\r\n      vdom.type === \"input\"\r\n    ) {\r\n      vdom.bindattr[\"checked\"] = value;\r\n      [\"change\", \"input\"].forEach(eventname => {\r\n        const origin = vdom.onevent[eventname];\r\n\r\n        const eventsarray = toArray(origin);\r\n\r\n        set(\r\n          vdom.onevent,\r\n          eventname,\r\n          [\r\n            ...eventsarray,\r\n\r\n            (e: any) => {\r\n              return (value.value = e.target.checked);\r\n            }\r\n          ].filter(Boolean)\r\n        );\r\n      });\r\n    } else {\r\n      console.log(_element);\r\n      console.error(value);\r\n      console.error(vdom);\r\n      console.error(invalid_ReactiveState + invalid_Virtualdom);\r\n      throw TypeError();\r\n      //throw TypeError(invalid_ReactiveState + invalid_Virtualdom);\r\n    }\r\n  }\r\n}); */\r\n","interface Ref<T = any | undefined> {\r\n  value: T | undefined;\r\n}\r\n\r\nexport default function createRef<T = any | undefined>(value?: T): Ref<T> {\r\n  return { value };\r\n}\r\n","import createeleattr from \"@masx200/dom-element-attribute-agent-proxy\";\r\nimport { AttrChange, attributeChangedCallback } from \"./attrchange\";\r\nimport computed from \"./computed\";\r\nimport { VaildVDom } from \"./conditon\";\r\nimport { createComponent, Htmlelementconstructor } from \"./createComponent\";\r\nimport createElement from \"./createelement\";\r\nimport createstate from \"./createstate\";\r\nimport { Custom } from \"./customclass\";\r\nimport { appendchild, getdomchildren, removeNode } from \"./dom\";\r\nimport { onmounted, onunmounted } from \"./element-onmount-unmount\";\r\nimport { componentsymbol } from \"./iscomponent\";\r\nimport mount from \"./mount-real-element\";\r\nimport ReactiveState, { isReactiveState } from \"./reactivestate\";\r\nimport { readysymbol } from \"./readysymbol\";\r\nimport { get, set } from \"./reflect\";\r\nimport render from \"./render-vdom-to-real\";\r\nimport { isArray, isfunction, isSet } from \"./util\";\r\nimport Virtualdom from \"./VirtualElement\";\r\nexport { listmap as listMap };\r\nconst listvalueattr = Symbol(\"listvalueattr\");\r\n// const listlengthsymbol = Symbol(\"listlength\");\r\nconst listinnervdom = Symbol(\"listinnervdom\");\r\nconst listinnerelement = Symbol(\"listinnerelement\");\r\nconst cached_vdom_symbol = Symbol(\"cached_vdom\");\r\nconst cached_realele = Symbol(\"cached_realele\");\r\nfunction listmap(\r\n  list: any[] | Set<any> | ReactiveState<any[] | Set<any>>,\r\n  mapfun: (value: ReactiveState<any>, index: number) => VaildVDom\r\n): Virtualdom<Htmlelementconstructor> {\r\n  if (!isArray(list) && !isSet(list) && !isReactiveState(list)) {\r\n    console.error(list);\r\n    throw new TypeError();\r\n  }\r\n  if (!isfunction(mapfun)) {\r\n    console.error(mapfun);\r\n    throw new TypeError();\r\n  }\r\n  const itemclass = createComponent(\r\n    Object.assign(\r\n      (props: Record<string, ReactiveState<any>>) => {\r\n        const { value: propvalue, index: propindex } = props as {\r\n          value: ReactiveState<any>;\r\n          index: ReactiveState<any>;\r\n        };\r\n        // const myprops = {propvalue,}\r\n        const value = propvalue; //myprops.value;\r\n        const index = propindex.valueOf() as number; //myprops.index.valueOf() as number;\r\n        return mapfun(value, index);\r\n      },\r\n      { defaultProps: { index: 0, value: undefined } }\r\n    ) as Custom\r\n    //,/* {defaultProps:{\r\n\r\n    //  value\r\n    // }} */\r\n  );\r\n  const ITEMfactory = (value: ReactiveState<any>, index: number) =>\r\n    createElement(itemclass, { value, index });\r\n  //   console.log(ITEMfactory);\r\n  class ListMap extends AttrChange {\r\n    constructor() {\r\n      super();\r\n      /*    const defaultProps = get(this.constructor, \"defaultProps\");\r\n      // this.constructor[\"defaultProps\"];\r\n      const attrs: Record<string, any> = createeleattragentreadwrite(this);\r\n      //   const props = {};\r\n      if (isobject(defaultProps)) {\r\n        Object.assign(attrs, defaultProps);\r\n        // Object.assign(props, this.constructor[\"defaultProps\"]);\r\n      } */\r\n    }\r\n    static defaultProps = { value: [] };\r\n    [cached_vdom_symbol]: Record<\r\n      number,\r\n      Virtualdom<Htmlelementconstructor>\r\n    > = {};\r\n    [cached_realele]: Record<number, Element> = {};\r\n    [listvalueattr] = createstate([]);\r\n    // [listlengthsymbol]: number;\r\n    [listinnerelement]: Array<Element | Node>;\r\n    [listinnervdom]: Virtualdom<Htmlelementconstructor>[];\r\n    static [componentsymbol] = componentsymbol;\r\n    [readysymbol] = false;\r\n    [attributeChangedCallback](name: string) {\r\n      if (this[readysymbol]) {\r\n        if (name === \"value\") {\r\n          const attrs = createeleattr(this);\r\n          const value = attrs[\"value\"];\r\n\r\n          if (!isArray(value)) {\r\n            console.log(value);\r\n            throw new TypeError();\r\n          }\r\n          // this[listlengthsymbol] = value.length;\r\n          /* 状态变化时同步一次 */\r\n          set(this[listvalueattr], \"value\", value);\r\n          //  [] = ;\r\n          const domchildren = getdomchildren(this);\r\n          const newlength = value.length;\r\n          const oldlength = domchildren.length;\r\n          if (newlength > oldlength) {\r\n            const numindexs = Array(newlength)\r\n              .fill(undefined)\r\n              .map((v, i) => i)\r\n              .slice(oldlength);\r\n\r\n            const vdomstoadd = numindexs.map(index => {\r\n              const cached_vdom1 = get(this[cached_vdom_symbol], index);\r\n              if (cached_vdom1) {\r\n                return cached_vdom1;\r\n              } else {\r\n                const vdom = ITEMfactory(\r\n                  computed(\r\n                    this[listvalueattr],\r\n                    v => (v as any[])[index] as any\r\n                  ),\r\n\r\n                  index\r\n                );\r\n                set(this[cached_vdom_symbol], index, vdom);\r\n                return vdom;\r\n              }\r\n            });\r\n            const realelementstoadd = vdomstoadd.map(vdom => {\r\n              const index = vdom.props.index;\r\n              const cached_element = get(this[cached_realele], index);\r\n              if (cached_element) {\r\n                return cached_element;\r\n              } else {\r\n                const element = render(vdom);\r\n                set(this[cached_realele], index, element);\r\n                return element;\r\n              }\r\n            });\r\n            this[listinnervdom].push(...vdomstoadd);\r\n            this[listinnerelement].push(...realelementstoadd);\r\n            realelementstoadd.forEach(element => appendchild(this, element));\r\n          } else if (newlength < oldlength) {\r\n            /* 把旧的清除掉 */\r\n            this[listinnervdom] = this[listinnervdom].slice(0, newlength);\r\n            this[listinnerelement] = this[listinnerelement].slice(0, newlength);\r\n            getdomchildren(this)\r\n              .slice(newlength)\r\n              .forEach(element => removeNode(element));\r\n          }\r\n        }\r\n      }\r\n    }\r\n    async disconnectedCallback() {\r\n      onunmounted(this);\r\n    }\r\n    async connectedCallback() {\r\n      if (!this[readysymbol]) {\r\n        this[readysymbol] = true;\r\n\r\n        const attrs = createeleattr(this);\r\n        const value: any[] = attrs[\"value\"];\r\n\r\n        if (!isArray(value)) {\r\n          console.log(value);\r\n          throw new TypeError();\r\n        }\r\n        /* 挂载时同步一次 */\r\n        // this[listvalueattr][\"value\"] = value;\r\n        set(this[listvalueattr], \"value\", value);\r\n        this[listinnervdom] = value.map((v, index) =>\r\n          ITEMfactory(\r\n            computed(this[listvalueattr], v => (v as any[])[index] as any),\r\n\r\n            index\r\n          )\r\n        );\r\n        this[listinnerelement] = render(this[listinnervdom]);\r\n\r\n        Object.assign(this[cached_vdom_symbol], this[listinnervdom]);\r\n        Object.assign(this[cached_realele], this[listinnerelement]);\r\n        mount(this[listinnerelement], this);\r\n        // this[listlengthsymbol] = value.length;\r\n      }\r\n      onmounted(this);\r\n    }\r\n  }\r\n  return createElement(ListMap, { value: list });\r\n}\r\n"],"names":["a","isString","isnumber","isboolean","isundefined","issymbol","isplainobject","isobject","gettagtype","isstring","isfunction","isarray","Array","isArray","toString","call","replace","trim","isSet","Set","HTMLElement","customElements","Proxy","window","TypeError","Reflect","apply","construct","defineProperty","deleteProperty","get","getOwnPropertyDescriptor","getPrototypeOf","has","ownKeys","set","isclassextendsHTMLElement","initclass","prototype","CustomElementRegistry","elementset","Symbol","for","elementmap","extendsname","RandomDefineCustomElement","length","table","Componentstatusname","outputentrie","Object","entries","find","v","undefined","Usevaluetoquerythekeyfromthetable","elementname","fill","map","charactorlist","Math","floor","random","join","charactorandnumberlist","getrandomstringandnumber","define","extends","name","constructor","options","add","iterator","i","n","String","fromCharCode","hexnumberlist","hyphenateRE","hyphenate","str","toLowerCase","valuestring","isinputcheckbox","ele","geteletagname","createeleattragentreadwrite","Element","asserthtmlelement","temp","create","outputattrs","[object Object]","isinputtextortextareaflag","isinputtextortextarea","keys","getAttributeNames","attributesownkeys","from","flat","Infinity","filter","target","key","getAttribute","getattribute","JSON","parse","error","t","csstext","obj","stringify","value","classtext","setattribute","removeAttribute","k","includes","otherdescipter","enumerable","configurable","writable","myvalue","tagName","setAttribute","tagname","document","seteletext","e","textContent","setelehtml","innerHTML","appendchild","container","appendChild","createDocumentFragment","createElementNS","namespace","createtextnode","data","createTextNode","svgnamespace","mathnamespace","domaddlisten","event","addEventListener","getdomchildren","childNodes","HTMLElementprototype","attributeChangedCallback","AttrChange","super","defaultProps","this","attrs","assign","qualifiedName","callback","oldValue","isFunction","r","u","p","s","h","push","f","Map","arguments","merge_entries","m","forEach","type","global","freeSelf","self","freeGlobal","Function","root","Date","now","objectProto","hasOwnProperty","nativeObjectToString","symToStringTag","toStringTag","isOwn","tag","unmasked","result","nullTag","undefinedTag","getRawTag","objectToString","symbolTag","isObjectLike","baseGetTag","NAN","reTrim","reIsBadHex","reIsBinary","reIsOctal","freeParseInt","parseInt","isSymbol","isObject","other","valueOf","isBinary","test","slice","FUNC_ERROR_TEXT","nativeMax","max","nativeMin","min","func","wait","lastArgs","lastThis","maxWait","timerId","lastCallTime","lastInvokeTime","leading","maxing","trailing","invokeFunc","time","args","thisArg","shouldInvoke","timeSinceLastCall","timerExpired","trailingEdge","setTimeout","timeWaiting","remainingWait","debounced","isInvoking","leadingEdge","clearTimeout","toNumber","cancel","flush","cached_callback_eventlistner","cached_create_componet","cached_callback_debounced_watchs","addonelistner","removeonelistner","cancelsubscribe","debouncedispatch","isReactiveState","ReactiveState","eventtargetsymbol","memlisteners","dispatchsymbol","subscribesymbol","removeallistenerssymbol","addallistenerssymbol","init","EventTarget","debouncedfun","debounce","eventname","dispatchEvent","CustomEvent","detail","removeEventListener","isprimitive","eventlistener","possiblecallback","delete","toPrimitive","Letter_case_and_Chinese","isVirtualdom","isvirtualelement","createVirtualElement","props","children","propsentries","propsentriesNOTevents","startsWith","Entries_beginning_with_a_letter","thisarg","bindattr","fromEntries","onevent","directives","propsorchildren","createElement","typenormalized","propsnormalized","childrennormalized","toArray","isvalidvdom","every","prevdom","inargs","htm","html","vdom","clear","isconnected","element","documentElement","node","parentNode","getancestornode","watchrecord","ctxopen","MountedSet","UnMountedSet","StateSet","usestste","state","useMounted","fun","Error","useUnMounted","closectx","clearall","watch","statearray","debouncedcallback","stateandlisteners","state1","listener","cachedfun","listenfun","requestAnimationFrame","rewatch","usewatch","watchsingle","extenddirectives","directive","ref","_vdom","createhtmlandtextdirective","errorname","text","componentsymbol","eventlistenerssymbol","callarray","firstaddlisteners","bindstatesymbol","virtualdomsymbol","throwinvalideletype","render","textnode","reactive","nodeValue","changetext","fragmentnode","mount","createnativeelement","propsjson","createcostumelemet","attribute1","createeleattr","primitivestate","callbacks","values","handleprops","MountElement","el","body","head","elesarray","isNode","arr","Node","state1array","reactivestate","getter","st","possiblevalue","memorized","newvalue","readonlyproxy","getproperyreadproxy","Arraycomputed","__proto__","myvalueobj","property","bind","Setprototype","Mapprototype","isMap","setPrototypeOf","deepobserveaddpath","patharray","ancestor","Promise","RegExp","isregexp","isdate","fakeobj","argumentslist","argarray","descripter","observedeepagent","set_prototype","createstate","inittype","initobj","containReactiveState","some","state_entries","objproxyhandler","deepobserve","_target_","returnvalue","dele","size","handleobjectstate","parsecsstext","styleelement","implementation","createHTMLDocument","prefixcssrules","cssRulesarray","prefix","cssrule","isCSSStyleRule","cssstylerule","selectorold","selectorText","stylebodyold","cssText","selectoraftertransform","split","selectorTextone","prefixselector","parentRule","parentStyleSheet","style","styleMap","selectoraddprefix","isCSSMediaRule","cssRules","isCSSImportRule","savestyleblob","href","Boolean","componentsstylesheet","urltext","source","URL","createObjectURL","Blob","registercssprefix","c","transformcsstext","async","waitloadallstyle","containerthis","all","styleurl","stylelinkelement","rs","loaderrorfun","onload","onerror","loadlinkstyle","url","rel","createlinkstylesheet","readysymbol","setimmediate","resolve","then","innerwatchrecords","innerstatesymbol","attributessymbol","elementsymbol","vdomsymbol","mountedsymbol","unmountedsymbol","createComponent","custfun","cached_class","css","Component","thisattributess","readonlyprop","possiblyvirtualdom","thisvdomsymbol","onmounted","onunmounted","propreactivestate","attributes","readdlisteners","domremovelisten","removelisteners","unwatch","truevdomsymbol","falsevdomsymbol","trueelesymbol","falseelesymbol","handletrue","handlefalse","conditon","iftrue","iffalse","true","false","Condition","optionstrue","optionsfalse","elementtomount","model","types","bindattribute","domprop","eventnames","eventsarray","createRef","inputelement","selector","querySelectorAll","Event","listvalueattr","listinnervdom","listinnerelement","cached_vdom_symbol","cached_realele","listmap","list","mapfun","itemclass","propvalue","index","propindex","ITEMfactory","ListMap","domchildren","newlength","oldlength","vdomstoadd","cached_vdom1","computed","realelementstoadd","cached_element","removeChild","removeNode"],"mappings":"qWAEwBA,GACtB,OACEC,EAASD,IACTE,EAASF,IACTG,EAAUH,IACVI,EAAYJ,IACC,iBAANA,WCRKK,EAASL,GACvB,MAAoB,iBAANA,EAQhB,MAAMM,EAAiBN,GACrBO,EAASP,IAAwB,WAAlBQ,EAAWR,YAIZI,EAAYJ,GAC1B,OAASA,YAAKA,GAAuB,OAANA,WAGjBE,EAASF,GACvB,MAAoB,iBAANA,WAEAG,EAAUH,GACxB,MAAoB,kBAANA,WAEAO,EAASP,GACvB,MAAoB,iBAANA,GAAwB,OAANA,WAIlBS,EAAST,GACvB,MAAoB,iBAANA,WAEAU,EAAWV,GACzB,MAAoB,mBAANA,WAGAW,EAAQX,GACtB,OAAOA,aAAaY,GAASA,EAAMC,QAAQb,IAAwB,UAAlBQ,EAAWR,YAK9CQ,EAAWR,GACzB,MACE,GAAGc,SACAC,KAAKf,GACLgB,QAAQ,WAAY,IACpBA,QAAQ,IAAK,IAEbC,gBAMSC,EAAMlB,GACpB,MAAyB,QAAlBQ,EAAWR,IAAgBA,aAAamB,ECvDjD,kBAAQC,EAAWC,eAAEA,QAAgBC,GAAUC,EAC/C,IACGb,EAAWU,KAEXV,EAAWY,KAEXf,EAASc,GAUV,MAAM,IAAIG,ECjBZ,MAAMC,EAAUF,EAAOE,SAGVC,MACXA,EAAKC,UACLA,EAASC,eACTA,EAAcC,eACdA,EAAcC,IACdA,EAAGC,yBACHA,EAAwBC,eACxBA,GAAcC,IACdA,GAAGC,QAGHA,GAAOC,IAEPA,IAEEV,WCNYW,GAA0BC,GAGxC,SACE3B,EAAW2B,IACXA,EAAUC,WACVD,EAAUC,qBAAqBlB,aCjBnC,IAKGb,EAASgB,EAAOF,gBAOjB,MAAM,IAAIG,EAgBZD,EAAOgB,sBAAwBT,EAC7BE,GAAeT,EAAOF,gBACtB,eAEF,MAAMmB,GAAaC,EAAOC,IAAI,cACxBC,GAAaF,EAAOC,IAAI,eAMxBH,sBAAEA,IAA0BhB,EAC5BF,GAAiBE,EAAOF,eAGzBY,GAAIZ,GAAgBmB,KACvBL,GAAId,GAAgBmB,GAAY,IAAIrB,GAGjCc,GAAIZ,GAAgBsB,KACvBR,GAAId,GAAgBsB,GAAY,IAGlC,OAAe,CAACN,EAAqBO,IACnCC,GAA0BR,EAAWO,GAEvC,SAASC,GACPR,EACAO,EACAE,EAAS,GAET,IAAKV,GAA0BC,GAG7B,MAAMb,IAKR,GAAKM,EAAIT,GAAgBmB,IAAYP,IAAII,GAevC,OAnEJ,SACEU,EACAC,GAEA,MAAMC,EAAeC,EAAOC,QAAQJ,GAAOK,KAAKC,GACvCA,EAAE,KAAOL,GAElB,OAAOC,EAAeA,EAAa,QAAKK,EA4D/BC,CACLzB,EAAIT,GAAgBsB,IACpBN,GAjBiD,CACnD,MAAMmB,EAsGV,SAAkCV,EAAS,GACzC,OACElC,EAAMkC,GACHW,UAAKH,GACLI,IAAI,IAxBF5B,EAKL6B,GACAC,EAAKC,MAAMD,EAAKE,SAAWH,GAAcb,UAoBtCiB,KAAK,IACR,IACAnD,EAAMkC,GACHW,UAAKH,GACLI,IAAI,IApBF5B,EAILkC,GACAJ,EAAKC,MAAMD,EAAKE,SAAWE,GAAuBlB,UAgB/CiB,KAAK,IAjHYE,CAAyBnB,GAE7C,OAAIzB,GAAeS,IAAI0B,GACdX,GAA0BR,EAAWO,EAAaE,EAAS,IAE9DF,EACFvB,GAAe6C,OAAOV,EAAanB,EAAW,CAAE8B,QAASvB,IAEzDvB,GAAe6C,OAAOV,EAAanB,GAIhCmB,IAeXnC,GAAe6C,OAAS,SACtBE,EACAC,EACAC,GAEA,IAAKlC,GAA0BiC,GAG7B,MAAM7C,IAEHM,EAAIT,GAAgBmB,IAAYP,IAAIoC,KACnCpC,GAAIZ,GAAesB,IAAayB,GAElCvB,GACEwB,EACAC,EAAUA,EAAQH,aAAUb,IAG9Bf,GAAsBD,UAAU4B,OAAOnD,KACrCM,GACA+C,EACAC,EACAC,GAEFjD,GAAemB,IAAY+B,IAAIF,GAC/BhD,GAAesB,IAAYyB,GAAQC,KAIzClC,GAAId,GAAgBoB,EAAO+B,SAAU,KACnC,MAAMrB,EAAUD,EAAOC,QAAQ9B,GAAesB,KAE9C,OAAOQ,EAAQV,EAAO+B,UAAUzD,KAAKoC,KAQvC,MAAMQ,GAAgB/C,EAAM,IACzB6C,UAAKH,GACLI,IAAI,CAACL,EAAGoB,IAAM,GAAKA,GACnBf,IAAIgB,GAAKC,EAAOC,aAAaF,IAE1BG,GAAgBjE,EAAM,IACzB6C,UAAKH,GACLI,IAAI,CAACL,EAAGoB,IAAMA,GACdf,IAAI1D,GAAKA,EAAEc,SAAS,KAEjBkD,GAAyB,IAC1B,IAAI7C,EAAI,IAAI0D,MAAkBlB,MC9InC,MAAMmB,GAAc,aACdC,GAAaC,GACVA,EAAIhE,QAAQ8D,GAAa,OAAOG,cAEnCN,GAASpD,EAAOoD,OAChBlD,GAAUF,EAAOE,SACjBK,IAAEA,GAAGK,IAAEA,GAAGD,QAAEA,IAAYT,GACxByD,GAAc,QACpB,SAAS3E,GAASP,GAChB,MAAoB,iBAANA,GAAwB,OAANA,EAElC,SAASS,GAAST,GAChB,MAAoB,iBAANA,EAMhB,SAASkB,GAAMlB,GACb,OAAOA,aAAamB,EAGtB,MAAMgE,GACJC,GAEA,UAAYC,GAAcD,KACJ,aAArBtD,GAAIsD,EAAK,SAA+C,UAArBtD,GAAIsD,EAAK,kBAsBvBE,GACtBF,IARF,SAA2BA,GACzB,KAAMA,aAAeG,GAGnB,MAAM/D,IAMRgE,CAAkBJ,GAElB,IAAIK,EAA4BvC,EAAOwC,OAAO,MAE9C,MAAMC,EAAmC,IAAIrE,EAAMmE,EAAM,CACvDG,UACE,MAAMC,EAA4BC,GAAsBV,GAElDW,EAwNZ,SACEX,GAGA,OAAOA,EAAIY,oBA5NMC,CAAkBb,GAE/B,OAAOxE,EAAMsF,KACX,IAAI/E,EACF,IACK4E,EACHZ,GAAgBC,GAAO,eAAY9B,EACnCuC,EAA4BX,QAAc5B,GAIzC6C,KAAKC,EAAAA,GACLC,OAAOrG,KAAOA,MAIvB4F,IAAIU,EAAQC,GACV,MAAMV,EAA4BC,GAAsBV,GAExD,GAAID,GAAgBC,IAAgB,YAARmB,EAC1B,OAAOzE,GAAIsD,EAAK,WAElB,GAAIS,GAA6BU,IAAQrB,GACvC,OAAOpD,GAAIsD,EAAKF,IACX,CACL,MAAM7B,EAqMd,SACE+B,EACAmB,GAEA,OAAOnB,EAAIoB,aAAaD,GAzMRE,CAAarB,EAAKT,GAAO4B,IAGnC,GAAU,KAANlD,EACF,OAAO,EAGT,GAAU,OAANA,EACF,OAKF,IAAI5C,GAAS4C,GAMN,OALL,IACE,OAAOqD,EAAKC,MAAMhC,GAAOtB,IACzB,MAAOuD,GACP,OAAOvD,KAKfuC,IAAIiB,EAAGN,EAAKlD,GACV,MAAMwC,EAA4BC,GAAsBV,GAGxD,GAAI,mBAAsB/B,EAIxB,MAAM7B,IAKR,GAA2B,UAAvB6D,GAAcD,IAA4B,YAARmB,EAEpC,OADApE,GAAIiD,EAAKmB,EAAKlD,IACP,EAGT,GAAIwC,GAA6BU,IAAQrB,GAEvC,OAAO/C,GAAIiD,EAAKF,GAAaP,GAAOtB,IAC/B,GAAY,UAARkD,EAAiB,CAC1B,MAAMO,EAAUrG,GAAS4C,GACrBA,EACA9C,GAAS8C,IArGK0D,EAsGG1D,EAnG3B0D,EAAML,EAAKC,MAAMD,EAAKM,UAAUD,IAEb7D,EAAOC,QAAQ4D,GAAKrD,IAAI,EAAE6C,EAAKU,KAAW,CAC3DlC,GAAUwB,GAAKtF,OACfgG,IAGgBvD,IAAI,EAAE6C,EAAKU,KAAWV,EAAM,IAAMU,GAAOlD,KAAK,MA6FtDY,GAAOtB,GAcX,OAZAlB,GAAIL,GAAIsD,EAAK,SAAU,UAAW0B,EAAQ7F,SAYnC,EACF,GAAY,UAARsF,GAAmBhG,GAAS8C,GAAI,CACzC,MAAM6D,GAtIGlH,EAsIiBqD,EArIzBzC,EAAMC,QAAQb,GAsIXqD,EAAEU,KAAK,KACP7C,GAAMmC,GACN,IAAIA,GAAGU,KAAK,KACZY,GAAOtB,IAGX,OADA8D,GAAa/B,EAAKT,GAAO4B,GAAMW,IACxB,EAYP,OAAI,IAAU7D,GAAV,MAAeA,GACjB+D,GAAgBhC,EAAKT,GAAO4B,KACrB,GAGLrF,GAAMmC,IACR8D,GAAa/B,EAAKT,GAAO4B,GAAMG,EAAKM,UAAU,IAAI3D,MAC3C,KAEG,IAANA,IACFA,EAAI,IAGN8D,GACE/B,EACAT,GAAO4B,GACPhG,GAAS8C,GAAKqD,EAAKM,UAAU3D,GAAKsB,GAAOtB,KAMpC,GA/KjB,IAAiBrD,EAeS+G,GAqKtBnB,gBAAeiB,EAAGQ,KAChBD,GAAgBhC,EAAKT,GAAO0C,KAErB,GAETzB,KAAIU,EAAQC,IACHrE,GAAQyD,GAAa2B,SAASf,GAcvCX,oBACS,EAETA,yBAAyBU,EAAQC,GAC/B,MAAMgB,EAAiB,CACrBC,YAAY,EACZC,cAAc,EACdC,UAAU,GAENC,EAAe7F,GAAI6D,EAAaY,GACtC,YAAuB,IAAZoB,EACF,CACLV,MAAOU,KACJJ,QAGL,GAiCJ3B,oBACS,IASX,OAAOD,EAcT,SAASN,GAAcD,GACrB,OAAOA,EAAIwC,QAAQ3C,cAErB,SAASkC,GACP/B,EACAmB,EACAU,GAEA,OAAO7B,EAAIyC,aAAatB,EAAKU,GAE/B,SAASG,GACPhC,EACAmB,GAEA,OAAOnB,EAAIgC,gBAAgBb,GAU7B,SAAST,GACPV,GAEA,MAAM0C,EAAUzC,GAAcD,GAC9B,MACc,aAAZ0C,GACY,WAAZA,GACa,UAAZA,GAA4C,SAArBhG,GAAIsD,EAAK,QCnUrC,MAAM2C,GAAWxG,EAAOwG,kBAIRC,GAAWC,EAAmB5E,GAC5C4E,EAAEC,YAAc7E,WAEF8E,GAAWF,EAAY5E,GACrC4E,EAAEG,UAAY/E,WAEAgF,GACdC,EACAlD,GAEAkD,EAAUC,YAAYnD,GAKxB,SAGgBoD,KACd,OAAOT,GAASS,kCAKFC,GAAgBC,EAAmBtE,GACjD,OAAO2D,GAASU,gBAAgBC,EAAWtE,YAE7BuE,GAAeC,GAC7B,OAAOb,GAASc,eAAelE,EAAOiE,IAEjC,MAAME,GAAe,6BAMrB,MAAMC,GAAgB,qCAc7B,SAOgBC,GACd5D,EACA6D,EACAlI,GAEAqE,EAAI8D,iBAAiBD,EAAOlI,YAUdoI,GAAe/D,GAC7B,MAAO,IAAIA,EAAIgE,qBAED5C,GAAapB,EAAchB,GACzC,OAAOiF,GAAqB7C,aAAazF,KAAKqE,EAAKhB,GAQrD,MAAMiF,GAAuBjI,YAAYkB,UCpFlC,MAAMgH,GAA2B,iCAC3BC,WAAmBnI,YAE9BwE,cACE4D,QACA,MAAMC,EAAe3H,EAAI4H,KAAKrF,YAAa,gBAErCsF,EAA6BrE,GAA4BoE,MAE3DnJ,EAASkJ,IAIXvG,EAAO0G,OAAOD,EAAOF,GA0DzB7D,aAAaiE,EAAuB5C,GAClC,MAAM6C,EAAWhI,EAAI4H,KAAMJ,IACrBS,EAAWvD,GAAakD,KAAMG,GAGhCE,IAAa9C,KDErB,SAA6B7B,EAAchB,EAAc6C,GACvDoC,GAAqBxB,aAAa9G,KAAKqE,EAAKhB,EAAM6C,GCF9CY,CAAa6B,KAAMG,EAAe5C,GAGhC+C,EACEF,IAKFA,EAAS/I,KAAK2I,KAAMG,EAAeE,EAAU9C,IAKnDrB,gBAAgBiE,GACd,MAAMC,EAAWhI,EAAI4H,KAAMJ,IACrBS,EAAWvD,GAAakD,KAAMG,ODZRzE,EAAchB,ECctC,OAAS2F,IDde3E,ECgBVsE,KDhBwBtF,ECgBlByF,EDf1BR,GAAqBjC,gBAAgBrG,KAAKqE,EAAKhB,GCgBvC4F,EAAWF,IAEbA,EAAS/I,KAAK2I,KAAMG,EAAeE,OAAUzG,KCxGrD,IAAIoB,GAAE,SAASmC,EAAEoD,EAAEC,EAAEjC,GAAG,IAAI,IAAIkC,EAAE,EAAEA,EAAEF,EAAEnH,OAAOqH,IAAI,CAAC,IAAIC,EAAEH,EAAEE,GAAGE,EAAE,iBAAiBD,EAAEF,EAAEE,GAAGA,EAAEpK,EAAEiK,IAAIE,GAAG,IAAInK,EAAEiI,EAAE,GAAGoC,EAAE,IAAIrK,EAAEiI,EAAE,GAAG/E,EAAO0G,OAAO3B,EAAE,IAAI,GAAGoC,GAAG,IAAIrK,GAAGiI,EAAE,GAAGA,EAAE,IAAI,IAAIgC,IAAIE,IAAIE,EAAE,IAAIrK,EAAEiI,EAAE,GAAGgC,IAAIE,KAAKE,EAAE,GAAGpC,EAAEqC,KAAKtK,EAAE6G,EAAEnF,MAAM,KAAKgD,GAAEmC,EAAEwD,EAAEH,EAAE,CAAC,GAAG,QAAQG,GAAG,OAAOpC,GAAGpB,GAAE,SAASnC,GAAG,IAAI,IAAImC,EAAEoD,EAAEC,EAAE,EAAEjC,EAAE,GAAGkC,EAAE,GAAGC,EAAE,CAAC,GAAGC,EAAE,SAAS3F,GAAG,IAAIwF,IAAIxF,IAAIuD,EAAEA,EAAEjH,QAAQ,uBAAuB,MAAMoJ,EAAEE,KAAK5F,GAAGuD,EAAE,GAAG,IAAIiC,IAAIxF,GAAGuD,IAAImC,EAAEE,KAAK5F,GAAGuD,EAAE,GAAGiC,EAAE,GAAG,IAAIA,GAAG,QAAQjC,GAAGvD,EAAE0F,EAAEE,KAAK5F,EAAE,GAAG,IAAIwF,GAAGjC,IAAIvD,EAAE0F,EAAEE,QAAQ,EAAErC,GAAGiC,GAAG,KAAKjC,IAAIvD,GAAG,IAAIwF,KAAKE,EAAEE,KAAKrC,EAAEiC,EAAED,GAAGC,EAAE,GAAGxF,IAAI0F,EAAEE,KAAK5F,EAAEwF,EAAED,GAAGC,EAAE,IAAIjC,EAAE,IAAIjI,EAAE,EAAEA,EAAE0E,EAAE5B,OAAO9C,IAAI,CAACA,IAAI,IAAIkK,GAAGG,IAAIA,EAAErK,IAAI,IAAI,IAAIuK,EAAE,EAAEA,EAAE7F,EAAE1E,GAAG8C,OAAOyH,IAAI1D,EAAEnC,EAAE1E,GAAGuK,GAAG,IAAIL,EAAE,MAAMrD,GAAGwD,IAAID,EAAE,CAACA,GAAGF,EAAE,GAAGjC,GAAGpB,EAAE,IAAIqD,EAAE,OAAOjC,GAAG,MAAMpB,GAAGqD,EAAE,EAAEjC,EAAE,IAAIA,EAAEpB,EAAEoB,EAAE,GAAGkC,EAAEtD,IAAIsD,EAAEA,EAAE,GAAGlC,GAAGpB,EAAE,MAAMA,GAAG,MAAMA,EAAEsD,EAAEtD,EAAE,MAAMA,GAAGwD,IAAIH,EAAE,GAAGA,IAAI,MAAMrD,GAAGqD,EAAE,EAAED,EAAEhC,EAAEA,EAAE,IAAI,MAAMpB,IAAIqD,EAAE,GAAG,MAAMxF,EAAE1E,GAAGuK,EAAE,KAAKF,IAAI,IAAIH,IAAIE,EAAEA,EAAE,IAAIF,EAAEE,GAAGA,EAAEA,EAAE,IAAIE,KAAKJ,EAAE,GAAGA,EAAE,GAAG,MAAMrD,GAAG,OAAOA,GAAG,OAAOA,GAAG,OAAOA,GAAGwD,IAAIH,EAAE,GAAGjC,GAAGpB,GAAG,IAAIqD,GAAG,QAAQjC,IAAIiC,EAAE,EAAEE,EAAEA,EAAE,IAAI,OAAOC,IAAID,GAAGH,GAAE,mBAAmBO,EAAIN,GAAED,GAAE,IAAIO,EAAI,GAAGvC,GAAEgC,GAAE,SAASvF,GAAG,IAAIuF,EAAEC,GAAEpI,IAAI4C,GAAG,OAAOuF,GAAGC,GAAE/H,IAAIuC,EAAEuF,EAAEpD,GAAEnC,IAAIuF,GAAG,SAASvF,GAAG,IAAI,IAAIuF,EAAE,GAAGhC,EAAE,EAAEA,EAAEvD,EAAE5B,OAAOmF,IAAIgC,GAAGvF,EAAEuD,GAAGnF,OAAO,IAAI4B,EAAEuD,GAAG,OAAOiC,GAAED,KAAKC,GAAED,GAAGpD,GAAEnC,KAAK,YAAwBmC,GAAG,IAAIoD,EAAEvF,GAAEgF,KAAKzB,GAAEpB,GAAG4D,UAAU,IAAI,OAAOR,EAAEnH,OAAO,EAAEmH,EAAEA,EAAE,YCQztCS,GACd1K,GAEA,MAAM2K,EAA+B,GAYrC,OAVA3K,EAAE4K,QAAQ,EAAErE,EAAKU,MACV0D,EAAEpE,KACLoE,EAAEpE,GAAO,IAAIpF,GAIf8F,EAAM2D,QAASvH,IACbsH,EAAEpE,GAAKhC,IAAIlB,OAGRH,EAAOC,QAAQwH,GAAGjH,IAAI,EAAE2D,EAAGhE,KAAO,CAACgE,EAAG,IAAIhE,KCOnD,OALA,SAAkB4D,GAChB,IAAI4D,SAAc5D,EAClB,OAAgB,MAATA,IAA0B,UAAR4D,GAA4B,YAARA,iEC1Bb,iBAAVC,IAAsBA,IAAUA,GAAO5H,SAAWA,GAAU4H,GCEhFC,GAA0B,iBAARC,GAAoBA,GAAQA,EAAK9H,SAAWA,GAAU8H,KAGjEC,IAAcF,IAAYG,SAAS,cAATA,MCY3B,WACR,OAAOC,GAAKC,KAAKC,UChBNF,GAAK1I,OCAd6I,GAAcpI,EAAOZ,UAGrBiJ,GAAiBD,GAAYC,eAO7BC,GAAuBF,GAAYxK,SAGnC2K,GAAiBhJ,GAASA,GAAOiJ,iBAAcpI,EA6BnD,OApBA,SAAmB2D,GACjB,IAAI0E,EAAQJ,GAAexK,KAAKkG,EAAOwE,IACnCG,EAAM3E,EAAMwE,IAEhB,IACExE,EAAMwE,SAAkBnI,EACxB,IAAIuI,GAAW,EACf,MAAO5D,IAET,IAAI6D,EAASN,GAAqBzK,KAAKkG,GAQvC,OAPI4E,IACEF,EACF1E,EAAMwE,IAAkBG,SAEjB3E,EAAMwE,KAGVK,GClCLN,GAPctI,EAAOZ,UAOcxB,SAavC,OAJA,SAAwBmG,GACtB,OAAOuE,GAAqBzK,KAAKkG,ICb/B8E,GAAU,gBACVC,GAAe,qBAGfP,GAAiBhJ,GAASA,GAAOiJ,iBAAcpI,EAkBnD,OATA,SAAoB2D,GAClB,OAAa,MAATA,OACe3D,IAAV2D,EAAsB+E,GAAeD,GAEtCN,IAAkBA,MAAkBvI,EAAO+D,GAC/CgF,GAAUhF,GACViF,GAAejF,ICIrB,OAJA,SAAsBA,GACpB,OAAgB,MAATA,GAAiC,iBAATA,GCrB7BkF,GAAY,kBAwBhB,OALA,SAAkBlF,GAChB,MAAuB,iBAATA,GACXmF,GAAanF,IAAUoF,GAAWpF,IAAUkF,ICrB7CG,GAAM,IAGNC,GAAS,aAGTC,GAAa,qBAGbC,GAAa,aAGbC,GAAY,cAGZC,GAAeC,EA8CnB,OArBA,SAAkB3F,GAChB,GAAoB,iBAATA,EACT,OAAOA,EAET,GAAI4F,GAAS5F,GACX,OAAOqF,GAET,GAAIQ,GAAS7F,GAAQ,CACnB,IAAI8F,EAAgC,mBAAjB9F,EAAM+F,QAAwB/F,EAAM+F,UAAY/F,EACnEA,EAAQ6F,GAASC,GAAUA,EAAQ,GAAMA,EAE3C,GAAoB,iBAAT9F,EACT,OAAiB,IAAVA,EAAcA,GAASA,EAEhCA,EAAQA,EAAMjG,QAAQuL,GAAQ,IAC9B,IAAIU,EAAWR,GAAWS,KAAKjG,GAC/B,OAAQgG,GAAYP,GAAUQ,KAAKjG,GAC/B0F,GAAa1F,EAAMkG,MAAM,GAAIF,EAAW,EAAI,GAC3CT,GAAWU,KAAKjG,GAASqF,IAAOrF,GCzDnCmG,GAAkB,sBAGlBC,GAAYzJ,EAAK0J,IACjBC,GAAY3J,EAAK4J,IAqLrB,OA7HA,SAAkBC,EAAMC,EAAMpJ,GAC5B,IAAIqJ,EACAC,EACAC,EACA/B,EACAgC,EACAC,EACAC,EAAiB,EACjBC,GAAU,EACVC,GAAS,EACTC,GAAW,EAEf,GAAmB,mBAARV,EACT,MAAM,IAAIjM,EAAU4L,IAUtB,SAASgB,EAAWC,GAClB,IAAIC,EAAOX,EACPY,EAAUX,EAKd,OAHAD,EAAWC,OAAWtK,EACtB0K,EAAiBK,EACjBvC,EAAS2B,EAAK/L,MAAM6M,EAASD,GAuB/B,SAASE,EAAaH,GACpB,IAAII,EAAoBJ,EAAON,EAM/B,YAAyBzK,IAAjByK,GAA+BU,GAAqBf,GACzDe,EAAoB,GAAOP,GANJG,EAAOL,GAM8BH,EAGjE,SAASa,IACP,IAAIL,EAAOhD,KACX,GAAImD,EAAaH,GACf,OAAOM,EAAaN,GAGtBP,EAAUc,EAAWF,EA3BvB,SAAuBL,GACrB,IAEIQ,EAAcnB,GAFMW,EAAON,GAI/B,OAAOG,EACHX,GAAUsB,EAAahB,GAJDQ,EAAOL,IAK7Ba,EAoB+BC,CAAcT,IAGnD,SAASM,EAAaN,GAKpB,OAJAP,OAAUxK,EAIN6K,GAAYR,EACPS,EAAWC,IAEpBV,EAAWC,OAAWtK,EACfwI,GAeT,SAASiD,IACP,IAAIV,EAAOhD,KACP2D,EAAaR,EAAaH,GAM9B,GAJAV,EAAWlD,UACXmD,EAAWlE,KACXqE,EAAeM,EAEXW,EAAY,CACd,QAAgB1L,IAAZwK,EACF,OAzEN,SAAqBO,GAMnB,OAJAL,EAAiBK,EAEjBP,EAAUc,EAAWF,EAAchB,GAE5BO,EAAUG,EAAWC,GAAQvC,EAmEzBmD,CAAYlB,GAErB,GAAIG,EAIF,OAFAgB,EAAapB,GACbA,EAAUc,EAAWF,EAAchB,GAC5BU,EAAWL,GAMtB,YAHgBzK,IAAZwK,IACFA,EAAUc,EAAWF,EAAchB,IAE9B5B,EAIT,OA3GA4B,EAAOyB,GAASzB,IAAS,EACrBZ,GAASxI,KACX2J,IAAY3J,EAAQ2J,QAEpBJ,GADAK,EAAS,YAAa5J,GACH+I,GAAU8B,GAAS7K,EAAQuJ,UAAY,EAAGH,GAAQG,EACrEM,EAAW,aAAc7J,IAAYA,EAAQ6J,SAAWA,GAoG1DY,EAAUK,OApCV,gBACkB9L,IAAZwK,GACFoB,EAAapB,GAEfE,EAAiB,EACjBL,EAAWI,EAAeH,EAAWE,OAAUxK,GAgCjDyL,EAAUM,MA7BV,WACE,YAAmB/L,IAAZwK,EAAwBhC,EAAS6C,EAAatD,OA6BhD0D,GCxLF,MAAMO,GAA+B,IAAI9E,EACnC+E,GAAyB,IAAI/E,EAI7BgF,GAAmC,IAAIhF,YCD7C,MAAMiF,GAAgBhN,EAAO,iBACvBiN,GAAmBjN,EAAO,oBAG1BkN,GAAkBlN,EAAO,mBAChCmN,GAAmBnN,EAAO,6BAGhBoN,GAAgB7P,GAC9B,OAAOA,aAAa8P,IAAmC,kBAAlBtP,EAAWR,GAI3C,MAAM+P,GAAoBtN,EAAO,eAC3BuN,GAAevN,EAAO,gBACtBwN,GAAiBxN,EAAO,YACxByN,GAAkBzN,EAAO,aACzB0N,GAA0B1N,EAAO,qBACjC2N,GAAuB3N,EAAO,kBAW3C,MAAqBqN,GAanBlK,YAAYyK,GAFH3G,KAACjH,EAAOiJ,aAAe,gBA6EhChC,SAAsB,IAAI4G,EAC1B5G,SAAiB,IAAIvI,EAGrBuI,aAAU,IACDA,KAAKzC,MA3EZyC,KAAKzC,MAAQoJ,EAGbzO,EAAe8H,KAAM,QAAS,CAC5BzC,MAAOoJ,EACP5I,cAAc,EACdC,UAAU,IAmBZ,MAAM6I,EAAeC,GAAUC,IAC7B,MAAMrM,EAAOqM,EAAY9L,EAAO8L,GAAa,QAE7C/G,KAAKqG,IAAmBW,cACtB,IAAIC,EAAY,QAAS,CAAEC,OAAQxM,OAGvCsF,KAAKkG,IAAqBa,IACxBF,EAAaE,IAQjB7K,CAACuK,MACCzG,KAAKsG,IAAcpF,QAAQd,IACzBJ,KAAKgG,IAAkB5F,KAG3BlE,CAAC8J,IAAkB5F,GAEjBJ,KAAKqG,IAAmBc,oBADX,QACqC/G,GAEpDlE,CAAC6J,IAAe3F,GAEdJ,KAAKqG,IAAmB7G,iBADX,QACkCY,GAEjDlE,CAACwK,MAEC1G,KAAKsG,IAAcpF,QAAQd,IACzBJ,KAAK+F,IAAe3F,KAoBxBlE,WACE,MAAMqB,EAAQyC,KAAKsD,UACnB,OAAO8D,EAAY7J,GACftC,EAAOsC,GACP/F,EAAM+F,GACNP,EAAKM,UAAU,IAAKC,IACpB1G,EAAS0G,GACTP,EAAKM,UAAUC,GACf,GAGNrB,KAlBCmK,MACAC,GAiBAC,KAAgBQ,GAGf/G,KAAKkG,IAAkBa,GAEzB7K,CAACsK,IACCpG,GAGA,IAAIiH,EACJ,MAAMC,EAAmB1B,GAA6BxN,IAAIgI,GACtDkH,EACFD,EAAgBC,GAGhBD,EAAgB,IAAMjH,IAEtBwF,GAA6BnN,IAAI2H,EAAUiH,IAK7CrH,KAAKsG,IAAczL,IAAIwM,GAEzBnL,CAAC+J,IAAiB7F,GAChB,MAAMiH,EAAgBzB,GAA6BxN,IAAIgI,GAInDiH,IACFrH,KAAKsG,IAAciB,OAAOF,GAC1BrH,KAAKgG,IAAkBqB,IAI3BnL,CAACnD,EAAOyO,eAEN,MAAMjK,EAAQyC,KAAKsD,UACnB,OAAO8D,EAAY7J,GACfA,EACA1G,EAAS0G,GACTP,EAAKM,UAAUC,WCvLvB,MAAMkK,GAA0B,iCAWhBC,GAAapR,GAC3B,OACEO,EAASP,IAET8B,EAAI9B,EAAGqR,MAAsBA,GAG1B,MAAMA,GAAmB5O,EAAO,oBAKvC,SAAS6O,GACPzG,EACA0G,EAAsB,GACtBC,EAAyB,IAEzBD,EAAQrO,EAAO0G,OAAO,GAAI2H,GAC1BC,EAAWA,EAASrL,KAAK,EAAA,GAEzB,MAAMsL,EAAevO,EAAOC,QAAQoO,GAC9BG,EAAwBD,EAAapL,OACzC,EAAEE,OAAWA,EAAIoL,WAAW,MAAQpL,EAAIoL,WAAW,QAE/CC,EAAkCF,EAAsBrL,OAC5D,EAAEE,KAAS4K,GAAwBjE,KAAK3G,EAAI,KAExCsL,EAAyB3O,EAAOwC,OAAO,MAoE7C,MAnEA,CACE,UACA,UACA,OACA,QACA,WACA,aACA,YACAkF,QAAQrE,IACR3E,EAAeiQ,EAAStL,EAAK,CAE3BmB,UAAU,MASdxE,EAAO0G,OAAOiI,EAAS,CACrBhH,KAAAA,EACAiH,SAAU5O,EAAO6O,YACfH,EAAgCvL,OAAO4B,GAAK4H,GAAgB5H,EAAE,MAEhEsJ,MAAOrO,EAAO6O,YACZH,EAAgCvL,OAAO4B,IAAM4H,GAAgB5H,EAAE,MAEjEuJ,SAAAA,EACAQ,QAAS9O,EAAO6O,YACdrH,GAAc,IACT+G,EACApL,OAAO,EAAEE,KAAS,KAAOA,EAAI,IAC7B7C,IAAI,EAAE6C,EAAKU,KAAW,CACrBV,EACG4G,MAAM,GACNlI,cACAhE,OACH,CAACgG,GAAOd,KAAK,EAAA,QAEdsL,EACApL,OAAO,EAAEE,KAASA,EAAIoL,WAAW,OACjCjO,IAAI,EAAE6C,EAAKU,KAAW,CACrBV,EACG4G,MAAM,GACNlI,cACAhE,OACH,CAACgG,GAAOd,KAAK,EAAA,QAIrB8L,WAAY/O,EAAO6O,YACjBL,EACGrL,OAAO,EAAEE,KAAoB,MAAXA,EAAI,IAAyB,MAAXA,EAAI,IAAyB,MAAXA,EAAI,IAC1D7C,IAAI,EAAE6C,EAAKU,KAAW,CACrBV,EACG4G,MAAM,GACNlI,cACAhE,OACHgG,OAIRrF,EAAeiQ,EAASpP,EAAOiJ,YAAa,CAAEzE,MAAO,mBAGrDrF,EAAeiQ,EAASR,GAAkB,CAAEpK,MAAOoK,KAC5CQ,cCtDPhH,EACAqH,KACGV,GAEH,OAAI7Q,EAAQuR,GACHxQ,EAAMyQ,QAAe7O,EAAW,CACrCuH,OACAvH,EACA,IAAI4O,KAAoBV,GAAUrL,KAAK,EAAA,KAQlCzE,EAAMyQ,QAAe7O,EAAWmH,WAoB3C,SAAS0H,GACPtH,EACA0G,EAAsB,MACnBC,GAMH,IAAIY,EACF3R,EAASoK,IAASnK,EAAWmK,GAAQA,EAAO,GAC9C,MAAMwH,EAAkB/R,EAAciR,GAASA,EAAQ,GACjDe,EAAmCd,EACtCrL,KAAKC,EAAAA,GACL1C,IAAI1D,GAAY,IAANA,EAAU,IAAMA,GAC1BqG,OAAOrG,KAAOA,GAQjB,OANES,EAAS2R,KAGTA,EAAiBA,EAAenR,OAAOgE,eAMvC,KAAOmN,EAEAE,EAeA5Q,EAAM4P,QAAsBhO,EAAW,CAC5C8O,EACAC,EACAC,aClIUC,GAAQvS,GACtB,OAAQa,EAAQb,GAAKA,EAAI,CAACA,IAAImG,KAAK,EAAA,GAAOE,OAAOrG,IAAMI,EAAYJ,aCiCrDwS,GAAYnP,GAC1B,GAAI5C,EAAS4C,GACX,OAAO,EAET,GAAInD,EAASmD,GACX,OAAO,EAGT,OAAIxC,EAAQwC,GAa8BA,EAAEoP,MAAMxK,GAAKuK,GAAYvK,IAEjEmJ,GAAa/N,GAGNmP,GAAYnP,EAAEmO,YAKrB3B,GAAgBxM,kBAaOiL,GACzB,MAAMoE,EAAUH,GApDlB,YAAiBI,GAGf,OAAOjR,EAAMkR,GAAkBvI,GAAGsI,GAiDVE,IAAQvE,IAE1BwE,EAA0B,IAAnBJ,EAAQ5P,OAAe4P,EAAQ,GAAKA,EACjD,GAAIF,GAAYM,GACd,OAAOA,EAIP,MAAM,IAAItR,cCtFZ4D,EAiBAkD,EACAyK,GAAiB,GAiBjB,OAfIA,GACF/K,GAAWM,EAAW,IAUXiK,GAAQnN,GAAKe,KAAKC,EAAAA,GAC1BwE,QAAS3C,GACZI,GAAYC,EAAWL,IAElBK,WCtCO0K,GAAYC,GAC1B,OAAOlL,EAASmL,kBAElB,SAAyBC,GACvB,KACEA,GACAA,EAAKC,YACLD,EAAKC,aAAerL,GAMpBoL,EAAOA,EAAKC,WAEd,OAAOD,EAd6BE,CAAgBJ,GCHtD,IAAIK,GAAgD,GAqBpD,IAAIC,IAAU,EACVC,GAA4B,IAAIrS,EAChCsS,GAA8B,IAAItS,EAClCuS,GAAoC,IAAIvS,WAM5BwS,GAASC,GACnBL,IACFG,GAASnP,IAAIqP,YASDC,GAAWC,GACzB,IAAI9J,EAAW8J,GAWb,MAAMtS,IAVN,IAAI+R,GAKF,MAAMQ,IAJNP,GAAWjP,IAAIuP,YAaLE,GAAaF,GAC3B,IAAI9J,EAAW8J,GAWb,MAAMtS,IAVN,IAAI+R,GAIF,MAAMQ,IAHNN,GAAalP,IAAIuP,GA2BvB,SAAgBG,KACdV,IAAU,EACVW,KAEF,SAASA,KAjBPV,GAAa,IAAIrS,EAOjBsS,GAAe,IAAItS,EAHnBuS,GAAW,IAAIvS,EA9DfmS,GAAc,YCOAa,GACdP,EAEA9J,GAEA,GAAInJ,EAAQiT,IAAU/D,GAAgB+D,GAAQ,CAC5C,MAAMQ,EAAmC7B,GAAQqB,GACjD,IAAKQ,EAAWtR,OAEd,MAAM,IAAIiR,EAGZ,MAAMM,EAAoB7D,GAAS1G,GAC7BwK,EAAsDF,EAAW1Q,IACrE6Q,IACE,MAAMC,EAAqB,MAEzB,MAAMC,EAAYjF,GAAiC1N,IAAIgI,GACvD,GAAI2K,EACF,OAAOA,EACF,CACL,MAAMC,EAAY,KAEhBL,KAAqBD,EAAW1Q,IAAIuG,GAAKA,EAAE+C,aAG7C,OADAwC,GAAiCrN,IAAI2H,EAAU4K,GACxCA,IAXgB,GAoB3B,OAuBR,SACEd,EACA9J,GAGA,IAEI+F,GAAgB+D,KAEhB5J,EAAWF,GAOb,MAAMtI,IAGRoS,EAAM1D,IAAiBpG,GASvB6K,EAAsB,KACpBC,GAAQhB,cDpGaA,EAA2B9J,GAC9CyJ,IACFD,GAAYhJ,KAAK,CAACsJ,EAAO9J,ICsG3B+K,CAASjB,EAAO9J,GA9DVgL,CACEP,EAEAC,GAGK,CAACD,EAAQC,KASpB,MALoC,KAClCF,EAAkB1J,QAAQ,EAAEgJ,EAAOY,MACjCZ,EAAMjE,IAAiB6E,MAa3B,MAAM,IAAIhT,WA2CEoT,GAAQhB,GACtBA,EAAMxD,eC1GgB2E,GAAiBzQ,EAAyB,IAChE,IAAKhE,EAAcgE,GAEjB,MAAM,IAAI9C,EAiBZ,OAfA0B,EAAOC,QAAQmB,GAASsG,QAAQ,EAAErE,EAAKU,MACrC,GAAqB,mBAAVA,EAGT,MAAMzF,IAEN,GAAKyQ,GAAW1L,GAKd,MAAM,IAAIwN,EAJVtS,EAAQU,IAAI8P,GAAY1L,EAAKU,KAQ5BgL,GCnCF,4BAAQ0C,IAA0BpT,EAUnCyT,GAA2B,CAC/BpP,IAAIqP,EAAwB7P,EAAc8P,GACxC,GAAIxU,EAAWuU,GACbvT,EAAMuT,OAAiB3R,EAAW,CAAC8B,QAG9B,CAAA,IAAI7E,EAAS0U,GAOlB,MAAMzT,IANNW,GAAI8S,EAAe,QAAS7P,MA+FlC,SAAS+P,GAA2BnN,EAAsBoN,GACxD,OAAO,SAAShQ,EAAciQ,GAC5B,MAAMpC,EAAU7N,EAChB,GACE3E,EAAS4U,GAGTV,GAAsB,KACpB3M,EAAW5C,EAAKiQ,SAIb,CAAA,IACLxF,GAAgBwF,GAuBhB,MAAM7T,IAnBN2S,GAAMkB,EAAM,KACV,MAAMzB,EAAQyB,EACVrC,GAAYC,IACdjL,EAAW5C,EAAKT,EAAOiP,MAO3Be,GAAsB,KAEpB3M,EAAW5C,EAAKT,EAAO0Q,QAjH/BN,GAAiB,CACfnP,KACEiN,EACAzN,EAEA8P,GAGAC,GAA2BhN,GAAY,OAAvCgN,CAA+C/P,EAAKyN,IAmCtDjN,KACEyP,EACAjQ,EACA8P,GAGAC,GAA2BnN,GAAY,OAAvCmN,CAA+C/P,EAAKiQ,MC3ExD,MAAMC,GAAkB7S,EAAO,aCGxB,MAAM8S,GAAuB9S,EAAO,8BAEzCwQ,EACAxC,EACA3G,IAkBF,SACE1E,EACA6D,EACAuM,GAEA,MAAMvC,EAAU7N,EAChBoQ,EAAU5K,QAAS7J,IACjB,IAAKL,EAAWK,GAGd,MAAMS,IAGHS,GAAIgR,EAASsC,KAChBpT,GAAI8Q,EAASsC,GAAsB,IAGpCzT,EAAIsD,EAAKmQ,IAEPjL,KAAK,CAACrB,EAAOlI,IAChBiI,GAAa5D,EAAK6D,EAAOlI,KAhC3B0U,CAAkBxC,EAASxC,EAAW8B,GAAQzI,ICUzC,MAAM4L,GAAkBjT,EAAO,aAGzBkT,GAAmBlT,EAAO,kBACvC,SAASmT,GAAoB/K,GAG3B,MAAMrJ,aA0BgBqU,GACtB/C,EAMApK,GAEA,GAAI7H,EAAQiS,GACV,OAAQA,EACLpP,IAAI1D,GAAK6V,GAAO7V,IAChBmG,KAAK,EAAA,GAEV,GAAIjG,EAAS4S,IAASrS,EAASqS,GAAO,CACpC,MAAMgD,EAAWnN,GAAemK,GAGhC,OAFA3Q,GAAI2T,EAAUH,GAAkB7C,GAEzBgD,EAIF,GAAIjG,GAAgBiD,GAAoC,CAC7D,MAAMiD,EAAWjD,EACXgD,EAAWnN,GAAehE,EAAOoR,IACvC5T,GAAI2T,EAAUH,GAAkB7C,GAUhCqB,GAAM4B,EAAU,KACd,MAAMnC,EAAQmC,EACV/C,GAAYC,a9B5DK6C,EAAgB7O,GACzC6O,EAASE,UAAYrR,EAAOsC,G8B4DtBgP,CAAWH,EAAUnR,EAAOiP,MAGhC,MAAMX,EAAU6C,EAKhB,OAJA3T,GAAI8Q,EAASyC,GAAiB,IAAIvU,GAEjCW,EAAImR,EAASyC,IAA6CnR,IAAIwR,GAExDD,EACF,GACL1E,GAAa0B,GAEb,CACA,MAAMjI,KAAEA,GAASiI,EACjB,IAAIG,OAKY3P,EAChB,GAAoB,iBAATuH,EAAmB,CAC5B,GAAa,WAATA,EAGF,OAAOrC,KACF,GAAa,QAATqC,EAEToI,E9B1GCxK,GAAgBK,GAAc,Y8B2G1B,GAAa,SAAT+B,EAEToI,E9BnFCxK,GAAgBM,GAAe,Y8BoF3B,CAAA,GAAI,KAAO8B,GAAiB,SAATA,EAAiB,CACzC,MAAMqL,EAAe1N,KAIrB,OAFA2N,GAAMN,GAAO/C,EAAKtB,UAAW0E,GAEtBA,EAKPjD,EAAUvK,EACND,GAAgBC,EAAWmC,Y9BjHHA,GAClC,OAAO9C,GAASoK,cAActH,G8BiHpBuL,CAAoBvL,SAErB,GAAmB,mBAARA,EAAoB,CAOhCtK,EAASsK,kBACXiI,EAAKvB,MAAQ7K,EAAKC,MAChBD,EAAKM,UAAU,IAAK6D,kBAAyBiI,EAAKvB,UAItD,MAAM8E,EAAY3P,EAAKC,MACrBD,EAAKM,UAAU,IACV8L,EAAKvB,SACLrO,EAAO6O,YACR7O,EAAOC,QAAQ2P,EAAKhB,UAAUpO,IAAI,EAAE6C,EAAKU,KAChC,CAACV,EAAKU,EAAMA,YAK3BgM,EjC1IN,SACE5Q,EACAgU,EACA7E,GAGA,GAAIpP,GAA0BC,GAS5B,OADAQ,GAA0BR,GACnBV,EAAUU,EAAW,CAACgU,EAAW7E,IAIxC,MAAMhQ,IiCuHM8U,CACRzL,EACAwL,EACAvD,EAAKtB,eAIPoE,KA+DF,OA1CE/K,IACCnK,EAAWmK,IAASpK,EAASoK,MF3LhCb,EAFwBhK,EEqMP6K,IFjMjB/I,EAAI9B,EAAGsV,MAAqBA,IEoMpBrC,GACFkD,GACErD,EAAKtB,SAAS9N,IAAIuE,GACH,QAAT4C,GAAkBuG,GAAanJ,GAG1B4N,GAAO5N,EAAGa,IACC,SAAT+B,GAAmBuG,GAAanJ,GAClC4N,GAAO5N,EAAGc,IACRL,GAAa0I,GAAanJ,GAC5B4N,GAAO5N,EAAGS,GAEVmN,GAAO5N,IAIlBgL,IAUJA,GAkBR,SACEA,EACAH,GAEA,EAAEG,EAASH,KACT5P,EAAOC,QAAQ2P,EAAKb,YAAYrH,QAAQ,EAAExG,EAAM6C,MAC9C,IACEvG,EACEuR,GAAW7N,IAQb,MAAM,IAAI2P,EAJV9B,GAAW7N,GAAM6C,EAAOgM,EAASH,KAQrC,MAAMyD,EAAqCC,GAAcvD,GACzD/P,EAAO0G,OACL2M,EAGAzD,EAAKvB,OAIPpP,GAAI8Q,EAAS0C,GAAkB7C,GAE/BA,EAAKG,QAAUA,EAGf/P,EAAOC,QAAQ2P,EAAKhB,UAAUlH,QAAQ,EAAErE,EAAKkQ,MAC3CF,EAAWhQ,GAAOkQ,EAAezJ,UACjCmH,GAAMsC,EAAgB,KACpB,MAAM7C,EAAQ6C,EACVzD,GAAYC,KACdsD,EAAWhQ,GAAOqN,EAAM5G,eAe9B9J,EAAOC,QAAQ2P,EAAKd,SAASpH,QAAQ,EAAE3B,EAAOyN,MAC5C1E,GAAQiB,EAAShK,EAAOyN,MAnD5B,CAqDGzD,EAASH,GAKZ,IAAI5P,EAAOyT,OAAO7D,EAAKhB,aAAc5O,EAAOyT,OAAO7D,EAAKb,aACrD9L,KAAK,EAAA,GACLE,OACC4B,GAAK4H,GAAgB5H,IAItB2C,QAAS3C,IACHhG,GAAIgR,EAASyC,KAChBvT,GAAI8Q,EAASyC,GAAiB,IAAIvU,GAGnCW,EAAImR,EAASyC,IAA6CnR,IAAI0D,KA3F/D2O,CAAY3D,EAASH,GAGhBG,MFtOiBjT,EEiP1B,MATE4V,KASI,IAAI7B,WC7OY8C,GACtB/D,EACAxK,GAEA,GAAIzH,EAAQiS,MACVA,EAAOA,EAAK3M,KAAKC,EAAAA,IACPtD,OAGR,MAAM,IAAItB,EAGd,MAAMsV,EAAKxO,EACX,KAAMwO,aAAc1V,aAGlB,MAAMI,IAGR,GACEsV,IAAO/O,GAASgP,MAChBD,IAAO/O,GAASmL,iBAChB4D,IAAO/O,GAASiP,KAIhB,MAAMjD,IAmBR,MAAMkD,EAAY1E,GAAQO,GAC1B,GAAIN,GAAYM,GAEdqD,GAAMN,GAAOoB,GAAY3O,OACpB,CAAA,KAAI4O,GAAOpE,KAWQqE,EAXoCrE,EAcpDjS,EAAQsW,IAAQA,EAAIrU,QAAUqU,EAAI1E,MAAMzS,GAAKkX,GAAOlX,MAT5D,MAAMwB,IAJN2U,GAAMc,EAAW3O,OAUO6O,EAF1B,OAAO7O,WAQO4O,GAAOlX,GACrB,OAAOA,aAAaoX,cC3EoB9Q,GACxC,OAAO,IAAIhF,EAAMgF,EAAQ,CACvBV,SACS,EAETA,oBACS,EAETA,oBACS,EAETA,oBACS,gBCkBXgO,EACA9J,GAEA,IAEKjJ,EAAQ+S,KAAU/D,GAAgB+D,KAEnC5J,EAAWF,GAOb,MAAMtI,IAER,MAAM6V,EAEJ9E,GAAQqB,GACV,IAAKyD,EAAYvU,OAEf,MAAM,IAAIiR,EAaZ,MAAMQ,EAKR,SACEX,EACA9J,GAEA,MAAMwN,EAAgB,IAAIxH,GACpByH,EAAS,KAEb,MAAMtQ,EAAQvF,EAAMoI,OAAUxG,EAAWsQ,EAAMlQ,IAAI8T,GAAMA,EAAGxK,YAEtDyK,EAAgB5H,GAAgB5I,GAASA,EAAM+F,UAAY/F,EAEjE,GAAI1G,EAASkX,IAAkB3G,EAAY2G,GACzC,OAAOA,EAGP,MAAMjW,KAIV,IAAIkW,EAAYH,IAuBhB,OAjBA3V,EAAe0V,EAAe,QAAS,CACrCxV,IAAKyV,EACL9P,cAAc,IAGhBmM,EAAMhJ,QAAQgJ,IACZO,GAAMP,EAAO,KACX,IAAI+D,EAAWJ,IACXI,IAAaD,IACfJ,EAAcrH,MAEdyH,EAAYC,OAMXC,GAAcC,GAAoBP,IA/C1BQ,CAAcT,EAAavN,GAE1C,OADA6J,GAASY,GACFA,EA+CT,MAAMwD,GAAY,qBAEFF,GAAoB7X,GAIlC,OAAO,IAAIsB,EADItB,EACU,CACvB4F,0BAAyBU,EAAQC,IAE3BlG,EAASkG,QACX,EAEOxE,EAAyBuE,EAAQC,GAG5CX,QAAQU,GACN,IAAIqB,EAAU7F,EAAIwE,EAAQ,SAC1B,MAAM0R,EAAazX,EAASoH,GAAWA,EAAUA,EAAQoQ,IAEzD,OAAOnX,EAAMsF,KAAK,IAAI/E,EAAI,IAAIe,GAAQoE,MAAYpE,GAAQ8V,OAM5DpS,IAAIU,EAAQC,GACV,MAAMoB,EAAU7F,EAAIwE,EAAQ,SACtB0R,EAAazX,EAASoH,GAAWA,EAAUA,EAAQoQ,IACzD,OAAO9V,GAAIqE,EAAQC,IAAQtE,GAAI+V,EAAYzR,IAE7CX,IAAIU,EAAQC,GACV,GAAItE,GAAIqE,EAAQC,GACd,OAAOzE,EAAIwE,EAAQC,GACd,CACL,MAAMoB,EAAU7F,EAAIwE,EAAQ,SACtB0R,EAAazX,EAASoH,GAAWA,EAAUzE,EAAOyE,GAExD,GAAI1F,GAAI+V,EAAYzR,GAAM,CAExB,MAAM0R,EAAWnW,EAAIkW,EAAYzR,GACjC,OAAOyD,EAAWiO,GAAYA,EAASC,KAAKF,GAAcC,OCzJpE,MAAME,GAAehX,EAAImB,UACnB8V,GAAe5N,EAAIlI,UAUzB,SAAS+V,GAAMrY,GACb,OAAOA,aAAawK,EAEtB,SAAStJ,GAAMlB,GACb,OAAOA,aAAamB,EAEtB,SAASN,GAAQb,GACf,OAAOY,EAAMC,QAAQb,GAGvB,MAAMyB,GAAUF,EAAOE,iBAErBS,kBACAL,SACAH,aACAC,kBACAC,OACAE,4BACAC,kBACAC,OACAC,OAEAE,GAAGmW,eACHA,IACE7W,GACJ,SAASlB,GAASP,GAChB,MAAoB,iBAANA,GAAwB,OAANA,EAElC,SAASU,GAAWV,GAClB,MAAoB,mBAANA,EAoBhB,SAASuY,GAGPjS,EACAwD,EACA0O,EAA2B,GAC3BC,EAAWnS,GAEX,IACG5F,GAAWoJ,GAMZ,MAAMiK,IAWR,GAAczN,aAnFMoS,GAKtB,SAAkB1Y,GAChB,OAAOA,aAAa2Y,EA6EKC,CAAStS,IAjFpC,SAAgBtG,GACd,OAAOA,aAAaoL,EAgFyByN,CAAOvS,GAClD,OAAOA,EAET,GAAI5F,GAAW4F,IAAW/F,GAAS+F,GAAS,CAG1C,IAAIwS,EAmDJ,OAlDI5X,GAAMoF,IACRwS,EAAU,IAAI3X,EAAI,IAAImF,IACtBnE,GAAI2W,EAAS,MAAQ7R,IACnBkR,GAAa5T,IAAIxD,KAAKuF,EAAQW,GAC9B6C,EAAS2O,EAAUD,OAAWlV,OAAWA,GAElC6U,GAAa5T,IAAIxD,KAAK+X,EAAS7R,KAExC9E,GAAI2W,EAAS,SAAW7R,IACtBkR,GAAalH,OAAOlQ,KAAKuF,EAAQW,GACjC6C,EAAS2O,EAAUD,OAAWlV,OAAWA,GAClC6U,GAAalH,OAAOlQ,KAAK+X,EAAS7R,KAE3C9E,GAAI2W,EAAS,QAAS,KACpBX,GAAapF,MAAMhS,KAAKuF,GACxBwD,EAAS2O,EAAUD,OAAWlV,OAAWA,GAClC6U,GAAapF,MAAMhS,KAAK+X,MAGxBT,GAAM/R,IACfwS,EAAU,IAAItO,EAAI,IAAIlE,IACtBnE,GAAI2W,EAAS,QAAS,KACpBV,GAAarF,MAAMhS,KAAKuF,GACxBwD,EAAS2O,EAAUD,OAAWlV,OAAWA,GAClC8U,GAAarF,MAAMhS,KAAK+X,KAEjC3W,GAAI2W,EAAS,MAAO,CAACvS,EAAUU,KAC7BmR,GAAajW,IAAIpB,KAAKuF,EAAQC,EAAKU,GACnC6C,EAAS2O,EAAUD,OAAWlV,OAAWA,GAClC8U,GAAajW,IAAIpB,KAAK+X,EAASvS,EAAKU,KAE7C9E,GAAI2W,EAAS,SAAW7R,IACtBmR,GAAanH,OAAOlQ,KAAKuF,EAAQW,GACjC6C,EAAS2O,EAAUD,OAAWlV,OAAWA,GAClC8U,GAAanH,OAAOlQ,KAAK+X,EAAS7R,MAG3C6R,EADSjY,GAAQyF,GACP,GAID5F,GAAW4F,UAGV,GAEPpF,GAAMoF,IAAY+R,GAAM/R,IAC3BgS,GAAeQ,EAAS,MAGnB,IAAIxX,EAAMwX,EAAS,CACxBlT,gBAAeiB,EAAGsD,EAAGnK,KACnB8J,EACE2O,EACA,IAAID,EAAW7T,EAAOwF,IAEtBlI,GAAIjC,EAAG,SAAWA,EAAEiH,MAAQvG,GAAWV,EAAE8B,KAAO9B,EAAE8B,WAAQwB,EAC1DxB,GAAIwE,EAAQ6D,IAEPvI,GAAe0E,EAAQ6D,EAAGnK,IAEnC4F,gBAAeiB,EAAGsD,KAChBL,EACE2O,EACA,IAAID,EAAW7T,EAAOwF,SACtB7G,EACAxB,GAAIwE,EAAQ6D,IAIPtI,GAAeyE,EAAQ6D,IAEhCvE,YACS1D,GAAQoE,GAEjBV,KAAIiB,EAAGsD,IACElI,GAAIqE,EAAQ6D,GAErBvE,mBACS5D,GAAesE,GAExBV,gBAAeiB,EAAGxD,IACTiV,GAAehS,EAAQjD,GAEhCuC,UAAUiB,EAAGkS,GACX,GACErY,GAAW4F,GAGX,OAAO3E,GAAU2E,EAAQyS,IAG7BnT,MAAMiB,EAAGgL,EAASmH,GAEhB,GAAItY,GAAW4F,GAgBb,OAAO5E,GAAM4E,EAAQuL,EAASmH,IAMlCpT,yBAAyBiB,EAAGQ,GAC1B,IAAI4R,EAAalX,GAAyBuE,EAAQe,GAClD,OAAIxG,GAAQyF,IAAiB,WAANe,EACd4R,EAEHA,GACFA,EAAWxR,cAAe,EACnBwR,QAEP,GA6BNrT,KAAIiB,EAAGQ,EAAGhE,KAGN3C,GAAWoJ,IAIXA,EACE2O,EACA,IAAID,EAAW7T,EAAO0C,IACtBhE,EACAvB,GAAIwE,EAAQe,IAKTlF,GAAImE,EAAQe,EAAGhE,IAWxBuC,IAAIiB,EAAGQ,GAEL,IAAIJ,EAAQnF,GAAIwE,EAAQe,GAExB,OAAI3G,GAAWuG,KAAW/F,GAAMoF,IAAW+R,GAAM/R,IACxCxE,GAAIgX,EAASzR,GAAG6Q,KAAKY,GAE1BpY,GAAWuG,IAAU1G,GAAS0G,GAczBsR,GACLtR,EACA6C,EACA,IAAI0O,EAAW7T,EAAO0C,IAEtBf,GAIKW,KAMb,OAAOX,EAGX,SAAwB4S,GAEtB5S,EAAWwD,GACX,IACGpJ,GAAWoJ,GAKZ,MAAMiK,IAQR,IACGrT,GAAWY,GAIZ,MAAMyS,IASR,OAAIrT,GAAW4F,IAAW/F,GAAS+F,GAC1BiS,GAAmBjS,EAAQwD,GAE3BxD,EC9UJ,MAAM6S,GAAgBhY,EAAImB,UAQjC,YACE+N,GAGA,MAAMuD,EAYR,SAASwF,EACP/I,GAOA,MAAMgJ,EAAW3Y,EAAW2P,GACxB,WACAS,EAAYT,GACZ,YACA9P,EAAS8P,GACT,gBAEJ,GAAIS,EAAYT,IAAS3P,EAAW2P,GAClC,OAAOwH,GACL,IAAIvW,EAAM,IAAIwO,GAAcO,GAAO,CACjCzK,oBACS,EAETA,oBACS,EAETA,KAAIU,EAAQC,EAAKU,MAKL,UAARV,KACEuK,EAAY7J,IAAuB,cAAboS,GACrB3Y,EAAWuG,IAAuB,aAAboS,MAEpB/S,EAAOC,KAASU,IAElB9E,GAAImE,EAAQC,EAAKU,GACjBX,EAAO2J,QAEF,GASXrK,oBACS,KAIR,GACLiK,GAAgBQ,GAIhB,OAAO+I,EAAY/I,EAAKrD,WACnB,GAAIzM,EAAS8P,GAUlB,gBCrFoBA,GACtB,IAAIiJ,EAAUjJ,EACd,MAAMkJ,EACJjZ,EAAc+P,IAASnN,EAAOyT,OAAOtG,GAAMmJ,KAAKxZ,GAAK6P,GAAgB7P,IACjEyZ,EAAgBvW,EAAOC,QAAQkN,GAAMhK,OAAO4B,IAEhD,OAAO4H,GADG5H,EAAE,MAGVsR,IACFD,EAAU,IAAKjJ,GACfoJ,EAAc7O,QAAQ,EAAErE,EAAKqN,MAC3BhS,EAAe0X,EAAS/S,EAAK,CAC3BiB,YAAY,EACZ5B,QACSgO,EAAM5G,UAEfvF,cAAc,OAIpB,MAAMsO,EAAkC,IAAIjG,GAAcwJ,GACtDC,GACFE,EAAc7O,QAAQ,EAAErE,EAAKqN,MAC3BO,GAAMP,EAAO,KACXmC,EAAS9F,IAAgBtL,EAAO4B,QAKtC,MAAMmT,EAAwC,CAC9CA,QAA0BpT,GACjB1F,EAAMsF,KACX,IAAI/E,EAAI,IAAIe,GAAQoE,MAAYpE,GAAQJ,EAAIwE,EAAQ,aAGxDoT,eAAiC,KACxB,EAETA,eAAiC,KACxB,EAETA,yBAA2C,CACzCpT,EACAC,KAGA,GAAIlG,EAASkG,GACX,OAEF,MAAMoB,EAAU7F,EAAIwE,EAAQ,SAEtB2S,EACJlX,EAAyBuE,EAAQC,IACjCxE,EAAyB4F,EAASpB,GAKpC,OAJI0S,IACFA,EAAWxR,cAAe,GAGrBwR,GAETS,eAAiC,CAACpT,EAA+BC,KAC/D,MAAMoB,EAAU7F,EAAIwE,EAAQ,SAC5B,OAAIrE,GAAI0F,EAASpB,KACf1E,EAAe8F,EAASpB,GACxBD,EAAO2J,IAAgBtL,EAAO4B,KACvB,IAKXmT,IAAsB,CAACpT,EAA+BC,KACpD,MAAMoB,EAAU7F,EAAIwE,EAAQ,SAC5B,OAAOrE,GAAIqE,EAAQC,IAAQtE,GAAI0F,EAASpB,IAE1CmT,IAAsB,CAACpT,EAA+BC,KACpD,MAAMU,EAAQnF,EAAIwE,EAAQ,SAC1B,GAAY,UAARC,IAAoB5F,EAAQsG,IAAU3G,EAAc2G,IACtD,OAAO0S,GAAY7X,EAAIwE,EAAQC,GAAM,CAACqT,EAAUpB,KAC9ClS,EAAO2J,IAAgBuI,EAAU,MAE9B,GAAIvW,GAAIqE,EAAQC,GACrB,OAAOzE,EAAIwE,EAAQC,GACd,GAAItE,GAAIgF,EAAOV,GAAM,CAC1B,IACErF,EAAM+F,IACG,QAARV,GAAyB,UAARA,GAA2B,WAARA,EAqChC,OAAIhG,EAAS0G,GACX0S,GAAY7X,EAAImF,EAAOV,GAAM,KAClCD,EAAO2J,IAAgBtL,EAAO4B,MAGzBzE,EAAImF,EAAOV,GAxClB,OAAQA,GACN,IAAK,MACH,OAAShC,IACP,IAAK4U,GAAclX,IAAIlB,KAAKkG,EAAO1C,GAAM,CACvC,MAAMsV,EAAcV,GAAc5S,GAAKxF,KAAKkG,EAAO1C,GAEnD,OADA+B,EAAO2J,MACA4J,KAGR3B,KAAKjR,GAGV,IAAK,SACH,OAAS6S,IACP,GAAIX,GAAclX,IAAIlB,KAAKkG,EAAO6S,GAAO,CACvC,MAAMD,EAAcV,GAAc5S,GAAKxF,KAAKkG,EAAO6S,GAEnD,OADAxT,EAAO2J,MACA4J,KAGR3B,KAAKjR,GAGV,IAAK,QACH,YACE,GAAIA,EAAM8S,KAAM,CACd,MAAMF,EAAcV,GAAc5S,GAAKxF,KAAKkG,GAE5C,OADAX,EAAO2J,MACA4J,KAGR3B,KAAKjR,MAalByS,IAAsB,CAACpT,EAA+BC,EAAKU,KACrD4I,GAAgB5I,KAElBA,EAAQA,EAAM+F,WAEhB,MAAMrF,EAAU7F,EAAIwE,EAAQ,SAC5B,MAAY,UAARC,GAAmBhG,EAAS0G,IAE9B9E,GAAImE,EAAQC,EAAKU,GACjBX,EAAO2J,OACA,IACGhO,GAAIqE,EAAQC,KACtBpE,GAAIwF,EAASpB,EAAKU,GAClBX,EAAO2J,IAAgBtL,EAAO4B,KACvB,KAUX,OAAO,IAAIjF,EACTyU,EAEA2D,GDzEOM,CAAkB3J,GAEzB,MAAM0D,IAlFwBqF,CAAY/I,GAE5C,OADAsD,GAASC,GACFA,WEPOqG,GAAa5E,GAC3B,MAAM6E,EAAerE,GACnB1D,GAAc,QAAS,CAACkD,KAQ1B,OAFAhN,GrCqEON,GAASoS,eAAeC,mBAAmB,IqCrExBlH,gBAAiBgH,GAEpCtZ,EAAMsF,KACXpE,EACEA,EAAIoY,EAAc,SAElB,sBAoEUG,GACdC,EACAC,GAEA,OAAOD,EACJ5W,IAAK8W,IACJ,YA5GyBxa,GAC7B,MAAyB,iBAAlBQ,EAAWR,GA2GVya,CAAeD,GAAU,CAG3B,gBAxE0BE,EAA4BH,GAI5D,MAAMI,EAAcD,EAAaE,aAC3BC,EAAeH,EAAaI,QAAQ3N,MAAMwN,EAAY7X,QAItDiY,EAHiBJ,EAEcK,MAAM,KAExCtX,IAAIuX,IACH,IAAIC,EAAiBX,EAAS,IAAMU,EAMpC,OAJIA,EAAgBtJ,WAAW,OAC7BuJ,EACEA,EAAiB,IAAMD,EAAgBja,QAAQ,IAAKuZ,IAEjDW,IAERnX,KAAK,KAOR,MAAO,CACL8G,KAAM6P,EAAa7P,KACnBsQ,WAAYT,EAAaS,WACzBC,iBAAkBV,EAAaU,iBAC/BC,MAAOX,EAAaW,MACpBC,SAAUxZ,EAAI4Y,EAAc,YAC5BE,aAAcG,EACdD,QAASC,EAAyBF,EAGlCjV,CAACnD,EAAOiJ,aAAc,gBAkCG6P,CAAkBf,EAASD,GAG3C,gBAnGkBva,GAC7B,MAAyB,iBAAlBQ,EAAWR,GAkGHwb,CAAehB,IACxBH,GAAe,IAAIG,EAAQiB,UAAWlB,GAC/BC,YAlGiBxa,GAC9B,MAAyB,kBAAlBQ,EAAWR,GAkGH0b,CAAgBlB,QAEzBmB,GAAcpB,OAAQjX,EAAWkX,EAAQoB,MAGlCpB,IAGVnU,OAAOwV,GAGZ,MAAMC,GAAoD,GAG1D,SACgBH,GACd7T,EACAhB,EACAiV,GCpIF,IAAuBC,EDsIrBlU,EAAUA,EAAQ7C,cACb6W,GAAqBhU,KACxBgU,GAAqBhU,GAAW,IAAI3G,GAElC2F,EACFgV,GAAqBhU,GAASvD,KC3IXyX,ED2I6BlV,EC1I3CmV,EAAIC,gBAAgB,IAAIC,EAAK,CAACH,GAAS,CAAEnR,KAAM,gBD2I3CkR,GACTD,GAAqBhU,GAASvD,IAAIwX,YAsBtBK,GAAkB/G,EAAckF,GAK9CoB,GAAcpB,WAfiBlF,EAAckF,GAQ7C,OALiBF,GADAJ,GADL5E,GAE8BkF,GAAQlU,OAAOwV,GAXzCnY,IAAI2Y,GAAKA,EAAEvB,SAAS/W,KAAK,MAoBtBuY,CADPjH,EAC6BkF,IAsBpCgC,eAAeC,GACpBjC,EACAkC,SAEM/D,EAAQgE,IACZ,IAAIZ,GAAqBvB,IAAS7W,IAAIiZ,aApBxCC,EACAtU,GAEA,OAAO,IAAIoQ,EAAQmE,IACjB,MAAMC,EAAe,KACnBF,EAAiBG,OAASH,EAAiBI,QAAU,KACrDH,KAGFD,EAAiBG,OAASD,EAC1BF,EAAiBI,QAAUF,EAC3BzU,GAAYC,EAAWsU,MAUrBK,UA7C+BC,GACnC,OAAOrH,GACL1D,GAAc,OAAQ,CAAEyJ,KAAMsB,EAAKC,IAAK,gBA2CxBC,CAAqBT,GAAWF,KElM7C,MAAMY,GAAc5a,EAAO,uBCAlB6a,GAAaxJ,GAC3B,OAAO4E,EAAQ6E,UAAUC,KAAK,IAAM1J,KCD/B,MAAM2J,GAAoBhb,EAAO,oBAC3Bib,GAAmBjb,EAAO,cA+C1Bkb,GAAmBlb,EAAO,cACjCmb,GAAgBnb,EAAO,gBACvBob,GAAapb,EAAO,aACpBqb,GAAgBrb,EAAO,WACvBsb,GAAkBtb,EAAO,sBAQfub,GAAgBC,aAC9B,GAAIvd,EAAWud,GAAU,CACvB,MAAMC,EAAe3O,GAAuBzN,IAAImc,GAChD,GAAIC,EACF,OAAOA,EAGT,MAAMzU,EAAe3H,EAAImc,EAAS,gBAC5BE,EAAMrc,EAAImc,EAAS,OACzB,MAAMG,UAAkB7U,GAMtB3D,YACEyQ,EAAoB,GACpB7E,EAAkB,IAElBhI,QARFE,QAAyD,GAsHzDA,SAAgB,EA5Gd,MAAMyU,EAAMrc,EAAI4H,KAAKrF,YAAa,OAElC,GAAI8Z,EAAK,CACP,MAAM5D,EAAS7Q,KAAK9B,QAAQ3C,cACvB6W,GAAqBvB,IACxB6B,GAAkB+B,EAAK5D,GAa3B,MAAM5Q,EAA6BrE,GAA4BoE,MAM3DnJ,EAAS8V,IACXnT,EAAO0G,OAAOD,EAAO0M,GAMvB,MAAM9E,EAAQ5H,EjB5BpB4J,IAAU,EACVW,KiB8BM,MAAMmK,EAAkBnb,EAAO6O,YAC7B7O,EAAOC,QAAQoO,GAAO7N,IAAI,EAAE6C,EAAKU,KAAW,CAACV,EAAK6S,GAAYnS,MAEhEyC,KAAKiU,IAAoBU,EAIzB,MAAMC,EAAe1G,GACnB1U,EAAO6O,YACL7O,EAAOC,QAAQkb,GAAiB3a,IAAI,EAAE6C,EAAKU,KAAW,CACpDV,EACAqR,GAAc3Q,OAKpB,IAAIsX,EAMJ,IACEA,EAAqB7c,EAAMuc,OAAS3a,EAAW,CAC7Cgb,EACA9M,EAASrL,KAAK,EAAA,KAShB,MAAOS,GAGP,MAFAqN,KAEMrN,EAQR,GALI/F,EAAQ0d,KACVA,EAAqBA,EAClBpY,KAAKC,EAAAA,GACLC,OAAOwV,KAERrJ,GAAY+L,GAiBd,MAHAtK,KAGMzS,IAjB6B,CACnC,MAAMgd,EAE6BjM,GACjCgM,GAGF7U,KAAKmU,IAAcW,EAAerY,KAAKC,EAAAA,GAAUC,OAAOwV,GACxDnS,KAAKoU,IjBpIN,IAAItK,IiBqIH9J,KAAKqU,IjBlIN,IAAItK,IiBmIH/J,KAAKgU,IjB9IN,IAAIhK,IiB+IHhK,KAAK+T,IjBnKN,IAAInK,IiBoKHW,MA6BJrO,0BAIE,GAHK8D,KAAKkU,MACRlU,KAAKkU,IAAiB/H,GAAOnM,KAAKmU,KAAa1X,KAAKC,EAAAA,KAEjDsD,KAAK2T,IAAc,CACtB3T,KAAK2T,KAAe,EAIpB,MAAMc,EAAMrc,EAAI4H,KAAKrF,YAAa,OAC5BkW,EAAS7Q,KAAK9B,QAAQ3C,cACxBkZ,GAAOrC,GAAqBvB,IAG9BvS,GAAW0B,KAAM,IAuBjB8S,GAAiBjC,EAAQ7Q,MAAM8T,KAAK,KAGlCrH,GAAMzM,KAAKkU,IAAgBlU,MAAM,MAInCyM,GAAMzM,KAAKkU,IAAgBlU,MAI/BA,KAAKoU,IAAelT,QAAQL,IAC1B+S,GAAa/S,KAEfkU,GAAU/U,MAEZ9D,6BACE8D,KAAKqU,IAAiBnT,QAAQL,IAC5B+S,GAAa/S,KAGfmU,GAAYhV,MAEd9D,IA9LC+X,KAoHOrI,KAEP+H,GAwEA/T,KACClF,GAMA,GAAIsF,KAAK2T,IACP,CACE,MAAMsB,EAAoBjV,KAAKiU,IAAkBvZ,GAC3Cwa,EAAatZ,GAA4BoE,MAI3CiV,IACFA,QAA6BC,EAAWxa,MAmBlD,OA5GSga,KAAoB9I,GACpB8I,MAAM3d,EAAS0d,IAAQA,EAAMA,OAAM7a,EAInC8a,eAAe7d,EAASkJ,GAC3B/C,EAAKC,MAAMD,EAAKM,UAAUyC,SAC1BnG,EAoGNiM,GAAuBpN,IAAI8b,EAASG,GAC7BA,EAIP,MAAM5c,aC3RMid,GAAUrZ,GACxB,GAAIvE,EAAQuE,GACVA,EAAIwF,QAAQ3C,IACVwW,GAAUxW,UAEP,GACLiP,GAAO9R,GAEP,CAkCA,YbSFA,GAIInD,GAAImD,EAAKmQ,KACVzT,EAAIsD,EAAKmQ,IAAoD3K,QAC5D,EAAE3B,EAAOlI,MAEPiI,GAAa5D,EAAK6D,EAAOlI,KajD7B8d,CAAezZ,GAIbnD,GAAImD,EAAKsQ,KAGR5T,EAAIsD,EAAKsQ,IAGP9K,QAASgJ,IACRgB,GAAQhB,GAGRA,EAAM3D,QAIVhO,GAAImD,EAAKsY,KAGR5b,EAAIsD,EAAKsY,IAA2C9S,QAClDgJ,IACCgB,GAAQhB,KASV3R,GAAImD,EAAKqY,IAAoB,CACV3b,EAAIsD,EAAKqY,IAIjB7S,QAAQ,EAAEgJ,EAAO9J,MAC5B,MAAMiH,EAAgBzB,GAA6BxN,IAAIgI,GAInDiH,GACF6C,EAAMnE,IAAesB,KAI3B0N,GAAUtV,GAAe/D,cAKbsZ,GAAYtZ,GAC1B,GAAIvE,EAAQuE,GACVA,EAAIwF,QAAQ3C,IACVyW,GAAYzW,UAET,GACLiP,GAAO9R,GAEP,CA0BA,Yb7DFA,GAKInD,GAAImD,EAAKmQ,KACVzT,EAAIsD,EAAKmQ,IAGP3K,QAAQ,EAAE3B,EAAOlI,O7BSxB,SACEqE,EACA6D,EACAlI,GAEAqE,EAAIyL,oBAAoB5H,EAAOlI,G6BZzB+d,CAAgB1Z,EAAK6D,EAAOlI,Ka6BhCge,CAAgB3Z,GAYdnD,GAAImD,EAAKsY,KAGR5b,EAAIsD,EAAKsY,IAA2C9S,QAClDgJ,cjBSeA,GACtBA,EAAMzD,MiBTE6O,CAAQpL,KAIV3R,GAAImD,EAAKqY,IAAoB,CACV3b,EAAIsD,EAAKqY,IAIjB7S,QAAQ,EAAEgJ,EAAO9J,MAC5B,MAAMiH,EAAgBzB,GAA6BxN,IAAIgI,GAInDiH,GACF6C,EAAMlE,IAAkBqB,KAI9B2N,GAAYvV,GAAe/D,KCrGxB,MACD6Z,GAAiBxc,EAAO,YACxByc,GAAkBzc,EAAO,aACzB0c,GAAgB1c,EAAO,WACvB2c,GAAiB3c,EAAO,YACxB4c,GAAa5c,EAAO,cACpB6c,GAAc7c,EAAO,2BAGzB8c,EACAC,EACAC,WAEA,IAAM5P,GAAgB0P,KAAapf,EAAUof,GAG3C,MAAM/d,IAER,CAACge,EAAQC,GAAS7U,QAAQ5K,IACxB,IAAMI,EAAYJ,KAAMwS,GAAYxS,GAGlC,MAAM,IAAIwB,IAGd,MAAM8C,EAAU,CAAEob,KAAMF,EAAQG,MAAOF,GACvC,MAAMG,UAAkBrW,GAMtB3D,cACE4D,QAFFE,SAAgB,EAId,MAAMmW,EAAc/d,EAAIwC,EAAS,QAC3Bwb,EAAehe,EAAIwC,EAAS,SAClCoF,KAAKuV,IAIH,CAACY,GAAa1Z,KAAK,EAAA,GAAOE,OAAOwV,GACnCnS,KAAKwV,IAKH,CAACY,GAAc3Z,KAAK,EAAA,GAAOE,OAAOwV,GAQtCjW,IAzBQ0P,KACP+H,GAwBAiC,OAEC,GADAnX,GAAWuB,KAAM,IACbA,KAAKwV,IAAkB,CACpBxV,KAAK0V,MAER1V,KAAK0V,IAAkBvJ,GAAOnM,KAAKwV,MAIrC,MAAMa,EAAiBrW,KAAK0V,IAC5BjJ,GAAM4J,EAAgBrW,MACtBqW,EAAenV,QAAQ3C,GAAKwW,GAAUxW,IAClCyB,KAAKyV,KACPzV,KAAKyV,IAAevU,QAAQ3C,GAAKyW,GAAYzW,KAInDrC,CAACyZ,MAEC,GADAlX,GAAWuB,KAAM,IACbA,KAAKuV,IAAiB,CACnBvV,KAAKyV,MACRzV,KAAKyV,IAAiBtJ,GAAOnM,KAAKuV,MAKpC,MAAMc,EAAiBrW,KAAKyV,IAC5BhJ,GAAM4J,EAAgBrW,MACtBqW,EAAenV,QAAQ3C,GAAKwW,GAAUxW,IAClCyB,KAAK0V,KACP1V,KAAK0V,IAAgBxU,QAAQ3C,GAAKyW,GAAYzW,KAIpDrC,0BACE,IAAK8D,KAAK2T,IAAc,CAEtB3T,KAAK2T,KAAe,EAEpB,MAAM1T,EAAgC6M,GAAc9M,OAEhD,IAASC,SACX7H,EAAI4H,KAAM2V,IAAYte,KAAK2I,OAEzB,IAAUC,SACZ7H,EAAI4H,KAAM4V,IAAave,KAAK2I,MAIhC+U,GAAU/U,MAGZ9D,6BACE8Y,GAAYhV,MAGd9D,CAAC0D,IACClF,GAEA,GAAIsF,KAAK2T,KAEM,UAATjZ,EAAkB,CACpB,MAAMuF,EAAgC6M,GAAc9M,OAEhD,IAASC,SACXD,KAAK2V,OAGH,IAAU1V,SACZD,KAAK4V,QAWf,OAzGSM,KAAoBtK,GAwGhBnD,GAAcyN,EAAW,CAAE3Y,MAAOsY,IC9GjD,SAASS,GACPC,EACAC,EACAC,EACAC,EACAnZ,EACA6L,GAEA,IAAKjD,GAAgB5I,GAGnB,MAAMzF,IAER,IAAIye,EAAM3Y,SAASwL,EAAKjI,MA6BtB,MAAMrJ,IA3BNW,GAAI2Q,EAAKhB,SAAUoO,EAAejZ,GAOlCmZ,EAAWxV,QAAQ6F,IACjB,MAEM4P,EAAc9N,GAFLO,EAAKd,QAAQvB,IAI5BtO,GACE2Q,EAAKd,QACLvB,EACA8B,GAAQ,IACH8N,EAEFpY,GACShB,EAAMA,MAAQnF,EAAImG,EAAE3B,OAAQ6Z,KAErC9Z,OAAOwV,eClFMyE,GAA+BrZ,GACrD,MAAO,CAAEA,MAAAA,GDMXgL,GAAW,CACTrM,MAAMqB,EAAOgM,EAASH,GACpBkN,GACE,CAAC,QAAS,WAAY,UACtB,QACA,QACA,CAAC,SAAU,SACX/Y,EACA6L,IAGJlN,QAAQqB,EAAOgM,EAASH,GACtBkN,GAAM,CAAC,SAAU,UAAW,UAAW,CAAC,SAAU,SAAU/Y,EAAO6L,GAGnE,MAEMuN,EADS9N,GAAQO,EAAKd,eAgB5B7P,GACE2Q,EAAKd,QAlBW,QAoBhBO,GAAQ,IAAI8N,EAjB8BpX,IAC1C,MAAMsX,EAAetX,EAAM3C,OACrBlC,EAAQ6E,EAAM3C,OAA4BlC,KAC5CA,Y5CuEuBoc,GAC/B,MAAO,IAAIzY,GAAS0Y,iBAAiBD,I4CvE/BC,CAAiB,cAAcrc,MAE5BiC,OAAOjB,GAAOA,IAAQmb,GAEtB3V,QAAQqI,IACPA,EAAQvC,cAAc,IAAIgQ,EAAM,gBAQSra,OAAOwV,OE3B5D,MAAM8E,GAAgBle,EAAO,iBAEvBme,GAAgBne,EAAO,iBACvBoe,GAAmBpe,EAAO,oBAC1Bqe,GAAqBre,EAAO,eAC5Bse,GAAiBte,EAAO,kBAC9B,SAASue,GACPC,EACAC,iBAEA,IAAKrgB,EAAQogB,KAAU/f,EAAM+f,KAAUpR,GAAgBoR,GAErD,MAAM,IAAIzf,EAEZ,IAAKd,EAAWwgB,GAEd,MAAM,IAAI1f,EAEZ,MAAM2f,EAAYnD,GAChB9a,EAAO0G,OACJ2H,IACC,MAAQtK,MAAOma,EAAWC,MAAOC,GAAc/P,EAKzCtK,EAAQma,EACRC,EAAQC,EAAUtU,UACxB,OAAOkU,EAAOja,EAAOoa,IAEvB,CAAE5X,aAAc,CAAE4X,MAAO,EAAGpa,WAAO3D,MAOjCie,EAAc,CAACta,EAA2Boa,IAC9ClP,GAAcgP,EAAW,CAAEla,MAAAA,EAAOoa,MAAAA,IAEpC,MAAMG,UAAgBjY,GACpB3D,cACE4D,QAWFE,QAGI,GACJA,QAA4C,GAC5CA,QAAkB0P,GAAY,IAK9B1P,SAAgB,EAChB9D,IAXCkb,KAIAC,KACAJ,KAIOrL,KACP+H,GACA/T,KAA0BlF,GACzB,GAAIsF,KAAK2T,KACM,UAATjZ,EAAkB,CACpB,MACM6C,EADQuP,GAAc9M,YAG5B,IAAK7I,EAAQoG,GAEX,MAAM,IAAIzF,EAIZW,GAAIuH,KAAKiX,IAAgB,QAAS1Z,GAElC,MAAMwa,EAActY,GAAeO,MAC7BgY,EAAYza,EAAMnE,OAClB6e,EAAYF,EAAY3e,OAC9B,GAAI4e,EAAYC,EAAW,CACzB,MAKMC,EALYhhB,EAAM8gB,GACrBje,UAAKH,GACLI,IAAI,CAACL,EAAGoB,IAAMA,GACd0I,MAAMwU,GAEoBje,IAAI2d,IAC/B,MAAMQ,EAAe/f,EAAI4H,KAAKoX,IAAqBO,GACnD,GAAIQ,EACF,OAAOA,EACF,CACL,MAAM/O,EAAOyO,EACXO,GACEpY,KAAKiX,IACLtd,GAAMA,EAAYge,IAGpBA,GAGF,OADAlf,GAAIuH,KAAKoX,IAAqBO,EAAOvO,GAC9BA,KAGLiP,EAAoBH,EAAWle,IAAIoP,IACvC,MAAMuO,EAAQvO,EAAKvB,MAAM8P,MACnBW,EAAiBlgB,EAAI4H,KAAKqX,IAAiBM,GACjD,GAAIW,EACF,OAAOA,EACF,CACL,MAAM/O,EAAU4C,GAAO/C,GAEvB,OADA3Q,GAAIuH,KAAKqX,IAAiBM,EAAOpO,GAC1BA,KAGXvJ,KAAKkX,IAAetW,QAAQsX,GAC5BlY,KAAKmX,IAAkBvW,QAAQyX,GAC/BA,EAAkBnX,QAAQqI,GAAW5K,GAAYqB,KAAMuJ,SAC9CyO,EAAYC,IAErBjY,KAAKkX,IAAiBlX,KAAKkX,IAAezT,MAAM,EAAGuU,GACnDhY,KAAKmX,IAAoBnX,KAAKmX,IAAkB1T,MAAM,EAAGuU,GACzDvY,GAAeO,MACZyD,MAAMuU,GACN9W,QAAQqI,a9C/FIE,GACzB,IAAIC,EAAaD,EAAKC,WAClBA,GACFA,EAAW6O,YAAY9O,I8C4FO+O,CAAWjP,MAKzCrN,6BACE8Y,GAAYhV,MAEd9D,0BACE,IAAK8D,KAAK2T,IAAc,CACtB3T,KAAK2T,KAAe,EAEpB,MACMpW,EADQuP,GAAc9M,YAG5B,IAAK7I,EAAQoG,GAEX,MAAM,IAAIzF,EAIZW,GAAIuH,KAAKiX,IAAgB,QAAS1Z,GAClCyC,KAAKkX,IAAiB3Z,EAAMvD,IAAI,CAACL,EAAGge,IAClCE,EACEO,GAASpY,KAAKiX,IAAgBtd,GAAMA,EAAYge,IAEhDA,IAGJ3X,KAAKmX,IAAoBhL,GAAOnM,KAAKkX,KAErC1d,EAAO0G,OAAOF,KAAKoX,IAAqBpX,KAAKkX,KAC7C1d,EAAO0G,OAAOF,KAAKqX,IAAiBrX,KAAKmX,KACzC1K,GAAMzM,KAAKmX,IAAmBnX,MAGhC+U,GAAU/U,OAGd,OA/GS8X,eAAe,CAAEva,MAAO,IAUxBua,KAAoBlM,GAqGtBnD,GAAcqP,EAAS,CAAEva,MAAOga"}