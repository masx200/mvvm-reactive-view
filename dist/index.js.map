{"version":3,"file":"index.js","sources":["../src/isprimitive.ts","../src/util.ts","../src/assetbrowser.ts","../node_modules/@masx200/dom-element-attribute-agent-proxy/dist/index.js","../src/dom.ts","../src/reflect.ts","../src/attrchange.ts","../node_modules/htm/dist/htm.module.js","../src/merge-entries.ts","../node_modules/lodash/isObject.js","../node_modules/lodash/_freeGlobal.js","../node_modules/lodash/_root.js","../node_modules/lodash/now.js","../node_modules/lodash/_Symbol.js","../node_modules/lodash/_getRawTag.js","../node_modules/lodash/_objectToString.js","../node_modules/lodash/_baseGetTag.js","../node_modules/lodash/isObjectLike.js","../node_modules/lodash/isSymbol.js","../node_modules/lodash/toNumber.js","../node_modules/lodash/debounce.js","../src/reactivestate.ts","../src/VirtualElement.ts","../src/createelement.ts","../src/html.ts","../src/toArray.ts","../src/mount-real-element.ts","../src/CustomElementRegistry.ts","../src/createcostumelemet.ts","../src/isconnected.ts","../src/context-mounted-unmounted.ts","../src/watch.ts","../src/extend-directive.ts","../src/directives.ts","../src/iscomponent.ts","../src/handle-onevent.ts","../src/render-vdom-to-real.ts","../src/MountElement.ts","../node_modules/@masx200/deep-observe-agent-proxy/dist/index.js","../src/handleobjectstate.ts","../src/createstate.ts","../src/cssurlblob.ts","../src/parsecss-transformcss.ts","../src/readonlyproxy.ts","../src/readysymbol.ts","../src/setimmediate.ts","../src/createComponent.ts","../src/element-onmount-unmount.ts","../src/conditon.ts","../src/computed.ts","../src/createref.ts","../src/model-input-textarea-value-directive-binding.ts"],"sourcesContent":["import { isString, isnumber, isboolean, isundefined } from \"./util\";\r\ntype Primitive = string | number | boolean | undefined | bigint;\r\nexport default function(a: any): a is Primitive {\r\n  return (\r\n    isString(a) ||\r\n    isnumber(a) ||\r\n    isboolean(a) ||\r\n    isundefined(a) ||\r\n    typeof a === \"bigint\"\r\n  );\r\n}\r\n","export function issymbol(a: any): a is symbol {\r\n  return typeof a === \"symbol\";\r\n  //||gettagtype(a) === \"symbol\";\r\n}\r\n\r\nexport { isplainobject };\r\nexport { isfunction as isFunction, isarray as isArray, isstring as isString };\r\nexport { isprimitive };\r\n\r\nconst isplainobject = (a: any): a is Record<any, any> =>\r\n  isobject(a) && gettagtype(a) === \"Object\";\r\n\r\nimport isprimitive from \"./isprimitive\";\r\n/* eslint-disable @typescript-eslint/explicit-function-return-type */\r\nexport function isundefined(a: any): a is void {\r\n  return (!a && a === void 0) || a === null;\r\n}\r\n\r\nexport function isnumber(a: any): a is number {\r\n  return typeof a === \"number\";\r\n}\r\nexport function isboolean(a: any): a is boolean {\r\n  return typeof a === \"boolean\";\r\n}\r\nexport function isobject(a: any): a is Exclude<object, Function> {\r\n  return typeof a === \"object\" && a !== null;\r\n}\r\n// export function isstring(a: string): true;\r\n// export function isstring(a): boolean;\r\nexport function isstring(a: any): a is string {\r\n  return typeof a === \"string\";\r\n}\r\nexport function isfunction(a: any): a is Function {\r\n  return typeof a === \"function\";\r\n}\r\n\r\nexport function isarray(a: any): a is Array<any> {\r\n  return a instanceof Array && Array.isArray(a) && gettagtype(a) === \"Array\";\r\n}\r\n/* export function getsymbol(a: string) {\r\n  return Symbol(a);\r\n} */\r\nexport function gettagtype(a: any): string {\r\n  return (\r\n    {}.toString\r\n      .call(a)\r\n      .replace(\"[object \", \"\")\r\n      .replace(\"]\", \"\")\r\n      //.toLowerCase()\r\n      .trim()\r\n  );\r\n}\r\n//export function ispromise(a: any): a is Promise<any> {\r\n//  return gettagtype(a) === \"promise\" && isFunction(get(a, \"then\"));\r\n//}\r\nexport function isSet(a: any): a is Set<any> {\r\n  return gettagtype(a) === \"Set\" && a instanceof Set;\r\n}\r\n\r\nconst camelizeRE = /-(\\w)/g;\r\nexport const camelize = (str: string): string => {\r\n  return str.replace(camelizeRE, (_, c) => (c ? c.toUpperCase() : \"\"));\r\n};\r\n\r\nconst hyphenateRE = /\\B([A-Z])/g;\r\nexport const hyphenate = (str: string): string => {\r\n  return str.replace(hyphenateRE, \"-$1\").toLowerCase();\r\n};\r\n","import { isfunction, isobject } from \"./util\";\r\nconst { HTMLElement, customElements, Proxy } = window;\r\nif (\r\n  !isfunction(HTMLElement) ||\r\n  //   typeof HTMLElement !== \"function\" ||\r\n  !isfunction(Proxy) ||\r\n  //   typeof Proxy !== \"function\" ||\r\n  !isobject(customElements)\r\n  /*||\r\n  //   typeof customElements !== \"object\" ||\r\n  !isfunction(window.CustomElementRegistry)\r\n  //||\r\n  //   typeof CustomElementRegistry !== \"function\"\r\n\r\n*/\r\n) {\r\n  console.error(\"Proxy,HTMLElement ,customElements ,browser not supported !\");\r\n  throw new TypeError();\r\n}\r\n","const hyphenateRE = /\\B([A-Z])/g;\r\n\r\nconst hyphenate = str => {\r\n    return str.replace(hyphenateRE, \"-$1\").toLowerCase();\r\n};\r\n\r\nconst String = window.String;\r\n\r\nconst Reflect = window.Reflect;\r\n\r\nconst {get: get, set: set, ownKeys: ownKeys} = Reflect;\r\n\r\nconst valuestring = \"value\";\r\n\r\nfunction isobject(a) {\r\n    return typeof a === \"object\" && a !== null;\r\n}\r\n\r\nfunction isstring(a) {\r\n    return typeof a === \"string\";\r\n}\r\n\r\nfunction isArray(a) {\r\n    return Array.isArray(a);\r\n}\r\n\r\nfunction isSet(a) {\r\n    return a instanceof Set;\r\n}\r\n\r\nconst isinputcheckbox = ele => \"input\" === geteletagname(ele) && get(ele, \"type\") === \"checkbox\";\r\n\r\nfunction objtostylestring(obj) {\r\n    obj = JSON.parse(JSON.stringify(obj));\r\n    obj = Object.fromEntries(Object.entries(obj).map(([key, value]) => [ hyphenate(key).trim(), value ]));\r\n    return Object.entries(obj).map(([key, value]) => key + \":\" + value).join(\";\");\r\n}\r\n\r\nfunction asserthtmlelement(ele) {\r\n    if (!(ele instanceof Element)) {\r\n        console.error(ele);\r\n        console.error(\"invalid HTMLElement!\");\r\n        throw TypeError();\r\n    }\r\n}\r\n\r\nfunction createeleattragentreadwrite(ele) {\r\n    asserthtmlelement(ele);\r\n    var temp = Object.create(null);\r\n    const outputattrs = new Proxy(temp, {\r\n        ownKeys() {\r\n            const isinputtextortextareaflag = isinputtextortextarea(ele);\r\n            const keys = attributesownkeys(ele);\r\n            return Array.from(new Set([ ...keys, isinputcheckbox(ele) ? \"checked\" : undefined, isinputtextortextareaflag ? valuestring : undefined ].flat(Infinity).filter(a => !!a)));\r\n        },\r\n        get(target, key) {\r\n            const isinputtextortextareaflag = isinputtextortextarea(ele);\r\n            if (isinputcheckbox(ele) && key === \"checked\") {\r\n                return get(ele, \"checked\");\r\n            }\r\n            if (isinputtextortextareaflag && key === valuestring) {\r\n                return get(ele, valuestring);\r\n            } else {\r\n                const v = getattribute(ele, String(key));\r\n                if (v === \"\") {\r\n                    return true;\r\n                }\r\n                if (v === null) {\r\n                    return;\r\n                }\r\n                if (isstring(v)) {\r\n                    try {\r\n                        return JSON.parse(String(v));\r\n                    } catch (error) {\r\n                        return v;\r\n                    }\r\n                } else return;\r\n            }\r\n        },\r\n        set(t, key, v) {\r\n            const isinputtextortextareaflag = isinputtextortextarea(ele);\r\n            if (\"function\" === typeof v) {\r\n                console.error(v);\r\n                console.error(\"Setting properties as functions is not allowed\");\r\n                throw TypeError();\r\n            }\r\n            if (geteletagname(ele) === \"input\" && key === \"checked\") {\r\n                set(ele, key, v);\r\n                return true;\r\n            }\r\n            if (isinputtextortextareaflag && key === valuestring) {\r\n                return set(ele, valuestring, String(v));\r\n            } else if (key === \"style\") {\r\n                const csstext = isstring(v) ? v : isobject(v) ? objtostylestring(v) : String(v);\r\n                set(get(ele, \"style\"), \"cssText\", csstext.trim());\r\n                return true;\r\n            } else if (key === \"class\" && isobject(v)) {\r\n                const classtext = isArray(v) ? v.join(\" \") : isSet(v) ? [ ...v ].join(\" \") : String(v);\r\n                setattribute(ele, String(key), classtext);\r\n            } else {\r\n                if (isSet(v)) {\r\n                    setattribute(ele, String(key), JSON.stringify([ ...v ]));\r\n                } else {\r\n                    if (v === true) {\r\n                        v = \"\";\r\n                    }\r\n                    setattribute(ele, String(key), isobject(v) ? JSON.stringify(v) : String(v));\r\n                    return true;\r\n                }\r\n            }\r\n            return true;\r\n        },\r\n        deleteProperty(t, k) {\r\n            removeAttribute(ele, String(k));\r\n            return true;\r\n        },\r\n        has(target, key) {\r\n            return ownKeys(outputattrs).includes(key);\r\n        },\r\n        defineProperty() {\r\n            return false;\r\n        },\r\n        getOwnPropertyDescriptor(target, key) {\r\n            const otherdescipter = {\r\n                enumerable: true,\r\n                configurable: true,\r\n                writable: true\r\n            };\r\n            const myvalue = get(outputattrs, key);\r\n            if (typeof myvalue !== \"undefined\") {\r\n                return {\r\n                    value: myvalue,\r\n                    ...otherdescipter\r\n                };\r\n            } else {\r\n                return;\r\n            }\r\n        },\r\n        setPrototypeOf() {\r\n            return false;\r\n        }\r\n    });\r\n    return outputattrs;\r\n}\r\n\r\nfunction attributesownkeys(ele) {\r\n    return ele.getAttributeNames();\r\n}\r\n\r\nfunction getattribute(ele, key) {\r\n    return ele.getAttribute(key);\r\n}\r\n\r\nfunction geteletagname(ele) {\r\n    return ele.tagName.toLowerCase();\r\n}\r\n\r\nfunction setattribute(ele, key, value) {\r\n    return ele.setAttribute(key, value);\r\n}\r\n\r\nfunction removeAttribute(ele, key) {\r\n    return ele.removeAttribute(key);\r\n}\r\n\r\nfunction isinputtextortextarea(ele) {\r\n    const tagname = geteletagname(ele);\r\n    return tagname === \"textarea\" || tagname === \"select\" || tagname === \"input\" && get(ele, \"type\") === \"text\";\r\n}\r\n\r\nexport default createeleattragentreadwrite;\r\n//# sourceMappingURL=index.js.map\r\n","const document = window.document;\r\n//import { seteletext, setelehtml } from \"./directives\";\r\n//export { seteletext, setelehtml };\r\n\r\nexport function seteletext(e: Element | Node, v: string) {\r\n  e.textContent = v;\r\n}\r\nexport function setelehtml(e: Element, v: string) {\r\n  e.innerHTML = v;\r\n}\r\nexport function appendchild(\r\n  container: HTMLElement | SVGSVGElement | SVGElement | Element | Node,\r\n  ele: HTMLElement | SVGElement | Element | Node\r\n) {\r\n  container.appendChild(ele);\r\n}\r\nexport function createsvgelement() {\r\n  return createElementNS(svgnamespace, \"svg\");\r\n}\r\nexport function createnonescript() {\r\n  return createDocumentFragment();\r\n}\r\nexport function createDocumentFragment() {\r\n  return document.createDocumentFragment();\r\n}\r\nexport function createnativeelement(type: string) {\r\n  return document.createElement(type);\r\n}\r\nexport function createElementNS(namespace: string, name: string) {\r\n  return document.createElementNS(namespace, name);\r\n}\r\nexport function createtextnode(data: string | number) {\r\n  return document.createTextNode(String(data));\r\n}\r\nexport const svgnamespace = \"http://www.w3.org/2000/svg\";\r\nexport function changetext(textnode: Text, value: string) {\r\n  textnode.nodeValue = String(value);\r\n}\r\nexport default document;\r\n\r\nexport const mathnamespace = \"http://www.w3.org/1998/Math/MathML\";\r\n\r\nexport function createmathelement() {\r\n  return createElementNS(mathnamespace, \"math\");\r\n}\r\nexport function createComment() {\r\n  return document.createComment(\"\");\r\n}\r\nexport function removeNode(node: Element) {\r\n  let parentNode = node.parentNode;\r\n  if (parentNode) {\r\n    parentNode.removeChild(node);\r\n  }\r\n}\r\nexport function replaceChild(newChild: Node, oldChild: Node) {\r\n  let parentNode = oldChild.parentNode;\r\n  if (parentNode) {\r\n    parentNode.replaceChild(newChild, oldChild);\r\n  }\r\n}\r\n\r\nexport function domaddlisten(\r\n  ele: Element | Node,\r\n  event: string,\r\n  call: EventListener\r\n) {\r\n  ele.addEventListener(event, call);\r\n}\r\n\r\nexport function domremovelisten(\r\n  ele: Element | Node,\r\n  event: string,\r\n  call: EventListener\r\n) {\r\n  ele.removeEventListener(event, call);\r\n}\r\nexport function getdomchildren(ele: Element | Node) {\r\n  return Array.from(ele.childNodes);\r\n}\r\nexport function getAttribute(ele: Element, name: string) {\r\n  return HTMLElementprototype.getAttribute.call(ele, name);\r\n}\r\nexport function setAttribute(ele: Element, name: string, value: any) {\r\n  HTMLElementprototype.setAttribute.call(ele, name, value);\r\n}\r\nexport function removeAttribute(ele: Element, name: string) {\r\n  HTMLElementprototype.removeAttribute.call(ele, name);\r\n}\r\nconst HTMLElementprototype = HTMLElement.prototype;\r\n\r\nexport function insertfirst(\r\n  container: HTMLElement | Element,\r\n  ele: HTMLElement\r\n) {\r\n  container.insertBefore(ele, container.firstChild);\r\n}\r\nexport function createanotherhtmldocument() {\r\n  return document.implementation.createHTMLDocument(\"\");\r\n}\r\n/* export function getparentNode(ele: Node): Node {\r\n  return ele.parentNode ? ele.parentNode : ele;\r\n}\r\n */\r\n","const Reflect = window.Reflect;\r\n// export default Reflect;\r\n\r\nexport const {\r\n  apply,\r\n  construct,\r\n  defineProperty,\r\n  deleteProperty,\r\n  get,\r\n  getOwnPropertyDescriptor,\r\n  getPrototypeOf,\r\n  has,\r\n\r\n  //   isExtensible,\r\n  ownKeys,\r\n  //   preventExtensions,\r\n  set\r\n  //   setPrototypeOf\r\n} = Reflect;\r\n// export {};\r\n/*\r\napply()\r\n对一个函数进行调用操作，同时可以传入一个数组作为调用参数。和 Function.prototype.apply() 功能类似。\r\nconstruct()\r\n对构造函数进行 new 操作，相当于执行 new target(...args)。\r\ndefineProperty()\r\n和 Object.defineProperty() 类似。\r\ndeleteProperty()\r\n作为函数的delete操作符，相当于执行 delete target[name]。\r\n//Reflect.enumerate()\r\n该方法会返回一个包含有目标对象身上所有可枚举的自身字符串属性以及继承字符串属性的迭代器，for...in 操作遍历到的正是这些属性。\r\nget()\r\n获取对象身上某个属性的值，类似于 target[name]。\r\ngetOwnPropertyDescriptor()\r\n类似于 Object.getOwnPropertyDescriptor()。\r\ngetPrototypeOf()\r\n类似于 Object.getPrototypeOf()。\r\nhas()\r\n判断一个对象是否存在某个属性，和 in 运算符 的功能完全相同。\r\nisExtensible()\r\n类似于 Object.isExtensible().\r\nownKeys()\r\n返回一个包含所有自身属性（不包含继承属性）的数组。(类似于 Object.keys(), 但不会受enumerable影响).\r\npreventExtensions()\r\n类似于 Object.preventExtensions()。返回一个Boolean。\r\nset()\r\n将值分配给属性的函数。返回一个Boolean，如果更新成功，则返回true。\r\nsetPrototypeOf()\r\n类似于 Object.setPrototypeOf()。\r\n*/\r\n","import { getAttribute, removeAttribute, setAttribute } from \"./dom\";\r\nimport { get } from \"./reflect\";\r\nimport { isFunction } from \"./util\";\r\nexport const attributeChangedCallback = \"attributeChangedCallback\";\r\nexport class AttrChange extends HTMLElement {\r\n  //   [attributeChangedCallback](name?: string): void;\r\n  // prototype!: HTMLElement;\r\n  /*  defaultProps?: { [key: string]: any } | undefined;\r\n  css?: string | undefined; */\r\n  /* constructor() {\r\n    super();\r\n  } */\r\n\r\n  /* 跟seteletext发生冲突,清空children */\r\n  //   get textContent() {\r\n  //     return String(super.textContent || \"\");\r\n  //   }\r\n  //   set textContent(_a: string) {\r\n  //     console.trace();\r\n  //     // return;\r\n  //   }\r\n  //   get innerHTML() {\r\n  //     return super.innerHTML;\r\n  //   }\r\n  //   set innerHTML(_a: string) {\r\n  //     // return;\r\n  //   }\r\n  //   get innerText() {\r\n  //     return super.innerText;\r\n  //   }\r\n  //   set innerText(_a: string) {\r\n  //     // return;\r\n  //   }\r\n  // [attributeChangedCallback](\r\n  //   name: string\r\n\r\n  /* _name?: any, _oldValue?: any, _newValue?: any */\r\n  // ) {\r\n  //   noop(name);\r\n  //\r\n  //  }\r\n  /* constructor() {\r\n    super();\r\n  } */\r\n\r\n  //禁止设置innerhtml，innertext，textcontent\r\n  /* disconnectedCallback() {\r\n  console.log('Custom square element removed from page.');\r\n} */\r\n  /* connectedCallback() {\r\n  console.log('Custom square element added to page.');\r\n  updateStyle(this);\r\n} */\r\n  //\r\n  //   connectedCallback(){}\r\n  /* attributeChangedCallback(name, oldValue, newValue) {\r\n  console.log('Custom square element attributes changed.');\r\n  updateStyle(this);\r\n} */\r\n  setAttribute(qualifiedName: string, value: string) {\r\n    const callback = get(this, attributeChangedCallback);\r\n    const oldValue = getAttribute(this, qualifiedName);\r\n    // super.getAttribute(qualifiedName);\r\n\r\n    if (oldValue !== value) {\r\n      setAttribute(this, qualifiedName, value);\r\n      //   super.setAttribute(qualifiedName, value);\r\n      if (\r\n        isFunction(\r\n          callback\r\n          // this[attributeChangedCallback]\r\n        )\r\n      ) {\r\n        // setimmediate(() => {\r\n        callback.call(this, qualifiedName, oldValue, value);\r\n        // });\r\n      }\r\n    }\r\n  }\r\n  removeAttribute(qualifiedName: string) {\r\n    const callback = get(this, attributeChangedCallback);\r\n    const oldValue = getAttribute(this, qualifiedName);\r\n\r\n    if (null !== oldValue) {\r\n      //   super.removeAttribute(qualifiedName);\r\n      removeAttribute(this, qualifiedName);\r\n      if (isFunction(callback)) {\r\n        // setimmediate(() => {\r\n        callback.call(this, qualifiedName, oldValue, undefined);\r\n        // });\r\n      }\r\n    }\r\n  }\r\n}\r\n","var n=function(t,r,u,e){for(var p=1;p<r.length;p++){var s=r[p],h=\"number\"==typeof s?u[s]:s,a=r[++p];1===a?e[0]=h:3===a?e[1]=Object.assign(e[1]||{},h):5===a?(e[1]=e[1]||{})[r[++p]]=h:6===a?e[1][r[++p]]+=h+\"\":e.push(a?t.apply(null,n(t,h,u,[\"\",null])):h)}return e},t=function(n){for(var t,r,u=1,e=\"\",p=\"\",s=[0],h=function(n){1===u&&(n||(e=e.replace(/^\\s*\\n\\s*|\\s*\\n\\s*$/g,\"\")))?s.push(n||e,0):3===u&&(n||e)?(s.push(n||e,1),u=2):2===u&&\"...\"===e&&n?s.push(n,3):2===u&&e&&!n?s.push(!0,5,e):u>=5&&((e||!n&&5===u)&&(s.push(e,u,r),u=6),n&&(s.push(n,u,r),u=6)),e=\"\"},a=0;a<n.length;a++){a&&(1===u&&h(),h(a));for(var f=0;f<n[a].length;f++)t=n[a][f],1===u?\"<\"===t?(h(),s=[s],u=3):e+=t:4===u?\"--\"===e&&\">\"===t?(u=1,e=\"\"):e=t+e[0]:p?t===p?p=\"\":e+=t:'\"'===t||\"'\"===t?p=t:\">\"===t?(h(),u=1):u&&(\"=\"===t?(u=5,r=e,e=\"\"):\"/\"===t&&(u<5||\">\"===n[a][f+1])?(h(),3===u&&(s=s[0]),u=s,(s=s[0]).push(u,2),u=0):\" \"===t||\"\\t\"===t||\"\\n\"===t||\"\\r\"===t?(h(),u=2):e+=t),3===u&&\"!--\"===e&&(u=4,s=s[0])}return h(),s},r=\"function\"==typeof Map,u=r?new Map:{},e=r?function(n){var r=u.get(n);return r||u.set(n,r=t(n)),r}:function(n){for(var r=\"\",e=0;e<n.length;e++)r+=n[e].length+\"-\"+n[e];return u[r]||(u[r]=t(n))};export default function(t){var r=n(this,e(t),arguments,[]);return r.length>1?r:r[0]}\n","/* \r\n        \r\n        [[\"value\",[\"f\",\"f\"]],[\"value\",[\"f\",\"f\"]]]\r\n\r\n\r\n        [[\"value\",[\"f\",\"f\",\"f\",\"f\"]]]\r\n        \r\n        */\r\nexport function merge_entries(\r\n  a: [string, any][] /* Array<[any, Array<any>]> */\r\n): [string, any][] {\r\n  const m: { [s: string]: Set<any> } = {};\r\n\r\n  a.forEach(([key, value]) => {\r\n    if (!m[key]) {\r\n      m[key] = new Set();\r\n    }\r\n    // m[key] && (m[key] = new Set());\r\n\r\n    value.forEach((v: any) => {\r\n      m[key].add(v);\r\n    });\r\n  });\r\n  return Object.entries(m).map(([k, v]) => [k, [...v]]);\r\n}\r\n","/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\nfunction isObject(value) {\n  var type = typeof value;\n  return value != null && (type == 'object' || type == 'function');\n}\n\nmodule.exports = isObject;\n","/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\nmodule.exports = freeGlobal;\n","var freeGlobal = require('./_freeGlobal');\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\nmodule.exports = root;\n","var root = require('./_root');\n\n/**\n * Gets the timestamp of the number of milliseconds that have elapsed since\n * the Unix epoch (1 January 1970 00:00:00 UTC).\n *\n * @static\n * @memberOf _\n * @since 2.4.0\n * @category Date\n * @returns {number} Returns the timestamp.\n * @example\n *\n * _.defer(function(stamp) {\n *   console.log(_.now() - stamp);\n * }, _.now());\n * // => Logs the number of milliseconds it took for the deferred invocation.\n */\nvar now = function() {\n  return root.Date.now();\n};\n\nmodule.exports = now;\n","var root = require('./_root');\n\n/** Built-in value references. */\nvar Symbol = root.Symbol;\n\nmodule.exports = Symbol;\n","var Symbol = require('./_Symbol');\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * A specialized version of `baseGetTag` which ignores `Symbol.toStringTag` values.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the raw `toStringTag`.\n */\nfunction getRawTag(value) {\n  var isOwn = hasOwnProperty.call(value, symToStringTag),\n      tag = value[symToStringTag];\n\n  try {\n    value[symToStringTag] = undefined;\n    var unmasked = true;\n  } catch (e) {}\n\n  var result = nativeObjectToString.call(value);\n  if (unmasked) {\n    if (isOwn) {\n      value[symToStringTag] = tag;\n    } else {\n      delete value[symToStringTag];\n    }\n  }\n  return result;\n}\n\nmodule.exports = getRawTag;\n","/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/**\n * Converts `value` to a string using `Object.prototype.toString`.\n *\n * @private\n * @param {*} value The value to convert.\n * @returns {string} Returns the converted string.\n */\nfunction objectToString(value) {\n  return nativeObjectToString.call(value);\n}\n\nmodule.exports = objectToString;\n","var Symbol = require('./_Symbol'),\n    getRawTag = require('./_getRawTag'),\n    objectToString = require('./_objectToString');\n\n/** `Object#toString` result references. */\nvar nullTag = '[object Null]',\n    undefinedTag = '[object Undefined]';\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * The base implementation of `getTag` without fallbacks for buggy environments.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the `toStringTag`.\n */\nfunction baseGetTag(value) {\n  if (value == null) {\n    return value === undefined ? undefinedTag : nullTag;\n  }\n  return (symToStringTag && symToStringTag in Object(value))\n    ? getRawTag(value)\n    : objectToString(value);\n}\n\nmodule.exports = baseGetTag;\n","/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return value != null && typeof value == 'object';\n}\n\nmodule.exports = isObjectLike;\n","var baseGetTag = require('./_baseGetTag'),\n    isObjectLike = require('./isObjectLike');\n\n/** `Object#toString` result references. */\nvar symbolTag = '[object Symbol]';\n\n/**\n * Checks if `value` is classified as a `Symbol` primitive or object.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a symbol, else `false`.\n * @example\n *\n * _.isSymbol(Symbol.iterator);\n * // => true\n *\n * _.isSymbol('abc');\n * // => false\n */\nfunction isSymbol(value) {\n  return typeof value == 'symbol' ||\n    (isObjectLike(value) && baseGetTag(value) == symbolTag);\n}\n\nmodule.exports = isSymbol;\n","var isObject = require('./isObject'),\n    isSymbol = require('./isSymbol');\n\n/** Used as references for various `Number` constants. */\nvar NAN = 0 / 0;\n\n/** Used to match leading and trailing whitespace. */\nvar reTrim = /^\\s+|\\s+$/g;\n\n/** Used to detect bad signed hexadecimal string values. */\nvar reIsBadHex = /^[-+]0x[0-9a-f]+$/i;\n\n/** Used to detect binary string values. */\nvar reIsBinary = /^0b[01]+$/i;\n\n/** Used to detect octal string values. */\nvar reIsOctal = /^0o[0-7]+$/i;\n\n/** Built-in method references without a dependency on `root`. */\nvar freeParseInt = parseInt;\n\n/**\n * Converts `value` to a number.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to process.\n * @returns {number} Returns the number.\n * @example\n *\n * _.toNumber(3.2);\n * // => 3.2\n *\n * _.toNumber(Number.MIN_VALUE);\n * // => 5e-324\n *\n * _.toNumber(Infinity);\n * // => Infinity\n *\n * _.toNumber('3.2');\n * // => 3.2\n */\nfunction toNumber(value) {\n  if (typeof value == 'number') {\n    return value;\n  }\n  if (isSymbol(value)) {\n    return NAN;\n  }\n  if (isObject(value)) {\n    var other = typeof value.valueOf == 'function' ? value.valueOf() : value;\n    value = isObject(other) ? (other + '') : other;\n  }\n  if (typeof value != 'string') {\n    return value === 0 ? value : +value;\n  }\n  value = value.replace(reTrim, '');\n  var isBinary = reIsBinary.test(value);\n  return (isBinary || reIsOctal.test(value))\n    ? freeParseInt(value.slice(2), isBinary ? 2 : 8)\n    : (reIsBadHex.test(value) ? NAN : +value);\n}\n\nmodule.exports = toNumber;\n","var isObject = require('./isObject'),\n    now = require('./now'),\n    toNumber = require('./toNumber');\n\n/** Error message constants. */\nvar FUNC_ERROR_TEXT = 'Expected a function';\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeMax = Math.max,\n    nativeMin = Math.min;\n\n/**\n * Creates a debounced function that delays invoking `func` until after `wait`\n * milliseconds have elapsed since the last time the debounced function was\n * invoked. The debounced function comes with a `cancel` method to cancel\n * delayed `func` invocations and a `flush` method to immediately invoke them.\n * Provide `options` to indicate whether `func` should be invoked on the\n * leading and/or trailing edge of the `wait` timeout. The `func` is invoked\n * with the last arguments provided to the debounced function. Subsequent\n * calls to the debounced function return the result of the last `func`\n * invocation.\n *\n * **Note:** If `leading` and `trailing` options are `true`, `func` is\n * invoked on the trailing edge of the timeout only if the debounced function\n * is invoked more than once during the `wait` timeout.\n *\n * If `wait` is `0` and `leading` is `false`, `func` invocation is deferred\n * until to the next tick, similar to `setTimeout` with a timeout of `0`.\n *\n * See [David Corbacho's article](https://css-tricks.com/debouncing-throttling-explained-examples/)\n * for details over the differences between `_.debounce` and `_.throttle`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to debounce.\n * @param {number} [wait=0] The number of milliseconds to delay.\n * @param {Object} [options={}] The options object.\n * @param {boolean} [options.leading=false]\n *  Specify invoking on the leading edge of the timeout.\n * @param {number} [options.maxWait]\n *  The maximum time `func` is allowed to be delayed before it's invoked.\n * @param {boolean} [options.trailing=true]\n *  Specify invoking on the trailing edge of the timeout.\n * @returns {Function} Returns the new debounced function.\n * @example\n *\n * // Avoid costly calculations while the window size is in flux.\n * jQuery(window).on('resize', _.debounce(calculateLayout, 150));\n *\n * // Invoke `sendMail` when clicked, debouncing subsequent calls.\n * jQuery(element).on('click', _.debounce(sendMail, 300, {\n *   'leading': true,\n *   'trailing': false\n * }));\n *\n * // Ensure `batchLog` is invoked once after 1 second of debounced calls.\n * var debounced = _.debounce(batchLog, 250, { 'maxWait': 1000 });\n * var source = new EventSource('/stream');\n * jQuery(source).on('message', debounced);\n *\n * // Cancel the trailing debounced invocation.\n * jQuery(window).on('popstate', debounced.cancel);\n */\nfunction debounce(func, wait, options) {\n  var lastArgs,\n      lastThis,\n      maxWait,\n      result,\n      timerId,\n      lastCallTime,\n      lastInvokeTime = 0,\n      leading = false,\n      maxing = false,\n      trailing = true;\n\n  if (typeof func != 'function') {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  wait = toNumber(wait) || 0;\n  if (isObject(options)) {\n    leading = !!options.leading;\n    maxing = 'maxWait' in options;\n    maxWait = maxing ? nativeMax(toNumber(options.maxWait) || 0, wait) : maxWait;\n    trailing = 'trailing' in options ? !!options.trailing : trailing;\n  }\n\n  function invokeFunc(time) {\n    var args = lastArgs,\n        thisArg = lastThis;\n\n    lastArgs = lastThis = undefined;\n    lastInvokeTime = time;\n    result = func.apply(thisArg, args);\n    return result;\n  }\n\n  function leadingEdge(time) {\n    // Reset any `maxWait` timer.\n    lastInvokeTime = time;\n    // Start the timer for the trailing edge.\n    timerId = setTimeout(timerExpired, wait);\n    // Invoke the leading edge.\n    return leading ? invokeFunc(time) : result;\n  }\n\n  function remainingWait(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime,\n        timeWaiting = wait - timeSinceLastCall;\n\n    return maxing\n      ? nativeMin(timeWaiting, maxWait - timeSinceLastInvoke)\n      : timeWaiting;\n  }\n\n  function shouldInvoke(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime;\n\n    // Either this is the first call, activity has stopped and we're at the\n    // trailing edge, the system time has gone backwards and we're treating\n    // it as the trailing edge, or we've hit the `maxWait` limit.\n    return (lastCallTime === undefined || (timeSinceLastCall >= wait) ||\n      (timeSinceLastCall < 0) || (maxing && timeSinceLastInvoke >= maxWait));\n  }\n\n  function timerExpired() {\n    var time = now();\n    if (shouldInvoke(time)) {\n      return trailingEdge(time);\n    }\n    // Restart the timer.\n    timerId = setTimeout(timerExpired, remainingWait(time));\n  }\n\n  function trailingEdge(time) {\n    timerId = undefined;\n\n    // Only invoke if we have `lastArgs` which means `func` has been\n    // debounced at least once.\n    if (trailing && lastArgs) {\n      return invokeFunc(time);\n    }\n    lastArgs = lastThis = undefined;\n    return result;\n  }\n\n  function cancel() {\n    if (timerId !== undefined) {\n      clearTimeout(timerId);\n    }\n    lastInvokeTime = 0;\n    lastArgs = lastCallTime = lastThis = timerId = undefined;\n  }\n\n  function flush() {\n    return timerId === undefined ? result : trailingEdge(now());\n  }\n\n  function debounced() {\n    var time = now(),\n        isInvoking = shouldInvoke(time);\n\n    lastArgs = arguments;\n    lastThis = this;\n    lastCallTime = time;\n\n    if (isInvoking) {\n      if (timerId === undefined) {\n        return leadingEdge(lastCallTime);\n      }\n      if (maxing) {\n        // Handle invocations in a tight loop.\n        clearTimeout(timerId);\n        timerId = setTimeout(timerExpired, wait);\n        return invokeFunc(lastCallTime);\n      }\n    }\n    if (timerId === undefined) {\n      timerId = setTimeout(timerExpired, wait);\n    }\n    return result;\n  }\n  debounced.cancel = cancel;\n  debounced.flush = flush;\n  return debounced;\n}\n\nmodule.exports = debounce;\n","export const addonelistner = Symbol(\"addonelistner\");\r\nexport const removeonelistner = Symbol(\"removeonelistner\");\r\nimport debounce from \"lodash/debounce\";\r\n// import Reflect from \"./reflect\";\r\nimport isprimitive from \"./isprimitive\";\r\nimport { gettagtype, isobject, isSet } from \"./util\";\r\nimport { UnwrapedState } from \"./watch\";\r\nexport const callbackmap = Symbol(\"callbackmap\");\r\nexport const cancelsubscribe = Symbol(\"cancelsubscribe\");\r\nconst debouncedispatch = Symbol(\"debouncedispatch\");\r\nexport const invalid_primitive_or_object_state =\r\n  \"invalid primitive or object state\";\r\nexport function isReactiveState(a: any): a is ReactiveState<any> {\r\n  return a instanceof ReactiveState && gettagtype(a) === \"ReactiveState\";\r\n}\r\n// export const textnodesymbol = Symbol(\"textnode\");\r\nexport const changetextnodesymbol = Symbol(\"changetextnode\");\r\nexport const eventtargetsymbol = Symbol(\"eventtatget\");\r\nexport const memlisteners = Symbol(\"memlisteners\");\r\nexport const dispatchsymbol = Symbol(\"dispatch\");\r\nexport const subscribesymbol = Symbol(\"subscribe\");\r\nexport const removeallistenerssymbol = Symbol(\"removeallisteners\");\r\nexport const addallistenerssymbol = Symbol(\"addallisteners\");\r\n/* const forkarryaprototype = {};\r\nownKeys(Array.prototype).forEach(key => {\r\n  forkarryaprototype[key] = Array.prototype[key];\r\n}); */\r\n/* class forkarray {}\r\nObject.assign(forkarray.prototype, forkarryaprototype);\r\nforkarray.prototype.constructor = forkarray;\r\ndeleteProperty(forkarray.prototype, \"length\"); */\r\n/* extends forkarray  */\r\n\r\nexport default class ReactiveState<T extends UnwrapedState> {\r\n  [callbackmap] = new Map<Function, EventListener>();\r\n\r\n  readonly [Symbol.toStringTag] = \"ReactiveState\";\r\n\r\n  constructor(init?: T) {\r\n    //super();\r\n    if (isprimitive(init) || isobject(init)) {\r\n      Object.defineProperty(this, \"value\", {\r\n        value: init,\r\n        configurable: true,\r\n        writable: true\r\n      });\r\n\r\n      // this.value = init;\r\n    } else {\r\n      console.error(init);\r\n      console.error(invalid_primitive_or_object_state);\r\n      throw TypeError();\r\n    }\r\n    // this[eventtargetsymbol] = new EventTarget();\r\n\r\n    /*\r\n  //  Object.defineProperty(this, Symbol.toStringTag, {\r\n //     value: \"ReactiveState\",\r\n   //   configurable: true\r\n    //});\r\n\r\n*/\r\n\r\n    const debouncedfun = debounce((eventname?: string) => {\r\n      const name = eventname ? String(eventname) : \"value\";\r\n\r\n      this[eventtargetsymbol].dispatchEvent(\r\n        new CustomEvent(\"value\", { detail: name })\r\n      );\r\n    });\r\n    this[debouncedispatch] = (eventname?: string) => {\r\n      debouncedfun(eventname);\r\n    };\r\n  }\r\n  [debouncedispatch]: (eventname?: string | undefined) => void;\r\n  /* get [Symbol.toStringTag]() {\r\n  //  return \"ReativeState\";\r\n\r\n} */\r\n  [removeallistenerssymbol]() {\r\n    this[memlisteners].forEach(callback => {\r\n      this[removeonelistner](callback);\r\n    });\r\n  }\r\n  [removeonelistner](callback: EventListener) {\r\n    const name = \"value\";\r\n    this[eventtargetsymbol].removeEventListener(name, callback);\r\n  }\r\n  [addonelistner](callback: EventListener) {\r\n    const name = \"value\";\r\n    this[eventtargetsymbol].addEventListener(name, callback);\r\n  }\r\n  [addallistenerssymbol]() {\r\n    // const name = \"value\";\r\n    this[memlisteners].forEach(callback => {\r\n      this[addonelistner](callback);\r\n      //   this[eventtargetsymbol].addEventListener(name, callback);\r\n    });\r\n  }\r\n  /*  [changetextnodesymbol](textnode: Text) {\r\n    this[textnodesymbol] = textnode;\r\n  } */\r\n  // [textnodesymbol]: Text | undefined;\r\n  /*  [changetextnodesymbol](textnode: Text) {\r\n      this[textnodesymbol] = textnode;\r\n    } */\r\n  // [textnodesymbol]: Text | undefined;\r\n  value: T | undefined;\r\n  [eventtargetsymbol] = new EventTarget();\r\n  [memlisteners] = new Set<EventListener>();\r\n\r\n  //剑头函数绑定this\r\n  valueOf = () => {\r\n    return this.value;\r\n  };\r\n  toString() {\r\n    const value = this.valueOf();\r\n    return isprimitive(value)\r\n      ? String(value)\r\n      : isSet(value)\r\n      ? JSON.stringify([...value])\r\n      : isobject(value)\r\n      ? JSON.stringify(value)\r\n      : \"\";\r\n  }\r\n\r\n  [dispatchsymbol](eventname?: string) {\r\n    //添加防抖函数\r\n\r\n    this[debouncedispatch](eventname);\r\n  }\r\n  [subscribesymbol](\r\n    callback: Function\r\n    /*, eventname?: string*/\r\n  ) {\r\n    let eventlistener: EventListener;\r\n    const possiblecallback = this[callbackmap].get(callback);\r\n    if (possiblecallback) {\r\n      eventlistener = possiblecallback;\r\n    } else {\r\n      //自动解包\r\n      eventlistener = () => callback(this.valueOf());\r\n\r\n      this[callbackmap].set(callback, eventlistener);\r\n    }\r\n    // this[eventtargetsymbol].addEventListener(\"value\", callback);\r\n    // const name = eventname ? String(eventname) : \"value\";\r\n    //  const name = \"value\";\r\n    this[memlisteners].add(eventlistener);\r\n  }\r\n  [cancelsubscribe](callback: Function) {\r\n    const eventlistener = this[callbackmap].get(callback);\r\n    if (!eventlistener) {\r\n      throw new Error();\r\n    }\r\n    this[memlisteners].delete(eventlistener);\r\n    this[removeonelistner](eventlistener);\r\n  }\r\n\r\n  [Symbol.toPrimitive]() {\r\n    //return this.value;\r\n    const value = this.valueOf();\r\n    return isprimitive(value)\r\n      ? value\r\n      : isobject(value)\r\n      ? JSON.stringify(value)\r\n      : void 0;\r\n  }\r\n}\r\n/* Reflect.defineProperty(ReactiveState.prototype, Symbol.toStringTag, {\r\n  value: \"ReactiveState\"\r\n}); */\r\n","import { ElementAttrs } from \"./createelement\";\r\nimport { Class } from \"./customclass\";\r\n//// import { Class } from \"./rendervdomtoreal\";\r\nimport { merge_entries } from \"./merge-entries\";\r\nimport ReactiveState, { isReactiveState } from \"./reactivestate\";\r\nimport { defineProperty, get } from \"./reflect\";\r\nimport { isobject } from \"./util\";\r\n// //export function isVirtualdom(a: any): a is Virtualdom<any> {\r\n//   return a instanceof Virtualdom;\r\n// }//\r\nexport function isVirtualdom(a: any): a is Virtualdom<any> {\r\n  return (\r\n    isobject(a) &&\r\n    // has(a, isvirtualelement) &&\r\n    get(a, isvirtualelement) === isvirtualelement\r\n  );\r\n}\r\nexport const isvirtualelement = Symbol(\"isvirtualelement\");\r\nexport type Vdomchildren = Array<\r\n  Virtualdom<any> | string | ReactiveState<any> | number\r\n>;\r\nexport { createVirtualElement };\r\nfunction createVirtualElement<T extends Class | string | Function>(\r\n  type: T,\r\n  props: ElementAttrs = {},\r\n  children: Vdomchildren = []\r\n): Virtualdom<T> {\r\n  props = Object.assign({}, props);\r\n  children = children.flat(1 / 0);\r\n  const 字母大小写 = /[A-Za-z\\u4e00-\\u9fa5]/;\r\n  const propsentries = Object.entries(props);\r\n  const propsentriesNOTevents = propsentries.filter(\r\n    ([key]) => !(key.startsWith(\"@\") || key.startsWith(\"on\"))\r\n  );\r\n  const 字母开头的entries = propsentriesNOTevents.filter(([key]) =>\r\n    字母大小写.test(key[0])\r\n  );\r\n  const thisarg: Virtualdom<T> = Object.create(null);\r\n  [\r\n    \"onevent\",\r\n    \"element\",\r\n    \"type\",\r\n    \"props\",\r\n    \"children\",\r\n    \"directives\",\r\n    \"bindattr\"\r\n  ].forEach(key => {\r\n    defineProperty(thisarg, key, {\r\n      //   enumerable: false,\r\n      writable: true\r\n    });\r\n  });\r\n  //   [\"type\", \"props\", \"children\", \"directives\", \"bindattr\"].forEach(key => {\r\n  //     defineProperty(thisarg, key, {\r\n  //       enumerable: true,\r\n  //       writable: true\r\n  //     });\r\n  //   });\r\n  Object.assign(thisarg, {\r\n    type,\r\n    bindattr: Object.fromEntries(\r\n      字母开头的entries.filter(e => isReactiveState(e[1]))\r\n    ),\r\n    props: Object.fromEntries(\r\n      字母开头的entries.filter(e => !isReactiveState(e[1]))\r\n    ),\r\n    children,\r\n    onevent: Object.fromEntries(\r\n      merge_entries([\r\n        ...propsentries\r\n          .filter(([key]) => /\\@/.test(key[0]))\r\n          .map(([key, value]) => [\r\n            key\r\n              .slice(1)\r\n              .toLowerCase()\r\n              .trim(),\r\n            [value].flat(1 / 0)\r\n          ]),\r\n        ...propsentries\r\n          .filter(([key]) => key.startsWith(\"on\"))\r\n          .map(([key, value]) => [\r\n            key\r\n              .slice(2)\r\n              .toLowerCase()\r\n              .trim(),\r\n            [value].flat(1 / 0)\r\n          ])\r\n      ] as [string, any][])\r\n    ),\r\n    directives: Object.fromEntries(\r\n      propsentriesNOTevents\r\n        .filter(([key]) => key[0] === \"*\" || key[0] === \"_\")\r\n        .map(([key, value]) => [\r\n          key\r\n            .slice(1)\r\n            .toLowerCase()\r\n            .trim(),\r\n          value\r\n        ])\r\n    )\r\n  });\r\n  defineProperty(thisarg, Symbol.toStringTag, { value: \"VirtualElement\" });\r\n  //   thisarg[Symbol.toStringTag] = \"VirtualElement\";\r\n  //   thisarg[isvirtualelement] = isvirtualelement;\r\n  defineProperty(thisarg, isvirtualelement, { value: isvirtualelement });\r\n  return thisarg;\r\n}\r\n// JSON.stringify\r\ninterface Virtualdom<T extends Class | string | Function> {\r\n  readonly [isvirtualelement]: unique symbol;\r\n  readonly [Symbol.toStringTag]: \"VirtualElement\";\r\n  element: Element | undefined;\r\n  type: T;\r\n  props: ElementAttrs;\r\n  children: Vdomchildren;\r\n  directives: Record<string, any>;\r\n  //   { [key: string]: any };\r\n  onevent: Record<string, Array<EventListener>>;\r\n  //   {\r\n  //     [key: string]: Array<EventListener>;\r\n  //   };\r\n  bindattr: Record<string, ReactiveState<any>>;\r\n  /* {\r\n    [key: string]: ReactiveState<any>;\r\n  }; */\r\n}\r\nexport default Virtualdom;\r\n// //export default class Virtualdom<T extends Class | string | Function> {\r\n//   [Symbol.toStringTag] = \"VirtualElement\";\r\n//   // get [Symbol.toStringTag]() {\r\n//     return \"VirtualElement\";\r\n//   // } //\r\n// //   options: any |undefined\r\n// //  element: undefined | Element | Node;\r\n//   type: T | undefined;\r\n//   props: ElementAttrs = {};\r\n//   children: Vdomchildren = [];\r\n//   directives: object = {};\r\n//   onevent: { [key: string]: Array<EventListener> } = {};\r\n//   bindattr: { [key: string]: ReactiveState<any> } = {};\r\n//   constructor(type: T, props: ElementAttrs = {}, children: Vdomchildren = []) {\r\n//     //对象浅拷贝\r\n//     props = { ...props };\r\n//     const 字母大小写 = /[A-Za-z\\u4e00-\\u9fa5]/;\r\n//     // console.log(type, props, children);\r\n//     //添加支持on开头事件绑定写法\r\n//     const propsentries = Object.entries(props);\r\n//     //\r\n// .map(([key, value]) => [\r\n// key.startsWith(\"on\")?key.replace(\"on\",\"@\")：key\r\n// ,\r\n// value\r\n\r\n// ]);\r\n// //\r\n// //   const propsentriesNOTevents = propsentries.filter(\r\n//       ([key]) => !(key.startsWith(\"@\") || key.startsWith(\"on\"))\r\n//     );\r\n//     const 字母开头的entries = propsentriesNOTevents.filter(([key]) =>\r\n//       字母大小写.test(key[0])\r\n//     );\r\n\r\n//     Object.assign(this, {\r\n//       type,\r\n//       bindattr: Object.fromEntries(\r\n//         //   propsentriesNOTevents\r\n//           .filter(([key]) => 字母大小写.test(key[0])) //\r\n// //    字母开头的entries.filter(\r\n//           e => isReactiveState(e[1])\r\n//           // e[1] instanceof ReactiveState\r\n//         )\r\n//       ),\r\n//       props: Object.fromEntries(\r\n//         //   propsentriesNOTevents\r\n//           .filter(([key]) => 字母大小写.test(key[0])) //\r\n// //  字母开头的entries.filter(\r\n//           e => !isReactiveState(e[1])\r\n//           //    e[1] instanceof ReactiveState\r\n//         )\r\n//       ),\r\n//       children: children.flat(1 / 0),\r\n//       onevent: Object.fromEntries(\r\n//         // 需要合并entries\r\n//         [\r\n//         ['value',[f,f]]\r\n//         ,\r\n//         ['value',[f,f]]\r\n//       ]\r\n//         合并成\r\n\r\n//          [\r\n//         ['value',[f,f,f,f]]\r\n//          ]\r\n//         //\r\n\r\n// //\r\n\r\n//         [[\"value\",[\"f\",\"f\"]],[\"value\",[\"f\",\"f\"]]]\r\n\r\n//         [[\"value\",[\"f\",\"f\",\"f\",\"f\"]]]\r\n\r\n//         //\r\n// //     merge_entries([\r\n//           ...propsentries\r\n//             .filter(([key]) => /\\@/.test(key[0]))\r\n//             .map(([key, value]) => [\r\n//               //事件名称变成小写\r\n//               key\r\n//                 .slice(1)\r\n//                 .toLowerCase()\r\n//                 .trim(),\r\n//               //把事件绑定变成事件数组\r\n//               [value].flat(1 / 0)\r\n//             ]),\r\n//           ...propsentries\r\n//             .filter(([key]) => key.startsWith(\"on\"))\r\n//             .map(([key, value]) => [\r\n//               //事件名称变成小写\r\n//               key\r\n//                 .slice(2)\r\n//                 .toLowerCase()\r\n//                 .trim(),\r\n//               //把事件绑定变成事件数组\r\n//               [value].flat(1 / 0)\r\n//             ])\r\n//         ])\r\n//       ),\r\n\r\n//       //指令支持以\"*\"开头和\"_\"开头\r\n//       directives: Object.fromEntries(\r\n//         propsentriesNOTevents\r\n//         //  .filter(([key]) => /\\//\r\n// //.test(key[0]) || key[0].startsWith(\"_\"))\r\n//         //  .map(([key, value]) => [\r\n//             //指令也变成小写\r\n//             key\r\n//               .slice(1)\r\n//               .toLowerCase()\r\n//               .trim(),\r\n\r\n//             value\r\n//           ])\r\n//       )\r\n//     });\r\n//     //\r\n//  Object.defineProperty(this, Symbol.toStringTag, {\r\n//       value: \"virtualdom\",\r\n//       configurable: true\r\n//     });\r\n// //\r\n// //  }\r\n// }//\r\n// // defineProperty(Virtualdom.prototype, Symbol.toStringTag, {\r\n//   value: \"VirtualElement\"\r\n// });\r\n//  //\r\n","import { Class } from \"./customclass\";\r\nimport ReactiveState from \"./reactivestate\";\r\nimport { apply } from \"./reflect\";\r\nimport { isarray, isfunction, isplainobject, isstring } from \"./util\";\r\nimport Virtualdom, { Vdomchildren, createVirtualElement } from \"./VirtualElement\";\r\ntype styleprop =\r\n  | string\r\n  | object\r\n  | ReactiveState<string>\r\n  | ReactiveState<object>;\r\n\r\ntype classprop =\r\n  | string\r\n  | Set<string>\r\n  | Array<string>\r\n  | ReactiveState<string | Set<string> | Array<string>>;\r\nexport interface ElementAttrs {\r\n  style?: styleprop;\r\n  class?: classprop;\r\n  [key: string]: any;\r\n}\r\n\r\nexport default function<T extends Function | string>(\r\n  type: T,\r\n  propsorchildren?: Vdomchildren,\r\n  ...children: Vdomchildren\r\n): Virtualdom<T>;\r\nexport default function<T extends Vdomchildren>(\r\n  type: \"\",\r\n  propsorchildren?: T,\r\n  ...children: T\r\n): T;\r\nexport default function<T extends Vdomchildren>(\r\n  type: \"\",\r\n  props?: ElementAttrs,\r\n  ...children: T\r\n): T;\r\nexport default function<T extends Function | string>(\r\n  type: T,\r\n  props?: ElementAttrs,\r\n  ...children: Vdomchildren\r\n): Virtualdom<T>;\r\n//如果第二个参数是数组，则 变成\r\n/* \r\nh(type,...children)\r\nh(type,children)\r\n*/\r\n\r\nexport default function(\r\n  type?: Function | string | \"\" | Class,\r\n  propsorchildren?: Vdomchildren | ElementAttrs,\r\n  ...children: Vdomchildren\r\n) {\r\n  if (isarray(propsorchildren)) {\r\n    return apply(createElement, undefined, [\r\n      type,\r\n      undefined,\r\n      [...propsorchildren, ...children].flat(1 / 0)\r\n    ]);\r\n    /*   createElement(\r\n      type,\r\n      undefined,\r\n      [...propsorchildren, ...children].flat(1 / 0)\r\n    ); */\r\n  } else {\r\n    return apply(createElement, undefined, arguments); // createElement(...arguments);\r\n  }\r\n}\r\nfunction createElement<T extends Vdomchildren>(\r\n  type: \"\",\r\n  props?: ElementAttrs,\r\n  ...children: T\r\n): T;\r\nfunction createElement<T extends Function | string>(\r\n  type: T,\r\n  props?: ElementAttrs,\r\n  ...children: Vdomchildren\r\n): Virtualdom<T>;\r\n\r\n/* function createElement<T extends Vdomchildren>(\r\n  type: \"\",\r\n  props?: ElementAttrs,\r\n  ...children: T\r\n): T; */\r\n\r\nfunction createElement<T extends Function | string | Class>(\r\n  type: T,\r\n  props: ElementAttrs = {},\r\n  ...children: Vdomchildren\r\n): Virtualdom<T> | Vdomchildren {\r\n  // | Array<Virtualdom | string>\r\n  // if(isarray()){}\r\n  /* add fragment element */\r\n  //   console.log(type, props, children);\r\n  let typenormalized: \"\" | Function | string =\r\n    isstring(type) || isfunction(type) ? type : \"\";\r\n  const propsnormalized = isplainobject(props) ? props : {};\r\n  const childrennormalized: Vdomchildren = children\r\n    .flat(Infinity)\r\n    .map(a => (a === 0 ? \"0\" : a))\r\n    .filter(a => !!a);\r\n  if (\r\n    isstring(typenormalized)\r\n    //   typeof typenormalized === \"string\"\r\n  ) {\r\n    typenormalized = typenormalized.trim().toLowerCase();\r\n  }\r\n\r\n  if (\r\n    //typeof typenormalized === \"string\" &&\r\n\r\n    \"\" === typenormalized\r\n  ) {\r\n    return childrennormalized;\r\n  } else {\r\n    /* propsnormalized = Object.fromEntries(\r\n    Object.entries(propsnormalized).map(([key, value]) => [\r\n      key.trim().toLowerCase(),\r\n      value\r\n    ])\r\n  ); */\r\n\r\n    /* return new Virtualdom(\r\n      typenormalized,\r\n      propsnormalized,\r\n      childrennormalized\r\n    ) as Virtualdom<any>;\r\n*/\r\n    return apply(createVirtualElement, undefined, [\r\n      typenormalized,\r\n      propsnormalized,\r\n      childrennormalized\r\n    ]) as Virtualdom<T>;\r\n\r\n    /*  createVirtualElement(\r\n     \r\n    ); */\r\n  }\r\n}\r\n","import { apply } from \"./reflect\";\r\n\r\n// declare const htm: (\r\n//   strings?: TemplateStringsArray,\r\n//   ...values: any[]\r\n// ) => Virtualdom<any>;\r\n/* declare module \"htm/dist/htm.module\" {\r\n  const htm: (\r\n    strings?: TemplateStringsArray,\r\n    ...values: any[]\r\n  ) => Virtualdom<any>;\r\n  export default htm;\r\n} */\r\n/* interface HTM {\r\n  (strings?: TemplateStringsArray, ...values: any[]): Virtualdom<any>;\r\n} */\r\nimport htm from \"htm\";\r\nimport { VaildVDom } from \"./conditon\";\r\n// import htm from \"../types/htm\";\r\nimport { invalid_Virtualdom } from \"./MountElement\";\r\nimport h from \"./createelement\";\r\nimport { isReactiveState } from \"./reactivestate\";\r\nimport { isArray, isnumber, isstring } from \"./util\";\r\nimport Virtualdom, { isVirtualdom, Vdomchildren } from \"./VirtualElement\";\r\n\r\n// const html = htm.bind(h);\r\n// function html(\r\n//   strings?: TemplateStringsArray,\r\n//   ...values: any[]\r\n// ): Virtualdom<any>;\r\nfunction html(...inargs: any[]): Virtualdom<any> | Vdomchildren {\r\n  // return (htm as HTM).call(h, ...inargs);\r\n\r\n  return apply(htm /* as HTM */, h, inargs);\r\n}\r\n\r\n/* 如果出现未闭合标签会产生错误的vdom */\r\nexport function isvalidvdom(v: any): v is VaildVDom {\r\n  if (isstring(v)) {\r\n    return true;\r\n  }\r\n  if (isnumber(v)) {\r\n    return true;\r\n  }\r\n  let flag = false;\r\n  if (isArray(v)) {\r\n    /*flag = v\r\n      .map((ele: any) => {\r\n        return isvalidvdom(ele);\r\n        //isstring(ele) || ele instanceof Virtualdom;\r\n      })\r\n      .includes(false)\r\n      ? false\r\n      : true;\r\n    return flag;*/\r\n    //https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/every\r\n    //不允许空数组\r\n    /* children可能为空数组 */\r\n    return /* !! */ /* v.length */ /* && */ v.every(e => isvalidvdom(e));\r\n  } else if (\r\n    isVirtualdom(v)\r\n    // v instanceof Virtualdom\r\n  ) {\r\n    return isvalidvdom(v.children);\r\n    /*  if (isvalidvdom(v.children)) {\r\n      return true;\r\n    } */\r\n  } else if (\r\n    isReactiveState(v)\r\n    //  v instanceof ReactiveState\r\n  ) {\r\n    return true;\r\n  }\r\n  /*  else {\r\n  } */\r\n  return flag;\r\n}\r\nexport default function(\r\n  strings?: TemplateStringsArray,\r\n  ...values: any[]\r\n): Virtualdom<any> | Vdomchildren;\r\nexport default function(...args: any[]) {\r\n  const vdom = html(...args);\r\n  if (isvalidvdom(vdom)) {\r\n    return vdom;\r\n  } else {\r\n    console.error(vdom);\r\n    console.error(invalid_Virtualdom);\r\n    throw new TypeError();\r\n  }\r\n}\r\n","import { isArray, isundefined } from \"./util\";\r\n/* export function toArray<T not Array>(a: T): Array<T>;\r\nexport function toArray<T>(a: Array<T>): Array<T>; */\r\n// export function toArray<T>(a: Array<T>): Array<T>;\r\nexport function toArray(a: any): any[] {\r\n  return (isArray(a) ? a : [a]).flat(1 / 0).filter(a => !isundefined(a));\r\n}\r\n","import { appendchild, /* setelehtml,  */ seteletext } from \"./dom\";\r\nimport { toArray } from \"./toArray\";\r\nexport default function<\r\n  T extends HTMLElement | SVGSVGElement | SVGElement | Element | Node\r\n>(\r\n  ele:\r\n    | Node\r\n    | Array<\r\n        | HTMLElement\r\n        | Text\r\n        | SVGSVGElement\r\n        | DocumentFragment\r\n        | SVGElement\r\n        | Element\r\n        | Node\r\n      >\r\n    | SVGElement\r\n    | DocumentFragment\r\n    | HTMLElement\r\n    | Text\r\n    | SVGSVGElement\r\n    | Element,\r\n  container: T,\r\n  clear: boolean = true\r\n): T {\r\n  if (clear) {\r\n    seteletext(container, \"\");\r\n  }\r\n  //   container.innerHTML = \"\";\r\n  /*  let eles: Array<any>;\r\n  if (Array.isArray(ele)) {\r\n    eles = ele;\r\n  } else {\r\n    // appendchild(container, ele);\r\n    eles = [ele];\r\n  } */\r\n  const eles = toArray(ele).flat(Infinity);\r\n  eles.forEach((e: Node | HTMLElement | Element | SVGElement) =>\r\n    appendchild(container, e)\r\n  );\r\n  return container;\r\n}\r\n","export const invalid_custom_element_class = \"invalid custom element class !\";\r\nimport { isclassextendsHTMLElement } from \"./createcostumelemet\";\r\nimport { get, getPrototypeOf, has, set } from \"./reflect\";\r\nimport { isobject } from \"./util\";\r\nif (\r\n  //   typeof Proxy !== \"function\" ||\r\n  !isobject(window.customElements) //||\r\n  //   typeof customElements !== \"object\" ||\r\n\r\n  //||\r\n  //   typeof CustomElementRegistry !== \"function\"\r\n) {\r\n  console.error(\" customElements  not supported !\");\r\n  throw new TypeError();\r\n}\r\n\r\nfunction Usevaluetoquerythekeyfromthetable(\r\n  table: object,\r\n  Componentstatusname: any\r\n): string | undefined {\r\n  const outputentrie = Object.entries(table).find(v => {\r\n    return v[1] === Componentstatusname;\r\n  });\r\n  return outputentrie ? outputentrie[0] : undefined;\r\n}\r\n\r\ninterface ElementDefinitionOptions {\r\n  extends?: string;\r\n}\r\nwindow.CustomElementRegistry = get(\r\n  getPrototypeOf(window.customElements),\r\n  \"constructor\"\r\n);\r\nconst elementset = Symbol.for(\"elementset\");\r\nconst elementmap = Symbol.for(\"elementmap\");\r\n\r\ninterface CustomElements extends CustomElementRegistry {\r\n  [elementset]: Set<Function>;\r\n  [elementmap]: Record<string, Function>;\r\n}\r\nconst { CustomElementRegistry } = window;\r\nconst customElements = window.customElements as CustomElements;\r\n// export default customElements;\r\n\r\nif (!has(customElements, elementset)) {\r\n  set(customElements, elementset, new Set());\r\n  //   customElements[elementset] = new Set();\r\n}\r\nif (!has(customElements, elementmap)) {\r\n  set(customElements, elementmap, {});\r\n  //   customElements[elementmap] = {};\r\n}\r\nexport default (initclass: Function, extendsname?: string) =>\r\n  RandomDefineCustomElement(initclass, extendsname);\r\n\r\nfunction RandomDefineCustomElement(\r\n  initclass: Function,\r\n  extendsname?: string,\r\n  length = 1\r\n): string | undefined {\r\n  if (!isclassextendsHTMLElement(initclass)) {\r\n    console.error(initclass);\r\n    console.error(invalid_custom_element_class);\r\n    throw TypeError();\r\n  }\r\n\r\n  //如果未注册自定义组件，则用随机名称注册，如果名称重复则重新生成新的随机名\r\n\r\n  if (!get(customElements, elementset).has(initclass)) {\r\n    const elementname = getrandomstringandnumber(length);\r\n\r\n    if (customElements.get(elementname)) {\r\n      return RandomDefineCustomElement(initclass, extendsname, length + 1);\r\n    } else {\r\n      if (extendsname) {\r\n        customElements.define(elementname, initclass, { extends: extendsname });\r\n      } else {\r\n        customElements.define(elementname, initclass);\r\n      }\r\n    }\r\n\r\n    return elementname;\r\n  } else {\r\n    return Usevaluetoquerythekeyfromthetable(\r\n      get(customElements, elementmap),\r\n      initclass\r\n    );\r\n  }\r\n\r\n  //如果已经注册自定义组件，则返回注册的名称\r\n}\r\n\r\n/* customElements.get = function name(name) {\r\n  return customElements[elementmap].get(name);\r\n};\r\n */\r\ncustomElements.define = function(\r\n  name: string,\r\n  constructor: Function,\r\n  options?: ElementDefinitionOptions\r\n): void {\r\n  if (!isclassextendsHTMLElement(constructor)) {\r\n    console.error(constructor);\r\n    console.error(invalid_custom_element_class);\r\n    throw TypeError();\r\n  }\r\n  if (!get(customElements, elementset).has(constructor)) {\r\n    if (has(customElements[elementmap], name)) {\r\n      /* 防止定义重名 */\r\n      RandomDefineCustomElement(\r\n        constructor,\r\n        options ? options.extends : undefined\r\n      );\r\n    } else {\r\n      CustomElementRegistry.prototype.define.call(\r\n        customElements,\r\n        name,\r\n        constructor,\r\n        options\r\n      );\r\n      customElements[elementset].add(constructor);\r\n      customElements[elementmap][name] = constructor;\r\n    }\r\n  }\r\n};\r\nset(customElements, Symbol.iterator, () => {\r\n  const entries = Object.entries(customElements[elementmap]);\r\n\r\n  return entries[Symbol.iterator].call(entries);\r\n});\r\n/* customElements[Symbol.iterator] = () => {\r\n  const entries = Object.entries(customElements[elementmap]);\r\n\r\n  return entries[Symbol.iterator].call(entries);\r\n}; */\r\n\r\nconst charactorlist = Array(26)\r\n  .fill(undefined)\r\n  .map((v, i) => 97 + i)\r\n  .map(n => String.fromCharCode(n));\r\n\r\nconst hexnumberlist = Array(16)\r\n  .fill(undefined)\r\n  .map((v, i) => i)\r\n  .map(a => a.toString(16));\r\n\r\nconst charactorandnumberlist = [\r\n  ...new Set([...hexnumberlist, ...charactorlist])\r\n];\r\n\r\nfunction getrandomcharactor() {\r\n  return get(\r\n    //  Array(26)\r\n    //  .fill(undefined)\r\n    //  .map((v, i) => 97 + i)\r\n    // .map(n => String.fromCharCode(n))\r\n    charactorlist,\r\n    Math.floor(Math.random() * charactorlist.length)\r\n  );\r\n}\r\nfunction getrandomhexnumberandcharactor() {\r\n  return get(\r\n    // Array(16)\r\n    //  .fill(undefined)\r\n    // .map((v, i) => i)\r\n    charactorandnumberlist,\r\n    Math.floor(Math.random() * charactorandnumberlist.length)\r\n  );\r\n\r\n  //.toString(16);\r\n}\r\nfunction getrandomstringandnumber(length = 1) {\r\n  return (\r\n    Array(length)\r\n      .fill(undefined)\r\n      .map(() => getrandomcharactor())\r\n\r\n      .join(\"\") +\r\n    \"-\" +\r\n    Array(length)\r\n      .fill(undefined)\r\n      .map(() => getrandomhexnumberandcharactor())\r\n      .join(\"\")\r\n  );\r\n}\r\n","import { Class } from \"./customclass\";\r\n//import setlikearray from \"./setlikearay\";\r\n// const customElementsarray = new Set;\r\nimport RandomDefineCustomElement, {\r\n  invalid_custom_element_class\r\n} from \"./CustomElementRegistry\";\r\nimport { construct } from \"./reflect\";\r\n/* function getcustomelementname(initclass: any): string {\r\n  return customElements(initclass);\r\n} */\r\nimport { isfunction } from \"./util\";\r\n\r\nexport function isclassextendsHTMLElement(initclass: {\r\n  prototype: any;\r\n}): initclass is Class {\r\n  return !!(\r\n    isfunction(initclass) &&\r\n    initclass.prototype &&\r\n    initclass.prototype instanceof HTMLElement\r\n  );\r\n}\r\n\r\n// import Reflect from \"./reflect\";\r\n\r\n// import { Class } from \"./rendervdomtoreal\";\r\n\r\nexport function createcostumelemet(\r\n  initclass: Class | Function,\r\n  propsjson?: object,\r\n  children?: any[]\r\n  //   options?: any\r\n): HTMLElement {\r\n  if (isclassextendsHTMLElement(initclass)) {\r\n    // customElementsarray.push(initclass);\r\n    /*   const elementname =\r\n     getcustomelementname(initclass); */\r\n    /* if (customElements.get(elementname) === initclass) {\r\n    } else {\r\n      customElements.define(elementname, initclass);\r\n    } */\r\n    RandomDefineCustomElement(initclass);\r\n    return construct(initclass, [propsjson, children /* , options */]); // (children);\r\n  } else {\r\n    console.error(initclass);\r\n    console.error(invalid_custom_element_class);\r\n    throw TypeError();\r\n  }\r\n}\r\n","// import { getparentNode } from \"./dom\";\r\n\r\nexport function isconnected(element: Node) {\r\n  return document.documentElement === getancestornode(element);\r\n}\r\nfunction getancestornode(node: Node) {\r\n  while (\r\n    node &&\r\n    node.parentNode &&\r\n    node.parentNode !== document\r\n    /*  getparentNode(node) &&\r\n    getparentNode(node) !== node &&\r\n    getparentNode(node) !== document */\r\n  ) {\r\n    //   if(getparentNode(node)){}\r\n    node = node.parentNode; // getparentNode(node);\r\n  }\r\n  return node;\r\n}\r\n","let watchrecord: [ReactiveState<any>, Function][] = [];\r\n/* 记录组件中使用的watch的state和callback,\r\n组件卸载时removeeventlistener,\r\n组件挂载时addeventlistener\r\n*/\r\nimport ReactiveState from \"./reactivestate\";\r\nimport { isFunction } from \"./util\";\r\nexport function getwatchrecords() {\r\n  return [...watchrecord];\r\n}\r\nexport function usewatch(state: ReactiveState<any>, callback: Function) {\r\n  if (ctxopen) {\r\n    watchrecord.push([state, callback]);\r\n  }\r\n}\r\nfunction clearwatch() {\r\n  watchrecord = [];\r\n}\r\nexport const invalid_Function = \"invalid Function\";\r\nconst errormessage =\r\n  \"invalid useMounted or useUnMounted out of createComponent\";\r\nlet ctxopen = false;\r\nlet MountedSet: Set<Function> = new Set();\r\nlet UnMountedSet: Set<Function> = new Set();\r\nlet StateSet: Set<ReactiveState<any>> = new Set();\r\n/* 收集组件内部创建的 ReactiveState*/\r\n\r\nexport function getstates() {\r\n  return [...StateSet];\r\n}\r\nexport function usestste(state: ReactiveState<any>) {\r\n  if (ctxopen) {\r\n    StateSet.add(state);\r\n  }\r\n}\r\nexport function getMounted() {\r\n  return [...MountedSet];\r\n}\r\nexport function getUnMounted() {\r\n  return [...UnMountedSet];\r\n}\r\nexport function useMounted(fun: Function) {\r\n  if (isFunction(fun)) {\r\n    if (ctxopen) {\r\n      MountedSet.add(fun);\r\n    } else {\r\n      //console.error()\r\n      console.error(errormessage);\r\n      throw Error();\r\n    }\r\n  } else {\r\n    console.error(fun);\r\n    console.error(invalid_Function);\r\n    throw TypeError();\r\n  }\r\n}\r\n\r\nexport function useUnMounted(fun: Function) {\r\n  if (isFunction(fun)) {\r\n    if (ctxopen) {\r\n      UnMountedSet.add(fun);\r\n    } else {\r\n      console.error(errormessage);\r\n      throw Error();\r\n      //throw Error(errormessage);\r\n    }\r\n  } else {\r\n    console.error(fun);\r\n    console.error(invalid_Function);\r\n    throw TypeError();\r\n    //throw TypeError(invalid_Function);\r\n  }\r\n}\r\nexport function clearMounted() {\r\n  MountedSet = new Set();\r\n}\r\n\r\nfunction clearstate() {\r\n  StateSet = new Set();\r\n}\r\nexport function clearUnMounted() {\r\n  UnMountedSet = new Set();\r\n}\r\nexport function openctx() {\r\n  ctxopen = true;\r\n  clearall();\r\n}\r\nexport function closectx() {\r\n  ctxopen = false;\r\n  clearall();\r\n}\r\nfunction clearall() {\r\n  clearMounted();\r\n  clearUnMounted();\r\n  clearstate();\r\n  clearwatch();\r\n}\r\n","import debounce from \"lodash/debounce\";\r\nexport type CancelWatchfun = () => void;\r\nexport type UnwrapedState =\r\n  | string\r\n  | number\r\n  | boolean\r\n  | undefined\r\n  | object\r\n  | bigint;\r\nexport interface CallbackReactiveState /* <\r\n  \r\n> */ {\r\n  (...args: UnwrapedState[]): void;\r\n}\r\n\r\nimport { invalid_ReactiveState } from \"./conditon\";\r\nimport { invalid_Function, usewatch } from \"./context-mounted-unmounted\";\r\nimport ReactiveState, {\r\n  addallistenerssymbol,\r\n  isReactiveState,\r\n  removeallistenerssymbol,\r\n  subscribesymbol,\r\n  cancelsubscribe\r\n} from \"./reactivestate\";\r\n//import { requestAnimationFrame } from \"./directives\";\r\nimport { isarray, isFunction } from \"./util\";\r\nimport { toArray } from \"./toArray\";\r\n\r\nexport function watch<T extends UnwrapedState>(\r\n  state: ReactiveState<T> | Array<ReactiveState<T>>,\r\n\r\n  callback: CallbackReactiveState\r\n) {\r\n  if (isarray(state) || isReactiveState(state)) {\r\n    const statearray: ReactiveState<any>[] = toArray(state);\r\n    if (!statearray.length) {\r\n      console.error(\"Empty array not allowed\");\r\n      throw new Error();\r\n    }\r\n    /* 给watch的callback自动防抖 */\r\n    const debouncedcallback = debounce(callback);\r\n    const stateandlisteners: [ReactiveState<any>, Function][] = statearray.map(\r\n      state1 => {\r\n        const listener = () => {\r\n          //watch的回调函数自动解包\r\n          debouncedcallback(...statearray.map(r => r.valueOf()));\r\n        };\r\n        watchsingle(\r\n          state1,\r\n\r\n          listener\r\n        );\r\n\r\n        return [state1, listener];\r\n      }\r\n    );\r\n\r\n    const cancelWatch: CancelWatchfun = () => {\r\n      stateandlisteners.forEach(([state, listener]) => {\r\n        state[cancelsubscribe](listener);\r\n      });\r\n    };\r\n    return cancelWatch;\r\n  }\r\n  //  else if (isReactiveState(state)) {\r\n  //  watchsingle(state, callback);\r\n  ////return watch(toArray(state),callback)\r\n  // }\r\n  else {\r\n    console.error(state);\r\n    console.error(callback);\r\n    console.error(invalid_ReactiveState + invalid_Function);\r\n    throw new TypeError();\r\n  }\r\n}\r\n\r\nfunction watchsingle(\r\n  state: ReactiveState<any>,\r\n  callback: Function\r\n  //  statekey?: string\r\n) {\r\n  if (\r\n    !(\r\n      isReactiveState(state) &&\r\n      // state instanceof ReactiveState\r\n      isFunction(callback)\r\n    )\r\n  ) {\r\n    console.error(state);\r\n    console.error(callback);\r\n    console.error(invalid_ReactiveState + invalid_Function);\r\n\r\n    throw TypeError();\r\n  }\r\n\r\n  state[subscribesymbol](callback);\r\n\r\n  //  if (statekey) {\r\n\r\n  //   state[subscribesymbol](callback, statekey);\r\n  // } else {\r\n\r\n  //  }\r\n\r\n  requestAnimationFrame(() => {\r\n    rewatch(state);\r\n    // state[addallistenerssymbol]();\r\n  });\r\n\r\n  usewatch(state, callback);\r\n}\r\nexport function unwatch(state: ReactiveState<any>): void {\r\n  state[removeallistenerssymbol]();\r\n}\r\n\r\nexport function rewatch(state: ReactiveState<any>): void {\r\n  state[addallistenerssymbol]();\r\n}\r\n","import { invalid_Function } from \"./context-mounted-unmounted\";\r\nimport directives from \"./directives\";\r\nimport Virtualdom from \"./VirtualElement\";\r\nexport interface Extendfun {\r\n  (\r\n    value: any,\r\n    element: Element,\r\n\r\n    vdom: Virtualdom<any>\r\n  ): void;\r\n}\r\nexport interface ExtendOptions {\r\n  [s: string]: Extendfun;\r\n}\r\nexport default function extenddirectives(options: ExtendOptions = {}) {\r\n  Object.entries(options).forEach(([key, value]) => {\r\n    if (typeof value !== \"function\") {\r\n      console.error(value);\r\n      console.error(invalid_Function);\r\n      throw TypeError();\r\n    } else {\r\n      if (!directives[key]) {\r\n        Reflect.set(directives, key, value);\r\n      } else {\r\n        console.error(directives);\r\n        console.error(\"do not extend existing directive\");\r\n        throw new Error();\r\n      }\r\n    }\r\n  });\r\n  return directives;\r\n}\r\n","export const { requestAnimationFrame } = window;\r\nimport { setelehtml, seteletext } from \"./dom\";\r\nimport { ExtendOptions } from \"./extend-directive\";\r\nimport { isconnected } from \"./isconnected\";\r\nimport ReactiveState, { isReactiveState } from \"./reactivestate\";\r\nimport { isfunction, isobject, isstring } from \"./util\";\r\nimport { watch } from \"./watch\";\r\nimport { set, apply } from \"./reflect\";\r\nimport Virtualdom from \"./VirtualElement\";\r\n\r\nconst directive: ExtendOptions = {\r\n  ref(ref: object | Function, ele: Element, _vdom: Virtualdom<any>) {\r\n    if (isfunction(ref)) {\r\n      apply(ref as Function, undefined, [ele]);\r\n      // ref(ele)\r\n      //   ref.call(undefined, ele);\r\n    } else if (isobject(ref)) {\r\n      set(ref as object, \"value\", ele);\r\n      //   ref.value = ele;\r\n    } else {\r\n      console.log(_vdom);\r\n      console.error(ref);\r\n      console.error(\"invalid ref\");\r\n      throw TypeError();\r\n    }\r\n  }\r\n};\r\nimport extenddirectives from \"./extend-directive\";\r\nextenddirectives({\r\n  html(\r\n    html: string | ReactiveState<any>,\r\n    ele: Element,\r\n\r\n    _vdom: Virtualdom<any>\r\n  ) {\r\n    console.log(_vdom);\r\n    createhtmlandtextdirective(setelehtml, \"html\")(ele, html);\r\n\r\n    // ele.innerHTML = html;\r\n    // console.log(ele.outerHTML);\r\n    /*  if (typeof html == \"string\") {\r\n          requestAnimationFrame(() => {\r\n            setelehtml(ele, html);\r\n    \r\n            /* ele.innerHTML = html;*/\r\n    //   console.log(ele.outerHTML);\r\n    /*     });\r\n        } else if (html instanceof ReactiveState) {\r\n          //   const ReactiveState = html;\r\n          watch(html, (state: { value: any }) => {\r\n            /*ele.innerHTML = String(state);*/\r\n    /*\r\n            setelehtml(ele, String(state));\r\n          });\r\n          //   ReactiveState[subscribesymbol]((state: { value: any }) => {\r\n          //     ele.innerHTML = String(state.value);\r\n          //   });\r\n          requestAnimationFrame(() => {\r\n            // console.log(\"html\");\r\n            /*  ele.innerHTML = String(html);*/\r\n    /*\r\n      //      setelehtml(ele, String(html));\r\n     //     });\r\n      //  } else {\r\n    \r\n    //console.error()\r\n      //    throw TypeError(\"invalid html\");\r\n     //   }\r\n    \r\n    */\r\n  },\r\n  text(\r\n    text: string | ReactiveState<any>,\r\n    ele: Element,\r\n    _vdom: Virtualdom<any>\r\n  ) {\r\n    console.log(_vdom);\r\n    createhtmlandtextdirective(seteletext, \"text\")(ele, text);\r\n\r\n    /*\r\n    \r\n      // ele.textContent = text;\r\n        // console.log(ele.outerHTML);\r\n        if (typeof text == \"string\") {\r\n          requestAnimationFrame(() => {\r\n            seteletext(ele, text);\r\n            /*    ele.textContent = text;*/\r\n    /*      //   console.log(ele.outerHTML);\r\n          });\r\n        } else if (text instanceof ReactiveState) {\r\n          //   const ReactiveState = text;\r\n          watch(text, (state: { value: any }) => {\r\n            seteletext(ele, String(state));\r\n    \r\n            /* ele.textContent = String(state);*/\r\n    /*   });\r\n          //   ReactiveState[subscribesymbol]((state: { value: any }) => {\r\n          //     ele.textContent = String(state.value);\r\n          //   });\r\n          requestAnimationFrame(() => {\r\n            // console.log(\"text\");\r\n            seteletext(ele, String(text));\r\n    \r\n            /*  ele.textContent = String(text);*/\r\n    /*    });\r\n       // } else {\r\n      //    throw TypeError(\"invalid text\");\r\n     //   }\r\n    \r\n    */\r\n  }\r\n});\r\nfunction createhtmlandtextdirective(seteletext: Function, errorname: string) {\r\n  return function(ele: Element, text: string | ReactiveState<any>) {\r\n    const element = ele;\r\n    if (\r\n      isstring(text)\r\n      //typeof text == \"string\"\r\n    ) {\r\n      requestAnimationFrame(() => {\r\n        seteletext(ele, text);\r\n        /*    ele.textContent = text;*/\r\n        //   console.log(ele.outerHTML);\r\n      });\r\n    } else if (\r\n      isReactiveState(text)\r\n      //  text instanceof ReactiveState\r\n    ) {\r\n      //   const ReactiveState = text;\r\n      watch(text, (/* state: { value: any } */) => {\r\n        const state = text;\r\n        if (isconnected(element)) {\r\n          seteletext(ele, String(state));\r\n        }\r\n        /* ele.textContent = String(state);*/\r\n      });\r\n      //   ReactiveState[subscribesymbol]((state: { value: any }) => {\r\n      //     ele.textContent = String(state.value);\r\n      //   });\r\n      requestAnimationFrame(() => {\r\n        // console.log(\"text\");\r\n        seteletext(ele, String(text));\r\n\r\n        /*  ele.textContent = String(text);*/\r\n      });\r\n    } else {\r\n      console.error(text);\r\n      console.error(\"invalid \" + errorname);\r\n      throw TypeError();\r\n    }\r\n  };\r\n}\r\nexport default directive;\r\n","import { get } from \"./reflect\";\r\nimport { isFunction } from \"./util\";\r\nconst componentsymbol = Symbol(\"component\");\r\nexport { componentsymbol };\r\nexport function iscomponent(a: any) {\r\n  return (\r\n    isFunction(a) &&\r\n    //  has(a, componentsymbol) &&\r\n    get(a, componentsymbol) === componentsymbol\r\n  );\r\n}\r\n","import { invalid_Function } from \"./context-mounted-unmounted\";\r\nimport { domaddlisten, domremovelisten } from \"./dom\";\r\nimport { toArray } from \"./toArray\";\r\nimport { /* isArray, */ isfunction } from \"./util\";\r\nimport { has, set, get } from \"./reflect\";\r\nexport const eventlistenerssymbol = Symbol(\"eventlisteners\");\r\nexport default function(\r\n  element: Element | Node,\r\n  eventname: string,\r\n  callback: EventListener | Array<EventListener>\r\n) {\r\n  /* if (!element[eventlistenerssymbol]) {\r\n    element[eventlistenerssymbol] = [];\r\n  }\r\n*/\r\n  firstaddlisteners(element, eventname, toArray(callback));\r\n  /*\r\n//  if (isfunction(callback)) {\r\n//    firstaddlisteners(element, eventname, [callback]);\r\n//  } else if (isArray(callback)) {\r\n//    firstaddlisteners(element, eventname, callback);\r\n // } else {\r\n //   console.error(callback);\r\n //   throw TypeError(invalid_Function);\r\n // }\r\n*/\r\n}\r\nexport function firstaddlisteners(\r\n  ele: Element | Node,\r\n  event: string,\r\n  callarray: Array<EventListener>\r\n) {\r\n  const element = ele;\r\n  callarray.forEach((call: EventListener) => {\r\n    if (!isfunction(call)) {\r\n      console.error(call);\r\n      console.error(invalid_Function);\r\n      throw TypeError();\r\n    }\r\n\r\n    if (!has(element, eventlistenerssymbol)) {\r\n      set(element, eventlistenerssymbol, []);\r\n      //   element[eventlistenerssymbol] = [];\r\n    }\r\n    (get(ele, eventlistenerssymbol) as [string, EventListener][])\r\n      /* ele[eventlistenerssymbol] */\r\n      .push([event, call]);\r\n    domaddlisten(ele, event, call);\r\n  });\r\n}\r\nexport function removelisteners(\r\n  ele: Element | Node\r\n  //   event: string,\r\n  //   callarray: Array<EventListener>\r\n) {\r\n  // const element = ele;\r\n  if (has(ele, eventlistenerssymbol)) {\r\n    (get(ele, eventlistenerssymbol) as [string, EventListener][])\r\n      /*   ele[eventlistenerssymbol] */\r\n\r\n      .forEach(([event, call]) => {\r\n        //   ele[eventlistenerssymbol].push([event, call]);\r\n        domremovelisten(ele, event, call);\r\n      });\r\n  }\r\n}\r\nexport function readdlisteners(\r\n  ele: Element | Node\r\n  //   event: string,\r\n  //   callarray: Array<EventListener>\r\n) {\r\n  if (has(ele, eventlistenerssymbol)) {\r\n    (get(ele, eventlistenerssymbol) as [string, EventListener][]).forEach(\r\n      ([event, call]) => {\r\n        //   ele[eventlistenerssymbol].push([event, call]);\r\n        domaddlisten(ele, event, call);\r\n      }\r\n    );\r\n  }\r\n}\r\n","import createeleattr from \"@masx200/dom-element-attribute-agent-proxy\";\r\nimport { createcostumelemet } from \"./createcostumelemet\";\r\nimport directives from \"./directives\";\r\nimport {\r\n  changetext,\r\n  createDocumentFragment,\r\n  createElementNS,\r\n  createmathelement,\r\n  //   createnonescript,\r\n  createnativeelement,\r\n  createsvgelement,\r\n  createtextnode,\r\n  mathnamespace,\r\n  svgnamespace\r\n} from \"./dom\";\r\nimport { iscomponent } from \"./iscomponent\";\r\nimport { isconnected } from \"./isconnected\";\r\nimport mount from \"./mount-real-element\";\r\nimport onevent /*  eventlistenerssymbol  */ from \"./handle-onevent\";\r\nimport ReactiveState, { isReactiveState } from \"./reactivestate\";\r\nimport { get, has, set } from \"./reflect\";\r\nimport { isArray, isfunction, isnumber, isobject, isstring } from \"./util\";\r\nimport Virtualdom, { isVirtualdom } from \"./VirtualElement\";\r\nimport { watch } from \"./watch\";\r\n\r\nexport const bindstatesymbol = Symbol(\"bindstate\");\r\n\r\nexport const reactivestatesymbol = Symbol(\"reactive\");\r\nexport const virtualdomsymbol = Symbol(\"virtualelement\");\r\nfunction throwinvalideletype(type?: any) {\r\n  console.error(type);\r\n  console.error(\"invalid element type!\");\r\n  throw TypeError(/*\"invalid element type!\"*/);\r\n}\r\nexport default function render(\r\n  vdom: Virtualdom<string | Function>,\r\n  namespace?: string\r\n): Element;\r\nexport default function render(\r\n  vdom: Virtualdom<\"script\" | \"\" | \"html\">,\r\n  namespace?: string\r\n): Node;\r\nexport default function render(\r\n  vdom: Array<Virtualdom<any> | string | ReactiveState<any> | number>,\r\n  namespace?: string\r\n): Array<Node | Element>;\r\nexport default function render(\r\n  vdom: string | ReactiveState<any> | number,\r\n  namespace?: string\r\n): Node;\r\nexport default function render(\r\n  vdom: Array<Virtualdom<any>>,\r\n  namespace?: string\r\n): Array<Element>;\r\nexport default function render(\r\n  vdom: Array<string | ReactiveState<any> | number>,\r\n  namespace?: string\r\n): Array<Node>;\r\nexport default function render(\r\n  vdom:\r\n    | Virtualdom<any>\r\n    | string\r\n    | number\r\n    | ReactiveState<any>\r\n    | Array<Virtualdom<any> | string | ReactiveState<any> | number>,\r\n  namespace?: string\r\n): Array<Node | Element> | Element | Node {\r\n  if (isArray(vdom)) {\r\n    return (vdom as (string | number | ReactiveState<any> | Virtualdom<any>)[])\r\n      .map(a => render(a as any))\r\n      .flat(1 / 0);\r\n  }\r\n  if (isnumber(vdom) || isstring(vdom)) {\r\n    const textnode = createtextnode(vdom);\r\n    set(textnode, virtualdomsymbol, vdom);\r\n    // textnode[virtualdomsymbol] = vdom;\r\n    return textnode;\r\n\r\n    // } else if (typeof vdom === \"string\") {\r\n    // return createtextnode(vdom);\r\n  } else if (isReactiveState(vdom) /*instanceof ReactiveState*/) {\r\n    const reactive = vdom;\r\n    const textnode = createtextnode(String(reactive));\r\n    set(textnode, virtualdomsymbol, vdom);\r\n    // textnode[virtualdomsymbol] = reactive;\r\n\r\n    //textnode[reactivestatesymbol] = reactive;\r\n    /*  try {\r\n      reactive[textnodesymbol] = textnode;\r\n    } catch (error) {\r\n      console.warn(error);\r\n    } */\r\n\r\n    watch(reactive, (/* state: ReactiveState<any> */) => {\r\n      const state = reactive;\r\n      if (isconnected(element)) {\r\n        changetext(textnode, String(state));\r\n      }\r\n    });\r\n    const element = textnode;\r\n    set(element, bindstatesymbol, new Set());\r\n    // element[bindstatesymbol] = new Set();\r\n    (get(element, bindstatesymbol) as Set<ReactiveState<any>>).add(reactive);\r\n    // element[bindstatesymbol].add(reactive);\r\n    return textnode;\r\n  } else if (\r\n    isVirtualdom(vdom)\r\n    //vdom instanceof Virtualdom && \"type\" in vdom\r\n  ) {\r\n    const { type } = vdom;\r\n    let element:\r\n      | Element\r\n      | HTMLElement\r\n      | SVGSVGElement\r\n      | SVGElement\r\n      | undefined = undefined;\r\n    if (typeof type === \"string\") {\r\n      if (type === \"script\") {\r\n        /* 禁止加载脚本 */\r\n\r\n        return createDocumentFragment();\r\n      } else if (type === \"svg\") {\r\n        /* 没想到svg的创建方式这么特别?否则显示不出svg */\r\n        element = createsvgelement();\r\n      } else if (type === \"math\") {\r\n        /* 没想到svg的创建方式这么特别?否则显示不出svg */\r\n        element = createmathelement();\r\n      } else if (\"\" === type || type === \"html\") {\r\n        const fragmentnode = createDocumentFragment();\r\n\r\n        mount(render(vdom.children), fragmentnode);\r\n\r\n        return fragmentnode;\r\n        //不要创建html元素\r\n        // return render(vdom.children);\r\n        // element = createDocumentFragment();\r\n      } else {\r\n        element = namespace\r\n          ? createElementNS(namespace, type)\r\n          : createnativeelement(type);\r\n      }\r\n    } else if (typeof type == \"function\") {\r\n      //添加默认props\r\n\r\n      /*static defaultProps = {\r\n        name: 'Omi',\r\n        myAge: 18\r\n  }*/\r\n      if (isobject(type[\"defaultProps\"])) {\r\n        vdom.props = JSON.parse(\r\n          JSON.stringify({ ...type[\"defaultProps\"], ...vdom.props })\r\n        );\r\n      }\r\n\r\n      const propsjson = JSON.parse(\r\n        JSON.stringify({\r\n          ...vdom.props,\r\n          ...Object.fromEntries(\r\n            Object.entries(vdom.bindattr).map(([key, value]) => {\r\n              return [key, value.value];\r\n            })\r\n          )\r\n        })\r\n      );\r\n      element = createcostumelemet(\r\n        type,\r\n        propsjson,\r\n        vdom.children\r\n        // vdom.options\r\n      );\r\n    } else {\r\n      throwinvalideletype(vdom);\r\n      // throw TypeError(\"invalid element type!\");\r\n    }\r\n    /*  if (element) {\r\n      const attribute1: { [key: string]: any } = createeleattr(element);\r\n      Object.assign(\r\n        attribute1,\r\n\r\n        /* 把属性为false的先不设置 */\r\n    //     vdom.props\r\n    //     // Object.fromEntries(Object.entries(vdom.props).filter())\r\n    //   );\r\n    // } */\r\n    // apply(handleprops)\r\n\r\n    /* 自定义组件不添加children,而是从构造函数传入 */\r\n    /* web components也可以设置 childnodes,比如说slot */\r\n    /* https://webkit.org/blog/4096/introducing-shadow-dom-api/ */\r\n    /*  */\r\n    /* https://developer.mozilla.org/zh-CN/docs/Web/API/Element/slot */\r\n    if (\r\n      type &&\r\n      (isfunction(type) || isstring(type))\r\n      // /\r\n      //   /\r\n\r\n      /* typeof type !== \"function\" */\r\n    ) {\r\n      /* 如果自己创造的组件就不加children, */\r\n      if (\r\n        !iscomponent(type)\r\n        // componentsymbol !== type[componentsymbol]\r\n      ) {\r\n        if (element) {\r\n          mount(\r\n            vdom.children.map(e => {\r\n              if (type === \"svg\" && isVirtualdom(e)) {\r\n                /* 没想到svg的创建方式这么特别?否则显示不出svg */\r\n                //   element.innerHTML = element.innerHTML;\r\n                return render(e, svgnamespace);\r\n              } else if (type === \"math\" && isVirtualdom(e)) {\r\n                return render(e, mathnamespace);\r\n              } else if (namespace && isVirtualdom(e)) {\r\n                return render(e, namespace);\r\n              } else {\r\n                return render(e as any) as any;\r\n              }\r\n            }),\r\n\r\n            element\r\n          );\r\n          //   return element;\r\n        }\r\n      }\r\n    }\r\n    /* 对于select元素,设置value属性时,如果没有 找到对应的option元素,则设置失败,\r\n    \r\n    改成先加children,后设attributes,\r\n    */\r\n    if (element) {\r\n      handleprops(element, vdom);\r\n    }\r\n\r\n    return element as Node | Element;\r\n  } else {\r\n    throwinvalideletype(vdom);\r\n    // throw TypeError(\"invalid element type!\");\r\n  }\r\n  //   throw Error();\r\n  //   throwinvalideletype();\r\n\r\n  /* console.error(vdom);\r\n  throw new Error(); */\r\n  //   return;\r\n  throw new Error();\r\n}\r\n\r\nfunction handleprops(\r\n  element: HTMLElement | Element | SVGSVGElement | SVGElement,\r\n  vdom: Virtualdom<any>\r\n) {\r\n  ((element, vdom) => {\r\n    Object.entries(vdom.directives).forEach(([name, value]) => {\r\n      if (\r\n        isfunction(\r\n          directives[name]\r\n        ) /* typeof directives[name] === \"function\" */\r\n        /*name in directives &&*/\r\n      ) {\r\n        directives[name](value, element, vdom);\r\n      } else {\r\n        console.error(vdom.directives);\r\n        console.error(\"invalid directives \" + name);\r\n        throw new Error();\r\n      }\r\n    });\r\n\r\n    const attribute1: { [key: string]: any } = createeleattr(element);\r\n    Object.assign(\r\n      attribute1,\r\n\r\n      /* 把属性为false的先不设置 */\r\n      vdom.props\r\n      // Object.fromEntries(Object.entries(vdom.props).filter())\r\n    );\r\n    /* 添加常量的属性 */\r\n    set(element, virtualdomsymbol, vdom);\r\n    // element[virtualdomsymbol] = vdom;\r\n    vdom.element = element;\r\n    /* 添加绑定属性 */\r\n\r\n    Object.entries(vdom.bindattr).forEach(([key, primitivestate]) => {\r\n      attribute1[key] = primitivestate.valueOf();\r\n      watch(primitivestate, (/* state: ReactiveState<any> */) => {\r\n        const state = primitivestate;\r\n        if (isconnected(element)) {\r\n          attribute1[key] = state.valueOf();\r\n        }\r\n      });\r\n      /*     primitivestate[subscribesymbol]();\r\n      requestAnimationFrame(() => {\r\n        primitivestate[addallistenerssymbol]();\r\n      }); */\r\n    });\r\n\r\n    /* 添加事件绑定和指令执行 */\r\n\r\n    /*  if (!element[eventlistenerssymbol]) {\r\n      element[eventlistenerssymbol] = [];\r\n    }\r\n*/\r\n    Object.entries(vdom.onevent).forEach(([event, callbacks]) => {\r\n      onevent(element, event, callbacks);\r\n    });\r\n  })(element, vdom);\r\n  /*  if (!element[bindstatesymbol]) {\r\n    element[bindstatesymbol] = new Set();\r\n  }\r\n*/\r\n  [...Object.values(vdom.bindattr), ...Object.values(vdom.directives)]\r\n    .flat(1 / 0)\r\n    .filter(\r\n      e => isReactiveState(e)\r\n      // e instanceof ReactiveState\r\n    )\r\n\r\n    .forEach((e: ReactiveState<any>) => {\r\n      if (!has(element, bindstatesymbol)) {\r\n        set(element, bindstatesymbol, new Set());\r\n        // element[bindstatesymbol] = new Set();\r\n      }\r\n      (get(element, bindstatesymbol) as Set<ReactiveState<any>>).add(e);\r\n      //   element[bindstatesymbol].add(e);\r\n    });\r\n}\r\n","export const invalid_Virtualdom = \"invalid Virtualdom \";\r\nimport { VaildVDom } from \"./conditon\";\r\nimport document from \"./dom\";\r\nimport { isvalidvdom } from \"./html\";\r\nimport mount from \"./mount-real-element\";\r\nimport render from \"./render-vdom-to-real\";\r\nimport { toArray } from \"./toArray\";\r\nimport { isArray } from \"./util\";\r\nexport default function MountElement<T extends Element>(\r\n  vdom: VaildVDom | Node | Element | Array<Node | Element>,\r\n  container: T\r\n): T {\r\n  if (isArray(vdom)) {\r\n    vdom = vdom.flat(Infinity);\r\n    if (!vdom.length) {\r\n      //不允许空数组\r\n      console.error(\"Empty array not allowed\");\r\n      throw new TypeError();\r\n    }\r\n  }\r\n  const el = container;\r\n  if (!(el instanceof HTMLElement)) {\r\n    console.error(el);\r\n    console.error(\"invalid container HTMLElement!\");\r\n    throw TypeError();\r\n  }\r\n\r\n  if (\r\n    el === document.body ||\r\n    el === document.documentElement ||\r\n    el === document.head\r\n  ) {\r\n    console.error(el);\r\n    console.error(\"Do not mount  to <html> or <body> <head>.\");\r\n    throw Error();\r\n  }\r\n  /*   if (\r\n    !(\r\n      isvalidvdom(vdom) ||\r\n      vdom instanceof Node ||\r\n      (isArray(vdom) && isNodeArray(vdom))\r\n    )\r\n  ) {\r\n    console.error(vdom);\r\n    throw TypeError(invalid_Virtualdom);\r\n  } */\r\n\r\n  /*   let elesarray: Array<any>;\r\n  if (Array.isArray(vdom)) {\r\n    elesarray = vdom;\r\n  } else {\r\n    elesarray = [vdom];\r\n  } */\r\n  const elesarray = toArray(vdom);\r\n  if (isvalidvdom(vdom)) {\r\n    // mount(elesarray.map(e => render(e)), container);\r\n    mount(render(elesarray), container);\r\n  } else if (isNode(vdom) /*  instanceof Node */ || isNodeArray(vdom)) {\r\n    mount(elesarray, container);\r\n  } else {\r\n    console.error(vdom);\r\n    console.error(invalid_Virtualdom);\r\n    throw TypeError();\r\n  }\r\n\r\n  //\r\n  return container;\r\n}\r\nexport function isNodeArray(arr: any[]): arr is Node[] {\r\n  //https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/every\r\n  //不允许空数组\r\n  return !!(isArray(arr) && arr.length && arr.every(a => isNode(a)));\r\n  //!array.map(e => e instanceof Node).includes(false);\r\n}\r\nexport function isNode(a: any): a is Node {\r\n  return a instanceof Node;\r\n}\r\n","function isArray(a) {\r\n    return Array.isArray(a);\r\n}\r\nconst Reflect = window.Reflect;\r\nconst { ownKeys, deleteProperty, apply, construct, defineProperty, get, getOwnPropertyDescriptor, getPrototypeOf, has, set, setPrototypeOf } = Reflect;\r\nfunction isobject(a) {\r\n    return typeof a === \"object\" && a !== null;\r\n}\r\nfunction isfunction(a) {\r\n    return typeof a === \"function\";\r\n}\r\nfunction deepobserveaddpath(target, callback, patharray = [], ancestor = target) {\r\n    if (!isfunction(callback)) {\r\n        console.error(callback);\r\n        console.error(\"observe callback invalid !\");\r\n        throw Error();\r\n    }\r\n    if (isfunction(target) || isobject(target)) {\r\n        let fakeobj;\r\n        if (isArray(target)) {\r\n            fakeobj = [];\r\n        }\r\n        else if (isfunction(target)) {\r\n            fakeobj = (() => { });\r\n        }\r\n        else {\r\n            fakeobj = {};\r\n        }\r\n        setPrototypeOf(fakeobj, null);\r\n        return new Proxy(fakeobj, {\r\n            defineProperty(t, p, a) {\r\n                callback(ancestor, [...patharray, String(p)], has(a, \"value\") ? a.value : isfunction(a.get) ? a.get() : undefined, get(target, p));\r\n                return defineProperty(target, p, a);\r\n            },\r\n            deleteProperty(t, p) {\r\n                callback(ancestor, [...patharray, String(p)], undefined, get(target, p));\r\n                return deleteProperty(target, p);\r\n            },\r\n            ownKeys() {\r\n                return ownKeys(target);\r\n            },\r\n            has(t, p) {\r\n                return has(target, p);\r\n            },\r\n            getPrototypeOf() {\r\n                return getPrototypeOf(target);\r\n            },\r\n            setPrototypeOf(t, v) {\r\n                return setPrototypeOf(target, v);\r\n            },\r\n            construct(t, argumentslist) {\r\n                if (isfunction(target)) {\r\n                    return construct(target, argumentslist);\r\n                }\r\n            },\r\n            apply(t, thisarg, argarray) {\r\n                if (isfunction(target)) {\r\n                    return apply(target, thisarg, argarray);\r\n                }\r\n            },\r\n            getOwnPropertyDescriptor(t, k) {\r\n                var descripter = getOwnPropertyDescriptor(target, k);\r\n                if (isArray(target) && k === \"length\") {\r\n                    return descripter;\r\n                }\r\n                else {\r\n                    if (descripter) {\r\n                        descripter.configurable = true;\r\n                        return descripter;\r\n                    }\r\n                    else {\r\n                        return;\r\n                    }\r\n                }\r\n            },\r\n            set(t, k, v) {\r\n                if (isfunction(callback)) {\r\n                    callback(ancestor, [...patharray, String(k)], v, get(target, k));\r\n                }\r\n                return set(target, k, v);\r\n            },\r\n            get(t, k) {\r\n                var value = get(target, k);\r\n                if (isfunction(value) || isobject(value)) {\r\n                    return deepobserveaddpath(value, callback, [...patharray, String(k)], target);\r\n                }\r\n                else {\r\n                    return value;\r\n                }\r\n            }\r\n        });\r\n    }\r\n    else {\r\n        return target;\r\n    }\r\n}\r\nfunction observedeepagent(target, callback) {\r\n    if (!isfunction(callback)) {\r\n        console.error(callback);\r\n        console.error(\"observe callback  invalid function !\");\r\n        throw Error();\r\n    }\r\n    if (!isfunction(Proxy)) {\r\n        console.error(\"Proxy unsupported!\");\r\n        throw Error();\r\n    }\r\n    if (isfunction(target) || isobject(target)) {\r\n        return deepobserveaddpath(target, callback);\r\n    }\r\n    else {\r\n        return target;\r\n    }\r\n}\r\n\r\nexport default observedeepagent;\r\n//# sourceMappingURL=index.js.map\r\n","import { issymbol } from \"./util\";\r\nimport deepobserve from \"@masx200/deep-observe-agent-proxy\";\r\nimport { isplainobject, isarray, isSet, isobject } from \"./util\";\r\nimport ReactiveState, {\r\n  isReactiveState,\r\n  dispatchsymbol\r\n} from \"./reactivestate\";\r\nimport {\r\n  defineProperty,\r\n  ownKeys,\r\n  get,\r\n  getOwnPropertyDescriptor,\r\n  has,\r\n  deleteProperty,\r\n  set\r\n} from \"./reflect\";\r\nimport { watch } from \"./watch\";\r\nimport { set_prototype } from \"./createstate\";\r\n\r\nexport default function(init: object): ReactiveState<object> {\r\n  let initobj = init;\r\n  const containReactiveState =\r\n    isplainobject(init) && Object.values(init).some(a => isReactiveState(a));\r\n  const state_entries = Object.entries(init).filter(e => {\r\n    const a = e[1];\r\n    return isReactiveState(a);\r\n  });\r\n  if (containReactiveState) {\r\n    initobj = { ...init };\r\n    state_entries.forEach(([key, state]) => {\r\n      defineProperty(initobj, key, {\r\n        enumerable: true,\r\n        get() {\r\n          return state.valueOf();\r\n        },\r\n        configurable: true\r\n      });\r\n    });\r\n  }\r\n  const reactive: ReactiveState<object> = new ReactiveState(initobj);\r\n  if (containReactiveState) {\r\n    state_entries.forEach(([key, state]) => {\r\n      watch(state, () => {\r\n        reactive[dispatchsymbol](String(key));\r\n      });\r\n    });\r\n    // console.log(reactive);\r\n  }\r\n  const objproxyhandler: ProxyHandler<object> = {};\r\n  objproxyhandler.ownKeys = target => {\r\n    return Array.from(\r\n      new Set([...ownKeys(target), ...ownKeys(get(target, \"value\"))])\r\n    );\r\n  };\r\n  objproxyhandler.setPrototypeOf = () => {\r\n    return false;\r\n  };\r\n  objproxyhandler.defineProperty = () => {\r\n    return false;\r\n  };\r\n  objproxyhandler.getOwnPropertyDescriptor = (\r\n    target: ReactiveState<object>,\r\n    key\r\n  ) => {\r\n    //如果是symbol属性返回undefined\r\n    if (issymbol(key)) {\r\n      return;\r\n    }\r\n    const myvalue = get(target, \"value\");\r\n\r\n    const descripter =\r\n      getOwnPropertyDescriptor(target, key) ||\r\n      getOwnPropertyDescriptor(myvalue, key);\r\n    if (descripter) {\r\n      descripter.configurable = true;\r\n    }\r\n\r\n    return descripter;\r\n  };\r\n  objproxyhandler.deleteProperty = (target: ReactiveState<object>, key) => {\r\n    const myvalue = get(target, \"value\");\r\n    if (has(myvalue, key)) {\r\n      deleteProperty(myvalue, key);\r\n      target[dispatchsymbol](String(key));\r\n      return true;\r\n    } else {\r\n      return true;\r\n    }\r\n  };\r\n  objproxyhandler.has = (target: ReactiveState<object>, key) => {\r\n    const myvalue = get(target, \"value\");\r\n    return has(target, key) || has(myvalue, key);\r\n  };\r\n  objproxyhandler.get = (target: ReactiveState<object>, key) => {\r\n    const value = get(target, \"value\");\r\n    if (key === \"value\" && (isarray(value) || isplainobject(value))) {\r\n      return deepobserve(get(target, key), (_target_, patharray) => {\r\n        target[dispatchsymbol](patharray[0]);\r\n      });\r\n    } else if (has(target, key)) {\r\n      return get(target, key);\r\n    } else if (has(value, key)) {\r\n      if (\r\n        isSet(value) &&\r\n        (key === \"add\" || key === \"clear\" || key === \"delete\")\r\n      ) {\r\n        switch (key) {\r\n          case \"add\": {\r\n            return (add: any) => {\r\n              if (!set_prototype.has.call(value, add)) {\r\n                const returnvalue = set_prototype[key].call(value, add);\r\n                target[dispatchsymbol]();\r\n                return returnvalue;\r\n              }\r\n              return;\r\n            };\r\n          }\r\n          // break;\r\n          case \"delete\": {\r\n            return (dele: any) => {\r\n              if (set_prototype.has.call(value, dele)) {\r\n                const returnvalue = set_prototype[key].call(value, dele);\r\n                target[dispatchsymbol]();\r\n                return returnvalue;\r\n              }\r\n              return;\r\n            };\r\n          }\r\n          // break;\r\n          case \"clear\": {\r\n            return () => {\r\n              if (value.size) {\r\n                const returnvalue = set_prototype[key].call(value);\r\n                target[dispatchsymbol]();\r\n                return returnvalue;\r\n              }\r\n              return;\r\n            };\r\n          }\r\n          // break;\r\n        }\r\n      } else if (isarray(value) || isplainobject(value)) {\r\n        return deepobserve(get(value, key), () => {\r\n          target[dispatchsymbol](String(key));\r\n        });\r\n      } else {\r\n        return get(value, key);\r\n      }\r\n    }\r\n  };\r\n  objproxyhandler.set = (target: ReactiveState<object>, key, value) => {\r\n    if (isReactiveState(value)) {\r\n      //如果遇到 isReactiveState则自动解包\r\n      value = value.valueOf();\r\n    }\r\n    const myvalue = get(target, \"value\");\r\n    if (key === \"value\" && isobject(value)) {\r\n      // if (target[key] !== value) {\r\n      set(target, key, value);\r\n      target[dispatchsymbol]();\r\n    } else if (!has(target, key)) {\r\n      set(myvalue, key, value);\r\n      target[dispatchsymbol](String(key));\r\n\r\n      //\r\n    }\r\n    return true;\r\n  };\r\n  return new Proxy(\r\n    reactive,\r\n\r\n    objproxyhandler\r\n  ) as ReactiveState<object>;\r\n}\r\n","// import deepobserve from \"deep-observe-agent-proxy\";\r\nimport { getproperyreadproxy } from \"./computed\";\r\nimport { usestste } from \"./context-mounted-unmounted\";\r\nimport handleobjectstate from \"./handleobjectstate\";\r\nimport ReactiveState, {\r\n  dispatchsymbol,\r\n  invalid_primitive_or_object_state,\r\n  // textnodesymbol,\r\n  isReactiveState\r\n} from \"./reactivestate\";\r\nimport { set } from \"./reflect\";\r\nimport { isobject, isprimitive } from \"./util\";\r\nimport { UnwrapedState } from \"./watch\";\r\nexport const set_prototype = Set.prototype;\r\n\r\nexport default function<T extends UnwrapedState>(\r\n  init: ReactiveState<T>\r\n): ReactiveState<T>;\r\nexport default function<T extends UnwrapedState>(\r\n  init: Exclude<T, ReactiveState<any>> | undefined\r\n): ReactiveState<T>;\r\nexport default function<T extends UnwrapedState>(\r\n  init: Exclude<T, ReactiveState<any>> | ReactiveState<T> | undefined\r\n): ReactiveState<T> {\r\n  /* 收集组件内部创建的 ReactiveState*/\r\n  const state: ReactiveState<T> = createstate(init as any) as ReactiveState<T>;\r\n  usestste(state);\r\n  return state;\r\n}\r\n\r\nfunction createstate<T extends UnwrapedState>(\r\n  init: ReactiveState<T>\r\n): ReactiveState<T>;\r\nfunction createstate<T extends UnwrapedState>(\r\n  init: Exclude<T, ReactiveState<any>> | undefined\r\n): ReactiveState<T>;\r\n\r\nfunction createstate<T extends UnwrapedState>(\r\n  init: Exclude<T, ReactiveState<any>> | ReactiveState<T> | undefined\r\n) {\r\n  if (!(isprimitive(init) || isobject(init) || isReactiveState(init))) {\r\n    console.error(init);\r\n    console.error(invalid_primitive_or_object_state);\r\n    throw TypeError();\r\n  }\r\n\r\n  if (isprimitive(init)) {\r\n    return getproperyreadproxy(\r\n      new Proxy(new ReactiveState(init), {\r\n        defineProperty() {\r\n          return false;\r\n        },\r\n        deleteProperty() {\r\n          return false;\r\n        },\r\n        set(target, key, value) {\r\n          /*  if (key === textnodesymbol) {\r\n          return set(target, key, value);\r\n        } */\r\n          if (key === \"value\" && isprimitive(value)) {\r\n            if (target[key] !== value) {\r\n              /* 如果相同则不触发事件 */\r\n              set(target, key, value);\r\n              target[dispatchsymbol]();\r\n            }\r\n            return true;\r\n          } else {\r\n            return false;\r\n          }\r\n        },\r\n        setPrototypeOf() {\r\n          return false;\r\n        }\r\n      })\r\n    );\r\n  } else if (\r\n    isReactiveState(init)\r\n    // init instanceof ReactiveState\r\n  ) {\r\n    // 如果init是个 ReactiveState，则对其解包，并生成新的 ReactiveState\r\n    return createstate(init.valueOf());\r\n  } else if (isobject(init)) {\r\n    //如果在 ReactiveState属性中包含 ReactiveState，则转换成语法糖\r\n    //ReactiveState1=createstate( {aaaaa:ReactiveState2})\r\n    //\r\n    // else {\r\n    //   console.error(init);\r\n    //console.error(invalid_primitive_or_object_state)\r\n    //  throw TypeError();\r\n    //throw TypeError(\"invalid State\");\r\n    // }\r\n    return handleobjectstate(init);\r\n  } else {\r\n    throw Error();\r\n  }\r\n}\r\n\r\n// /*\r\n// let initobj=init\r\n// const containReactiveState=(isplainobject(init))&&Object.values(init).map(a=>isReactiveState(a)).includes(true)\r\n// const state_entries=Object.entries(init).filter(([key,a])=>isReactiveState(a))\r\n\r\n// if(\r\n// containReactiveState\r\n// ){\r\n\r\n// initobj={...init}\r\n\r\n// state_entries\r\n// .forEach(\r\n// ([key,state])=>{\r\n\r\n// defineProperty(initobj,key,{\r\n// enumerable:true,\r\n// get(){\r\n\r\n// return state.valueOf()\r\n\r\n// },\r\n// configurable: true\r\n\r\n// })\r\n\r\n// })\r\n\r\n// }\r\n// let reactive\r\n// =new ReactiveState(\r\n\r\n// initobj\r\n\r\n// )\r\n\r\n// if(containReactiveState){\r\n// state_entries.forEach(\r\n// ([key,state])=>{\r\n\r\n// watch(state,()=>{\r\n\r\n// reactive[dispatchsymbol](String(key));\r\n\r\n// })\r\n// }\r\n// )\r\n// }\r\n\r\n//     return new Proxy(\r\n// reactive\r\n\r\n// , {\r\n//     ownKeys(target) {\r\n//     return Array.from(\r\n//       new Set([...ownKeys(target), ...ownKeys(get(target, \"value\"))])\r\n//     );\r\n//   }\r\n//   ,\r\n//   setPrototypeOf() {\r\n//     return false;\r\n//   },\r\n//       defineProperty() {\r\n//         return false;\r\n//       },\r\n//       getOwnPropertyDescriptor(target, key) {\r\n//         const myvalue = get(target, \"value\");\r\n\r\n//         const descripter =\r\n//           getOwnPropertyDescriptor(target, key) ||\r\n//           getOwnPropertyDescriptor(myvalue, key);\r\n//         if (descripter) {\r\n//           descripter.configurable = true;\r\n//         }\r\n\r\n//         return descripter;\r\n//       },\r\n//       deleteProperty(target, key) {\r\n//         const myvalue = get(target, \"value\");\r\n//         if (has(myvalue, key)) {\r\n//           deleteProperty(myvalue, key);\r\n//           target[dispatchsymbol](String(key));\r\n//           return true;\r\n//         } else {\r\n//           return true;\r\n//         }\r\n//       },\r\n//       has(target, key) {\r\n//         const myvalue = get(target, \"value\");\r\n//         return has(target, key) || has(myvalue, key);\r\n//       },\r\n//       get(target, key) {\r\n//         const value = get(target, \"value\");\r\n\r\n//         if (\r\n//           key === \"value\" &&\r\n//           (isarray(value)  || isplainobject(value))\r\n//         ) {\r\n//           return deepobserve(get(target, key), (_target_, patharray) => {\r\n//             target[dispatchsymbol](patharray[0]);\r\n//           });\r\n//         } else if (has(target, key)) {\r\n//           return get(target, key);\r\n//         } else if (has(value, key)) {\r\n//           if (isSet(value) ) {\r\n//             const myvalue = value;\r\n//             if (key === \"add\") {\r\n//               return (add: any) => {\r\n//                 if (!set_prototype.has.call(myvalue, add)) {\r\n//                   const returnvalue = set_prototype[key].call(myvalue, add);\r\n//                   target[dispatchsymbol]();\r\n//                   return returnvalue;\r\n//                 }\r\n//               };\r\n//             } else if (key === \"delete\") {\r\n//               return (dele: any) => {\r\n//                 if (\r\n// set_prototype.has.call(myvalue, dele)) {\r\n//                   const returnvalue = set_prototype[key].call(myvalue, dele);\r\n//                   target[dispatchsymbol]();\r\n//                   return returnvalue;\r\n//                 }\r\n//               }\r\n// else if (key === \"clear\") {\r\n//               return () => {\r\n//                 if (value.length) {\r\n//                   const returnvalue = set_prototype[key].call(myvalue);\r\n//                   target[dispatchsymbol]();\r\n//                   return returnvalue;\r\n//                 }\r\n//               }\r\n// else {\r\n\r\n// return  get(value, key)\r\n// }\r\n\r\n//             }\r\n//           } else {\r\n// //只深度观察array和plainobject\r\n// if(\r\n// (isarray(value)  || isplainobject(value))\r\n// ){\r\n// return deepobserve(get(value, key), () => {\r\n//               target[dispatchsymbol](String(key));\r\n//             });\r\n// }\r\n// else{\r\n// return get(value, key)\r\n// }\r\n\r\n//           }\r\n\r\n//           /*  */\r\n//         }\r\n//     }},\r\n\r\n//     set(target, key, value)\r\n//      {\r\n\r\n// if(isReactiveState(value)){\r\n// //如果遇到 isReactiveState则自动解包\r\n// value=value.valueOf()\r\n\r\n// }\r\n//       /*   if (key === textnodesymbol) {\r\n//         return set(target, key, value);\r\n//       } */\r\n//       const myvalue = get(target, \"value\");\r\n//       if (key === \"value\" && isobject(value)) {\r\n//         // if (target[key] !== value) {\r\n//         set(target, key, value);\r\n//         target[dispatchsymbol]();\r\n\r\n//         // }\r\n//         return true;\r\n//       } else if (!has(target, key)) {\r\n//         set(myvalue, key, value);\r\n//         target[dispatchsymbol](String(key));\r\n\r\n//         //\r\n//       } else if (key === \"length\") {\r\n//         set(myvalue, key, value);\r\n//         target[dispatchsymbol](key);\r\n//       } else {\r\n//         return false;\r\n//       }\r\n//       return true;\r\n\r\n//     }\r\n\r\n// }) */\r\n","export { createcssBlob };\r\nfunction createcssBlob(source: string) {\r\n  return URL.createObjectURL(new Blob([source], { type: \"text/css\" }));\r\n}\r\n","export function isCSSStyleRule(a: any): a is CSSStyleRule {\r\n  return gettagtype(a) === \"CSSStyleRule\";\r\n}\r\nimport createElement from \"./createelement\";\r\nimport { createcssBlob } from \"./cssurlblob\";\r\n// import { RegExp } from \"core-js\";\r\nimport {\r\n  appendchild,\r\n  createanotherhtmldocument /* , insertfirst */\r\n} from \"./dom\";\r\nimport { get } from \"./reflect\";\r\nimport render from \"./render-vdom-to-real\";\r\nimport { gettagtype } from \"./util\";\r\nexport function isCSSMediaRule(a: any): a is CSSMediaRule {\r\n  return gettagtype(a) === \"CSSMediaRule\";\r\n}\r\nexport function isCSSImportRule(a: any): a is CSSImportRule {\r\n  return gettagtype(a) === \"CSSImportRule\";\r\n}\r\n\r\nexport function parsecsstext(text: string): Array<CSSRule> {\r\n  const styleelement = render(\r\n    createElement(\"style\", [text])\r\n  ) as HTMLStyleElement;\r\n  //   console.dir(styleelement);\r\n  /* 只有添加到document之后才会有sheet */\r\n  //const otherdocument = document.implementation.createHTMLDocument(\"\");\r\n  const otherdocument = createanotherhtmldocument();\r\n  appendchild(otherdocument.documentElement, styleelement);\r\n  //otherdocument.firstElementChild.appendChild(styleelement);\r\n  return Array.from(\r\n    get(\r\n      get(styleelement, \"sheet\"),\r\n\r\n      \"cssRules\"\r\n    )\r\n  );\r\n}\r\n\r\nexport function selectoraddprefix(cssstylerule: CSSStyleRule, prefix: string) {\r\n  //css 选择器可能有多个\r\n  //h1,p,h3,div\r\n  const selectorText = cssstylerule.selectorText;\r\n\r\n  const selectorarray = selectorText.split(\",\");\r\n  cssstylerule.selectorText = selectorarray\r\n    .map(selectorText => {\r\n      let prefixselector = prefix + \" \" + selectorText;\r\n\r\n      if (selectorText.startsWith(\"*\")) {\r\n        prefixselector =\r\n          prefixselector + \",\" + selectorText.replace(\"*\", prefix);\r\n      }\r\n      return prefixselector;\r\n    })\r\n    .join(\",\");\r\n  /*\r\n  const prefixselector = prefix + \" \" + selectorText;\r\n  if (selectorText.startsWith(\"*\")) {\r\n    cssstylerule.selectorText =\r\n      selectorText.replace(\"*\", prefix) + \",\" + prefixselector;\r\n    /* 对于'* '的处理,变成两个selectorrule*/\r\n\r\n  /* \r\n    *{font-size:80px !important;}\r\np{color:blue !important;} \r\n*/\r\n  /* \r\n    \r\n    q-9, q-9 * { font-size: 80px !important; }\r\nq-9 p { color: blue !important; }\r\n\r\n    */\r\n  /* } else {\r\n    cssstylerule.selectorText = prefixselector;\r\n  }\r\n*/\r\n  return cssstylerule;\r\n}\r\n\r\nexport function prefixcssrules(\r\n  cssRulesarray: Array<CSSRule>,\r\n  prefix: string\r\n): Array<CSSRule> {\r\n  return cssRulesarray\r\n    .map((cssrule: CSSRule) => {\r\n      if (isCSSStyleRule(cssrule)) {\r\n        return selectoraddprefix(cssrule, prefix);\r\n      } else if (isCSSMediaRule(cssrule)) {\r\n        prefixcssrules(Array.from(cssrule.cssRules), prefix);\r\n        return cssrule;\r\n      } else if (isCSSImportRule(cssrule)) {\r\n        //把url放入\r\n        savestyleblob(prefix, undefined, cssrule.href);\r\n        return;\r\n      } else {\r\n        return cssrule;\r\n      }\r\n    })\r\n    .filter(Boolean) as Array<CSSRule>;\r\n}\r\n\r\nconst componentsstylesheet: Record<string, Set<string>> =\r\n  // { [key: string]: Set<string> }\r\n  {};\r\nexport { componentsstylesheet };\r\nexport function savestyleblob(\r\n  tagname: string,\r\n  csstext?: string,\r\n  urltext?: string\r\n) {\r\n  tagname = tagname.toLowerCase();\r\n  if (!componentsstylesheet[tagname]) {\r\n    componentsstylesheet[tagname] = new Set();\r\n  }\r\n  if (csstext) {\r\n    componentsstylesheet[tagname].add(createcssBlob(csstext));\r\n  } else if (urltext) {\r\n    componentsstylesheet[tagname].add(urltext);\r\n  }\r\n}\r\nexport function cssrulestocsstext(cssrules: Array<CSSRule>): string {\r\n  return cssrules.map(c => c.cssText).join(\"\\n\");\r\n  // .replace(/\\n/g, \"\");\r\n}\r\nexport function createlinkstylesheet(url: string): HTMLLinkElement {\r\n  return render(\r\n    createElement(\"link\", { href: url, rel: \"stylesheet\" })\r\n  ) as HTMLLinkElement;\r\n}\r\nexport function transformcsstext(text: string, prefix: string): string {\r\n  const css = text;\r\n  const cssomold = parsecsstext(css);\r\n  const cssomnew = prefixcssrules(cssomold, prefix).filter(Boolean);\r\n  //   console.log([css, prefix, cssomold, cssomnew]);\r\n  const cssnewtext = cssrulestocsstext(cssomnew);\r\n  //   console.log([text, cssomold, cssomnew, cssnewtext]);\r\n  return cssnewtext;\r\n}\r\nexport function registercssprefix(text: string, prefix: string) {\r\n  const css = text;\r\n  const cssnewtext = transformcsstext(css, prefix);\r\n  //   cssnewtext.forEach(url => {\r\n  /* 把css文字转成url放入 */\r\n  savestyleblob(prefix, cssnewtext);\r\n  //   });\r\n}\r\nexport function loadlinkstyle(\r\n  stylelinkelement: HTMLElement,\r\n  container: HTMLElement | Element | SVGSVGElement | SVGElement\r\n): Promise<void> {\r\n  return new Promise(rs => {\r\n    const loaderrorfun = () => {\r\n      stylelinkelement.onload = stylelinkelement.onerror = null;\r\n      rs();\r\n      //   console.log(stylelinkelement.href);\r\n    };\r\n    stylelinkelement.onload = loaderrorfun;\r\n    stylelinkelement.onerror = loaderrorfun;\r\n    appendchild(container, stylelinkelement);\r\n  });\r\n}\r\n\r\nexport async function waitloadallstyle(\r\n  prefix: string,\r\n  _this: Element | HTMLElement | SVGSVGElement | SVGElement\r\n) {\r\n  await Promise.all(\r\n    [...componentsstylesheet[prefix]].map(styleurl =>\r\n      loadlinkstyle(createlinkstylesheet(styleurl), _this)\r\n    )\r\n  );\r\n}\r\n","export default function<T extends object>(target: T): T {\r\n  return new Proxy(target, {\r\n    set() {\r\n      return true;\r\n    },\r\n    defineProperty() {\r\n      return false;\r\n    },\r\n    deleteProperty() {\r\n      return false;\r\n    },\r\n    setPrototypeOf() {\r\n      return false;\r\n    }\r\n  });\r\n}\r\n","export const readysymbol = Symbol(\"readystate\");\r\n","export function setimmediate(fun: Function) {\r\n  return Promise.resolve().then(() => fun());\r\n}\r\n","export const innerwatchrecords = Symbol(\"innerwatchrecord\");\r\nexport const innerstatesymbol = Symbol(\"innerstate\");\r\nimport createeleattragentreadwrite from \"@masx200/dom-element-attribute-agent-proxy\";\r\nimport { AttrChange, attributeChangedCallback } from \"./attrchange\";\r\nimport {\r\n  closectx,\r\n  getMounted,\r\n  getstates,\r\n  getUnMounted,\r\n  getwatchrecords,\r\n  invalid_Function,\r\n  openctx\r\n} from \"./context-mounted-unmounted\";\r\nimport createstate from \"./createstate\";\r\nimport { Custom } from \"./customclass\";\r\nimport { seteletext } from \"./dom\";\r\nimport { onmounted, onunmounted } from \"./element-onmount-unmount\";\r\nimport { isvalidvdom } from \"./html\";\r\n// import { Promise } from \"q\";\r\n// import { inflate } from \"zlib\";\r\nimport { componentsymbol } from \"./iscomponent\";\r\n// import { insertfirst } from \"./dom\";\r\nimport mount from \"./mount-real-element\";\r\nimport { /* createApp, */ invalid_Virtualdom } from \"./MountElement\";\r\nimport {\r\n  /* parsecsstext,\r\n          prefixcssrules,\r\n          cssrulestocsstext, */\r\n  //   savestyleblob,\r\n  componentsstylesheet,\r\n  //   createlinkstylesheet,\r\n  //   transformcsstext,\r\n  registercssprefix,\r\n  /*  loadlinkstyle,\r\n          createlinkstylesheet */\r\n  //   savestyleblob\r\n  waitloadallstyle\r\n} from \"./parsecss-transformcss\";\r\nimport ReactiveState /* , { dispatchsymbol } */ from \"./reactivestate\";\r\nimport readonlyproxy from \"./readonlyproxy\";\r\nimport { readysymbol } from \"./readysymbol\";\r\nimport { apply, get } from \"./reflect\";\r\nimport render from \"./render-vdom-to-real\";\r\nimport { setimmediate } from \"./setimmediate\";\r\nimport { toArray } from \"./toArray\";\r\nimport { isArray, isfunction, isobject, isstring } from \"./util\";\r\n// import { Class } from \"./rendervdomtoreal\";\r\nimport Virtualdom from \"./VirtualElement\";\r\nconst attributessymbol = Symbol(\"attributes\");\r\nconst elementsymbol = Symbol(\"innerelement\");\r\nconst vdomsymbol = Symbol(\"innervdom\");\r\nconst mountedsymbol = Symbol(\"mounted\");\r\nconst unmountedsymbol = Symbol(\"unmounted\");\r\nexport interface Htmlelementconstructor {\r\n  new (): HTMLElement;\r\n  prototype: HTMLElement;\r\n  defaultProps?: Record<string, any>;\r\n  css?: string;\r\n}\r\n\r\nexport function createComponent(custfun: Custom): Htmlelementconstructor {\r\n  if (isfunction(custfun)) {\r\n    const defaultProps = get(custfun, \"defaultProps\"); //custfun[\"defaultProps\"];\r\n    const css = get(custfun, \"css\");\r\n    class Component extends AttrChange {\r\n      [innerwatchrecords]: [ReactiveState<any>, Function][];\r\n      [attributessymbol]: Record<string, ReactiveState<any>> = {};\r\n      // new (propsjson?: object | undefined, children?: any[] | undefined): HTMLElement\r\n\r\n      //   constructor(...args: any[]);\r\n      constructor(\r\n        propsjson: object = {},\r\n        children: any[] = [] /* , options?: any */ //   : HTMLElement;\r\n      ) {\r\n        super();\r\n        // this[attributessymbol] = {};\r\n        const css = get(this.constructor, \"css\");\r\n\r\n        if (css) {\r\n          const prefix = this.tagName.toLowerCase();\r\n          if (!componentsstylesheet[prefix]) {\r\n            registercssprefix(css, prefix);\r\n            /* 把css文本先解析成cssom ,然后添加前缀,然后转成字符串,生成blob,再生成link-stylesheet,添加*/\r\n            /* const cssomold = parsecsstext(css);\r\n                const cssomnew = prefixcssrules(cssomold, prefix);\r\n                //   console.log([css, prefix, cssomold, cssomnew]);\r\n                const cssnewtext = cssrulestocsstext(cssomnew); */\r\n            // const cssnewtext = transformcsstext(css, prefix);\r\n            // savestyleblob(prefix, cssnewtext);\r\n            // console.log(cssnewtext, componentsstylesheet);\r\n          }\r\n        }\r\n        const defaultProps = get(this.constructor, \"defaultProps\");\r\n        // this.constructor[\"defaultProps\"];\r\n        const attrs: Record<string, any> = createeleattragentreadwrite(this);\r\n        //   const props = {};\r\n        if (isobject(defaultProps)) {\r\n          Object.assign(attrs, defaultProps);\r\n          // Object.assign(props, this.constructor[\"defaultProps\"]);\r\n        }\r\n        if (isobject(propsjson)) {\r\n          Object.assign(attrs, propsjson);\r\n          // Object.assign(props, propsjson);\r\n        }\r\n        // console.log({ ...attrs });\r\n        //   this[attributessymbol] = createeleattragentreadwrite(this);\r\n        // const props = createeleattragentreadwrite(this);/\r\n        const props = attrs;\r\n        openctx();\r\n\r\n        const thisattributess = Object.fromEntries(\r\n          Object.entries(props).map(([key, value]) => [key, createstate(value)])\r\n        );\r\n        this[attributessymbol] = thisattributess;\r\n        // console.log({ props, thisattributess });\r\n        // debugger;\r\n        /* 把attributes的reactivestates也放进innerstates中 */\r\n        const readonlyprop = readonlyproxy(\r\n          Object.fromEntries(\r\n            Object.entries(thisattributess).map(([key, value]) => [\r\n              key,\r\n              readonlyproxy(value)\r\n            ])\r\n          )\r\n        );\r\n\r\n        let possiblyvirtualdom:\r\n          | string\r\n          | Virtualdom<any>\r\n          | ReactiveState<any>\r\n          | (string | Virtualdom<any> | ReactiveState<any>)[]\r\n          | any;\r\n        try {\r\n          possiblyvirtualdom = apply(custfun, undefined, [\r\n            readonlyprop,\r\n            children.flat(1 / 0)\r\n          ]);\r\n          /* custfun.call(\r\n            undefined,\r\n            //让组件里面无法修改props的reactivestate的value\r\n            // readonlyproxy(thisattributess),\r\n            readonlyprop,\r\n            children */\r\n          // );\r\n        } catch (error) {\r\n          closectx();\r\n          console.error(error);\r\n          throw error;\r\n        }\r\n\r\n        if (isArray(possiblyvirtualdom)) {\r\n          possiblyvirtualdom = possiblyvirtualdom\r\n            .flat(Infinity)\r\n            .filter(Boolean);\r\n        }\r\n        if (isvalidvdom(possiblyvirtualdom)) {\r\n          const thisvdomsymbol /* isArray(possiblyvirtualdom)\r\n                ? possiblyvirtualdom\r\n                : [possiblyvirtualdom]; */ = toArray(\r\n            possiblyvirtualdom\r\n          );\r\n          //\r\n          this[vdomsymbol] = thisvdomsymbol.flat(Infinity).filter(Boolean);\r\n          this[mountedsymbol] = getMounted();\r\n          this[unmountedsymbol] = getUnMounted();\r\n          this[innerstatesymbol] = getstates();\r\n          this[innerwatchrecords] = getwatchrecords();\r\n          closectx();\r\n        } else {\r\n          closectx();\r\n          console.error(possiblyvirtualdom);\r\n          console.error(invalid_Virtualdom);\r\n          throw TypeError();\r\n        }\r\n\r\n        //   this[mountedsymbol] = getMounted();\r\n        //   this[unmountedsymbol] = getUnMounted();\r\n      }\r\n      //   prototype!: HTMLElement;\r\n      //   defaultProps?: { [key: string]: any } | undefined;\r\n      //  css?: string | undefined;\r\n      [innerstatesymbol]: Array<ReactiveState<any>>;\r\n      static [componentsymbol] = componentsymbol;\r\n      static css = isstring(css) && css ? css : undefined;\r\n      [readysymbol] = false;\r\n      [mountedsymbol]: Array<Function>;\r\n      [unmountedsymbol]: Array<Function>;\r\n      static defaultProps = isobject(defaultProps)\r\n        ? JSON.parse(JSON.stringify(defaultProps))\r\n        : undefined;\r\n\r\n      [elementsymbol]: Array<Node>;\r\n      [vdomsymbol]: Array<\r\n        Virtualdom<any> | ReactiveState<any> | string | number\r\n      >;\r\n\r\n      async connectedCallback() {\r\n        if (!this[elementsymbol]) {\r\n          this[elementsymbol] = render(this[vdomsymbol]).flat(Infinity);\r\n        }\r\n        if (!this[readysymbol]) {\r\n          this[readysymbol] = true;\r\n          /* 这段代码只在初始化时执行一次 */\r\n          //   mount(this[elementsymbol], this, false);\r\n\r\n          const css = get(this.constructor, \"css\");\r\n          const prefix = this.tagName.toLowerCase();\r\n          if (css && componentsstylesheet[prefix]) {\r\n            /* 先清空当前组件 的children */\r\n\r\n            seteletext(this, \"\");\r\n            /* 应该要等待css加载完成之后再渲染出来,否则会有页面跳动 */\r\n            /* 是css里面的@import导致的 */\r\n            /* 挂载样式到组件最前面 */\r\n            //   console.log(componentsstylesheet[prefix]);\r\n            // if (componentsstylesheet[prefix]) {\r\n            /* const stylelinkelement = createlinkstylesheet(\r\n              componentsstylesheet[prefix]\r\n            ); */\r\n            /*   stylelinkelement.onload = () => {\r\n              mount(this[elementsymbol], this, false);\r\n            };\r\n            stylelinkelement.onerror = () => {\r\n              mount(this[elementsymbol], this, false);\r\n            }; */\r\n            // insertfirst(this, stylelinkelement);\r\n            // }\r\n            /*  Promise.all(\r\n              [...componentsstylesheet[prefix]].map(styleurl =>\r\n                loadlinkstyle(createlinkstylesheet(styleurl), this)\r\n              )\r\n            )\r\n*/\r\n            waitloadallstyle(prefix, this).then(() => {\r\n              //   console.log(\"style load all\");\r\n              //   console.log(\"mount1\");\r\n              mount(this[elementsymbol], this, false);\r\n            });\r\n          } else {\r\n            // console.log(\"mount2\");\r\n            mount(this[elementsymbol], this);\r\n          }\r\n        }\r\n        //把mounted callback 异步执行\r\n        this[mountedsymbol].forEach(f => {\r\n          setimmediate(f);\r\n        });\r\n        onmounted(this);\r\n      }\r\n      async disconnectedCallback() {\r\n        this[unmountedsymbol].forEach(f => {\r\n          setimmediate(f);\r\n        });\r\n\r\n        onunmounted(this);\r\n      }\r\n      [attributeChangedCallback](\r\n        name: string /* , oldValue: any, newValue: any */\r\n      ) {\r\n        // console.log(this[attributessymbol]);\r\n        const propreactivestate = this[attributessymbol][name];\r\n        const attributes = createeleattragentreadwrite(this) as Record<\r\n          string,\r\n          any\r\n        >;\r\n        if (propreactivestate) {\r\n          propreactivestate[\"value\"] = attributes[name];\r\n          /* 当属性改变时要跟ReactiveState同步状态 */\r\n          /*   set(\r\n            get(this, attributessymbol)[name],\r\n            \"value,\",\r\n            (createeleattragentreadwrite(this) as { [key: string]: any })[\r\n              name\r\n            ] as any */\r\n          //   );\r\n          /*   this[attributessymbol][name].value = createeleattragentreadwrite(\r\n            this\r\n          )[name]; */\r\n          //   this[attributessymbol][name][dispatchsymbol]();\r\n        }\r\n      }\r\n    }\r\n\r\n    return Component;\r\n  } else {\r\n    console.error(custfun);\r\n    console.error(invalid_Function);\r\n    throw TypeError();\r\n  }\r\n}\r\n","import { innerstatesymbol, innerwatchrecords } from \"./createComponent\";\r\nimport { getdomchildren } from \"./dom\";\r\nimport { readdlisteners, removelisteners } from \"./handle-onevent\";\r\nimport { isNode } from \"./MountElement\";\r\nimport ReactiveState, {\r\n  addonelistner,\r\n  callbackmap,\r\n  removeonelistner,\r\n  dispatchsymbol\r\n} from \"./reactivestate\";\r\nimport { get, has } from \"./reflect\";\r\nimport { bindstatesymbol } from \"./render-vdom-to-real\";\r\nimport { isArray } from \"./util\";\r\nimport { rewatch /* , unwatch */, unwatch } from \"./watch\";\r\n\r\nexport function onmounted(ele: Element | Node | Array<Node>) {\r\n  if (isArray(ele)) {\r\n    ele.forEach(e => {\r\n      onmounted(e);\r\n    });\r\n  } else if (\r\n    isNode(ele)\r\n    //   ele instanceof Node\r\n  ) {\r\n    // if (has(ele, eventlistenerssymbol)) {\r\n    readdlisteners(ele);\r\n    // }\r\n    //全局共享状态\r\n    if (\r\n      has(ele, bindstatesymbol)\r\n      // ele[bindstatesymbol]\r\n    ) {\r\n      (get(ele, bindstatesymbol) as ReactiveState<any>[])\r\n\r\n        /*  ele[bindstatesymbol] */\r\n        .forEach((state: ReactiveState<any>) => {\r\n          rewatch(state);\r\n\r\n          /* 当组件挂载时把状态跟dom元素同步一次 */\r\n          state[dispatchsymbol]();\r\n        });\r\n    }\r\n    if (\r\n      has(ele, innerstatesymbol)\r\n      //   ele[innerstatesymbol]\r\n    ) {\r\n      (get(ele, innerstatesymbol) as ReactiveState<any>[]).forEach(\r\n        (state: ReactiveState<any>) => {\r\n          rewatch(state);\r\n        }\r\n      );\r\n    }\r\n    // readdlisteners(ele);\r\n    /* 记录组件中使用的watch的state和callback,\r\n组件卸载时removeeventlistener,\r\n组件挂载时addeventlistener\r\n*/\r\n    if (has(ele, innerwatchrecords)) {\r\n      const watchrecords = get(ele, innerwatchrecords) as [\r\n        ReactiveState<any>,\r\n        Function\r\n      ][];\r\n      watchrecords.forEach(([state, callback]) => {\r\n        const eventlistener = state[callbackmap].get(callback);\r\n        if (!eventlistener) {\r\n          throw new Error();\r\n        }\r\n        state[addonelistner](eventlistener);\r\n      });\r\n    }\r\n    onmounted(getdomchildren(ele));\r\n  }\r\n\r\n  //\r\n}\r\nexport function onunmounted(ele: Element | Node | Array<Node>) {\r\n  if (isArray(ele)) {\r\n    ele.forEach(e => {\r\n      onunmounted(e);\r\n    });\r\n  } else if (\r\n    isNode(ele)\r\n    //   ele instanceof Node\r\n  ) {\r\n    // if (\r\n    //   has(ele, eventlistenerssymbol)\r\n    //   // ele[eventlistenerssymbol]\r\n    // ) {\r\n    removelisteners(ele);\r\n    // }\r\n    /*   if (ele[bindstatesymbol]) {\r\n      ele[bindstatesymbol].forEach((state: ReactiveState) => {\r\n        unwatch(state);\r\n      });\r\n */\r\n    // readdlisteners(ele);\r\n    // }\r\n    //\r\n    /* 组件卸载时unwatch组件内部的 ReactiveState*/\r\n    if (\r\n      has(ele, innerstatesymbol)\r\n      // ele[innerstatesymbol]\r\n    ) {\r\n      (get(ele, innerstatesymbol) as ReactiveState<any>[]).forEach(\r\n        (state: ReactiveState<any>) => {\r\n          unwatch(state);\r\n        }\r\n      );\r\n    }\r\n    if (has(ele, innerwatchrecords)) {\r\n      const watchrecords = get(ele, innerwatchrecords) as [\r\n        ReactiveState<any>,\r\n        Function\r\n      ][];\r\n      watchrecords.forEach(([state, callback]) => {\r\n        const eventlistener = state[callbackmap].get(callback);\r\n        if (!eventlistener) {\r\n          throw new Error();\r\n        }\r\n        state[removeonelistner](eventlistener);\r\n      });\r\n    }\r\n    onunmounted(getdomchildren(ele));\r\n  }\r\n}\r\n","import createeleattr from \"@masx200/dom-element-attribute-agent-proxy\";\r\nimport { AttrChange, attributeChangedCallback } from \"./attrchange\";\r\nimport { invalid_Virtualdom } from \"./MountElement\";\r\nimport createElement from \"./createelement\";\r\nimport { setelehtml } from \"./dom\";\r\n// const readysymbol = Symbol(\"ready\");\r\nimport { onmounted, onunmounted } from \"./element-onmount-unmount\";\r\nimport { isvalidvdom } from \"./html\";\r\nimport { componentsymbol } from \"./iscomponent\";\r\nimport mount from \"./mount-real-element\";\r\nimport ReactiveState, { isReactiveState } from \"./reactivestate\";\r\nimport { readysymbol } from \"./readysymbol\";\r\nimport { get } from \"./reflect\";\r\nimport render from \"./render-vdom-to-real\";\r\n// import mount from \"./mount\";\r\nimport { isboolean, isundefined } from \"./util\";\r\n// import createElement from \"./createelement\";\r\nimport Virtualdom, { Vdomchildren } from \"./VirtualElement\";\r\nimport { Htmlelementconstructor } from \"./createComponent\";\r\nexport type VaildVDom =\r\n  | Virtualdom<any>\r\n  | string\r\n  | number\r\n  | Vdomchildren\r\n  | ReactiveState<any>;\r\n// import { readysymbol } from \"./createComponent\";\r\nexport const invalid_ReactiveState = \"invalid ReactiveState\";\r\nconst truevdomsymbol = Symbol(\"truevdom\");\r\nconst falsevdomsymbol = Symbol(\"falsevdom\");\r\nconst trueelesymbol = Symbol(\"trueele\");\r\nconst falseelesymbol = Symbol(\"falseele\");\r\nconst handletrue = Symbol(\"handletrue\");\r\nconst handlefalse = Symbol(\"handlefalse\");\r\n\r\nexport default function(\r\n  conditon: ReactiveState<any> | boolean,\r\n  iftrue?: VaildVDom,\r\n  iffalse?: VaildVDom\r\n): Virtualdom<Htmlelementconstructor> {\r\n  if (!(isReactiveState(conditon) || isboolean(conditon))) {\r\n    console.error(conditon);\r\n    console.error(invalid_ReactiveState);\r\n    throw TypeError();\r\n  }\r\n  [iftrue, iffalse].forEach(a => {\r\n    if (!(isundefined(a) || isvalidvdom(a))) {\r\n      console.error(a);\r\n      console.error(invalid_Virtualdom);\r\n      throw new TypeError();\r\n    }\r\n  });\r\n  const options = { true: iftrue, false: iffalse };\r\n  class Condition extends AttrChange {\r\n    // prototype!: HTMLElement;\r\n    // defaultProps?: { [key: string]: any } | undefined;\r\n    // css?: string | undefined;\r\n    static [componentsymbol] = componentsymbol;\r\n    [readysymbol] = false;\r\n    constructor() /* propsjson?: object, children?: any[], options: object = {} */ {\r\n      super();\r\n      // if(){}\r\n      const optionstrue = get(options, \"true\");\r\n      const optionsfalse = get(options, \"false\");\r\n      this[truevdomsymbol] =\r\n        /*isarray(optionstrue)\r\n        ? optionstrue.filter(Boolean)\r\n        : */\r\n        [optionstrue].flat(1 / 0).filter(Boolean);\r\n      this[falsevdomsymbol] =\r\n        /* isarray(optionsfalse)\r\n        ? optionsfalse.filter(Boolean)\r\n        : */\r\n\r\n        [optionsfalse].flat(1 / 0).filter(Boolean);\r\n      // optionsfalse;\r\n    }\r\n    [falseelesymbol]: any[];\r\n    [trueelesymbol]: any[];\r\n    [truevdomsymbol]: any[];\r\n    [falsevdomsymbol]: any[];\r\n    //   [readysymbol] = false;\r\n    [handlefalse]() {\r\n      setelehtml(this, \"\");\r\n      if (this[falsevdomsymbol]) {\r\n        if (!this[falseelesymbol]) {\r\n          // } else {\r\n          this[falseelesymbol] = render(this[falsevdomsymbol]);\r\n          // this[falsevdomsymbol].map(e => render(e));\r\n        }\r\n        //   mount(this[falseelesymbol], this);\r\n        const elementtomount = this[falseelesymbol];\r\n        mount(elementtomount, this);\r\n        elementtomount.forEach(e => onmounted(e));\r\n        if (this[trueelesymbol]) {\r\n          this[trueelesymbol].forEach(e => onunmounted(e));\r\n        }\r\n      }\r\n    }\r\n    [handletrue]() {\r\n      setelehtml(this, \"\");\r\n      if (this[truevdomsymbol]) {\r\n        if (!this[trueelesymbol]) {\r\n          this[trueelesymbol] = render(this[truevdomsymbol]);\r\n          // this[truevdomsymbol].map(e => render(e));\r\n        }\r\n        //\r\n        //   mount(this[trueelesymbol], this);\r\n        const elementtomount = this[trueelesymbol];\r\n        mount(elementtomount, this);\r\n        elementtomount.forEach(e => onmounted(e));\r\n        if (this[falseelesymbol]) {\r\n          this[falseelesymbol].forEach(e => onunmounted(e));\r\n        }\r\n      }\r\n    }\r\n    async connectedCallback() {\r\n      if (!this[readysymbol]) {\r\n        // createApp(this[elementsymbol], this);\r\n        this[readysymbol] = true;\r\n\r\n        const attrs: { [key: string]: any } = createeleattr(this);\r\n        // console.log(attrs);\r\n        if (true === attrs[\"value\"]) {\r\n          get(this, handletrue).call(this);\r\n        }\r\n        if (false === attrs[\"value\"]) {\r\n          get(this, handlefalse).call(this);\r\n          //\r\n        }\r\n      }\r\n      onmounted(this);\r\n      //\r\n    }\r\n    async disconnectedCallback() {\r\n      onunmounted(this);\r\n    }\r\n\r\n    async [attributeChangedCallback](\r\n      name: string /* , oldValue: any, newValue: any */\r\n    ) {\r\n      if (this[readysymbol]) {\r\n        // console.log(name, oldValue, newValue);\r\n        if (name === \"value\") {\r\n          const attrs: { [key: string]: any } = createeleattr(this);\r\n          //   console.log(attrs);\r\n          if (true === attrs[\"value\"]) {\r\n            this[handletrue]();\r\n            //\r\n          }\r\n          if (false === attrs[\"value\"]) {\r\n            this[handlefalse]();\r\n            //\r\n          }\r\n        }\r\n\r\n        //\r\n      }\r\n    }\r\n  }\r\n  /* vdom.options = { true: iftrue, false: iffalse }; */\r\n  const vdom = createElement(Condition, { value: conditon });\r\n  return vdom;\r\n  /*  */\r\n}\r\n","/* interface CallbackReactiveState<\r\n \r\n> {\r\n  (...args: T[]): any;\r\n} */\r\nimport { invalid_ReactiveState } from \"./conditon\";\r\nimport { invalid_Function, usestste } from \"./context-mounted-unmounted\";\r\nimport ReactiveState, {\r\n  dispatchsymbol,\r\n  isReactiveState\r\n} from \"./reactivestate\";\r\nimport readonlyproxy from \"./readonlyproxy\";\r\nimport {\r\n  apply,\r\n  //   getPrototypeOf\r\n  //   set\r\n  defineProperty,\r\n  //   deleteProperty,\r\n  get,\r\n  //   getOwnPropertyDescriptor,\r\n  has,\r\n  ownKeys,\r\n  getOwnPropertyDescriptor\r\n} from \"./reflect\";\r\nimport { toArray } from \"./toArray\";\r\nimport { isArray, isFunction, isobject, isprimitive, issymbol } from \"./util\";\r\nimport { CallbackReactiveState, UnwrapedState, watch } from \"./watch\";\r\n\r\n//const { defineProperty } = Object;\r\nexport default function<T extends UnwrapedState>(\r\n  state: ReactiveState<T> | Array<ReactiveState<T>>,\r\n  callback: CallbackReactiveState\r\n): ReactiveState<any> {\r\n  if (\r\n    !(\r\n      (isArray(state) || isReactiveState(state)) &&\r\n      // state instanceof ReactiveState\r\n      isFunction(callback)\r\n    )\r\n  ) {\r\n    console.error(state);\r\n    console.error(callback);\r\n    console.error(invalid_ReactiveState + invalid_Function);\r\n\r\n    throw TypeError();\r\n  }\r\n  const state1array: ReactiveState<T>[] =\r\n    //   if (isReactiveState(state)) {\r\n    toArray(state);\r\n  if (!state1array.length) {\r\n    console.error(\"Empty array not allowed\");\r\n    throw new Error();\r\n  }\r\n  /*  state1 = Arraycomputed(\r\n      toArray(state),\r\n\r\n      callback\r\n    ); */\r\n  //   } else if (isArray(state)) {\r\n  //     state1array = state;\r\n  //     // state1 = Arraycomputed(state, callback);\r\n  //   } else {\r\n  //     state1array = Array.from(state);\r\n  //   }\r\n  const state1 = Arraycomputed(state1array, callback);\r\n  usestste(state1);\r\n  return state1;\r\n}\r\n\r\nfunction Arraycomputed<T extends UnwrapedState>(\r\n  state: ReactiveState<T>[],\r\n  callback: CallbackReactiveState\r\n): ReactiveState<any> {\r\n  const reactivestate = new ReactiveState();\r\n  const getter = () => {\r\n    //自动解包\r\n    const value = apply(callback, undefined, state.map(st => st.valueOf()));\r\n    // callback(...state.map(st => st.valueOf()));\r\n    const possiblevalue = isReactiveState(value) ? value.valueOf() : value;\r\n\r\n    if (isobject(possiblevalue) || isprimitive(possiblevalue)) {\r\n      return possiblevalue;\r\n    } else {\r\n      console.error(possiblevalue);\r\n      throw TypeError();\r\n    }\r\n  };\r\n\r\n  let memorized = getter();\r\n\r\n  // if (isFunction(memorized)) {\r\n  //   console.error(memorized);\r\n  //   throw new TypeError();\r\n  // }\r\n  defineProperty(reactivestate, \"value\", {\r\n    get: getter,\r\n    configurable: true\r\n  });\r\n\r\n  state.forEach(state => {\r\n    watch(state, () => {\r\n      let newvalue = getter();\r\n      if (newvalue !== memorized) {\r\n        reactivestate[dispatchsymbol]();\r\n\r\n        memorized = newvalue;\r\n      }\r\n      //\r\n    });\r\n  });\r\n\r\n  return readonlyproxy(getproperyreadproxy(reactivestate));\r\n}\r\nconst __proto__ = \"__proto__\";\r\nexport function getproperyreadproxy<T extends object>(a: T): T;\r\nexport function getproperyreadproxy(a: object) {\r\n  /* 把基本类型原型的属性 也加上*/\r\n  //   const target = isobject(a) ? a : getPrototypeOf(a);\r\n  const target = a;\r\n  return new Proxy(target, {\r\n    getOwnPropertyDescriptor(target, key) {\r\n      //对于symbol属性，返回undefined\r\n      if (issymbol(key)) {\r\n        return;\r\n      } else {\r\n        return getOwnPropertyDescriptor(target, key);\r\n      }\r\n    },\r\n    ownKeys(target) {\r\n      let myvalue = get(target, \"value\");\r\n      const myvalueobj = isobject(myvalue) ? myvalue : myvalue[__proto__];\r\n      //   return ownKeys(target);\r\n      return Array.from(new Set([...ownKeys(target), ...ownKeys(myvalueobj)]));\r\n\r\n      /* Array.from(\r\n        new Set([...ownKeys(target), ...ownKeys(get(target, \"value\"))])\r\n      ); */\r\n    },\r\n    has(target, key) {\r\n      const myvalue = get(target, \"value\");\r\n      const myvalueobj = isobject(myvalue) ? myvalue : myvalue[__proto__];\r\n      return has(target, key) || has(myvalueobj, key);\r\n    },\r\n    get(target, key) {\r\n      if (has(target, key)) {\r\n        return get(target, key);\r\n      } else {\r\n        const myvalue = get(target, \"value\");\r\n        const myvalueobj = isobject(myvalue) ? myvalue : Object(myvalue);\r\n\r\n        if (has(myvalueobj, key)) {\r\n          /* 对于string,number等原始类型,返回的函数要绑定this */\r\n          const property = get(myvalueobj, key);\r\n          return isFunction(property) ? property.bind(myvalueobj) : property;\r\n        }\r\n      }\r\n      //   return get(target, key);\r\n      /*  const myvalue = get(target, \"value\");\r\n\r\n      if (has(target, key)) {\r\n        return get(target, key);\r\n      } else if (has(myvalue, key)) {\r\n        return get(myvalue, key);\r\n      } */\r\n    }\r\n  });\r\n}\r\n","interface Ref<T = any | undefined> {\r\n  value: T | undefined;\r\n}\r\n\r\nexport default function createRef<T = any | undefined>(value?: T): Ref<T> {\r\n  return { value };\r\n}\r\n","import { invalid_ReactiveState } from \"./conditon\";\r\nimport { invalid_Virtualdom } from \"./MountElement\";\r\nimport directives from \"./extend-directive\";\r\nimport ReactiveState, {\r\n  // ReactiveState,\r\n  isReactiveState\r\n} from \"./reactivestate\";\r\nimport { set, get } from \"./reflect\";\r\nimport { toArray } from \"./toArray\";\r\nimport Virtualdom from \"./VirtualElement\";\r\ndirectives({\r\n  value(value, element, vdom) {\r\n    model(\r\n      [\"input\", \"textarea\", \"select\"],\r\n      \"value\",\r\n      \"value\",\r\n      [\"change\", \"input\"],\r\n      value,\r\n      vdom\r\n    );\r\n  },\r\n  checked(value, element, vdom) {\r\n    model([\"input\"], \"checked\", \"checked\", [\"change\", \"input\"], value, vdom);\r\n  }\r\n});\r\nfunction model(\r\n  types: string[],\r\n  bindattribute: string,\r\n  domprop: string,\r\n  eventnames: string[],\r\n  value: ReactiveState<any>,\r\n  vdom: Virtualdom<any>\r\n) {\r\n  if (!isReactiveState(value)) {\r\n    console.error(value);\r\n    console.error(invalid_ReactiveState + invalid_Virtualdom);\r\n    throw TypeError();\r\n  }\r\n  if (types.includes(vdom.type)) {\r\n    // const vdom = virtualdom;\r\n    set(vdom.bindattr, bindattribute, value);\r\n    /*  [\r\n      // vdom.bindattr[\"checked\"] = value;\r\n      \"change\",\r\n      \"input\"\r\n    ]. */\r\n\r\n    eventnames.forEach(eventname => {\r\n      const origin = vdom.onevent[eventname];\r\n\r\n      const eventsarray = toArray(origin);\r\n\r\n      set(\r\n        vdom.onevent,\r\n        eventname,\r\n        [\r\n          ...eventsarray,\r\n\r\n          (e: any) => {\r\n            return (value.value = get(e.target, domprop));\r\n          }\r\n        ].filter(Boolean)\r\n      );\r\n    });\r\n  } else {\r\n    console.error(vdom);\r\n    console.error(invalid_ReactiveState + invalid_Virtualdom);\r\n    throw TypeError();\r\n  }\r\n}\r\n\r\n/* directives({\r\n  value(_element: Element, value: ReactiveState<any>, vdom: Virtualdom<any>) {\r\n    // console.log(vdom);\r\n    if (\r\n      isReactiveState(value) &&\r\n      //   value instanceof ReactiveState\r\n\r\n      (vdom.type === \"input\" ||\r\n        vdom.type === \"textarea\" ||\r\n        vdom.type === \"select\")\r\n    ) {\r\n      vdom.bindattr[\"value\"] = value;\r\n      [\"change\", \"input\"].forEach(eventname => {\r\n        const origin = vdom.onevent[eventname];\r\n\r\n        const eventsarray = toArray(origin);\r\n\r\n        set(\r\n          vdom.onevent,\r\n          eventname,\r\n          [\r\n            ...eventsarray,\r\n\r\n            (e: any) => {\r\n              return (value.value = e.target.value);\r\n            }\r\n          ].filter(Boolean)\r\n        );\r\n      });\r\n    } else {\r\n      console.log(_element);\r\n      console.error(value);\r\n      console.error(vdom);\r\n      console.error(invalid_ReactiveState + invalid_Virtualdom);\r\n      throw TypeError();\r\n    }\r\n  }\r\n});\r\ndirectives({\r\n  checked(_element: Element, value: ReactiveState<any>, vdom: Virtualdom<any>) {\r\n    // console.log(vdom);\r\n    if (\r\n      isReactiveState(value) &&\r\n      //   value instanceof ReactiveState\r\n\r\n      vdom.type === \"input\"\r\n    ) {\r\n      vdom.bindattr[\"checked\"] = value;\r\n      [\"change\", \"input\"].forEach(eventname => {\r\n        const origin = vdom.onevent[eventname];\r\n\r\n        const eventsarray = toArray(origin);\r\n\r\n        set(\r\n          vdom.onevent,\r\n          eventname,\r\n          [\r\n            ...eventsarray,\r\n\r\n            (e: any) => {\r\n              return (value.value = e.target.checked);\r\n            }\r\n          ].filter(Boolean)\r\n        );\r\n      });\r\n    } else {\r\n      console.log(_element);\r\n      console.error(value);\r\n      console.error(vdom);\r\n      console.error(invalid_ReactiveState + invalid_Virtualdom);\r\n      throw TypeError();\r\n      //throw TypeError(invalid_ReactiveState + invalid_Virtualdom);\r\n    }\r\n  }\r\n}); */\r\n"],"names":["a","isString","isnumber","isboolean","isundefined","issymbol","isplainobject","isobject","gettagtype","isstring","isfunction","isarray","Array","isArray","toString","call","replace","trim","isSet","Set","HTMLElement","customElements","Proxy","window","console","error","TypeError","hyphenateRE","hyphenate","str","toLowerCase","String","Reflect","get","set","ownKeys","valuestring","isinputcheckbox","ele","geteletagname","objtostylestring","obj","JSON","parse","stringify","Object","fromEntries","entries","map","key","value","join","asserthtmlelement","Element","createeleattragentreadwrite","temp","create","outputattrs","[object Object]","isinputtextortextareaflag","isinputtextortextarea","keys","attributesownkeys","from","undefined","flat","Infinity","filter","target","v","getattribute","t","csstext","classtext","setattribute","k","removeAttribute","includes","otherdescipter","enumerable","configurable","writable","myvalue","getAttributeNames","getAttribute","tagName","setAttribute","tagname","document","seteletext","e","textContent","setelehtml","innerHTML","appendchild","container","appendChild","createsvgelement","createElementNS","svgnamespace","createDocumentFragment","createnativeelement","type","createElement","namespace","name","createtextnode","data","createTextNode","changetext","textnode","nodeValue","mathnamespace","createmathelement","domaddlisten","event","addEventListener","domremovelisten","removeEventListener","getdomchildren","childNodes","HTMLElementprototype","prototype","createanotherhtmldocument","implementation","createHTMLDocument","apply","construct","defineProperty","deleteProperty","getOwnPropertyDescriptor","getPrototypeOf","has","attributeChangedCallback","AttrChange","qualifiedName","callback","this","oldValue","isFunction","n","r","u","p","length","s","h","assign","push","f","Map","arguments","merge_entries","m","forEach","add","isObject","freeGlobal","global","freeSelf","self","root","Function","now","Date","Symbol","objectProto","hasOwnProperty","nativeObjectToString","symToStringTag","toStringTag","getRawTag","isOwn","tag","unmasked","result","objectToString","nullTag","undefinedTag","baseGetTag","isObjectLike","symbolTag","isSymbol","NAN","reTrim","reIsBadHex","reIsBinary","reIsOctal","freeParseInt","parseInt","toNumber","other","valueOf","isBinary","test","slice","FUNC_ERROR_TEXT","nativeMax","Math","max","nativeMin","min","debounce","func","wait","options","lastArgs","lastThis","maxWait","timerId","lastCallTime","lastInvokeTime","leading","maxing","trailing","invokeFunc","time","args","thisArg","leadingEdge","setTimeout","timerExpired","remainingWait","timeSinceLastCall","timeSinceLastInvoke","timeWaiting","shouldInvoke","trailingEdge","cancel","clearTimeout","flush","debounced","isInvoking","addonelistner","removeonelistner","callbackmap","cancelsubscribe","debouncedispatch","invalid_primitive_or_object_state","isReactiveState","ReactiveState","eventtargetsymbol","memlisteners","dispatchsymbol","subscribesymbol","removeallistenerssymbol","addallistenerssymbol","init","EventTarget","isprimitive","debouncedfun","eventname","dispatchEvent","CustomEvent","detail","eventlistener","possiblecallback","Error","delete","toPrimitive","isVirtualdom","isvirtualelement","createVirtualElement","props","children","字母大小写","propsentries","propsentriesNOTevents","startsWith","字母开头的entries","thisarg","bindattr","onevent","directives","propsorchildren","typenormalized","propsnormalized","childrennormalized","html","inargs","htm","isvalidvdom","flag","every","vdom","invalid_Virtualdom","toArray","clear","eles","invalid_custom_element_class","Usevaluetoquerythekeyfromthetable","table","Componentstatusname","outputentrie","find","CustomElementRegistry","elementset","for","elementmap","initclass","extendsname","RandomDefineCustomElement","isclassextendsHTMLElement","elementname","getrandomstringandnumber","define","extends","constructor","iterator","charactorlist","fill","i","fromCharCode","hexnumberlist","charactorandnumberlist","getrandomcharactor","floor","random","getrandomhexnumberandcharactor","createcostumelemet","propsjson","isconnected","element","documentElement","getancestornode","node","parentNode","watchrecord","getwatchrecords","usewatch","state","ctxopen","clearwatch","invalid_Function","errormessage","MountedSet","UnMountedSet","StateSet","getstates","usestste","getMounted","getUnMounted","useMounted","fun","useUnMounted","clearMounted","clearstate","clearUnMounted","openctx","clearall","closectx","watch","statearray","debouncedcallback","stateandlisteners","state1","listener","watchsingle","cancelWatch","invalid_ReactiveState","requestAnimationFrame","rewatch","unwatch","extenddirectives","directive","ref","_vdom","log","createhtmlandtextdirective","text","errorname","componentsymbol","iscomponent","eventlistenerssymbol","firstaddlisteners","callarray","removelisteners","readdlisteners","bindstatesymbol","virtualdomsymbol","throwinvalideletype","render","reactive","fragmentnode","mount","handleprops","attribute1","createeleattr","primitivestate","callbacks","values","MountElement","el","body","head","elesarray","isNode","isNodeArray","arr","Node","setPrototypeOf","deepobserveaddpath","patharray","ancestor","fakeobj","argumentslist","argarray","descripter","observedeepagent","initobj","containReactiveState","some","state_entries","objproxyhandler","deepobserve","_target_","set_prototype","returnvalue","dele","size","createstate","getproperyreadproxy","handleobjectstate","createcssBlob","source","URL","createObjectURL","Blob","isCSSStyleRule","isCSSMediaRule","isCSSImportRule","parsecsstext","styleelement","otherdocument","selectoraddprefix","cssstylerule","prefix","selectorText","selectorarray","split","prefixselector","prefixcssrules","cssRulesarray","cssrule","cssRules","savestyleblob","href","Boolean","componentsstylesheet","urltext","cssrulestocsstext","cssrules","c","cssText","createlinkstylesheet","url","rel","transformcsstext","css","cssomold","cssomnew","cssnewtext","registercssprefix","loadlinkstyle","stylelinkelement","Promise","rs","loaderrorfun","onload","onerror","async","waitloadallstyle","_this","all","styleurl","readysymbol","setimmediate","resolve","then","innerwatchrecords","innerstatesymbol","attributessymbol","elementsymbol","vdomsymbol","mountedsymbol","unmountedsymbol","createComponent","custfun","defaultProps","Component","super","attrs","thisattributess","readonlyprop","readonlyproxy","possiblyvirtualdom","thisvdomsymbol","onmounted","onunmounted","propreactivestate","attributes","watchrecords","truevdomsymbol","falsevdomsymbol","trueelesymbol","falseelesymbol","handletrue","handlefalse","conditon","iftrue","iffalse","true","false","Condition","optionstrue","optionsfalse","elementtomount","state1array","Arraycomputed","reactivestate","getter","st","possiblevalue","memorized","newvalue","__proto__","myvalueobj","property","bind","createRef","model","types","bindattribute","domprop","eventnames","origin","eventsarray"],"mappings":"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"}